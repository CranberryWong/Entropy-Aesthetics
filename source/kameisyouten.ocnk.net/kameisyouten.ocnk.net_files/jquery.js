/**
 * jQuery - Collapser - Plugin v2.0
 * http://www.aakashweb.com/
 * Copyright 2014, Aakash Chakravarthy
 * Released under the MIT License.
 *
 * https://github.com/vaakash/jquery-collapser
 *
 * forked by Ochanoko-net, Inc.
 */
!function(a){"use strict";a.fn.collapser=function(b){var c=a.extend({},a.fn.collapser.defaults,b),d="collapser";return this.each(function(b,e){if(!a.data(e,d)){var f=new a.fn.collapser.Process(a.extend(!0,{},c),e);f.initHandling(),a.data(e,d,f)}}),this},a.fn.collapser.defaults={target:"next",mode:"words",speed:"slow",truncate:10,ellipsis:"...",effect:"fade",controlBtn:"",showText:"Show more",hideText:"Hide text",showClass:"elastic_shown",hideClass:"elastic_hidden",ellipsisClass:"coll_ellipsis",innerClass:"inner_elastic_box",ctrlClass:"elastic_ctrl_link",ctrlWrapperClass:"elastic_ctrl_box",modeClassPrefix:"elastic_mode_",atStart:"hide",stripTags:!1,useLinesEllipsis:!0,lockHide:!1,dynamic:!1,changeText:!1,beforeShow:null,afterShow:null,beforeHide:null,afterHide:null},a.fn.collapser.Process=function(b,c){if(!(this instanceof a.fn.collapser.Process))return new a.fn.collapser.Process(b,c);var d=this;return d.$elem=a(c),d.options=a.extend({},b,a(c).data()),d.mode=d.options.mode,d.status=0,d.remaining={},d.ctrlHtml="",this};var b=a.fn.collapser.Process.prototype;b.show=function(b,c){var d=this,e=a(b);"undefined"==typeof c&&(c=d.options.speed);var f=function(){a.isFunction(d.options.afterShow)&&d.options.afterShow.call(d.$elem,d)};switch(a.isFunction(d.options.beforeShow)&&d.options.beforeShow.call(d.$elem,d),d.mode){case"chars":case"words":var g=e.height();e.html(e.data("tHTML"));var h=e.height();e.height(g),e.animate({height:h},c,function(){e.height("auto"),f()}).removeClass(d.options.hideClass).addClass(d.options.showClass),e.data({tHTML:e.html()});break;case"lines":0==e.children("."+d.options.innerClass).length&&e.wrapInner('<div class="'+d.options.innerClass+'">');var i=e.children("."+d.options.innerClass),j=i.height(),k=i.html(e.data("oCnt")).css({height:""}).height();i.css({height:j});d.options.useLinesEllipsis&&e.find("."+d.options.ellipsisClass).remove(),i.animate({height:k},c,function(){i.height("auto"),f()}),e.removeClass(d.options.hideClass).addClass(d.options.showClass);break;case"block":d.blockMode(e,"show",c,f)}return d.status=1,d.options.lockHide===!0?(d.removeCtrlButton(e),""):void("block"===d.mode?e.off("click.coll").on("click.coll",function(a){a.preventDefault(),d.hide(e)}):(0!==e.find("[data-ctrl]").length||a.isFunction(d.options.controlBtn)||e.append(d.ctrlHtml),d.ctrlBtn=a.isFunction(d.options.controlBtn)?d.options.controlBtn.call(d.$elem):a(e.find("[data-ctrl]")),d.ctrlBtn.off("click.coll").on("click.coll",function(a){a.preventDefault(),d.hide(e)}).html(d.options.hideText)))},b.hide=function(b,c){var d,e,f=this,g=a(b);"undefined"==typeof c&&(c=f.options.speed);var h=function(){a.isFunction(f.options.afterHide)&&f.options.afterHide.call(f.$elem,f)};switch(a.isFunction(f.options.beforeHide)&&f.options.beforeHide.call(f.$elem,f),f.removeCtrlButton(g),f.mode){case"chars":d=a.trim(g.text()),f.remaining.chars=d.length-f.options.truncate,f.options.truncate<d.length&&(g.data({tHTML:g.html()}),d=f.pad(d.slice(0,f.options.truncate),d.slice(f.options.truncate,d.length)),g.html(d).removeClass(f.options.showClass).addClass(f.options.hideClass),h());break;case"words":d=a.trim(g.text()),e=d.split(" "),f.remaining.words=e.length-f.options.truncate,e.length>f.options.truncate&&(g.data({tHTML:g.html()}),d=f.pad(e.slice(0,f.options.truncate).join(" "),e.slice(f.options.truncate,e.length).join(" ")),g.html(d).removeClass(f.options.showClass).addClass(f.options.hideClass),h());break;case"lines":0===g.children("."+f.options.innerClass).length&&g.wrapInner('<div class="'+f.options.innerClass+'">');var i=g.children("."+f.options.innerClass).css({height:""});f.options.stripTags?i.html(i.text()):i.html(i.html());var j,k,l,m=i.height();"undefined"==typeof g.data("lHeight")?(j=i.clone(),k=j.text("a").insertAfter(i).height(),g.data({lHeight:k}),i.next().remove()):k=g.data("lHeight"),l=m/k,f.remaining.lines=l-f.options.truncate,f.options.useLinesEllipsis&&g.find("."+f.options.ellipsisClass).remove(),0<f.remaining.lines&&(i.css({overflow:"hidden"}),i.animate({height:k*f.options.truncate},c).data({tHeight:m}),g.removeClass(f.options.showClass).addClass(f.options.hideClass),0!==g.find("[data-ctrl]").length||a.isFunction(f.options.controlBtn)||g.append(f.ctrlHtml),f.options.useLinesEllipsis&&g.find("."+f.options.ctrlClass).before(a('<span class="'+f.options.ellipsisClass+'">'+f.options.ellipsis+"</span>")),h());break;case"block":f.blockMode(g,"hide",c,h)}if(f.status=0,"block"==f.mode)g.off("click.coll").on("click.coll",function(a){a.preventDefault(),f.show(g)});else{f.ctrlBtn=a.isFunction(f.options.controlBtn)?f.options.controlBtn.call(f.$elem):a(g.find("[data-ctrl]")),f.ctrlBtn.off("click.coll").on("click.coll",function(a){a.preventDefault(),f.show(g)}).html(f.options.showText);var n=f.options.showText,o={chars:["character","characters"],words:["word","words"],lines:["lines","lines"]},p=f.remaining[f.mode]+(1==f.remaining[f.mode]?" "+o[f.mode][0]:" "+o[f.mode][1]);n=n.replace("%s",p),f.ctrlBtn.html(n)}},b.pad=function(b,c){var d=this;return b+'<span class="'+d.options.ellipsisClass+'">'+d.options.ellipsis+"</span>"+(a.isFunction(d.options.ctrlBtn)?"":d.ctrlHtml)+'<span class="coll-hidden" style="display:none">'+c+"</span>"},b.blockMode=function(b,c,d,e){var f=this,g=["fadeOut","slideUp","fadeIn","slideDown"],h="fade"==f.options.effect?0:1,i="hide"==c?g[h]:g[h+2];a.isFunction(f.options.target)?f.options.target.call(f.$elem)[i](d,e):a.fn[f.options.target]&&a(b)[f.options.target]()[i](d,e),"show"===c?(b.removeClass(f.options.showClass).addClass(f.options.hideClass),f.options.changeText&&b.text(f.options.hideText)):(b.removeClass(f.options.hideClass).addClass(f.options.showClass),f.options.changeText&&b.text(f.options.showText))},b.reInit=function(a){var b=this;b.removeCtrlButton(a),("chars"===b.mode||"words"===b.mode)&&a.html(b.e.data("oCnt")),0===b.status?b.hide(a,0):b.show(a,0)},b.removeCtrlButton=function(a){var b=this;b.options.ctrlWrapperClass?a.find("."+b.options.ctrlWrapperClass).remove():a.find("[data-ctrl]").remove()},b.setShorthandHtml=function(){var b=this,c=[],d="";!a.isFunction(b.options.controlBtn)&&b.options.controlBtn&&c.push(b.options.controlBtn),b.options.ctrlClass&&c.push(b.options.ctrlClass),b.options.ctrlWrapperClass&&(d+='<div class="'+b.options.ctrlWrapperClass+'">'),d+=' <a href="#" data-ctrl class="'+c.join(" ")+'"></a>',b.options.ctrlWrapperClass&&(d+="</div>"),b.ctrlHtml=d},b.perform=function(){var b=this;b.$elem.addClass(b.options.modeClassPrefix+b.mode),a(b.$elem).each(function(c,d){a(d).data({oCnt:b.$elem.html()});var e=a.isFunction(b.options.atStart)?b.options.atStart.call(b.$elem):b.options.atStart;e="undefined"!=typeof b.$elem.attr("data-start")?b.$elem.attr("data-start"):e,"hide"===e?b.hide(b.$elem,0):b.show(b.$elem,0)})},b.setResizeTimer=function(){var b,c=this;a(window).on("resize",function(){c.options.dynamic&&"lines"==c.mode&&(clearTimeout(b),b=setTimeout(function(){c.reInit(c.$elem)},100))})},b.initHandling=function(){var a=this;a.setShorthandHtml(),a.perform(),a.setResizeTimer()}}(jQuery);