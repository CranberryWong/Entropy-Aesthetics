!function(){"use strict";var That={selectors:{container:"#bb-that .bb-that:not(.bb-that--static)",sitemapLink:".bb-that-header--sitemap-trigger",sitemapClose:".bb-that__close",mobileCategories:".bb-that--visible-xs .bb-that-category:not(.bb-that-category--sub) .bb-that-category__title"},openClass:"bb-that--open",alertEvent:"bloomberg.that.alert",container:null,init:function(){this.container=document.querySelector(this.selectors.container),null!==this.container&&(this.bindEvents(),this.triggerAlert())},bindEvents:function(){var sitemapCallback=this.makeCallback(this.toggleSitemap);this.container.querySelector(this.selectors.sitemapLink).addEventListener("click",sitemapCallback,!1),this.container.querySelector(this.selectors.sitemapClose).addEventListener("click",sitemapCallback,!1);var mobileCategoryCallback=this.makeCallback(this.toggleMobileCategory);[].forEach.call(this.container.querySelectorAll(this.selectors.mobileCategories),function(element){element.addEventListener("click",mobileCategoryCallback,!1)})},makeCallback:function(callback){var that=this;return function(event){callback.call(that,event)}},toggleClass:function(element){var reg=new RegExp("(\\s|^)"+this.openClass+"(\\s|$)");element.className.match(reg)?element.className=element.className.replace(reg," "):element.className+=" "+this.openClass},toggleSitemap:function(event){event.preventDefault(),event.stopImmediatePropagation(),this.toggleClass(this.container)},toggleMobileCategory:function(event){event.preventDefault(),this.toggleClass(event.target.parentNode)},triggerAlert:function(){var evt=document.createEvent("Events");evt.initEvent(this.alertEvent,!0,!0),document.dispatchEvent(evt)}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){That.init()},!1):That.init()}(),function(){"use strict";var Alert={selectors:{that:"bb-that",alert:".bb-that__alert",alertClose:".bb-that__alert--close",alertActive:"bb-that__alert--active",dataEndpoint:"data-alert-service"},logs:{invalidTHAT:"THAT was not rendered correctly. ",noEndpoint:"Alert retrieval endpoint not set. ",noAlert:"There are no alerts to display at the moment ",parsingError:"There was an error when parsing the alert response ",invalidResponse:"There was an error when retrieving the alert ",alertClose:"The alert has been closed. ",alertSeen:"The alert has already been seen and closed."},cookieName:"bloomberg.that.alert",cookieDuration:1,alertEvent:"bloomberg.that.alert",endpoint:"",tophat:null,init:function(){this.validateTHAT()&&this.retrieveAlert()},validateTHAT:function(){var $valid=!1;return this.tophat=document.querySelector("div#"+this.selectors.that),this.tophat?(this.endpoint=this.tophat.getAttribute(this.selectors.dataEndpoint),this.endpoint?$valid=!0:this.log(!0,this.logs.noEndpoint)):this.log(!0,this.logs.invalidTHAT),$valid},retrieveAlert:function(){var xmlhttp=new XMLHttpRequest;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===XMLHttpRequest.DONE)if(200===xmlhttp.status)try{var $response=JSON.parse(xmlhttp.responseText);$response.hasOwnProperty("alerts")&&Array.isArray($response.alerts)&&0<$response.alerts.length?Alert.renderAlert($response.alerts[0]):Alert.log(!0,Alert.logs.noAlert)}catch(e){Alert.log(!0,Alert.logs.parsingError,e)}else Alert.log(!0,Alert.logs.invalidResponse,xmlhttp.status)},xmlhttp.open("GET",this.endpoint,!0),xmlhttp.send()},renderAlert:function(alert){this.getCookie(this.cookieName)?this.log(!1,this.logs.alertSeen):(this.tophat.insertAdjacentHTML("afterbegin",alert),document.querySelector(this.selectors.alert).classList.add(this.selectors.alertActive),this.bindClose())},bindClose:function(){document.querySelector(this.selectors.alertClose).addEventListener("click",function(){Alert.tophat.removeChild(document.querySelector(Alert.selectors.alert)),Alert.setCookie(Alert.cookieName,!0,Alert.cookieDuration),Alert.log(!1,Alert.logs.alertClose)})},setCookie:function(name,value,xdays){var d=new Date;d.setTime(d.getTime()+864e5*xdays),document.cookie=name+"="+value+";path=/;expires="+d.toUTCString()},getCookie:function(name){var v=document.cookie.match("(^|;) ?"+name+"=([^;]*)(;|$)");return v?v[2]:null},deleteCookie:function(name){this.setCookie(name,"",-1)},log:function(error,message,extra){error?window.console.error(this.alertEvent,{message:message,extra:extra}):window.console.log(this.alertEvent,{message:message,extra:extra})}};document.addEventListener(Alert.alertEvent,function(){Alert.init()})}();
