!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.PUBNUB=n():e.PUBNUB=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var t={};return n.m=e,n.c=t,n.p="",n(0)}([function(e,n,t){function r(e,n){return b.HmacSHA256(e,n).toString(b.enc.Base64)}function i(e){return document.getElementById(e)}function c(e){console.error(e)}function a(e,n){var t=[];return v.each(e.split(/\s+/),function(e){v.each((n||document).getElementsByTagName(e),function(e){t.push(e)})}),t}function o(e,n,t){v.each(e.split(","),function(e){var r=function(e){e||(e=window.event),t(e)||(e.cancelBubble=!0,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};n.addEventListener?n.addEventListener(e,r,!1):n.attachEvent?n.attachEvent("on"+e,r):n["on"+e]=r})}function u(){return a("head")[0]}function s(e,n,t){return t?void e.setAttribute(n,t):e&&e.getAttribute&&e.getAttribute(n)}function l(e,n){for(var t in n)if(n.hasOwnProperty(t))try{e.style[t]=n[t]+("|width|height|top|left|".indexOf(t)>0&&"number"==typeof n[t]?"px":"")}catch(e){return}}function f(e){return document.createElement(e)}function h(e){var n,t,r=0,i=0,c=e.timeout||v.DEF_TIMEOUT,a=e.data||{},o=e.fail||function(){},u=e.success||function(){},s=function(e,i){r||(r=1,clearTimeout(t),n&&(n.onerror=n.onload=null,n.abort&&n.abort(),n=null),e&&o(i))},l=function(){if(!i){var e;i=1,clearTimeout(t);try{e=JSON.parse(n.responseText)}catch(e){return s(1)}u(e)}};t=v.timeout(function(){s(1)},c);try{n="undefined"!=typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest,n.onerror=n.onabort=function(){s(1,n.responseText||{error:"Network Connection Error"})},n.onload=n.onloadend=l,a.pnsdk=m;var f=v.build_url(e.url,a);n.open("GET",f,!0),n.timeout=c,n.send()}catch(e){s(1,{error:"XHR Failed",stacktrace:e})}return s}function d(){if(!("onLine"in navigator))return 1;try{return navigator.onLine}catch(e){return!0}}function p(e){return"sendBeacon"in navigator&&navigator.sendBeacon(e)}t(1);var g=t(2),b=t(3),y=t(4),v=t(5),_=t(10),m="PubNub-JS-Web/"+y.version;window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||function(){});var k=function(){var e={},n=!1;try{n=window.localStorage}catch(e){return}var t=function(e){return-1===document.cookie.indexOf(e)?null:((document.cookie||"").match(RegExp(e+"=([^;]+)"))||[])[1]||null},r=function(e,n){document.cookie=e+"="+n+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"},i=function(){try{return r("pnctest","1"),"1"===t("pnctest")}catch(e){return!1}}();return{get:function(r){try{return n?n.getItem(r):i?t(r):e[r]}catch(n){return e[r]}},set:function(t,c){try{if(n)return n.setItem(t,c)&&0;i&&r(t,c),e[t]=c}catch(n){e[t]=c}}}}(),S={list:{},unbind:function(e){S.list[e]=[]},bind:function(e,n){(S.list[e]=S.list[e]||[]).push(n)},fire:function(e,n){v.each(S.list[e]||[],function(e){e(n)})}},x=function(e){var n=e.leave_on_unload||0;e.xdr=h,e.db=k,e.error=e.error||c,e._is_online=d,e.hmac_SHA256=r,e.crypto_obj=g(),e.sendBeacon=p,e.params={pnsdk:m};var t=function(e){return x(e)},b=v.PN_API(e);for(var y in b)b.hasOwnProperty(y)&&(t[y]=b[y]);return t.css=l,t.$=i,t.create=f,t.bind=o,t.head=u,t.search=a,t.attr=s,t.events=S,t.init=t,t.secure=t,t.crypto_obj=g(),t.WS=_,t.PNmessage=v.PNmessage,o("beforeunload",window,function(){return n&&t["each-channel"](function(e){t.LEAVE(e.name,0)}),!0}),t.ready(),e.notest?t:(o("offline",window,t.offline),o("offline",document,t.offline),t)};x.init=x,x.secure=x,x.crypto_obj=g(),x.WS=_,x.db=k,x.PNmessage=v.PNmessage,x.uuid=v.uuid,x.css=l,x.$=i,x.create=i,x.bind=o,x.head=u,x.search=a,x.attr=s,x.events=S,x.map=v.map,x.each=v.each,x.grep=v.grep,x.supplent=v.supplant,x.now=v.now,x.unique=v.unique,x.updater=v.updater,window.jQuery&&(window.jQuery.PUBNUB=x),e.exports=x},function(module,exports){(function(){window.JSON&&window.JSON.stringify||function(){function toJSON(e){try{return this.valueOf()}catch(e){return null}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var n=meta[e];return"string"==typeof n?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,n){var t,r,i,c,a,o=gap,u=n[e];switch(u&&"object"==typeof u&&(u=toJSON.call(u,e)),"function"==typeof rep&&(u=rep.call(n,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(u)){for(c=u.length,t=0;c>t;t+=1)a[t]=str(t,u)||"null";return i=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+o+"]":"["+a.join(",")+"]",gap=o,i}if(rep&&"object"==typeof rep)for(c=rep.length,t=0;c>t;t+=1)"string"==typeof(r=rep[t])&&(i=str(r,u))&&a.push(quote(r)+(gap?": ":":")+i);else for(r in u)Object.hasOwnProperty.call(u,r)&&(i=str(r,u))&&a.push(quote(r)+(gap?": ":":")+i);return i=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+o+"}":"{"+a.join(",")+"}",gap=o,i}}window.JSON||(window.JSON={});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,n,t){var r;if(gap="",indent="","number"==typeof t)for(r=0;t>r;r+=1)indent+=" ";else"string"==typeof t&&(indent=t);if(rep=n,n&&"function"!=typeof n&&("object"!=typeof n||"number"!=typeof n.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text){return eval("("+text+")")})}()}).call(window)},function(e,n,t){function r(){function e(e){return i.SHA256(e).toString(i.enc.Hex)}function n(e){return e=e||{},e.hasOwnProperty("encryptKey")||(e.encryptKey=f.encryptKey),e.hasOwnProperty("keyEncoding")||(e.keyEncoding=f.keyEncoding),e.hasOwnProperty("keyLength")||(e.keyLength=f.keyLength),e.hasOwnProperty("mode")||(e.mode=f.mode),-1==u.indexOf(e.keyEncoding.toLowerCase())&&(e.keyEncoding=f.keyEncoding),-1==s.indexOf(parseInt(e.keyLength,10))&&(e.keyLength=f.keyLength),-1==l.indexOf(e.mode.toLowerCase())&&(e.mode=f.mode),e}function t(e,n){return"base64"===n.keyEncoding?i.enc.Base64.parse(e):"hex"===n.keyEncoding?i.enc.Hex.parse(e):e}function r(n,r){return n=t(n,r),r.encryptKey?i.enc.Utf8.parse(e(n).slice(0,32)):n}function c(e){return"ecb"===e.mode?i.mode.ECB:i.mode.CBC}function a(e){return"cbc"===e.mode?i.enc.Utf8.parse(o):null}var o="0123456789012345",u=["hex","utf8","base64","binary"],s=[128,256],l=["ecb","cbc"],f={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"};return{encrypt:function(e,t,o){if(!t)return e;o=n(o);var u=a(o),s=c(o),l=r(t,o),f=JSON.stringify(e);return i.AES.encrypt(f,l,{iv:u,mode:s}).ciphertext.toString(i.enc.Base64)||e},decrypt:function(e,t,o){if(!t)return e;o=n(o);var u=a(o),s=c(o),l=r(t,o);try{var f=i.enc.Base64.parse(e),h=i.AES.decrypt({ciphertext:f},l,{iv:u,mode:s}).toString(i.enc.Utf8);return JSON.parse(h)}catch(e){return}}}}var i=t(3);e.exports=r},function(e,n){var t=t||function(e,n){var t={},r=t.lib={},i=function(){},c=r.Base={extend:function(e){i.prototype=this;var n=new i;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=r.WordArray=c.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=void 0!=n?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var n=this.words,t=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;e>i;i++)n[r+i>>>2]|=(t[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<t.length)for(i=0;e>i;i+=4)n[r+i>>>2]=t[i>>>2];else n.push.apply(n,t);return this.sigBytes+=e,this},clamp:function(){var n=this.words,t=this.sigBytes;n[t>>>2]&=4294967295<<32-t%4*8,n.length=e.ceil(t/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var t=[],r=0;n>r;r+=4)t.push(4294967296*e.random()|0);return new a.init(t,n)}}),o=t.enc={},u=o.Hex={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],r=0;e>r;r++){var i=n[r>>>2]>>>24-r%4*8&255;t.push((i>>>4).toString(16)),t.push((15&i).toString(16))}return t.join("")},parse:function(e){for(var n=e.length,t=[],r=0;n>r;r+=2)t[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new a.init(t,n/2)}},s=o.Latin1={stringify:function(e){var n=e.words;e=e.sigBytes;for(var t=[],r=0;e>r;r++)t.push(String.fromCharCode(n[r>>>2]>>>24-r%4*8&255));return t.join("")},parse:function(e){for(var n=e.length,t=[],r=0;n>r;r++)t[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new a.init(t,n)}},l=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var t=this._data,r=t.words,i=t.sigBytes,c=this.blockSize,o=i/(4*c),o=n?e.ceil(o):e.max((0|o)-this._minBufferSize,0);if(n=o*c,i=e.min(4*n,i),n){for(var u=0;n>u;u+=c)this._doProcessBlock(r,u);u=r.splice(0,n),t.sigBytes-=i}return new a.init(u,i)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(n,t){return new e.init(t).finalize(n)}},_createHmacHelper:function(e){return function(n,t){return new h.HMAC.init(e,t).finalize(n)}}});var h=t.algo={};return t}(Math);!function(e){for(var n=t,r=n.lib,i=r.WordArray,c=r.Hasher,r=n.algo,a=[],o=[],u=function(e){return 4294967296*(e-(0|e))|0},s=2,l=0;64>l;){var f;e:{f=s;for(var h=e.sqrt(f),d=2;h>=d;d++)if(!(f%d)){f=!1;break e}f=!0}f&&(8>l&&(a[l]=u(e.pow(s,.5))),o[l]=u(e.pow(s,1/3)),l++),s++}var p=[],r=r.SHA256=c.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,n){for(var t=this._hash.words,r=t[0],i=t[1],c=t[2],a=t[3],u=t[4],s=t[5],l=t[6],f=t[7],h=0;64>h;h++){if(16>h)p[h]=0|e[n+h];else{var d=p[h-15],g=p[h-2];p[h]=((d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3)+p[h-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+p[h-16]}d=f+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&s^~u&l)+o[h]+p[h],g=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&c^i&c),f=l,l=s,s=u,u=a+d|0,a=c,c=i,i=r,r=d+g|0}t[0]=t[0]+r|0,t[1]=t[1]+i|0,t[2]=t[2]+c|0,t[3]=t[3]+a|0,t[4]=t[4]+u|0,t[5]=t[5]+s|0,t[6]=t[6]+l|0,t[7]=t[7]+f|0},_doFinalize:function(){var n=this._data,t=n.words,r=8*this._nDataBytes,i=8*n.sigBytes;return t[i>>>5]|=128<<24-i%32,t[14+(i+64>>>9<<4)]=e.floor(r/4294967296),t[15+(i+64>>>9<<4)]=r,n.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=c._createHelper(r),n.HmacSHA256=c._createHmacHelper(r)}(Math),function(){var e=t,n=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var c=this._oKey=t.clone(),a=this._iKey=t.clone(),o=c.words,u=a.words,s=0;r>s;s++)o[s]^=1549556828,u[s]^=909522486;c.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var n=this._hasher;return e=n.finalize(e),n.reset(),n.finalize(this._oKey.clone().concat(e))}})}(),function(){var e=t,n=e.lib.WordArray;e.enc.Base64={stringify:function(e){var n=e.words,t=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;t>i;i+=3)for(var c=(n[i>>>2]>>>24-i%4*8&255)<<16|(n[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|n[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;4>a&&t>i+.75*a;a++)e.push(r.charAt(c>>>6*(3-a)&63));if(n=r.charAt(64))for(;e.length%4;)e.push(n);return e.join("")},parse:function(e){var t=e.length,r=this._map,i=r.charAt(64);i&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],c=0,a=0;t>a;a++)if(a%4){var o=r.indexOf(e.charAt(a-1))<<a%4*2,u=r.indexOf(e.charAt(a))>>>6-a%4*2;i[c>>>2]|=(o|u)<<24-c%4*8,c++}return n.create(i,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){function n(e,n,t,r,i,c,a){return((e=e+(n&t|~n&r)+i+a)<<c|e>>>32-c)+n}function r(e,n,t,r,i,c,a){return((e=e+(n&r|t&~r)+i+a)<<c|e>>>32-c)+n}function i(e,n,t,r,i,c,a){return((e=e+(n^t^r)+i+a)<<c|e>>>32-c)+n}function c(e,n,t,r,i,c,a){return((e=e+(t^(n|~r))+i+a)<<c|e>>>32-c)+n}for(var a=t,o=a.lib,u=o.WordArray,s=o.Hasher,o=a.algo,l=[],f=0;64>f;f++)l[f]=4294967296*e.abs(e.sin(f+1))|0;o=o.MD5=s.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var a=0;16>a;a++){var o=t+a,u=e[o];e[o]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var a=this._hash.words,o=e[t+0],u=e[t+1],s=e[t+2],f=e[t+3],h=e[t+4],d=e[t+5],p=e[t+6],g=e[t+7],b=e[t+8],y=e[t+9],v=e[t+10],_=e[t+11],m=e[t+12],k=e[t+13],S=e[t+14],x=e[t+15],w=a[0],O=a[1],K=a[2],M=a[3],w=n(w,O,K,M,o,7,l[0]),M=n(M,w,O,K,u,12,l[1]),K=n(K,M,w,O,s,17,l[2]),O=n(O,K,M,w,f,22,l[3]),w=n(w,O,K,M,h,7,l[4]),M=n(M,w,O,K,d,12,l[5]),K=n(K,M,w,O,p,17,l[6]),O=n(O,K,M,w,g,22,l[7]),w=n(w,O,K,M,b,7,l[8]),M=n(M,w,O,K,y,12,l[9]),K=n(K,M,w,O,v,17,l[10]),O=n(O,K,M,w,_,22,l[11]),w=n(w,O,K,M,m,7,l[12]),M=n(M,w,O,K,k,12,l[13]),K=n(K,M,w,O,S,17,l[14]),O=n(O,K,M,w,x,22,l[15]),w=r(w,O,K,M,u,5,l[16]),M=r(M,w,O,K,p,9,l[17]),K=r(K,M,w,O,_,14,l[18]),O=r(O,K,M,w,o,20,l[19]),w=r(w,O,K,M,d,5,l[20]),M=r(M,w,O,K,v,9,l[21]),K=r(K,M,w,O,x,14,l[22]),O=r(O,K,M,w,h,20,l[23]),w=r(w,O,K,M,y,5,l[24]),M=r(M,w,O,K,S,9,l[25]),K=r(K,M,w,O,f,14,l[26]),O=r(O,K,M,w,b,20,l[27]),w=r(w,O,K,M,k,5,l[28]),M=r(M,w,O,K,s,9,l[29]),K=r(K,M,w,O,g,14,l[30]),O=r(O,K,M,w,m,20,l[31]),w=i(w,O,K,M,d,4,l[32]),M=i(M,w,O,K,b,11,l[33]),K=i(K,M,w,O,_,16,l[34]),O=i(O,K,M,w,S,23,l[35]),w=i(w,O,K,M,u,4,l[36]),M=i(M,w,O,K,h,11,l[37]),K=i(K,M,w,O,g,16,l[38]),O=i(O,K,M,w,v,23,l[39]),w=i(w,O,K,M,k,4,l[40]),M=i(M,w,O,K,o,11,l[41]),K=i(K,M,w,O,f,16,l[42]),O=i(O,K,M,w,p,23,l[43]),w=i(w,O,K,M,y,4,l[44]),M=i(M,w,O,K,m,11,l[45]),K=i(K,M,w,O,x,16,l[46]),O=i(O,K,M,w,s,23,l[47]),w=c(w,O,K,M,o,6,l[48]),M=c(M,w,O,K,g,10,l[49]),K=c(K,M,w,O,S,15,l[50]),O=c(O,K,M,w,d,21,l[51]),w=c(w,O,K,M,m,6,l[52]),M=c(M,w,O,K,f,10,l[53]),K=c(K,M,w,O,v,15,l[54]),O=c(O,K,M,w,u,21,l[55]),w=c(w,O,K,M,b,6,l[56]),M=c(M,w,O,K,x,10,l[57]),K=c(K,M,w,O,p,15,l[58]),O=c(O,K,M,w,k,21,l[59]),w=c(w,O,K,M,h,6,l[60]),M=c(M,w,O,K,_,10,l[61]),K=c(K,M,w,O,s,15,l[62]),O=c(O,K,M,w,y,21,l[63]);a[0]=a[0]+w|0,a[1]=a[1]+O|0,a[2]=a[2]+K|0,a[3]=a[3]+M|0},_doFinalize:function(){var n=this._data,t=n.words,r=8*this._nDataBytes,i=8*n.sigBytes;t[i>>>5]|=128<<24-i%32;var c=e.floor(r/4294967296);for(t[15+(i+64>>>9<<4)]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),t[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n.sigBytes=4*(t.length+1),this._process(),n=this._hash,t=n.words,r=0;4>r;r++)i=t[r],t[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return n},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=s._createHelper(o),a.HmacMD5=s._createHmacHelper(o)}(Math),function(){var e=t,n=e.lib,r=n.Base,i=n.WordArray,n=e.algo,c=n.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:n.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,n){for(var t=this.cfg,r=t.hasher.create(),c=i.create(),a=c.words,o=t.keySize,t=t.iterations;a.length<o;){u&&r.update(u);var u=r.update(e).finalize(n);r.reset();for(var s=1;t>s;s++)u=r.finalize(u),r.reset();c.concat(u)}return c.sigBytes=4*o,c}});e.EvpKDF=function(e,n,t){return c.create(t).compute(e,n)}}(),t.lib.Cipher||function(e){var n=t,r=n.lib,i=r.Base,c=r.WordArray,a=r.BufferedBlockAlgorithm,o=n.enc.Base64,u=n.algo.EvpKDF,s=r.Cipher=a.extend({cfg:i.extend(),createEncryptor:function(e,n){return this.create(this._ENC_XFORM_MODE,e,n)},createDecryptor:function(e,n){return this.create(this._DEC_XFORM_MODE,e,n)},init:function(e,n,t){this.cfg=this.cfg.extend(t),this._xformMode=e,this._key=n,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(n,t,r){return("string"==typeof t?g:p).encrypt(e,n,t,r)},decrypt:function(n,t,r){return("string"==typeof t?g:p).decrypt(e,n,t,r)}}}});r.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var l=n.mode={},f=function(e,n,t){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;t>i;i++)e[n+i]^=r[i]},h=(r.BlockCipherMode=i.extend({createEncryptor:function(e,n){return this.Encryptor.create(e,n)},createDecryptor:function(e,n){return this.Decryptor.create(e,n)},init:function(e,n){this._cipher=e,this._iv=n}})).extend();h.Encryptor=h.extend({processBlock:function(e,n){var t=this._cipher,r=t.blockSize;f.call(this,e,n,r),t.encryptBlock(e,n),this._prevBlock=e.slice(n,n+r)}}),h.Decryptor=h.extend({processBlock:function(e,n){var t=this._cipher,r=t.blockSize,i=e.slice(n,n+r);t.decryptBlock(e,n),f.call(this,e,n,r),this._prevBlock=i}}),l=l.CBC=h,h=(n.pad={}).Pkcs7={pad:function(e,n){for(var t=4*n,t=t-e.sigBytes%t,r=t<<24|t<<16|t<<8|t,i=[],a=0;t>a;a+=4)i.push(r);t=c.create(i,t),e.concat(t)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},r.BlockCipher=s.extend({cfg:s.cfg.extend({mode:l,padding:h}),reset:function(){s.reset.call(this);var e=this.cfg,n=e.iv,e=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var t=e.createEncryptor;else t=e.createDecryptor,this._minBufferSize=1;this._mode=t.call(e,this,n&&n.words)},_doProcessBlock:function(e,n){this._mode.processBlock(e,n)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var n=this._process(!0)}else n=this._process(!0),e.unpad(n);return n},blockSize:4});var d=r.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),l=(n.format={}).OpenSSL={stringify:function(e){var n=e.ciphertext;return e=e.salt,(e?c.create([1398893684,1701076831]).concat(e).concat(n):n).toString(o)},parse:function(e){e=o.parse(e);var n=e.words;if(1398893684==n[0]&&1701076831==n[1]){var t=c.create(n.slice(2,4));n.splice(0,4),e.sigBytes-=16}return d.create({ciphertext:e,salt:t})}},p=r.SerializableCipher=i.extend({cfg:i.extend({format:l}),encrypt:function(e,n,t,r){r=this.cfg.extend(r);var i=e.createEncryptor(t,r);return n=i.finalize(n),i=i.cfg,d.create({ciphertext:n,key:t,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,n,t,r){return r=this.cfg.extend(r),n=this._parse(n,r.format),e.createDecryptor(t,r).finalize(n.ciphertext)},_parse:function(e,n){return"string"==typeof e?n.parse(e,this):e}}),n=(n.kdf={}).OpenSSL={execute:function(e,n,t,r){return r||(r=c.random(8)),e=u.create({keySize:n+t}).compute(e,r),t=c.create(e.words.slice(n),4*t),e.sigBytes=4*n,d.create({key:e,iv:t,salt:r})}},g=r.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:n}),encrypt:function(e,n,t,r){return r=this.cfg.extend(r),t=r.kdf.execute(t,e.keySize,e.ivSize),r.iv=t.iv,e=p.encrypt.call(this,e,n,t.key,r),e.mixIn(t),e},decrypt:function(e,n,t,r){return r=this.cfg.extend(r),n=this._parse(n,r.format),t=r.kdf.execute(t,e.keySize,e.ivSize,n.salt),r.iv=t.iv,p.decrypt.call(this,e,n,t.key,r)}})}(),function(){for(var e=t,n=e.lib.BlockCipher,r=e.algo,i=[],c=[],a=[],o=[],u=[],s=[],l=[],f=[],h=[],d=[],p=[],g=0;256>g;g++)p[g]=128>g?g<<1:g<<1^283;for(var b=0,y=0,g=0;256>g;g++){var v=y^y<<1^y<<2^y<<3^y<<4,v=v>>>8^255&v^99;i[b]=v,c[v]=b;var _=p[b],m=p[_],k=p[m],S=257*p[v]^16843008*v;a[b]=S<<24|S>>>8,o[b]=S<<16|S>>>16,u[b]=S<<8|S>>>24,s[b]=S,S=16843009*k^65537*m^257*_^16843008*b,l[v]=S<<24|S>>>8,f[v]=S<<16|S>>>16,h[v]=S<<8|S>>>24,d[v]=S,b?(b=_^p[p[p[k^_]]],y^=p[p[y]]):b=y=1}var x=[0,1,2,4,8,16,32,64,128,27,54],r=r.AES=n.extend({_doReset:function(){for(var e=this._key,n=e.words,t=e.sigBytes/4,e=4*((this._nRounds=t+6)+1),r=this._keySchedule=[],c=0;e>c;c++)if(t>c)r[c]=n[c];else{var a=r[c-1];c%t?t>6&&4==c%t&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a]):(a=a<<8|a>>>24,a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[255&a],a^=x[c/t|0]<<24),r[c]=r[c-t]^a}for(n=this._invKeySchedule=[],t=0;e>t;t++)c=e-t,a=t%4?r[c]:r[c-4],n[t]=4>t||4>=c?a:l[i[a>>>24]]^f[i[a>>>16&255]]^h[i[a>>>8&255]]^d[i[255&a]]},encryptBlock:function(e,n){this._doCryptBlock(e,n,this._keySchedule,a,o,u,s,i)},decryptBlock:function(e,n){var t=e[n+1];e[n+1]=e[n+3],e[n+3]=t,this._doCryptBlock(e,n,this._invKeySchedule,l,f,h,d,c),t=e[n+1],e[n+1]=e[n+3],e[n+3]=t},_doCryptBlock:function(e,n,t,r,i,c,a,o){for(var u=this._nRounds,s=e[n]^t[0],l=e[n+1]^t[1],f=e[n+2]^t[2],h=e[n+3]^t[3],d=4,p=1;u>p;p++)var g=r[s>>>24]^i[l>>>16&255]^c[f>>>8&255]^a[255&h]^t[d++],b=r[l>>>24]^i[f>>>16&255]^c[h>>>8&255]^a[255&s]^t[d++],y=r[f>>>24]^i[h>>>16&255]^c[s>>>8&255]^a[255&l]^t[d++],h=r[h>>>24]^i[s>>>16&255]^c[l>>>8&255]^a[255&f]^t[d++],s=g,l=b,f=y;g=(o[s>>>24]<<24|o[l>>>16&255]<<16|o[f>>>8&255]<<8|o[255&h])^t[d++],b=(o[l>>>24]<<24|o[f>>>16&255]<<16|o[h>>>8&255]<<8|o[255&s])^t[d++],y=(o[f>>>24]<<24|o[h>>>16&255]<<16|o[s>>>8&255]<<8|o[255&l])^t[d++],h=(o[h>>>24]<<24|o[s>>>16&255]<<16|o[l>>>8&255]<<8|o[255&f])^t[d++],e[n]=g,e[n+1]=b,e[n+2]=y,e[n+3]=h},keySize:8});e.AES=n._createHelper(r)}(),t.mode.ECB=function(){var e=t.lib.BlockCipherMode.extend();return e.Encryptor=e.extend({processBlock:function(e,n){this._cipher.encryptBlock(e,n)}}),e.Decryptor=e.extend({processBlock:function(e,n){this._cipher.decryptBlock(e,n)}}),e}(),e.exports=t},function(e,n){e.exports={name:"pubnub",preferGlobal:!1,version:"3.14.1",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",lodash:"^4.1.0"},noAnalyze:!1,devDependencies:{"babel-core":"^6.5.2","babel-eslint":"^5.0.0","babel-plugin-transform-class-properties":"^6.5.2","babel-plugin-transform-flow-strip-types":"^6.5.0","babel-preset-es2015":"^6.5.0",chai:"^3.5.0",eslint:"^2.2.0","eslint-config-airbnb":"^6.0.2","eslint-plugin-flowtype":"^2.1.0","eslint-plugin-mocha":"^2.0.0","eslint-plugin-react":"^4.1.0","flow-bin":"^0.22.0",grunt:"^0.4.5","grunt-babel":"^6.0.0","grunt-contrib-clean":"^1.0.0","grunt-contrib-copy":"^0.8.2","grunt-contrib-uglify":"^0.11.1","grunt-env":"^0.4.4","grunt-eslint":"^18.0.0","grunt-flow":"^1.0.3","grunt-karma":"^0.12.1","grunt-mocha-istanbul":"^3.0.1","grunt-text-replace":"^0.4.0","grunt-webpack":"^1.0.11","imports-loader":"^0.6.5",isparta:"^4.0.0","json-loader":"^0.5.4",karma:"^0.13.21","karma-chai":"^0.1.0","karma-mocha":"^0.2.1","karma-phantomjs-launcher":"^1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.0",mocha:"^2.4.5",nock:"^1.1.0","node-uuid":"^1.4.7",nodeunit:"^0.9.0","phantomjs-prebuilt":"^2.1.4",proxyquire:"^1.7.4",sinon:"^1.17.2","uglify-js":"^2.6.1",underscore:"^1.7.0",webpack:"^1.12.13","webpack-dev-server":"^1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"},files:["core","node.js","modern","CHANGELOG","FUTURE.md","LICENSE","README.md"]}},function(e,n,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(){return"x"+ ++v+ +new Date}function c(e,n){var t=[];return y.each(e,function(e,r){n?e.search("-pnpres")<0&&r.subscribed&&t.push(e):r.subscribed&&t.push(e)}),t.sort()}function a(e,n){var t=[];return y.each(e,function(e,r){n?e.search("-pnpres")<0&&r.subscribed&&t.push(e):r.subscribed&&t.push(e)}),t.sort()}function o(){_||(_=1,y.each(m,function(e){e()}))}function u(e){var n=e||{apns:{}};return n.getPubnubMessage=function(){var e={};if(Object.keys(n.apns).length){e.pn_apns={aps:{alert:n.apns.alert,badge:n.apns.badge}};for(var t in n.apns)e.pn_apns[t]=n.apns[t];var r=["badge","alert"];for(var t in r)delete e.pn_apns[r[t]]}n.gcm&&(e.pn_gcm={data:n.gcm});for(var t in n)e[t]=n[t];var i=["apns","gcm","publish","channel","callback","error"];for(var t in i)delete e[i[t]];return e},n.publish=function(){var e=n.getPubnubMessage();n.pubnub&&n.channel&&n.pubnub.publish({message:e,channel:n.channel,callback:n.callback,error:n.error})},n}function s(e){function n(e){return e||(e={}),y.each(Se,function(n,t){n in e||(e[n]=t)}),e}function t(e){var n=[];return y.each(e,function(e,t){n.push(e)}),n}function r(e){return t(e).sort()}function u(e){var n="",t=r(e);for(var i in t){var c=t[i];n+=c+"="+y.pamEncode(e[c]),i!=t.length-1&&(n+="&")}return n}function s(e,n,t){var r=!1;if(void 0===e)return n;if("number"==typeof e)r=!(e>K||0==e);else{if("boolean"==typeof e)return e?M:0;r=!0}return r?(t&&t("Presence Heartbeat value invalid. Valid range ( x > "+K+" or x = 0). Current Value : "+(n||K)),n||K):e}function f(e,n){return De.encrypt(e,n||Me)||e}function d(e,n){return De.decrypt(e,n||Me)||De.decrypt(e,Me)||e}function g(){return clearTimeout(be),!ve||ve>=500||1>ve||!c(de,!0).length&&!a(pe,!0).length?void(_e=!1):(_e=!0,void je.presence_heartbeat({callback:function(e){be=y.timeout(g,ve*O)},error:function(e){xe&&xe("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),be=y.timeout(g,ve*O)}}))}function b(){!_e&&g()}function v(e){if(me){if(!ie.length)return}else{if(e&&(ie.sending=0),ie.sending||!ie.length)return;ie.sending=1}H(ie.shift())}function A(e){var n=0;return y.each(a(pe),function(t){var r=pe[t];r&&(n++,(e||function(){})(r))}),n}function E(e){var n=0;return y.each(c(de),function(t){var r=de[t];r&&(n++,(e||function(){})(r))}),n}function C(e,n,t){if("object"==(void 0===e?"undefined":l(e))){if(e.error){var r={};return e.message&&(r.message=e.message),e.payload&&(r.payload=e.payload),void(t&&t(r))}if(e.payload)return void(e.next_page?n&&n(e.payload,e.next_page):n&&n(e.payload))}n&&n(e)}function P(e,n){if("object"==(void 0===e?"undefined":l(e))&&e.error){var t={};return e.message&&(t.message=e.message),e.payload&&(t.payload=e.payload),void(n&&n(t))}n&&n(e)}function N(e,t,r,i){var t=e.callback||t,c=e.error||xe,a=Oe();i=i||{},i.auth||(i.auth=e.auth_key||W.getAuthKey());var o=[X.getStandardOrigin(),"v1","channel-registration","sub-key",W.getSubscribeKey()];o.push.apply(o,r),a&&(i.callback=a),H({callback:a,data:n(i),success:function(e){C(e,t,c)},fail:function(e){P(e,c)},url:o})}function D(){we()||L(1,{error:"Offline. Please check your network settings."}),U&&clearTimeout(U),U=y.timeout(D,O)}function j(){Y&&je.time(function(e){T(function(){},e),e||L(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),z&&clearTimeout(z),z=y.timeout(j,$)})}function L(e,n){se&&se(e,n),se=null,clearTimeout(U),clearTimeout(z)}function R(e){return y.rnow()-ae-e/1e4}function T(e,n){function t(n){if(n){var t=n/1e4,i=(y.rnow()-r)/2;ae=y.rnow()-(t+i),e&&e(ae)}}var r=y.rnow();n&&t(n)||je.time(t)}var U,z,H=e.xdr,I=e.subscribe_key,F=e.publish_key,J=e.ssl,G=e.origin,q=e.auth_key,W=(new p.default).setAuthKey(q||"").setSubscribeKey(I).setPublishKey(F),X=new h.default(H,W,J,G),Q=+e.windowing||S,V=(+e.timeout||x)*O,$=(+e.keepalive||w)*O,Y=e.timecheck||0,Z=e.noleave||0,ee=e.secret_key||"",ne=e.hmac_SHA256,te=e.ssl?"s":"",re=function(){},ie=[],ce=!0,ae=0,oe=0,ue=0,se=0,le=e.restore||0,fe=0,he=!1,de={},pe={},ge={},be=null,ye=s(e.heartbeat||e.pnexpires||0,e.error),ve=e.heartbeat_interval||ye/2-1,_e=!1,me=e.no_wait_for_pending,ke=e["compatible_3.5"]||!1,Se=e.params||{},xe=e.error||function(){},we=e._is_online||function(){return 1},Oe=e.jsonp_cb||function(){return 0},Ke=e.db||{get:function(){},set:function(){}},Me=e.cipher_key,Be=e.uuid||!e.unique_uuid&&Ke&&Ke.get(W.getSubscribeKey()+"uuid")||"",Ae=e.instance_id||!1,Ee="",Ce=e.shutdown,Pe=void 0===e.use_send_beacon||e.use_send_beacon,Ne=Pe?e.sendBeacon:null;2===ye&&(ve=1);var De=e.crypto_obj||{encrypt:function(e,n){return e},decrypt:function(e,n){return e}},je={LEAVE:function(e,t,r,i,c){var a,o,u={uuid:Be,auth:r||W.getAuthKey()},s=X.nextOrigin(!1),i=i||function(){},l=c||function(){},f=Oe();if(e.indexOf(k)>0)return!0;if(ke){if(!te)return!1;if("0"==f)return!1}if(Z)return!1;if("0"!=f&&(u.callback=f),Ae&&(u.instanceid=Ee),a=[s,"v2","presence","sub_key",W.getSubscribeKey(),"channel",y.encode(e),"leave"],o=n(u),Ne){var h=y.buildURL(a,o);if(Ne(h))return i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return H({blocking:t||te,callback:f,data:o,success:function(e){C(e,i,l)},fail:function(e){P(e,l)},url:a}),!0},LEAVE_GROUP:function(e,t,r,i,c){var a,o,u={uuid:Be,auth:r||W.getAuthKey()},s=X.nextOrigin(!1),i=i||function(){},l=c||function(){},f=Oe();if(e.indexOf(k)>0)return!0;if(ke){if(!te)return!1;if("0"==f)return!1}if(Z)return!1;if("0"!=f&&(u.callback=f),e&&e.length>0&&(u["channel-group"]=e),Ae&&(u.instanceid=Ee),a=[s,"v2","presence","sub_key",W.getSubscribeKey(),"channel",y.encode(","),"leave"],o=n(u),Ne){var h=y.buildURL(a,o);if(Ne(h))return i&&i({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return H({blocking:t||te,callback:f,data:o,success:function(e){C(e,i,l)},fail:function(e){P(e,l)},url:a}),!0},set_resumed:function(e){he=e},get_cipher_key:function(){return Me},set_cipher_key:function(e){Me=e},raw_encrypt:function(e,n){return f(e,n)},raw_decrypt:function(e,n){return d(e,n)},get_heartbeat:function(){return ye},set_heartbeat:function(e,n){ye=s(e,ye,xe),ve=n||ye/2-1,2==ye&&(ve=1),re(),g()},get_heartbeat_interval:function(){return ve},set_heartbeat_interval:function(e){ve=e,g()},get_version:function(){return B},getGcmMessageObject:function(e){return{data:e}},getApnsMessageObject:function(e){var n={aps:{badge:1,alert:""}};for(var t in e)t[n]=e[t];return n},_add_param:function(e,n){Se[e]=n},channel_group:function(e,n){var t,r,i=e.channel_group,n=n||e.callback,c=e.channels||e.channel,a=e.cloak,o=[],u={},s=e.mode||"add";if(i){var l=i.split(":");l.length>1?(t="*"===l[0]?null:l[0],r=l[1]):r=l[0]}t&&o.push("namespace")&&o.push(y.encode(t)),o.push("channel-group"),r&&"*"!==r&&o.push(r),c?(y.isArray(c)&&(c=c.join(",")),u[s]=c,u.cloak=ce?"true":"false"):"remove"===s&&o.push("remove"),void 0!==a&&(u.cloak=a?"true":"false"),N(e,n,o,u)},channel_group_list_groups:function(e,n){var t;t=e.namespace||e.ns||e.channel_group||null,t&&(e.channel_group=t+":*"),je.channel_group(e,n)},channel_group_list_channels:function(e,n){return e.channel_group?void je.channel_group(e,n):xe("Missing Channel Group")},channel_group_remove_channel:function(e,n){return e.channel_group?e.channel||e.channels?(e.mode="remove",void je.channel_group(e,n)):xe("Missing Channel"):xe("Missing Channel Group")},channel_group_remove_group:function(e,n){
return e.channel_group?e.channel?xe("Use channel_group_remove_channel if you want to remove a channel from a group."):(e.mode="remove",void je.channel_group(e,n)):xe("Missing Channel Group")},channel_group_add_channel:function(e,n){return e.channel_group?e.channel||e.channels?void je.channel_group(e,n):xe("Missing Channel"):xe("Missing Channel Group")},channel_group_cloak:function(e,n){return void 0===e.cloak?void n(ce):(ce=e.cloak,void je.channel_group(e,n))},channel_group_list_namespaces:function(e,n){N(e,n,["namespace"])},channel_group_remove_namespace:function(e,n){N(e,n,["namespace",e.namespace,"remove"])},history:function(e,t){var t=e.callback||t,r=e.count||e.limit||100,i=e.reverse||"false",c=e.error||function(){},a=e.auth_key||W.getAuthKey(),o=e.cipher_key,u=e.channel,s=e.channel_group,f=e.start,h=e.end,p=e.include_token,g=e.string_message_token||!1,b={},y=Oe();return u||s?t?W.getSubscribeKey()?(b.stringtoken="true",b.count=r,b.reverse=i,b.auth=a,s&&(b["channel-group"]=s,u||(u=",")),y&&(b.callback=y),f&&(b.start=f),h&&(b.end=h),p&&(b.include_token="true"),g&&(b.string_message_token="true"),void X.fetchHistory(u,{callback:y,data:n(b),success:function(e){if("object"==(void 0===e?"undefined":l(e))&&e.error)return void c({message:e.message,payload:e.payload});for(var n=e[0],r=[],i=0;i<n.length;i++)if(p){var a=d(n[i].message,o),u=n[i].timetoken;try{r.push({message:JSON.parse(a),timetoken:u})}catch(e){r.push({message:a,timetoken:u})}}else{var a=d(n[i],o);try{r.push(JSON.parse(a))}catch(e){r.push(a)}}t([r,e[1],e[2]])},fail:function(e){P(e,c)}})):xe("Missing Subscribe Key"):xe("Missing Callback"):xe("Missing Channel")},replay:function(e,t){var t=t||e.callback||function(){},r=e.auth_key||W.getAuthKey(),i=e.source,c=e.destination,a=e.error||e.error||function(){},o=e.stop,u=e.start,s=e.end,l=e.reverse,f=e.limit,h=Oe(),d={};return i?c?W.getPublishKey()?W.getSubscribeKey()?("0"!=h&&(d.callback=h),o&&(d.stop="all"),l&&(d.reverse="true"),u&&(d.start=u),s&&(d.end=s),f&&(d.count=f),d.auth=r,void X.fetchReplay(i,c,{callback:h,success:function(e){C(e,t,a)},fail:function(){t([0,"Disconnected"])},data:n(d)})):xe("Missing Subscribe Key"):xe("Missing Publish Key"):xe("Missing Destination Channel"):xe("Missing Source Channel")},auth:function(e){W.setAuthKey(e),re()},time:function(e){var t=Oe(),r={uuid:Be,auth:W.getAuthKey()};Ae&&(r.instanceid=Ee),X.fetchTime(t,{callback:t,data:n(r),success:function(n){e(n[0])},fail:function(){e(0)}})},publish:function(e,t){var r=e.message;if(!r)return xe("Missing Message");var i,t=t||e.callback||r.callback||e.success||function(){},c=e.channel||r.channel,a=e.auth_key||W.getAuthKey(),o=e.cipher_key,u=e.error||r.error||function(){},s=e.post||!1,l=!("store_in_history"in e)||e.store_in_history,h=Oe(),d="push",p={uuid:Be,auth:a};return e.prepend&&(d="unshift"),c?W.getPublishKey()?W.getSubscribeKey()?(r.getPubnubMessage&&(r=r.getPubnubMessage()),r=JSON.stringify(f(r,o)),i=[X.getStandardOrigin(),"publish",W.getPublishKey(),W.getSubscribeKey(),0,y.encode(c),h,y.encode(r)],l||(p.store="0"),Ae&&(p.instanceid=Ee),ie[d]({callback:h,url:i,data:n(p),fail:function(e){P(e,u),v(1)},success:function(e){C(e,t,u),v(1)},mode:s?"POST":"GET"}),void v()):xe("Missing Subscribe Key"):xe("Missing Publish Key"):xe("Missing Channel")},unsubscribe:function(e,n){var t=e.channel,r=e.channel_group,i=e.auth_key||W.getAuthKey(),n=n||e.callback||function(){},c=e.error||function(){};if(fe=0,le=1,!t&&!r)return xe("Missing Channel or Channel Group");if(!W.getSubscribeKey())return xe("Missing Subscribe Key");if(t){var a=y.isArray(t)?t:(""+t).split(","),o=[],u=[];if(y.each(a,function(e){de[e]&&o.push(e)}),0==o.length)return void n({action:"leave"});y.each(o,function(e){u.push(e+k)}),y.each(o.concat(u),function(e){e in de&&(de[e]=0),e in ge&&delete ge[e]});var s=!0;_&&(s=je.LEAVE(o.join(","),0,i,n,c)),s||n({action:"leave"})}if(r){var l=y.isArray(r)?r:(""+r).split(","),f=[],h=[];if(y.each(l,function(e){pe[e]&&f.push(e)}),0==f.length)return void n({action:"leave"});y.each(f,function(e){h.push(e+k)}),y.each(f.concat(h),function(e){e in pe&&(pe[e]=0),e in ge&&delete ge[e]});var s=!0;_&&(s=je.LEAVE_GROUP(f.join(","),0,i,n,c)),s||n({action:"leave"})}re()},subscribe:function(e,t){function r(e){e?y.timeout(re,M):(X.shiftStandardOrigin(!0),X.shiftSubscribeOrigin(!0),y.timeout(function(){je.time(r)},O)),E(function(n){return e&&n.disconnected?(n.disconnected=0,n.reconnect(n.name)):void(e||n.disconnected||(n.disconnected=1,n.disconnect(n.name)))}),A(function(n){return e&&n.disconnected?(n.disconnected=0,n.reconnect(n.name)):void(e||n.disconnected||(n.disconnected=1,n.disconnect(n.name)))})}function i(){var e=Oe(),t=c(de).join(","),o=a(pe).join(",");if(t||o){t||(t=","),L();var u=n({uuid:Be,auth:W.getAuthKey()});o&&(u["channel-group"]=o);JSON.stringify(ge).length>2&&(u.state=JSON.stringify(ge)),ye&&(u.heartbeat=ye),Ae&&(u.instanceid=Ee),b(),se=H({timeout:K,callback:e,fail:function(e){e&&e.error&&e.service?(P(e,p),r(!1)):je.time(function(n){!n&&P(e,p),r(n)})},data:n(u),url:[X.getSubscribeOrigin(),"subscribe",W.getSubscribeKey(),y.encode(t),e,fe],success:function(e){if(!e||"object"==(void 0===e?"undefined":l(e))&&"error"in e&&e.error)return p(e),y.timeout(re,O);if(g(e[1]),fe=!fe&&le&&Ke.get(W.getSubscribeKey())||e[1],E(function(e){e.connected||(e.connected=1,e.connect(e.name))}),A(function(e){e.connected||(e.connected=1,e.connect(e.name))}),he&&!le)return fe=0,he=!1,Ke.set(W.getSubscribeKey(),0),void y.timeout(i,M);x&&(fe=1e4,x=0),Ke.set(W.getSubscribeKey(),e[1]);var n=function(){var n="",t="";e.length>3?(n=e[3],t=e[2]):n=e.length>2?e[2]:y.map(c(de),function(n){return y.map(Array(e[0].length).join(",").split(","),function(){return n})}).join(",");var r=n.split(","),i=t?t.split(","):[];return function(){var e=r.shift()||ue,n=i.shift(),t={};n?(e&&e.indexOf("-pnpres")>=0&&n.indexOf("-pnpres")<0&&(n+="-pnpres"),t=pe[n]||de[n]||{callback:function(){}}):t=de[e];var c=[t.callback||oe,e.split(k)[0]];return n&&c.push(n.split(k)[0]),c}}(),t=R(+e[1]);y.each(e[0],function(r){var i=n(),c=d(r,de[i[1]]?de[i[1]].cipher_key:null);i[0]&&i[0](c,e,i[2]||i[1],t,i[1])}),y.timeout(i,M)}})}}var o=e.channel,u=e.channel_group,t=t||e.callback,t=t||e.message,s=e.connect||function(){},f=e.reconnect||function(){},h=e.disconnect||function(){},p=e.error||p||function(){},g=e.idle||function(){},v=e.presence||0,S=e.noheresync||0,x=e.backfill||0,w=e.timetoken||0,K=e.timeout||V,M=e.windowing||Q,B=e.state,C=e.heartbeat||e.pnexpires,N=e.heartbeat_interval,D=e.restore||le;return W.setAuthKey(e.auth_key||W.getAuthKey()),le=D,fe=w,o||u?t?W.getSubscribeKey()?((C||0===C||N||0===N)&&je.set_heartbeat(C,N),o&&y.each((o.join?o.join(","):""+o).split(","),function(r){var i=de[r]||{};de[ue=r]={name:r,connected:i.connected,disconnected:i.disconnected,subscribed:1,callback:oe=t,cipher_key:e.cipher_key,connect:s,disconnect:h,reconnect:f},B&&(ge[r]=r in B?B[r]:B),v&&(je.subscribe({channel:r+k,callback:v,restore:D}),i.subscribed||S||je.here_now({channel:r,data:n({uuid:Be,auth:W.getAuthKey()}),callback:function(e){y.each("uuids"in e?e.uuids:[],function(n){v({action:"join",uuid:n,timestamp:Math.floor(y.rnow()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),u&&y.each((u.join?u.join(","):""+u).split(","),function(r){var i=pe[r]||{};pe[r]={name:r,connected:i.connected,disconnected:i.disconnected,subscribed:1,callback:oe=t,cipher_key:e.cipher_key,connect:s,disconnect:h,reconnect:f},v&&(je.subscribe({channel_group:r+k,callback:v,restore:D,auth_key:W.getAuthKey()}),i.subscribed||S||je.here_now({channel_group:r,data:n({uuid:Be,auth:W.getAuthKey()}),callback:function(e){y.each("uuids"in e?e.uuids:[],function(n){v({action:"join",uuid:n,timestamp:Math.floor(y.rnow()/1e3),occupancy:e.occupancy||1},e,r)})}}))}),re=function(){L(),y.timeout(i,M)},_?void re():m.push(re)):xe("Missing Subscribe Key"):xe("Missing Callback"):xe("Missing Channel")},here_now:function(e,t){var t=e.callback||t,r=e.debug,i=e.error||function(){},c=e.auth_key||W.getAuthKey(),a=e.channel,o=e.channel_group,u=Oe(),s=!("uuids"in e)||e.uuids,l=e.state,f={uuid:Be,auth:c};if(s||(f.disable_uuids=1),l&&(f.state=1),!t)return xe("Missing Callback");if(!W.getSubscribeKey())return xe("Missing Subscribe Key");var h=[X.getStandardOrigin(),"v2","presence","sub_key",W.getSubscribeKey()];a&&h.push("channel")&&h.push(y.encode(a)),"0"!=u&&(f.callback=u),o&&(f["channel-group"]=o,!a&&h.push("channel")&&h.push(",")),Ae&&(f.instanceid=Ee),H({callback:u,data:n(f),success:function(e){C(e,t,i)},fail:function(e){P(e,i)},debug:r,url:h})},where_now:function(e,t){var t=e.callback||t,r=e.error||function(){},i=e.auth_key||W.getAuthKey(),c=Oe(),a=e.uuid||Be,o={auth:i};return t?W.getSubscribeKey()?("0"!=c&&(o.callback=c),Ae&&(o.instanceid=Ee),void H({callback:c,data:n(o),success:function(e){C(e,t,r)},fail:function(e){P(e,r)},url:[X.getStandardOrigin(),"v2","presence","sub_key",W.getSubscribeKey(),"uuid",y.encode(a)]})):xe("Missing Subscribe Key"):xe("Missing Callback")},state:function(e,t){var r,t=e.callback||t||function(e){},i=e.error||function(){},c=e.auth_key||W.getAuthKey(),a=Oe(),o=e.state,u=e.uuid||Be,s=e.channel,l=e.channel_group,f=n({auth:c});return W.getSubscribeKey()?u?s||l?("0"!=a&&(f.callback=a),void 0!==s&&de[s]&&de[s].subscribed&&o&&(ge[s]=o),void 0!==l&&pe[l]&&pe[l].subscribed&&(o&&(ge[l]=o),f["channel-group"]=l,s||(s=",")),f.state=JSON.stringify(o),Ae&&(f.instanceid=Ee),r=o?[X.getStandardOrigin(),"v2","presence","sub-key",W.getSubscribeKey(),"channel",s,"uuid",u,"data"]:[X.getStandardOrigin(),"v2","presence","sub-key",W.getSubscribeKey(),"channel",s,"uuid",y.encode(u)],void H({callback:a,data:n(f),success:function(e){C(e,t,i)},fail:function(e){P(e,i)},url:r})):xe("Missing Channel"):xe("Missing UUID"):xe("Missing Subscribe Key")},grant:function(e,t){var t=e.callback||t,r=e.error||function(){},i=e.channel||e.channels,c=e.channel_group,a=Oe(),o=e.ttl,s=e.read?"1":"0",l=e.write?"1":"0",f=e.manage?"1":"0",h=e.auth_key||e.auth_keys;if(!t)return xe("Missing Callback");if(!W.getSubscribeKey())return xe("Missing Subscribe Key");if(!W.getPublishKey())return xe("Missing Publish Key");if(!ee)return xe("Missing Secret Key");var d=Math.floor((new Date).getTime()/1e3),p=W.getSubscribeKey()+"\n"+W.getPublishKey()+"\ngrant\n",g={w:l,r:s,timestamp:d};e.manage&&(g.m=f),y.isArray(i)&&(i=i.join(",")),y.isArray(h)&&(h=h.join(",")),void 0!==i&&null!=i&&i.length>0&&(g.channel=i),void 0!==c&&null!=c&&c.length>0&&(g["channel-group"]=c),"0"!=a&&(g.callback=a),(o||0===o)&&(g.ttl=o),h&&(g.auth=h),g=n(g),h||delete g.auth,p+=u(g);var b=ne(p,ee);b=b.replace(/\+/g,"-"),b=b.replace(/\//g,"_"),g.signature=b,H({callback:a,data:g,success:function(e){C(e,t,r)},fail:function(e){P(e,r)},url:[X.getStandardOrigin(),"v1","auth","grant","sub-key",W.getSubscribeKey()]})},mobile_gw_provision:function(e){var n,t=e.callback||function(){},r=e.auth_key||W.getAuthKey(),i=e.error||function(){},c=Oe(),a=e.channel,o=e.op,u=e.gw_type,s=e.device_id;if(!s)return xe("Missing Device ID (device_id)");if(!u)return xe("Missing GW Type (gw_type: gcm or apns)");if(!o)return xe("Missing GW Operation (op: add or remove)");if(!a)return xe("Missing gw destination Channel (channel)");if(!W.getPublishKey())return xe("Missing Publish Key");if(!W.getSubscribeKey())return xe("Missing Subscribe Key");var l={uuid:Be,auth:r,type:u};n=[X.getStandardOrigin(),"v1/push/sub-key",W.getSubscribeKey(),"devices",s],"add"==o?l.add=a:"remove"==o&&(l.remove=a),Ae&&(l.instanceid=Ee),H({callback:c,data:l,success:function(e){C(e,t,i)},fail:function(e){P(e,i)},url:n})},audit:function(e,t){var t=e.callback||t,r=e.error||function(){},i=e.channel,c=e.channel_group,a=e.auth_key,o=Oe();if(!t)return xe("Missing Callback");if(!W.getSubscribeKey())return xe("Missing Subscribe Key");if(!W.getPublishKey())return xe("Missing Publish Key");if(!ee)return xe("Missing Secret Key");var s=Math.floor((new Date).getTime()/1e3),l=W.getSubscribeKey()+"\n"+W.getPublishKey()+"\naudit\n",f={timestamp:s};"0"!=o&&(f.callback=o),void 0!==i&&null!=i&&i.length>0&&(f.channel=i),void 0!==c&&null!=c&&c.length>0&&(f["channel-group"]=c),a&&(f.auth=a),f=n(f),a||delete f.auth,l+=u(f);var h=ne(l,ee);h=h.replace(/\+/g,"-"),h=h.replace(/\//g,"_"),f.signature=h,H({callback:o,data:f,success:function(e){C(e,t,r)},fail:function(e){P(e,r)},url:[X.getStandardOrigin(),"v1","auth","audit","sub-key",W.getSubscribeKey()]})},revoke:function(e,n){e.read=!1,e.write=!1,je.grant(e,n)},set_uuid:function(e){Be=e,re()},get_uuid:function(){return Be},isArray:function(e){return y.isArray(e)},get_subscribed_channels:function(){return c(de,!0)},presence_heartbeat:function(e){var t=e.callback||function(){},r=e.error||function(){},i=Oe(),o={uuid:Be,auth:W.getAuthKey()};JSON.stringify(ge).length>2&&(o.state=JSON.stringify(ge)),ye>0&&320>ye&&(o.heartbeat=ye),"0"!=i&&(o.callback=i);var u=y.encode(c(de,!0).join(",")),s=a(pe,!0).join(",");u||(u=","),s&&(o["channel-group"]=s),Ae&&(o.instanceid=Ee),H({callback:i,data:n(o),url:[X.getStandardOrigin(),"v2","presence","sub-key",W.getSubscribeKey(),"channel",u,"heartbeat"],success:function(e){C(e,t,r)},fail:function(e){P(e,r)}})},stop_timers:function(){clearTimeout(U),clearTimeout(z),clearTimeout(be)},shutdown:function(){je.stop_timers(),Ce&&Ce()},xdr:H,ready:o,db:Ke,uuid:y.generateUUID,map:y.map,each:y.each,"each-channel":E,grep:y.grep,offline:function(){L(1,{message:"Offline. Please check your network settings."})},supplant:y.supplant,now:y.rnow,unique:i,updater:y.updater};return Be||(Be=je.uuid()),Ee||(Ee=je.uuid()),Ke.set(W.getSubscribeKey()+"uuid",Be),U=y.timeout(D,O),z=y.timeout(j,$),be=y.timeout(b,(ve-3)*O),T(),je}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},f=t(6),h=r(f),d=t(7),p=r(d),g=t(4),b=t(9),y=t(8),v=1,_=!1,m=[],k="-pnpres",S=10,x=310,w=60,O=1e3,K=5,M=30,B=g.version;e.exports={PN_API:s,unique:i,PNmessage:u,DEF_TIMEOUT:15e3,timeout:y.timeout,build_url:y.buildURL,each:y.each,uuid:y.generateUUID,URLBIT:b.URLBIT,grep:y.grep,supplant:y.supplant,now:y.rnow,updater:y.updater,map:y.map}},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),c=t(7),a=(function(e){return e&&e.__esModule?e:{default:e}}(c),t(8)),o=function(){function e(n,t){var i=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],c=arguments.length<=3||void 0===arguments[3]?"pubsub.pubnub.com":arguments[3];r(this,e),this._xdr=n,this._keychain=t,this._maxSubDomain=20,this._currentSubDomain=Math.floor(Math.random()*this._maxSubDomain),this._providedFQDN=(i?"https://":"http://")+c,this.shiftStandardOrigin(!1),this.shiftSubscribeOrigin(!1)}return i(e,[{key:"nextOrigin",value:function(e){if(-1===this._providedFQDN.indexOf("pubsub."))return this._providedFQDN;var n=void 0;return e?n=a.generateUUID().split("-")[0]:(this._currentSubDomain=this._currentSubDomain+1,this._currentSubDomain>=this._maxSubDomain&&(this._currentSubDomain=1),n=this._currentSubDomain.toString()),this._providedFQDN.replace("pubsub","ps"+n)}},{key:"shiftStandardOrigin",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];return this._standardOrigin=this.nextOrigin(e),this._standardOrigin}},{key:"shiftSubscribeOrigin",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];return this._subscribeOrigin=this.nextOrigin(e),this._subscribeOrigin}},{key:"fetchHistory",value:function(e,n){var t=n.data,r=n.callback,i=n.success,c=n.fail,o=[this.getStandardOrigin(),"v2","history","sub-key",this._keychain.getSubscribeKey(),"channel",a.encode(e)];this._xdr({data:t,callback:r,success:i,fail:c,url:o})}},{key:"fetchReplay",value:function(e,n,t){var r=t.data,i=t.callback,c=t.success,a=t.fail,o=[this.getStandardOrigin(),"v1","replay",this._keychain.getPublishKey(),this._keychain.getSubscribeKey(),e,n];this._xdr({data:r,callback:i,success:c,fail:a,url:o})}},{key:"fetchTime",value:function(e,n){var t=n.data,r=n.callback,i=n.success,c=n.fail,a=[this.getStandardOrigin(),"time",e];this._xdr({data:t,callback:r,success:i,fail:c,url:a})}},{key:"getOrigin",value:function(){return this._providedFQDN}},{key:"getStandardOrigin",value:function(){return this._standardOrigin}},{key:"getSubscribeOrigin",value:function(){return this._subscribeOrigin}}]),e}();n.default=o},function(e,n){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(){t(this,e)}return r(e,[{key:"setSubscribeKey",value:function(e){return this._subscribeKey=e,this}},{key:"setPublishKey",value:function(e){return this._publishKey=e,this}},{key:"setAuthKey",value:function(e){return this._authKey=e,this}},{key:"getSubscribeKey",value:function(){return this._subscribeKey}},{key:"getPublishKey",value:function(){return this._publishKey}},{key:"getAuthKey",value:function(){return this._authKey}}]),e}();n.default=i},function(e,n,t){"use strict";function r(){return+new Date}function i(e){return!!e&&"string"!=typeof e&&(Array.isArray&&Array.isArray(e)||"number"==typeof e.length)}function c(e,n){if(e&&n)if(i(e))for(var t=0,r=e.length;r>t;)n.call(e[t],e[t],t++);else for(var t in e)e.hasOwnProperty&&e.hasOwnProperty(t)&&n.call(e[t],t,e[t])}function a(e){return encodeURIComponent(e)}function o(e,n){var t=e.join(b.URLBIT),r=[];return n?(c(n,function(e,n){var t="object"===(void 0===n?"undefined":g(n))?JSON.stringify(n):n;void 0!==n&&null!==n&&a(t).length>0&&r.push(e+"="+a(t))}),t+="?"+r.join(b.PARAMSBIT)):t}function u(e,n){var t,i=0;return function c(){i+n>r()?(clearTimeout(t),t=setTimeout(c,n)):(i=r(),e())}}function s(e,n){var t=[];return c(e||[],function(e){n(e)&&t.push(e)}),t}function l(e,n){return e.replace(y,function(e,t){return n[t]||e})}function f(e,n){return"undefined"!=typeof setTimeout?setTimeout(e,n):void 0}function h(e){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)});return e&&e(n),n}function d(e,n){var t=[];return c(e||[],function(e,r){t.push(n(e,r))}),t}function p(e){return encodeURIComponent(e).replace(/[!'()*~]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},b=t(9),y=/{([\w\-]+)}/g;e.exports={buildURL:o,encode:a,each:c,updater:u,rnow:r,isArray:i,map:d,pamEncode:p,generateUUID:h,timeout:f,supplant:l,grep:s}},function(e,n){e.exports={PARAMSBIT:"&",URLBIT:"/"}},function(e,n){var t=function(e,n){if(!(this instanceof t))return new t(e,n);var r=this,e=r.url=e||"",i=(r.protocol=n||"Sec-WebSocket-Protocol",e.split("/")),c={ssl:"wss:"===i[0],origin:i[2],publish_key:i[3],subscribe_key:i[4],channel:i[5]};return r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.CLOSE_NORMAL=1e3,r.CLOSE_GOING_AWAY=1001,r.CLOSE_PROTOCOL_ERROR=1002,r.CLOSE_UNSUPPORTED=1003,r.CLOSE_TOO_LARGE=1004,r.CLOSE_NO_STATUS=1005,r.CLOSE_ABNORMAL=1006,r.onclose=r.onerror=r.onmessage=r.onopen=r.onsend=function(){},r.binaryType="",r.extensions="",r.bufferedAmount=0,r.trasnmitting=!1,r.buffer=[],r.readyState=r.CONNECTING,e?(r.pubnub=PUBNUB.init(c),r.pubnub.setup=c,r.setup=c,void r.pubnub.subscribe({restore:!1,channel:c.channel,disconnect:r.onerror,reconnect:r.onopen,error:function(){r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(e){r.onmessage({data:e})},connect:function(){r.readyState=r.OPEN,r.onopen()}})):(r.readyState=r.CLOSED,r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),r)};t.prototype.send=function(e){var n=this;n.pubnub.publish({channel:n.pubnub.setup.channel,message:e,callback:function(e){n.onsend({data:e})}})},t.prototype.close=function(){var e=this;e.pubnub.unsubscribe({channel:e.pubnub.setup.channel}),e.readyState=e.CLOSED,e.onclose({})},e.exports=t}])});
//# sourceMappingURL=pubnub.js.map