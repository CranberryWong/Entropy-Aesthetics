window.requestAnimationFrame||"test"==window.PREFETCH.NOTE.conf.env||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}),!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t()}(this,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}function n(e){G=e}function r(e){Y=e}function i(){return function(){return process.nextTick(c)}}function a(){return"undefined"!=typeof W?function(){W(c)}:l()}function o(){var e=0,t=new J(c),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function s(){var e=new MessageChannel;return e.port1.onmessage=c,function(){return e.port2.postMessage(0)}}function l(){var e=setTimeout;return function(){return e(c,1)}}function c(){for(var e=0;q>e;e+=2){var t=Q[e],n=Q[e+1];t(n),Q[e]=void 0,Q[e+1]=void 0}q=0}function u(){try{var e=require,t=e("vertx");return W=t.runOnLoop||t.runOnContext,a()}catch(n){return l()}}function d(e,t){var n=arguments,r=this,i=new this.constructor(h);void 0===i[tt]&&N(i);var a=r._state;return a?!function(){var e=n[a-1];Y(function(){return M(a,i,e,r._result)})}():C(r,i,e,t),i}function p(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(h);return w(n,e),n}function h(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function g(e){try{return e.then}catch(t){return at.error=t,at}}function v(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function y(e,t,n){Y(function(e){var r=!1,i=v(n,t,function(n){r||(r=!0,t!==n?w(e,n):$(e,n))},function(t){r||(r=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,x(e,i))},e)}function b(e,t){t._state===rt?$(e,t._result):t._state===it?x(e,t._result):C(t,void 0,function(t){return w(e,t)},function(t){return x(e,t)})}function _(e,n,r){n.constructor===e.constructor&&r===d&&n.constructor.resolve===p?b(e,n):r===at?(x(e,at.error),at.error=null):void 0===r?$(e,n):t(r)?y(e,n,r):$(e,n)}function w(t,n){t===n?x(t,m()):e(n)?_(t,n,g(n)):$(t,n)}function k(e){e._onerror&&e._onerror(e._result),S(e)}function $(e,t){e._state===nt&&(e._result=t,e._state=rt,0!==e._subscribers.length&&Y(S,e))}function x(e,t){e._state===nt&&(e._state=it,e._result=t,Y(k,e))}function C(e,t,n,r){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+rt]=n,i[a+it]=r,0===a&&e._state&&Y(S,e)}function S(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,a=e._result,o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?M(n,r,i,a):i(a);e._subscribers.length=0}}function T(){this.error=null}function A(e,t){try{return e(t)}catch(n){return ot.error=n,ot}}function M(e,n,r,i){var a=t(r),o=void 0,s=void 0,l=void 0,c=void 0;if(a){if(o=A(r,i),o===ot?(c=!0,s=o.error,o.error=null):l=!0,n===o)return void x(n,f())}else o=i,l=!0;n._state!==nt||(a&&l?w(n,o):c?x(n,s):e===rt?$(n,o):e===it&&x(n,o))}function E(e,t){try{t(function(t){w(e,t)},function(t){x(e,t)})}catch(n){x(e,n)}}function P(){return st++}function N(e){e[tt]=st++,e._state=void 0,e._result=void 0,e._subscribers=[]}function D(e,t){this._instanceConstructor=e,this.promise=new e(h),this.promise[tt]||N(this.promise),U(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?$(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&$(this.promise,this._result))):x(this.promise,z())}function z(){return new Error("Array Methods must be provided an Array")}function L(e){return new D(this,e).promise}function I(e){var t=this;return new t(U(e)?function(n,r){for(var i=e.length,a=0;i>a;a++)t.resolve(e[a]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,n=new t(h);return x(n,e),n}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(e){this[tt]=P(),this._result=this._state=void 0,this._subscribers=[],h!==e&&("function"!=typeof e&&O(),this instanceof H?E(this,e):F())}function R(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=H}var j=void 0;j=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var U=j,q=0,W=void 0,G=void 0,Y=function(e,t){Q[q]=e,Q[q+1]=t,q+=2,2===q&&(G?G(c):et())},V="undefined"!=typeof window?window:void 0,K=V||{},J=K.MutationObserver||K.WebKitMutationObserver,X="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),et=void 0;et=X?i():J?o():Z?s():void 0===V&&"function"==typeof require?u():l();var tt=Math.random().toString(36).substring(16),nt=void 0,rt=1,it=2,at=new T,ot=new T,st=0;return D.prototype._enumerate=function(e){for(var t=0;this._state===nt&&t<e.length;t++)this._eachEntry(e[t],t)},D.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===p){var i=g(e);if(i===d&&e._state!==nt)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===H){var a=new n(h);_(a,e,i),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},D.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===nt&&(this._remaining--,e===it?x(r,n):this._result[t]=n),0===this._remaining&&$(r,this._result)},D.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){return n._settledAt(rt,t,e)},function(e){return n._settledAt(it,t,e)})},H.all=L,H.race=I,H.resolve=p,H.reject=B,H._setScheduler=n,H._setAsap=r,H._asap=Y,H.prototype={constructor:H,then:d,"catch":function(e){return this.then(null,e)}},H.polyfill=R,H.Promise=H,H});var I18n=I18n||{};I18n.defaultLocale="en",I18n.fallbacks=!1,I18n.defaultSeparator=".",I18n.locale=null,I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,I18n.isValidNode=function(e,t,n){return null!==e[t]&&e[t]!==n},I18n.lookup=function(e,t){var n,t=t||{},r=e,i=this.prepareOptions(I18n.translations),a=i[t.locale||I18n.currentLocale()],t=this.prepareOptions(t);if(a){for("object"==typeof e&&(e=e.join(this.defaultSeparator)),t.scope&&(e=t.scope.toString()+this.defaultSeparator+e),e=e.split(this.defaultSeparator);e.length>0;)if(n=e.shift(),a=a[n],!a){I18n.fallbacks&&!t.fallback&&(a=I18n.lookup(r,this.prepareOptions({locale:I18n.defaultLocale,fallback:!0},t)));break}return!a&&this.isValidNode(t,"defaultValue")&&(a=t.defaultValue),a}},I18n.prepareOptions=function(){for(var e,t={},n=arguments.length,r=0;n>r;r++)if(e=arguments[r])for(var i in e)this.isValidNode(t,i)||(t[i]=e[i]);return t},I18n.interpolate=function(e,t){t=this.prepareOptions(t);var n,r,i,a=e.match(this.PLACEHOLDER);if(!a)return e;for(var o=0;n=a[o];o++)i=n.replace(this.PLACEHOLDER,"$1"),r=t[i],this.isValidNode(t,i)||(r="[missing "+n+" value]"),regex=new RegExp(n.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(regex,r);return e},I18n.translate=function(e,t){t=this.prepareOptions(t);var n=this.lookup(e,t);try{return"object"==typeof n?"number"==typeof t.count?this.pluralize(t.count,e,t):n:this.interpolate(n,t)}catch(r){return this.missingTranslation(e)}},I18n.localize=function(e,t){switch(e){case"currency":return this.toCurrency(t);case"number":return e=this.lookup("number.format"),this.toNumber(t,e);case"percentage":return this.toPercentage(t);default:return e.match(/^(date|time)/)?this.toTime(e,t):t.toString()}},I18n.parseDate=function(e){var t,n;if("object"==typeof e)return e;if(t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/)){for(var r=1;6>=r;r++)t[r]=parseInt(t[r],10)||0;t[2]-=1,n=t[7]?new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else"number"==typeof e?(n=new Date,n.setTime(e)):e.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(n=new Date,n.setTime(Date.parse(e))):(n=new Date,n.setTime(Date.parse(e)));return n},I18n.toTime=function(e,t){var n=this.parseDate(t),r=this.lookup(e);return n.toString().match(/invalid/i)?n.toString():r?this.strftime(n,r):n.toString()},I18n.strftime=function(e,t){var n=this.lookup("date");if(!n)return e.toString();n.meridian=n.meridian||["AM","PM"];var r=e.getDay(),i=e.getDate(),a=e.getFullYear(),o=e.getMonth()+1,s=e.getHours(),l=s,c=s>11?1:0,u=e.getSeconds(),d=e.getMinutes(),p=e.getTimezoneOffset(),h=Math.floor(Math.abs(p/60)),m=Math.abs(p)-60*h,f=(p>0?"-":"+")+(h.toString().length<2?"0"+h:h)+(m.toString().length<2?"0"+m:m);l>12?l-=12:0===l&&(l=12);var g=function(e){var t="0"+e.toString();return t.substr(t.length-2)},v=t;return v=v.replace("%a",n.abbr_day_names[r]),v=v.replace("%A",n.day_names[r]),v=v.replace("%b",n.abbr_month_names[o]),v=v.replace("%B",n.month_names[o]),v=v.replace("%d",g(i)),v=v.replace("%e",i),v=v.replace("%-d",i),v=v.replace("%H",g(s)),v=v.replace("%-H",s),v=v.replace("%I",g(l)),v=v.replace("%-I",l),v=v.replace("%m",g(o)),v=v.replace("%-m",o),v=v.replace("%M",g(d)),v=v.replace("%-M",d),v=v.replace("%p",n.meridian[c]),v=v.replace("%S",g(u)),v=v.replace("%-S",u),v=v.replace("%w",r),v=v.replace("%y",g(a)),v=v.replace("%-y",g(a).replace(/^0+/,"")),v=v.replace("%Y",a),v=v.replace("%z",f)},I18n.toNumber=function(e,t){t=this.prepareOptions(t,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var n,r,i=0>e,a=Math.abs(e).toFixed(t.precision).toString(),o=a.split("."),s=[];for(e=o[0],n=o[1];e.length>0;)s.unshift(e.substr(Math.max(0,e.length-3),3)),e=e.substr(0,e.length-3);if(r=s.join(t.delimiter),t.precision>0&&(r+=t.separator+o[1]),i&&(r="-"+r),t.strip_insignificant_zeros){var l={separator:new RegExp(t.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};r=r.replace(l.zeros,"").replace(l.separator,"")}return r},I18n.toCurrency=function(e,t){return t=this.prepareOptions(t,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),e=this.toNumber(e,t),e=t.format.replace("%u",t.unit).replace("%n",e)},I18n.toHumanSize=function(e,t){for(var n,r,i=1024,a=e,o=0;a>=i&&4>o;)a/=i,o+=1;return 0===o?(n=this.t("number.human.storage_units.units.byte",{count:a}),r=0):(n=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][o]),r=a-Math.floor(a)===0?0:1),t=this.prepareOptions(t,{precision:r,format:"%n%u",delimiter:""}),e=this.toNumber(a,t),e=t.format.replace("%u",n).replace("%n",e)},I18n.toPercentage=function(e,t){return t=this.prepareOptions(t,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),e=this.toNumber(e,t),e+"%"},I18n.pluralize=function(e,t,n){var r;try{r=this.lookup(t,n)}catch(i){}if(!r)return this.missingTranslation(t);var a;switch(n=this.prepareOptions(n),n.count=e.toString(),Math.abs(e)){case 0:a=this.isValidNode(r,"zero")?r.zero:this.isValidNode(r,"none")?r.none:this.isValidNode(r,"other")?r.other:this.missingTranslation(t,"zero");break;case 1:a=this.isValidNode(r,"one")?r.one:this.missingTranslation(t,"one");break;default:a=this.isValidNode(r,"other")?r.other:this.missingTranslation(t,"other")}return this.interpolate(a,n)},I18n.missingTranslation=function(){for(var e='[missing "'+this.currentLocale(),t=arguments.length,n=0;t>n;n++)e+="."+arguments[n];return e+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize,function(){"use strict";var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=angular.module("noteApp",["angularFileUpload","ngAnimate","ngCookies","ngResource","ngSanitize","720kb.tooltips","ui.router","ng-sortable","monospaced.elastic","angucomplete-alt","ngTagsInput","angulartics","angulartics.google.analytics","angulartics.reckoner","angulartics.reckoner_v1","duScroll","ipCookie","pathgather.popeye","angularGrid","angular-clipboard","slickCarousel"]),e.config(["$locationProvider","$stateProvider","$urlRouterProvider","$sceDelegateProvider","$compileProvider","$httpProvider","$analyticsProvider",function(e,t,n,r,i,a,o){var s,l;return e.html5Mode(!0).hashPrefix("!"),a.interceptors.push("LogInterceptor"),o.settings.rc_v1.disableEventTracking=!0,o.settings.rc.disableEventTracking=!0,l=function(e){return"/templates/"+e},window.PREFETCH.staticPage||n.otherwise("/_404"),r.resourceUrlWhitelist(["self","https://www.youtube.com/embed/**","https://player.vimeo.com/video/**","https://instagram.com/p/**","https://vine.co/v/**","https://"+window.PREFETCH.NOTE.s3_bucket+".s3-ap-northeast-1.amazonaws.com/**","http://eplus.jp/sys/**","http://eplus.jp/m/**","https://va.pia.jp/**"]),i.debugInfoEnabled(!1),a.useApplyAsync(!0),window.PREFETCH.staticPage.current&&(s=window.PREFETCH.staticPage.current,t.state("static",{"abstract":!0}).state("static."+s.state_name,{url:s.path})),t.state("_404",{url:"/_404",template:"<not-found></not-found>"}).state("home",{"abstract":!0,template:"<home></home>"}).state("home.home",{url:"/"}).state("author",{"abstract":!0,template:"<author-base></author-base>"}).state("author.home",{url:"/authors?q",template:"<author-index></author-index>"}).state("author.detail",{url:"/authors/{urlname:[0-9A-Za-z_-]+}",template:"<author-detail></author-detail>"}).state("hashtag",{"abstract":!0,template:"<div ui-view></div>"}).state("hashtag.home",{url:"/hashtags?page",template:"\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u4e00\u89a7"}).state("hashtag.detail",{url:"/hashtags/:hashtag?f&search&tab",template:"<hashtag-detail></hashtag-detail>"}).state("magazine",{"abstract":!0,template:"<div ui-view></div>"}).state("magazine.home",{url:"/magazines?page",template:"<magazine-index></magazine-index>"}).state("magazine.detail",{url:"/magazines/{key:m[0-9a-f]{12}}",template:"<magazine-detail></magazine-detail>"}).state("book",{"abstract":!0,template:"<div ui-view></div>"}).state("book.home",{url:"/books?page",template:"\u66f8\u7c4d\u4e00\u89a7"}).state("book.detail",{url:"/books/{key:b[0-9a-f]{12}}",template:"\u66f8\u7c4d\u8a73\u7d30"}).state("setting",{"abstract":!0,template:"<setting-base></setting-base>"}).state("setting.account",{url:"/settings/account",template:"<account-setting></account-setting>"}).state("setting.withdrawal",{url:"/settings/withdrawal",template:"<account-withdrawal></account-withdrawal>"}).state("setting.purchaseHistory",{url:"/settings/purchase_history?date&type",template:"<purchase-history></purchase-history>"}).state("setting.creditCard",{url:"/settings/credit_card",template:"<credit-card></credit-card>"}).state("search",{url:"/search?context&q&sort&size",template:"<search-index></search-index>"}).state("login",{url:"/login?redirectPath&follow&magazineFollow&likable_id&likables",template:"<login></login>"}).state("signup",{url:"/signup?redirectPath&page&follow&magazineFollow&urlname&code&nourlname&from&nkey&likable_id&likables?token",template:"<signup></signup>"}).state("activate",{url:"/activate?token&redirectPath",template:"<activate></activate>"}).state("updateEmail",{url:"/update_email?token",template:"<update-email></update-email>"}).state("resetPassword",{url:"/reset_password?token",template:"<reset-password></reset-password>"}).state("updatePassword",{url:"/update_password?token",template:"<update-password></update-password>"}).state("category",{"abstract":!0,template:"<div ui-view></div>"}).state("category.detail",{url:"/{category:[0-9A-Za-z_]+}?sort&method",template:"<category-detail></category-detail>"}).state("article",{"abstract":!0,template:"<div ui-view></div>"}).state("article.preview",{url:"/preview/{slug:[0-9A-Za-z_-]+}?modal&scrollpos&current_menu_id?prev_access_key",template:"<article-detail></article-detail>"}).state("article.detail",{url:"/{category:[0-9A-Za-z_]+}/{slug:[0-9A-Za-z_-]+}?modal&scrollpos&current_menu_id",template:"<article-detail></article-detail>"})}]),e.run(["$rootScope","$state","$stateParams","$window","$location","$document","$timeout","$q","UserAgent","ScrollPositionObserver","Auth","MessageModal","ContentLoading",function(e,n,r,i,a,o,s,l,c,u,d,p,h){return e.$on("$stateChangeStart",function(t,r,o){var s,l;return r.data||(r.data={setTitle:!0}),i.scrollTo(0,0),h.set(r),"category.detail"!==r.name&&"article.detail"!==r.name||(s=n.href(r.name,o),!s||-1===window.PREFETCH.staticPage.paths.indexOf(s))?(l=[],l.indexOf(r.name)>=0&&d.then(function(e){return e.error?n.go("login",{redirectPath:a.path()},{reload:!0,location:!0,inherit:!0}):void 0}),r.redirectTo&&(t.preventDefault(),n.go(r.redirectTo,o)),e.prevPage="",e.currentPage=""):(t.preventDefault(),void(i.location.href=a.path()))}),e.$on("$stateChangeSuccess",function(r,s,c,u,d){var p,h,m,f,g,v,y,b,_,w;return l(function(){return function(e,t){return s.data.resolveTitle=e,s.data.rejectTitle=t}}(this)).then(function(e){return i.document.title="home.home"===s.name?i.PREFETCH.NOTE.defaultTitle:""+e+" | "+i.PREFETCH.NOTE.siteName,i.PREFETCH.NOTE.enable_user_insight&&null!=i._uic.send_pv?(i._uih.url=document.URL,i._uih.sb=document.title,i._uih.ref=document.referrer,i._uic.send_pv(_uih,_uic)):void 0},function(){return i.document.title=i.PREFETCH.NOTE.defaultTitle}),e.currentPage.match(/\/notes\/n[0-9a-f]{12}/)||(e.prevPage=e.currentPage||o[0].referrer,e.prevState=u.name,e.prevStateParams=d),e.currentPage=a.absUrl(),e.loginPath="/login",-1!==["article.new","article.edit"].indexOf(u.name)&&i.NOTE.editor&&i.NOTE.editor.isActive&&(i.NOTE.editor.destroy(),i.NOTE.editor=null),b=n.href(s.name,c),"/"!==b&&(e.loginPath+="?redirectPath="+encodeURIComponent(b)),f=["article.new","article.edit"],e.hide_navbar=f.indexOf(s.name)>=0?!0:!1,h=["updateEmail"],e.hideFooter=(_=s.name,t.call(h,_)>=0),y=["article.new","article.edit","article.detail"],e.isNotePage=(w=s.name,t.call(y,w)>=0),p=["author.detail"],e.creator_page=!!(p.indexOf(s.name)>=0),m=[],e.magazine_page=!!(m.indexOf(s.name)>=0),g=["article.new","article.edit"],e.noteEditPage=!!(g.indexOf(s.name)>=0),v=["article.home","article.new","updateEmail","resetPassword","updatePassword"],e.noteStylePage=!!(v.indexOf(s.name)>=0)}),e.isSmartPhone=c.isSmartPhone,e.isTablet=c.isTablet,e.isMobile=c.isSmartPhone||c.isTablet,e.isIPhone=c.isIPhone,e.isPC=!e.isSmartPhone&&!e.isTablet,e.isIE=c.isIE,e.isSafari=c.isSafari,e.isWindows=-1!==navigator.platform.indexOf("Win"),e.$state=n,e.$stateParams=r,u.observe()}])}.call(this),function(){"use strict";angular.module("noteApp").controller("DashBoardCtrl",["$scope","$state","Auth","Title","Pv","TransferHistory","Sales","SalesDetail","Purchasers","EcPurchasers",function(e,t,n,r,i,a,o,s,l,c){var u,d;return e.$on("$SendThankyouMessageFinished",function(t,n){var r,i,a,o,s;if(e.purchasers){for(o=e.purchasers,s=[],i=0,a=o.length;a>i;i++)r=o[i],s.push(r.purchase_content_id===n||r.order_id===n?r.already_sent_thankyou=!0:void 0);return s}}),e.initPurchasers=function(){return e.purchaser_sort_type="date_desc",e.purchaser_datespan=moment().format("YYYYMM"),e.purchaseTypeList=[{key:"note_magazine",label:"\u30ce\u30fc\u30c8\u30fb\u30de\u30ac\u30b8\u30f3"}],e.purchaseType="note_magazine",e.page=1,e.load_ok=!1,n.then(function(n){return n.error?void(e.load_ok=!0):(e.currentUser=n.data,e.currentUser.no_urlname_user&&t.go("home.home"),e.currentUser.has_store&&e.purchaseTypeList.push({key:"ec",label:"\u7269\u8ca9"}),l.get({},function(t){var n,r,i,a,o,s;for(e.start_date_str=t.data.start_date_str,e.end_date_str=t.data.end_date_str,e.last_page=t.data.last_page,e.purchasers=t.data.purchasers,e.page+=1,e.load_ok=!0,r=function(e){var t,n,r,i,a,o,s,l;for(i=[],r=new Date,a=o=2014,l=r.getFullYear();l>=2014?l>=o:o>=l;a=l>=2014?++o:--o)for(n=s=1;12>=s;n=++s)if((2014!==a||1!==n&&2!==n&&3!==n)&&(t=a+("0"+n).slice(-2),i.push(t),e===t))return i},e.purchaser_datespans=r(e.purchaser_datespan),e.purchaser_datespans_obj={},o=e.purchaser_datespans,s=[],i=0,a=o.length;a>i;i++)n=o[i],s.push(e.purchaser_datespans_obj[n]=n);return s}))})},e.nextPurchaserPage=function(){return e.load_ok=!1,"ec"===e.purchaseType?c.get({page:e.page,datespan:e.purchaser_datespan},function(t){var n,r,i,a;for(e.last_page=t.data.is_last_page,a=t.data.purchasers,r=0,i=a.length;i>r;r++)n=a[r],e.purchasers.push(n);return e.page+=1}):l.get({page:e.page,sort:e.purchaser_sort_type,datespan:e.purchaser_datespan},function(t){var n,r,i,a;for(e.last_page=t.data.last_page,a=t.data.purchasers,r=0,i=a.length;i>r;r++)n=a[r],e.purchasers.push(n);return e.page+=1})},e.togglePurchaserDateSort=function(){return e.purchaser_sort_type="date_asc"===e.purchaser_sort_type?"date_desc":"date_desc"===e.purchaser_sort_type?"date_asc":"date_desc",e.purchasers=[],e.page=1,e.load_ok=!1,l.get({page:e.page,sort:e.purchaser_sort_type,datespan:e.purchaser_datespan},function(t){return e.last_page=t.data.last_page,e.purchasers=t.data.purchasers,e.page+=1,e.load_ok=!0})},e.togglePurchaserPriceSort=function(){return e.purchaser_sort_type="price_asc"===e.purchaser_sort_type?"price_desc":"price_desc"===e.purchaser_sort_type?"price_asc":"price_desc",e.purchasers=[],e.page=1,e.load_ok=!1,l.get({page:e.page,sort:e.purchaser_sort_type,datespan:e.purchaser_datespan},function(t){return e.last_page=t.data.last_page,e.purchasers=t.data.purchasers,e.page+=1,e.load_ok=!0})},e.filterPurchaseDatespan=function(){return e.purchasers=[],e.page=1,e.load_ok=!1,"ec"===e.purchaseType?c.get({page:e.page,datespan:e.purchaser_datespan},function(t){return e.last_page=t.data.is_last_page,e.purchasers=t.data.purchasers,e.page+=1}):l.get({page:e.page,sort:e.purchaser_sort_type,datespan:e.purchaser_datespan},function(t){return e.last_page=t.data.last_page,e.purchasers=t.data.purchasers,e.page+=1,e.load_ok=!0})},e.sortNoteStats=function(){return i.get({sort:e.sort_index,filter:e.filter,page:1,start_date:e.start_date,end_date:e.end_date},function(t){var n,r,i,a;for(t.data.note_stats.sort(function(t,n){switch(e.sort_index){case"pv":return n.read_count-t.read_count;case"comment":return n.comment_count-t.comment_count;case"like":return n.like_count-t.like_count}}),e.lastPage=t.data.last_page,e.note_stats=t.data.note_stats,a=e.note_stats,r=0,i=a.length;i>r;r++)n=a[r],n.content="TalkNote"===n.type?n.body:n.name;return e.stat_page=2})},u=function(t){return i.get({sort:e.sort_index,filter:t.filter,page:t.page,end_date:t.end_date,start_date:t.start_date,span:t.span},function(n){var r,i,a,o,s,l,c,u,d;if(n.data.note_stats.sort(function(t,n){switch(e.sort_index){case"pv":return n.read_count-t.read_count;case"comment":return n.comment_count-t.comment_count;case"like":return n.like_count-t.like_count;default:return n.read_count-t.read_count}}),t.concat===!0)for(c=n.data.note_stats,a=0,s=c.length;s>a;a++)r=c[a],e.note_stats.push(r);else e.note_stats=n.data.note_stats;for(e.stat_page+=1,e.start_date_str=n.data.start_date_str,e.start_date=n.data.start_date,e.end_date_str=n.data.end_date_str,e.end_date=n.data.end_date,e.arrive_count=n.data.arrive_count,e.total_pv=n.data.total_pv,e.total_like=n.data.total_like,e.total_comment=n.data.total_comment,e.last_calculate_at=n.data.last_calculate_at,e.lastPage=n.data.last_page,e.filter=t.filter,e.load_ok=!0,u=e.note_stats,d=[],o=0,l=u.length;l>o;o++)i=u[o],d.push(i.content="TalkNote"===i.type?i.body:i.name);return d})},e.initStats=function(){return r.set("\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"),e.stat_page=1,d("monthly")},e.changeFilter=function(t){return e.stat_page=1,e.lastPage=!1,d(t)},d=function(r){return e.load_ok=!1,n.then(function(n){return n.error?(e.load_ok=!0,void(e.error=n.error)):(e.currentUser=n.data,e.currentUser.no_urlname_user&&t.go("home.home"),e.sort_index="pv",u({filter:r,page:e.stat_page}))})},e.prevSpan=function(){return n.then(function(t){return t.error?void(e.error=t.error):(e.currentUser=t.data,e.stat_page=1,u({filter:e.filter,page:e.stat_page,end_date:e.end_date,span:"prev"}))})},e.nextSpan=function(){return n.then(function(t){return t.error?void(e.error=t.error):(e.currentUser=t.data,e.stat_page=1,u({filter:e.filter,page:e.stat_page,end_date:e.end_date,span:"next"}))})},e.nextPage=function(){return n.then(function(t){return t.error?void(e.error=t.error):(e.currentUser=t.data,u({filter:e.filter,page:e.stat_page,end_date:e.end_date,start_date:e.start_date,sort:e.sort_index,concat:!0}))})},e.sales_page=1,e.salesDetail=function(t){return s.get({datespan:t},function(n){var r,i,a,o;for(e.note_stats=n.data.note_stats,e.magazine_stats=n.data.magazine_stats,e.user_stats={},e.user_stats.support_num=0,e.user_stats.sales=0,o=n.data.user_stats,i=0,a=o.length;a>i;i++)r=o[i],e.user_stats.support_num+=r.support_num,e.user_stats.sales+=r.sales;return e.subscription_magazine_stats=n.data.subscription_magazine_stats,e.reserved_subscription_magazine_stats=n.data.reserved_subscription_magazine_stats,t?(e.date_str=moment(t,"YYYYMM").format("YYYY\u5e74M\u6708"),e.start_date_str=moment(t,"YYYYMM").startOf("month").format("YYYY/MM/DD"),e.end_date_str=moment(t,"YYYYMM").endOf("month").format("MM/DD")):(e.date_str="\u4eca\u6708",e.start_date_str=moment().startOf("month").format("YYYY/MM/DD"),e.end_date_str=moment().format("MM/DD")),e.status="detail"})},e.initSalesmanage=function(){return e.load_ok=!1,e.status="top",n.then(function(n){return n.error?(e.load_ok=!0,void(e.error=n.error)):(e.currentUser=n.data,e.currentUser.no_urlname_user&&t.go("home.home"),o.get({},function(t){var n,r,i,a,o,s;for(e.start_date_str=t.data.start_date,e.this_month_start_date_str=t.data.start_date,e.this_month_end_date_str=t.data.end_date,e.end_date_str=t.data.end_date,e.current_month_sales=t.data.current_month_sales,e.subscription_current_month_sales=t.data.subscription_current_month_sales,e.total_current_month_sales=t.data.total_current_month_sales,e.total_sales=t.data.total_sales,r=0,e.unpaid_sales=[],e.processed_sales=[],e.unpaid_sales_total=t.data.unpaid_sales_total,e.provisional_unpaid_sales_total=t.data.provisional_unpaid_sales_total,e.unpaid_sales_total_actually=t.data.unpaid_sales_total_actually,e.shortage_sales_transfer=t.data.shortage_sales_transfer,e.now_summarizing=t.data.now_summarizing,o=e.total_sales,s=[],i=0,a=o.length;a>i;i++)n=o[i],n.date_str=moment(n.date,"YYYYMM").format("YYYY\u5e74M\u6708"),"unpaid"===n.status&&e.unpaid_sales.push(n),s.push("done"===n.status||"apply"===n.status||"in_process"===n.status?e.processed_sales.push(n):void 0);return s}))}),e.backSalesmanageTop=function(){return e.status="top"}},e.initTransferHistory=function(){return e.load_ok=!1,n.then(function(n){return n.error?void(e.load_ok=!0):(e.currentUser=n.data,e.currentUser.no_urlname_user&&t.go("home.home"),a.get({},function(t){return e.transfer_histories=t.data.transfer_histories}))})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("FollowCtrl",["$scope","$state","Auth","FollowingList","FollowerList","MagazineFollowers","MagazineSubscribers","Bridge","ContentLink",function(e,t,n,r,i,a,o,s,l){var c,u,d,p;return e.currentUser={},e.isLoggedIn=null,e.followingModel={},e.followerModel={},e.followingModel.following_list=[],e.followerModel.followers_list=[],e.subscriberModel={},e.subscriberModel.subscribers_list=[],e.user={},e.followingPage=1,e.followerPage=1,e.subscriberPage=1,e.initCreatorFollowing=function(){return n.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0),s.user.urlname?(e.user=s.user,e.likerModel=s.likerModel,u()):e.$on("$UserLoaded",function(){return e.user=s.user,u()}),s.likerModel?(e.likerModel=s.likerModel,e.getLikerList=s.getLikerList):e.$on("$LikeListLoaded",function(){return e.likerModel=s.likerModel,e.getLikerList=s.getLikerList})})},u=function(){return r.get({page:e.followingPage,urlname:s.user.urlname},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.following_list,r=0,i=a.length;i>r;r++)n=a[r],e.followingModel.following_list.push(n);return e.followingPage+=1,e.following_last_page=t.data.last_page,e.load_ok=!0},function(){})},e.initCreatorFollowers=function(){return n.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0),s.user.urlname?(e.user=s.user,c()):e.$on("$UserLoaded",function(){return e.user=s.user,c()})})},c=function(){return i.get({page:e.followerPage,urlname:s.user.urlname},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.followers_list,r=0,i=a.length;i>r;r++)n=a[r],e.followerModel.followers_list.push(n);return e.followerPage+=1,e.follower_last_page=t.data.last_page,e.load_ok=!0},function(){return console.err("Error occurred")})},e.nextPage=function(t){switch(t){case"following":return u();case"follower":return c();case"magazineFollower":return d();case"magazineSubscriber":return p();case"likeList":return e.getLikerList()}},e.initMagazineFollowers=function(){return e.load_ok=null,n.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0),null!=s.magazine&&null!=s.magazine.key?(e.magazine=s.magazine,e.magazine.is_my_magazine?d():l.go("magazine",e.magazine)):e.$on("$MagazineLoaded",function(){return e.magazine=s.magazine,e.magazine.is_my_magazine?d():l.go("magazine",e.magazine)})})},d=function(){return a.get({page:e.followerPage,magazine_key:e.magazine.key},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.followers,r=0,i=a.length;i>r;r++)n=a[r],e.followerModel.followers_list.push(n);return e.followerPage+=1,e.follower_last_page=t.data.last_page,e.load_ok=!0},function(){return console.err("Error occurred")})},e.initMagazineSubscribers=function(){return e.load_ok=null,n.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0),null!=s.magazine&&null!=s.magazine.key?(e.magazine=s.magazine,e.magazine.is_my_magazine?p():l.go("magazine",e.magazine)):e.$on("$MagazineLoaded",function(){return e.magazine=s.magazine,e.magazine.is_my_magazine?p():l.go("magazine",e.magazine)})})},p=function(){return o.get({page:e.subscriberPage,magazine_key:e.magazine.key},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.subscribers,r=0,i=a.length;i>r;r++)n=a[r],e.subscriberModel.subscribers_list.push(n);return e.subscriberPage+=1,e.subscriber_last_page=t.data.last_page,e.load_ok=!0},function(){return console.err("Error occurred")})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("LaunchCtrl",["$scope","$stateParams","$location","Auth","Launch",function(e,t,n,r,i){var a,o;return e.container={},o=t.urlname,a=t.id,e.container.redirectPath=n.url(),i.get({urlname:o,id:a},function(t){var n;if(e.container.load_ok=!0,t.error)return e.container.isLoggedIn="auth"===t.error.code?!1:!0,e.container.error=!0,void(e.container.error_msg=t.error.message);e.container.isLoggedIn=!0;for(n in t.data)e.container[n]=t.data[n]})}])}.call(this),function(){"use strict";angular.module("noteApp").controller("LibraryCtrl",["$scope","$state","Note","Auth","Recently","LikedNote","Purchase","MyPurchasedMagazine","MySubscribedMagazine","Title","Bridge",function(e,t,n,r,i,a,o,s,l,c,u){var d;return e.currentUser={},e.isLoggedIn=null,e.noteModel={notes:[]},c.set("\u30de\u30a4\u30e9\u30a4\u30d6\u30e9\u30ea"),e.$on("$scrollBottom",function(t,n){switch(n.current.name){case"home.libraries.purchased":return e.nextPage("purchased");case"home.libraries.liked":return e.nextPage("liked");case"home.libraries.purchasedMagazines":return e.nextPage("purchasedMagazines")}}),e.nextPage=function(t){if(!e.loading){if("purchased"===t||"liked"===t){if(!e.noteModel.nextPage)return}else{if("purchasedMagazines"!==t)return;if(!e.nextMagazinePage)return}return e.loading=!0,"purchased"===t?o.get({note_intro_only:!0,page:e.noteModel.nextPage},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page)}):"liked"===t?a.get({note_intro_only:!0,page:e.noteModel.nextPage},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page)
}):"purchasedMagazines"===t?s.get({page:e.nextMagazinePage},function(t){return t.error?void(e.error=t.error):(e.magazines=e.magazines.concat(t.data.magazines),e.nextMagazinePage=t.data.next_page,e.lastMagazinePage=t.data.last_page,e.loading=!1)}):void 0}},e.initPurchasedNotes=function(){return r.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,u.currentUser=t.data,e.isLoggedIn=!0,e.loading=!0,o.get({note_intro_only:!0},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=t.data.notes,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1)}))})},e.initPurchasedMagazines=function(){return r.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,u.currentUser=t.data,e.isLoggedIn=!0,e.loading=!0,s.get(null,function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.magazines=t.data.magazines,e.lastMagazinePage=t.data.last_page,e.nextMagazinePage=t.data.next_page)}))})},e.initSubscribedMagazines=function(){return r.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,u.currentUser=t.data,e.isLoggedIn=!0,e.loading=!0,l.get(null,function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.magazines=t.data.magazines,e.lastMagazinePage=t.data.last_page,e.nextMagazinePage=t.data.next_page)}))})},e.initViewedNotes=function(){return e.isViewedNotes=!0,r.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,u.currentUser=t.data,e.isLoggedIn=!0,e.loading=!0,i.get({note_intro_only:!0},function(t){var n;return e.loading=!1,t.error?void(e.error=t.error):(n=d(t.data.notes,t.data.read_history_ids),e.noteModel.notes=n,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1)}))})},e.initLikedNotes=function(){return e.isLikedNotes=!0,r.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,u.currentUser=e.currentUser,e.isLoggedIn=!0,e.loading=!0,a.get({note_intro_only:!0},function(t){var n;return e.loading=!1,t.error?void(e.error=t.error):(n=d(t.data.notes,t.data.liked_note_ids),e.noteModel.notes=n,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1)}))})},e.setNoteTypeSelect=function(t){return e.noteTypeSelect=t},d=function(e,t){var n,r,i,a,o,s,l;if(null==t||0===t.length)return e;for(i=[],a=0,s=t.length;s>a;a++)for(n=t[a],o=0,l=e.length;l>o;o++)r=e[o],n===r.id&&i.push(r);return i},e.switchLibraryFilter=function(n){var r;return e.libraryFilterShow=!1,r="home.libraries."+n,t.go(r)}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("MagazineCtrl",["$scope","$rootScope","$location","$state","$filter","$stateParams","$timeout","$window","Auth","Magazine","Bridge","Title","User","UserMagazine","MagazineReadHistory","MagazinePurchase","FanClubConfirm","FanClubTransfer","MagazineLayout","MagazineSectionLayout","CustomDomainContext","ContentLink",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w){return e.$state=r,e.loading=!1,e.contents=[],e.currentPage=1,e.isLastPage=!1,e.searchTargetYm=null,e.searcnCategoryName=null,e.searcnHashtagId=null,e.initRenewMagazineTop=function(){return e.urlname=r.params.urlname,e.key=r.params.key,_.isCdAccess()&&(e.key=_.key,e.urlname=_.urlname),e.switchLoading(!0),l.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0),e.fetchMagazineLauout(),e.switchLoading(!1)})},e.fetchMagazineLauout=function(){return y.get({ym:r.params.date,magazine_key:e.key,hashtag_id:r.params.hashtag_id},function(t){var n,a,o,l,c,d,p,h,m,f,g,v,y,b,k;if(t.error)return void("not_found"===t.error.code&&r.go("_404",null,{location:!1}));if(l=t.data.magazine_layout,"magazine.home"===r.current.name&&e.urlname!==l.user.urlname)return w.go("magazine",l,{inherit:!0});if(!_.isCdAccess()&&l.custom_domain&&(r.current.name="magazine.home"))return c=l.custom_domain.tls?"https":"http",s.location.href=""+c+"://"+l.custom_domain.host;for(e.magazine=l,u.magazine=e.magazine,y=t.data.magazine_layout.page_layout.section.contents,p=0,f=y.length;f>p;p++)a=y[p],e.contents.push(a);for(e.isLastPage=t.data.magazine_layout.page_layout.section.is_last_page,e.magazineTotalCount=t.data.magazine_layout.page_layout.section.total_count,e.contentTotalCount=t.data.magazine_layout.page_layout.section.total_count,e.magazine.cover=t.data.magazine_layout.cover_landscape||i("defaultMagazineCover")(),e.magazine.own=e.currentUser?e.magazine.user.id===e.currentUser.id:!1,d=[],b=e.magazine.archive_note_counters,h=0,g=b.length;g>h;h++)for(n=b[h],k=n.counters,m=0,v=k.length;v>m;m++)o=k[m],d.push({summary_date:o.summary_date,name:""+n.year+"\u5e74"+o.month+"\u6708"});return e.selectCounterOptions=d,e.switchLoading(!1)},function(){return r.go("_404",null,{location:!1})})},e.fetchMagazineSectionLayout=function(t){return null==t&&(t=1),b.get({magazine_key:r.params.key,page:t,ym:e.searchTargetYm,hashtag_id:e.searcnHashtagId},function(t){var n,r,i,a;if(t.error)return void console.log(t.error);for(a=t.data.section.contents,r=0,i=a.length;i>r;r++)n=a[r],e.contents.push(n);return e.isLastPage=t.data.section.is_last_page,e.contentTotalCount=t.data.section.total_count,e.switchLoading(!1)})},e.switchLoading=function(t){return e.loading=t},e.$on("$MagazineTopReload",function(){return location.reload()}),e.clickCover=function(){return t.isPC?void 0:location.reload()},e.initMagazineTop=function(){return e.urlname=r.params.urlname,e.key=r.params.key,_.isCdAccess()&&(e.key=_.key,e.urlname=_.urlname),l.then(function(s){return s.error?e.isLoggedIn=!1:(e.currentUser=s.data,e.isLoggedIn=!0),c.get({magazine_key:e.key},function(s){var l,c,p,h,f,v,y,b;if(s.error)return void("not_found"===s.error.code&&r.go("_404",null,{location:!1}));if("magazine.home"===r.current.name&&e.urlname!==s.data.user.urlname)return w.go("magazine",s.data,{inherit:!0});if(s.data.is_jointly_managed===!0&&s.data.editors&&s.data.editors[0].user_id!==s.data.user.id){for(c=[],h=y=0,b=s.data.editors.length;b>=0?b>y:y>b;h=b>=0?++y:--y)if(l=s.data.editors[h],l.user_id===s.data.user.id){c.push(l),s.data.editors.splice(h,1);break}s.data.editors=c.concat(s.data.editors)}return e.magazine=s.data,e.magazine.cover=s.data.cover||i("defaultMagazineCover")(),u.magazine=e.magazine,t.$broadcast("$MagazineLoaded"),t.urlname_for_message=e.magazine.user.urlname,t.urlname_for_tokusyo=e.magazine.user.urlname,r.params.confirmation_key&&g.save({urlname:r.params.urlname,confirmation_key:r.params.confirmation_key},function(t){return t.error&&console.log("Failed to get fan club"),e.magazine.fan_club.is_member=t.data.status,r.go("magazine.home",{urlname:r.params.urlname,key:r.params.key,confirmation_key:null})}),f=[],e.magazine.name?i("truncate")(e.magazine.name,100)&&f.push(i("truncate")(e.magazine.name,100)):f.push(i("truncate")(e.magazine.name,100)),f.push(null!=e.magazine.user.nickname?e.magazine.user.nickname:e.magazine.user.urlname),d.set(f),"magazine.relocation"===r.current.name?e.magazine.relocation=!0:"purchaseLanding"===r.current.name?e.magazine.subscription_info&&e.magazine.subscription_info.can_advance_purchase||r.go("_404",null,{location:!1}):p="/"+e.magazine.user.urlname+"/m/"+e.magazine.key,v=navigator.userAgent,v.indexOf("facebookexternalhit")>0||v.indexOf("PhantomJS")>0||v.indexOf("MSIE")>0||v.indexOf("Trident")>0||a.modal||"magazine.home"===r.current.name||"cdMagazine.home"===r.current.name||null!=r.params.view||(n.path(p),history.replaceState({},p,p)),r.params.modal&&(e.init_action="modalopen"),o(function(){return m.save({key:e.magazine.key})},1e4,!1)},function(){return r.go("_404",null,{location:!1})})})},e.initUserMagazines=function(){var t,n;return n=_.isCdAccess()?_.key:a.urlname,t=function(){return h.get({urlname:n,includes_editable:!0},function(t){return t.error?void console.log(t.error):e.magazines=t.data.magazines},function(){return console.error("Failed to get a magazine")})},l.then(function(n){return n.error?e.isLoggedIn=!1:(e.currentUser=n.data,e.isLoggedIn=!0),u.user.urlname?t():e.$on("$UserLoaded",function(){return t()})})},e.sendFanClubEamilConfirmation=function(t){return t?v.save({urlname:r.params.urlname,email:t},function(t){return t.error?void((t.error.code="not_found")?(e.emailNotFound=!0,e.fanClubEmailTried=!0):console.log(t.error)):(e.fanClubEmailTried=!1,e.fanClubEmailSent=!0)}):void(e.fanClubEmailTried=!0)},e.onEmailChange=function(){return e.fanClubEmailTried=!1}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("MagazineEditorCtrl",["$scope","$state","$stateParams","$upload","$q","$location","Auth","Magazine","OurMagazine","MagazineEditor","ImageUploadMagazineCoverDelete","MessageModal","DistributionRatioModal","MagazineLayout","ContentLink","$window",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f){var g,v,y,b,_,w,k,$;return e.authenticate=function(){var n;return n=i.defer(),c.auth({magazine_key:t.params.key},function(t){return e.authenticated=!0,e.current_editor=t.data,e.magazine=t.data.magazine,void 0===e.magazine.cover&&(e.magazine.cover={}),e.magazineEdit={changed:!1,removeMagazineCoverFlag:!1},e.maxAllowedPrice=e.current_editor.has_authority_remove_price_restriction&&e.hasAdminAuthority()?5e4:1e4,n.resolve()},function(e){b(e.status),n.reject({message:e.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),n.promise.then(function(){return h.get({magazine_key:t.params.key},function(t){return t.error?void console.log(t.error):(e.magazine_layout=t.data.magazine_layout,e.magazineEdit.layoutType=t.data.magazine_layout.page_layout.style)})})},e.initHome=function(){return g(e.magazine,e.magazineEdit)},e.onClickLayout=function(t){return t!==e.magazineEdit.layoutType?(e.magazineEdit.layoutType=t,e.onMagazineChanged()):void 0},e.initEditors=function(){return e.currentUser=f.PREFETCH.NOTE.user,c.get({magazine_key:t.params.key},function(t){var n,r,i,a,o;for(e.magazine.is_jointly_managed===!1&&0===t.data.editors.length&&t.data.editors.push({user_id:e.current_editor.id,role:e.current_editor.editor_role,status:"active",distribution_ratio:100,user:{id:e.current_editor.id,urlname:e.current_editor.urlname,nickname:e.current_editor.nickname,user_profile_image_path:e.current_editor.user_profile_image_path}}),r={root:[],admin:[],member:[]},o=t.data.editors,i=0,a=o.length;a>i;i++)n=o[i],r[n.role].push(n);return e.editors=r.root.concat(r.admin.concat(r.member)),e.remainingToInvite=e.magazine.max_editors_count-(e.editors.length||1),e.data={already_picked_editors:e.editors,already_picked_user_tags:e.editors.map(function(e){return{user_id:e.user_id}})},e.ableToInvite=function(){return e.magazine.is_jointly_managed&&e.magazine.is_owner_premium_user&&e.hasAdminAuthority()&&e.magazine.price>0&&e.remainingToInvite>0?!0:e.magazine.is_jointly_managed===!1&&e.magazine.price>0&&e.current_editor.has_authority_jointly_managed_magazine&&e.remainingToInvite>0?!0:e.magazine.is_jointly_managed&&e.hasAdminAuthority()&&0===e.magazine.price?!0:e.magazine.is_jointly_managed===!1&&0===e.magazine.price?!0:!1}()},function(e){return b(e.status)})},e.initSalesManage=function(){return v(new Date)},e.hasAdminAuthority=function(){return"admin"===e.current_editor.editor_role||e.hasRootAuthority()},e.hasRootAuthority=function(){return"root"===e.current_editor.editor_role},e.switchMagazineStatus=function(){var t;return t="public"===e.magazineEdit.status?"private":"public",e.magazineEdit.status=t,e.onMagazineChanged()},e.updateMagazine=function(){var t;return e.processing=!0,t={magazine_key:e.magazineEdit.key,name:e.magazineEdit.name,description:e.magazineEdit.description,price:e.magazineEdit.price,status:e.magazineEdit.status,section_layout_id:e.magazineEdit.sectionLayoutId,layout_type:e.magazineEdit.layoutType,message:e.magazineEdit.message},e.magazineEdit.cover.temp_image?w().then(function(){return $()}).then(function(){return t.cover_key=e.magazineEdit.cover.key,k(t)}):e.magazineEdit.removeMagazineCoverFlag?w().then(function(){return k(t)}):k(t)},e.onFileSelect=function(t,n){var r,i;if("magazine_cover"===n)return r=["image/jpeg","image/png"],-1===r.indexOf(t[0].type)?d.show({message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"}):t[0].size>5e6?d.show({message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):(e.magazineEdit.cover.temp_image=t[0],i=new FileReader,i.readAsDataURL(t[0]),i.onload=function(t){return e.magazineEdit.cover.url=t.target.result,e.onMagazineChanged(),e.$apply()})},e.removeMagazineCover=function(){return e.magazineEdit.cover.temp_image=null,e.magazineEdit.cover.url=null,e.magazineEdit.cover.key=null,e.magazineEdit.removeMagazineCoverFlag=!0,e.magazineEdit.changed=!0},e.onMagazineChanged=function(){return e.magazineEdit.changed=!0},e.confirmLeave=function(){var n;return n=function(){var e;return e=i.defer(),c.leave({magazine_key:t.params.key},function(){return e.resolve()},function(t){return e.reject({message:t.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},d.confirm({title:"\u30de\u30ac\u30b8\u30f3\u304b\u3089\u8131\u9000",message:"<span class='txt-bold'>"+e.magazine.name+"</span>\u304b\u3089\u8131\u9000\u3057\u307e\u3059\u3002<br>\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"<span class='txt-bold'>"+e.magazine.name+"</span>\u304b\u3089\u8131\u9000\u3057\u307e\u3057\u305f\u3002",process:n,callback:_})},e.confirmRolify=function(n,r){var a,o,s;return s={admin:"\u7ba1\u7406\u8005",member:"\u30e1\u30f3\u30d0\u30fc"},a=n.user.nickname||n.user.urlname,o=function(){var e;return e=i.defer(),c.rolify({magazine_key:t.params.key,user_id:n.user_id,role:r},function(){return e.resolve()},function(t){return e.reject({message:t.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},d.confirm({title:"\u6a29\u9650\u306e\u5909\u66f4",message:"<span class='txt-bold'>"+a+"</span>\u3055\u3093\u3092"+s[n.role]+"\u304b\u3089"+s[r]+"\u306b\u3057\u307e\u3059\u3002<br>\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:""+s[r]+"\u306b\u3057\u307e\u3057\u305f\u3002",process:o,callback:e.initEditors})},e.confirmDeactivate=function(n){var r,a;return r=n.user.nickname||n.user.urlname,a=function(){var e;return e=i.defer(),c["delete"]({magazine_key:t.params.key,user_id:n.user_id},function(){return e.resolve()},function(t){return e.reject({message:t.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},d.confirm({title:"\u904b\u55b6\u30e1\u30f3\u30d0\u30fc\u306e\u524a\u9664",message:"<span class='txt-bold'>"+r+"</span>\u3055\u3093\u3092<br>\u904b\u55b6\u30e1\u30f3\u30d0\u30fc\u304b\u3089\u524a\u9664\u3057\u307e\u3059\u3002<br>\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f<div class='bg-warning space-t-1'>\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u3059\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002<br>"+(""+r+"\u3055\u3093\u306e\u30ce\u30fc\u30c8\u306f\u30de\u30ac\u30b8\u30f3\u304b\u3089\u524a\u9664\u3055\u308c\u307e\u3059\u3002</div>"),doneMessage:"\u904b\u55b6\u30e1\u30f3\u30d0\u30fc\u306e\u524a\u9664\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002",process:a,callback:e.initEditors})},e.confirmResendInvitation=function(n){var r,a;return r=n.user.nickname||n.user.urlname,a=function(){var e;return e=i.defer(),c.invite({magazine_key:t.params.key,user_ids:[n.user_id]},function(){return e.resolve()},function(t){return e.reject({message:t.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},d.confirm({title:"\u627f\u8a8d\u30e1\u30fc\u30eb\u306e\u518d\u9001\u4fe1",message:"<span class='txt-bold'>"+r+"</span>\u3055\u3093\u306b<br>\u627f\u8a8d\u30e1\u30fc\u30eb\u3092\u518d\u9001\u3057\u307e\u3059\u3002<br>\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u627f\u8a8d\u30e1\u30fc\u30eb\u3092\u518d\u9001\u3057\u307e\u3057\u305f\u3002",process:a,callback:e.initEditors})},e.ableToInvite=function(){return e.magazine.is_jointly_managed&&e.hasAdminAuthority()&&e.remainingToInvite>0?!0:e.magazine.is_jointly_managed===!1&&e.current_editor.has_authority_jointly_managed_magazine&&e.remainingToInvite>0?!0:e.magazine.is_jointly_managed===!1&&0===e.magazine.price&&e.remainingToInvite>0?!0:void 0},e.invite=function(e){var n;return n=i.defer(),e.magazine_key=t.params.key,c.invite(e,function(){return n.resolve()},function(e){return n.reject({message:e.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),n.promise},e.showDistributionRatioModal=function(){return p.show({magazineKey:t.params.key,editors:angular.copy(e.editors),callback:e.initEditors})},e.showPremiumAppealModal=function(){return d.showTemplate({templateUrl:"/templates/modal/premium_appeal_modal"})},e.getWholeSales=function(){return e.salesSpanMode="all",y()},e.getAnnualSales=function(){var t;return t=new Date,e.startDate=new Date(t.getFullYear()-1,t.getMonth(),1),e.endDate=new Date(t.getFullYear(),t.getMonth(),0),e.salesSpanMode="annual",y({annual:!0})},e.getSalesPrevMonth=function(){var t,n,r;return t=e.startDate,r=0===t.getMonth()?t.getFullYear()-1:t.getFullYear(),n=0===t.getMonth()?11:t.getMonth()-1,e.startDate=new Date(r,n,1),e.endDate=new Date(r,n+1,0),y({month:""+e.startDate.getFullYear()+("0"+(e.startDate.getMonth()+1)).substr(-2)})},e.getSalesNextMonth=function(){var t,n,r;return t=e.startDate,r=11===t.getMonth()?t.getFullYear()+1:t.getFullYear(),n=11===t.getMonth()?0:t.getMonth()+1,e.startDate=new Date(r,n,1),e.endDate=new Date(r,n+1,0),y({month:""+e.startDate.getFullYear()+("0"+(e.startDate.getMonth()+1)).substr(-2)})},e.isSalesNextLimit=function(){var t;return e.endDate?(t=new Date,e.endDate.getFullYear()===t.getFullYear()&&e.endDate.getMonth()===t.getMonth()):!1},_=function(){return m.go("magazine",e.magazine_layout)},b=function(e){return 404===e?t.go("_404",null,{location:!1}):_()},g=function(e,t){var n,r;r=[];for(n in e)r.push(t[n]=e[n]);return r},w=function(){var t;return t=i.defer(),u.put({magazine_key:e.magazineEdit.key},function(){return e.magazineEdit.cover.key=null,t.resolve()},function(){return console.log("Error occurred")}),t.promise},$=function(){var t;return t=r.upload({url:"/api/v1/image_upload/magazine_cover",file:e.magazineEdit.cover.temp_image}).success(function(t){return null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):(e.magazineEdit.cover.url=t.data.url,e.magazineEdit.cover.key=t.data.key)}).error(function(e,t){return 422===t?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):void 0})},k=function(t){return l.put(t,function(t){return g(t.data,e.magazine),e.magazineEdit.changed=!1,e.processing=!1,d.show({message:"\u30de\u30ac\u30b8\u30f3\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002",callback:function(){return location.reload()}})},function(t){return e.processing=!1,d.show({message:t.data.error})})},y=function(n){var r;return null==n&&(n={}),r={magazine_key:t.params.key},n.month&&(r.date_span=n.month),r.annual=n.annual===!0,l.sales(r,function(t){return e.sales=t.data},function(){return _()})},v=function(t){var n;return n=""+t.getFullYear()+("0"+(t.getMonth()+1)).substr(-2),e.startDate=new Date(t.getFullYear(),t.getMonth(),1),e.endDate=new Date(t.getFullYear(),t.getMonth()+1,0),e.salesSpanMode="month",y({month:n})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("MagazineFollowerCtrl",["$scope","$state","MagazineFollowers","$timeout",function(e,t,n){var r,i;return e.followers=[],e.initMagazineFollowers=function(){return e.$window=window,e.isLoading=!1,e.currentPage=0,e.isLastPage=!1,e.totalCount=0,e.csvLinkPath="/api/v2/magazines/"+e.magazine.key+"/users?context=followers",e.$on("$scrollBottom",function(){return function(){return i()}}(this)),r({page:1})},i=function(){return!e.isLoading&&!e.isLastPage&&e.currentPage>0?r({page:e.currentPage+1}):void 0},r=function(t){return null==t&&(t={}),e.isLoading=!0,n.get({magazine_key:e.magazine.key,page:t.page,per_page:20},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.followers,r=0,i=a.length;i>r;r++)n=a[r],e.followers.push(n);return e.currentPage+=1,e.isLastPage=t.data.last_page,e.isLoading=!1,e.totalCount=t.data.total_count},function(){return console.err("Error occurred")})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("MagazinePurchaserCtrl",["$scope","$state","MagazinePurchasers",function(e,t,n){var r,i;return e.initMagazinePurchasers=function(){return e.$window=window,e.currentPage=0,e.isLastPage=!1,e.purchasers=[],e.csvLinkPath="/api/v2/magazines/"+e.magazine.key+"/users?context=purchasers",e.totalCount=0,e.$on("$scrollBottom",function(){return function(){return i()}}(this)),r({page:0})},i=function(){return!e.isLoading&&!e.isLastPage&&e.currentPage>0?r({page:e.currentPage+1}):void 0},r=function(t){return null==t&&(t={}),e.isLoading=!0,n.get({magazine_key:e.magazine.key,page:t.page,per_page:20},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.purchasers,r=0,i=a.length;i>r;r++)n=a[r],e.purchasers.push(n);return e.currentPage+=1,e.isLastPage=t.data.last_page,e.isLoading=!1,e.totalCount=t.data.total_count},function(){return console.err("Error occurred")})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("MagazineSubscriberCtrl",["$scope","$state","$stateParams","MagazineSubscribers","$document","$timeout","MagazineSubscriberDuration","$filter",function(e,t,n,r,i,a,o,s){var l,c,u;return e.initMagazineSubscribers=function(){return e.subscribers=[],e.$window=window,e.status="active",e.month=n.month,e.monthStr=n.month?s("date")(n.month+"-01","yyyy\u5e74MM\u6708"):null,e.isLoading=!1,e.currentPage=0,e.isLastPage=!1,e.totalCount=0,e.listMonth=[],e.csvLinkPath="/api/v2/magazines/"+e.magazine.key+"/users?context=subscribers",i.on("click",function(t){return a($(t.target).hasClass("status-tab")?function(){return function(){return e.flipStatus=!0,e.flipMonth=!1}}(this):$(t.target).hasClass("month-tab")?function(){return function(){return e.flipMonth=!0,e.flipStatus=!1}}(this):function(){return function(){return e.flipStatus=!1,e.flipMonth=!1}}(this))}),e.$on("$scrollBottom",function(){return function(){return u()}}(this)),l(),c({page:0})},l=function(){return o.get({magazine_key:e.magazine.key},function(t){return t.error?void(e.error=t.error):e.listMonth=t.data.durations},function(){return console.err("Error occurred")})},c=function(t){return null==t&&(t={}),e.isLoading=!0,r.get({magazine_key:e.magazine.key,page:t.page,status:e.status,month:e.month},function(t){var n,r,i,a;if(t.error)return void(e.error=t.error);for(a=t.data.subscribers,r=0,i=a.length;i>r;r++)n=a[r],n.started_at=new Date,e.subscribers.push(n);return e.currentPage+=1,e.isLastPage=t.data.last_page,e.isLoading=!1,e.totalCount=t.data.total_count},function(){return console.err("Error occurred")})},u=function(){return!e.isLoading&&!e.isLastPage&&e.currentPage>0?c({page:e.currentPage+1}):void 0},e.changeCondition=function(t){switch(null==t&&(t="active"),e.currentPage=0,e.subscribers=[],t){case"active":e.status="active";break;case"in_active":e.status="in_active"}return c({page:0})},e.changeMonthCondition=function(n){return e.currentPath=0,e.subscribers=[],e.month=s("date")(n,"yyyy-MM"),e.monthStr=s("date")(n,"yyyy\u5e74MM\u6708"),t.go("magazine_edit.subscribers",{month:e.month})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("ManualRecommendMagazineCtrl",["$scope","$state","ManualRecommendedMagazines","SpTopStash",function(e,t,n,r){var i,a,o;return e.manualRecommendMagazines=[],e.page=0,e.lastPage=null,e.nextPage=null,e.loading=!1,e.stopLoading=!1,a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours()),i=0,e.getManualRecommendMagazine=function(){var t;return e.loading=!0,e.page+=1,t={page:e.page},n.get(t,function(t){return t.data&&t.data.magazines.length&&(e.manualRecommendMagazines=e.manualRecommendMagazines.concat(t.data.magazines),r.stash({manualRecommendMagazines:e.manualRecommendMagazines,page:e.page,nextPage:t.data.next_page,lastPage:t.data.last_page,stamp:o})),e.lastPage=t.data.last_page,e.nextPage=t.data.next_page,e.loading=!1,i+=1,e.stopLoading=i%3===0})},e.init=function(){var t;return t=r.stashPop(),t&&t.hasOwnProperty("manualRecommendMagazines")&&t.stamp.getTime()===o.getTime()?(e.manualRecommendMagazines=t.manualRecommendMagazines,e.page=t.page,e.lastPage=t.lastPage,r.stash(t)):e.getManualRecommendMagazine()},e.$on("$scrollBottom",function(){return e.lastPage||e.loading||e.stopLoading?void 0:e.getManualRecommendMagazine()})}])}.call(this),function(){"use strict";angular.module("noteApp").controller("NavBarCtrl",["$scope","$rootScope","$timeout","$window","$location","$state","Cookie","Auth","Notification","ActivationResend","FlashModal","Bridge","Title","CurrentUser","TimelineStash","UserAgent","MagazineLayout","CustomDomainContext","UserPopupModal","Category","SearchHistories","HashtagWhitelist","Contest",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w){var k;return e.$location=i,t.$location=i,e.currentUser={},e.categories=[],e.contestCount=r.PREFETCH.NOTE.contest_count,e.hashtags=[],e.isLoggedIn=null,e.notificationModel=e.notificationModel||{notifications:[]},e.isIPhone=f.isIPhone,e.isAndroid=f.isAndroid,e.isCdAccess=v.isCdAccess(),e.noteBaseUrl=v.getNoteBaseUrl(),e.showEcCart=r.PREFETCH.NOTE.show_ec_cart,e.cdLogo=v.logoUrl,e.defaultLogoUrl=r.PREFETCH.NOTE.defaultImage.logo_url,e.renewalSearchObj={renewalSearch:!1},k=null,e.getCategories=function(){return b.get({camelize:!1},function(){return function(t){return e.categories=t.data.categories}}(this),function(e){return console.log(e)})},e.getHashtags=function(){return e.hashtags=w.get(10)},e.getLen=function(e){var t,n,r;for(r=0,n=0;n<e.length;)t=e.charCodeAt(n),r+=t>=0&&129>t||63728===t||t>=65377&&65440>t||t>=63729&&63732>t?.5:1,n++;return r},e.isCdUser=function(){return e.isCdAccess?v.urlname===e.currentUser.urlname?!0:!1:!0},e.megaMenu={categories:f.isSmartPhone?!0:!1,hashtags:f.isSmartPhone?!0:!1,type:null,onFlag:f.isSmartPhone?!0:!1},e.openMegaMenu=function(t,n){return f.isSmartPhone?void 0:(e.megaMenu.onFlag=!0,e.megaMenu.type&&e.megaMenu.type!==n&&(e.megaMenu[e.megaMenu.type]=!1),e.megaMenu.type=n,e.megaMenu[n]=!0)},e.closeMegaMenu=function(t,r){return f.isSmartPhone?void 0:(e.megaMenu.onFlag=!1,e.closeMenuTimeout=n(function(){return e.megaMenu.type&&e.megaMenu.type===r&&e.megaMenu.onFlag?n.cancel(e.closeMenuTimeout):e.megaMenu[r]=!1},100))},e.showCagegoriesFlag=function(){return f.isSmartPhone?a.is("home.home")||a.is("timeline")||a.is("categories")?(e.megaMenu.hashtags=!1,!0):(e.megaMenu.hashtags=!0,!1):!0},e.showHashtagsFlag=function(){return f.isSmartPhone?!1:!0},e.clickNoteLogo=function(e){var t;return e.preventDefault(),v.isCdAccess()?"cdMagazine.home"===a.current.name||"cdCreator.home"===a.current.name?r.location.href="/":(t="magazine"===v.type?"cdMagazine.home":"cdCreator.home",a.go(t)):"home.home"===a.current.name?location.reload(!0):(a.is("showTextNoteFriendly")&&m.clear(),a.go("home.home"))},e.$on("$UserUnFollowed",function(t,n){var r,i,a,o,s;for(o=e.notificationModel.notifications,s=[],i=0,a=o.length;a>i;i++)r=o[i],n===r.notified_user_id?(r.is_followed=!r.is_followed,s.push(r.is_just_followed=r.is_followed)):s.push(void 0);return s}),e.$on("$UserFollowed",function(t,n){var r,i,a,o,s;for(o=e.notificationModel.notifications,s=[],i=0,a=o.length;a>i;i++)r=o[i],n===r.notified_user_id?(r.is_followed=!r.is_followed,s.push(r.is_just_followed=r.is_followed)):s.push(void 0);return s}),e.searchOn=function(){return e.isSearch=!0},e.searchOff=function(){return e.isSearch=!1},e.inputFocus=function(){return n(function(){return angular.element(".renewal-p-icon--search").on("click",function(){return angular.element("#hashtag_search_autocomplete_value").focus()})},300)},(e.isIPhone||e.isAndroid)&&e.inputFocus(),e.initNavBar=function(){return e.getCategories(),e.getHashtags(),h.then(function(n){return n.error?(e.error=n.error,e.isLoggedIn=!1):(e.currentUser=n.data,e.isLoggedIn=!0,e.navBarLoaded=!0,e.notificationModel.notificationNum=n.data.unread_notification_num),!e.isLoggedIn&&e.isTablet&&"/"===i.path()?angular.element(document.head).find('meta[name="viewport"]').attr("content","width=1024, user-scalable=no, maximum-scale=1.0"):angular.element(document.head).find('meta[name="viewport"]').attr("content","width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"),e.isLoggedIn?_.get().$promise.then(function(){return function(e){return t.historyWords=e.data.words}}(this)):t.historyWords=[]})},e.focusIn=function(){var n;return n=angular.element("#hashtag_search_autocomplete_value").val(),!n&&e.isLoggedIn&&t.historyWords&&t.historyWords.length>0?t.showHistories=!0:void 0},e.deleteSearchWord=function(e,n){var r;return e.stopPropagation(),_["delete"]({word:n,mode:"one"}),r=t.historyWords.indexOf(n),t.historyWords.splice(r,1),t.historyWords.length<=0?t.showHistories=!1:void 0},e.deleteSearchWords=function(e){return e.stopPropagation(),_["delete"]({mode:"all"}),t.historyWords=[],t.showHistories=!1},e.$on("$stateChangeSuccess",function(){var t,n;return a.is("home.home")&&!e.isLoggedIn||"SessionsCtrl"===a.current.controller||(e.infoMsgDisplayed=!0),(a.is("showTextNoteFriendly")||a.is("showTextNote")||v.isCdAccess()&&"magazine"===v.type&&a.is("cdMyNote")||v.isCdAccess()&&"creator"===v.type&&a.is("cdMyNote"))&&(t=v.isCdAccess()&&"magazine"===v.type?v.key:a.params.magazine_key,e.creatorUrlname=v.isCdAccess()&&"creator"===v.type?v.key:a.params.creator_urlname,t&&g.get({magazine_key:t,no_section:!0},function(n){return function(r){return r.error?void("not_found"===r.error.code&&n.$state.go("_404",null,{location:!1})):(e.magazine=r.data.magazine_layout,e.currentMenuId=a.params.current_menu_id,e.magazineKey=t,e.magazineUrlname=e.magazine.user.urlname)}}(this))),angular.element(".renewal-l-header").show(),angular.element(".footer").show(),window.PREFETCH.NOTE.user_popup&&!e.userPopupOpenedFlag?(n={title:"note\u304b\u3089\u306e\u304a\u77e5\u3089\u305b",message:window.PREFETCH.NOTE.user_popup.body,subMessage:window.PREFETCH.NOTE.user_popup.subText,image:window.PREFETCH.NOTE.user_popup.iconImagePath,count:window.PREFETCH.NOTE.user_popup.count,type:window.PREFETCH.NOTE.user_popup.type,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1,showShareButtons:window.PREFETCH.NOTE.user_popup.show_share_buttons}},window.PREFETCH.NOTE.user_popup.note&&(n.note=window.PREFETCH.NOTE.user_popup.note,n.note.user=window.PREFETCH.NOTE.user_popup.note_user,window.PREFETCH.NOTE.user_popup.note_user_custom_domain&&(n.note.custom_domain=window.PREFETCH.NOTE.user_popup.note_user_custom_domain)),window.PREFETCH.NOTE.user_popup.magazine&&(n.magazine=window.PREFETCH.NOTE.user_popup.magazine,n.magazine.user=window.PREFETCH.NOTE.user_popup.magazine_user,n.magazine.custom_domain=window.PREFETCH.NOTE.user_popup.magazine_user_custom_domain),y.show(n),e.userPopupOpenedFlag=!0):void 0}),e.$on("$stateChangeError",function(){return e.showNoteLogo=!0}),e.$on("$ProfileImageChanged",function(t,n){return e.currentUser.user_profile_image_path=n}),e.resendActivateMail=function(){return e.activate_mail_sending||e.resendActivateMailFinished?void 0:(e.activate_mail_sending=!0,c.save({redirect_path:""},function(){return e.activate_mail_sending=!1,e.resendActivateMailFinished=!0,n(function(){return e.hideBarAfterSendFlag=!0},3e3)},function(){return e.activate_mail_sending=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7f6e\u3044\u3066\u518d\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}))},e.closeAboveMsg=function(t){return e.hideTopNavMsg=e.hideTopNavMsg||{},o.put(t,!0),e.hideTopNavMsg[t]=!0},e.toggleSearch=function(){return e.renewalSearchObj.renewalSearch=!e.renewalSearchObj.renewalSearch,e.renewalSearchObj.renewalSearch?n(function(){return angular.element("#hashtag_search_autocomplete_value").focus()
},100):void 0},e.moveToLogin=function(e){return event.preventDefault(),r.location.href=e}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("NoteFormCtrl",["$scope","$state","$upload","Note","TalkNote","ImageNote","SoundNote","MovieNote","Auth","Bridge","MyMagazine","MagazineNote","OpenPickUrlnameModalService","TalkNoteDraft","ImageNoteDraft","SoundNoteDraft","MovieNoteDraft","DraftSaveAlert",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v){var y,b,_,w,k;return e.currentForm="chat",e.notetype="TalkNote",e.image_uploading=!1,e.settings={hashtag:{list:[]},enable_comment:!0},y=30,e.clickTalkNoteImageUpload=function(){var e;return e=navigator.userAgent,e.match(/\siPhone OS 8_0\s/)?void alert("\u73fe\u5728\u3001iOS8\u306eSafari\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u51fa\u6765\u307e\u305b\u3093\u3002"):($("#talk_note_image_upload").click(),null)},_=function(){var t;return e.currentUser.no_urlname_user?(t=function(){return location.reload()},p.open(t,"note"),!0):!1},e.clickSoundNoteImageUpload=function(){return $("#cover-input").click(),null},e.initNoteForm=function(){return l.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,e.isLoggedIn=!0,c.user.urlname?e.user=c.user:e.$on("$UserLoaded",function(){return e.user=c.user}),u.get({includes_editable:!0},function(t){return t.error?void alert("\u30de\u30ac\u30b8\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"):(e.myMagazines=t.data.magazines,e.note=e.note||{},null!=e.myMagazines&&e.myMagazines.length>0&&(e.note.limitedMagazine=e.myMagazines[0]),e.note.limitedCheck=!1)},function(){return console.error("\u30de\u30ac\u30b8\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))})},e.focusTalkNoteForm=function(){e.touched=!0,_()},e.saveTalkNoteDraft=function(){var t,n,r,i;return n=v.getMessage(e.note,e.settings),n&&alert(n),!e.isSubmitting&&!_()&&(i=e.uploadImage&&e.uploadImage.key,r=e.noteBody&&e.noteBody.trim().length>0,i||r)?(t=new h,t.message=e.noteBody,e.uploadImage&&(t.image_key=e.uploadImage.key),t.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.isSubmitting=!0,t.$save(null,function(t){e.isSubmitting=!1,e.noteBody=null,e.uploadImage=null,e.settings.hashtag.list=null,t.error&&alert(t.error.message)},function(){return e.isSubmitting=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})):void 0},e.createTalkNote=function(){var t,n,r;if(!e.isSubmitting&&!_()&&(n=e.uploadImage&&e.uploadImage.key,t=e.noteBody&&e.noteBody.trim().length>0,n||t))return r=new i,r.message=e.noteBody,e.uploadImage&&(r.image_key=e.uploadImage.key),r.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.currentUser.turnoff_comment_available&&(r.disable_comment=e.settings.enable_comment===!1),e.isSubmitting=!0,r.$save(null,function(t){return e.isSubmitting=!1,t.error?void alert(t.error.message):(e.noteModel.notes.unshift(t.data),e.noteBody=null,e.uploadImage=null,e.settings.hashtag.list=null)},function(){return e.isSubmitting=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})},e.onFileSelect=function(t){var r;return e.image_uploading=!0,r=t[0],e.upload=n.upload({url:"/api/v1/image_upload/note_picture",file:r}).success(function(t){return e.image_uploading=!1,null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):e.uploadImage=t.data})},e.deleteUploadImage=function(){return e.uploadImage=null},e.switchForm=function(t){var n;if(!_())return n=navigator.userAgent,"image"===t&&n.match(/\siPhone OS 8_0\s/)?void alert("\u73fe\u5728\u3001iOS8.0\u306eSafari\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u51fa\u6765\u307e\u305b\u3093\u3002"):(e.currentForm=null!=t&&t.length>0?t:"chat",e.notetype="chat"===e.currentForm?"TalkNote":e.currentForm.substr(0,1).toUpperCase()+e.currentForm.substr(1)+"Note")},e.go=function(e){return _()?void 0:t.go(e)},e.initSoundNote=function(){return e.note={paid_flag:!1,audio:null},e.note.enableDownload=!1,e.settings={}},e.onNoteAudioSelect=function(t){var r;return e.image_uploading=!0,r=t[0],e.upload=n.upload({url:"/api/v1/file_upload/audio",file:r}).success(function(t){var n;return t.error?void(e.uploadError="file_type_not_allowed"===t.error.code?"\u30d5\u30a1\u30a4\u30eb\u306e\u5f62\u5f0f\u304c\u9055\u3046\u304b\u3001\u30b5\u30a4\u30ba\u304c50MB\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002":"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"):(e.uploadError="",n=t.data,n.url=decodeURIComponent(n.url),n.url_for_download=decodeURIComponent(n.url_for_download),n.preview_url=decodeURIComponent(n.preview_url),e.note.audio=n,e.note.name||(e.note.name=n.original_filename.replace(/\.\S+$/,"")),e.note.price>0?e.onDragAreaClicked("p.btn-form[ng-click]"):void 0)})},e.onNoteSoundCoverSelect=function(t){var r,i;return r=t[0],(i=r.type.indexOf("gif")>=0?!0:!1)?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):(e.image_uploading=!0,e.upload=n.upload({url:"/api/v1/image_upload/sound_cover",file:r}).success(function(t){return e.image_uploading=!1,null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):(e.note.cover=t.data,$("div.cover-image").css("background","url('"+e.note.cover.url+"')").css("background-size","contain"),!0)}))},e.saveSoundNoteDraft=function(){var t,n,r,i;t=v.getMessage(e.note,e.settings),t&&alert(t),n=e.note,n.name&&n.artist_name&&n.audio&&(_()||(i=n.paid_flag?parseInt(n.price,10):0,e.settings.normalize(),r={status:"draft",name:n.name,artist_name:n.artist_name,audio_key:n.audio.key,paid_flag:n.paid_flag,price:i,cover_key:n.cover&&n.cover.key||null,description:n.description||null,enable_download:n.enableDownload||!1,magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.publishAt},r.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.afterSubmit=!0,f.save(r,function(t){return e.afterSubmit=!1,t.error?void alert(t.error.message):(e.note={},e.settings.hashtag.list=null,$("div.cover-image").css("background","#f8f9fa"),$('form[name="soundNoteForm"]').find("div.mejs-audio").remove(),!0)},function(){return e.afterSubmit=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})))},e.createSoundNote=function(){var n,r,i;return n=e.note,n.name&&n.artist_name&&n.audio&&!_()?(i=parseInt(n.price,10),n.paid_flag===!0&&(n.enableDownload=!0),e.settings.normalize(),r={status:"published",name:n.name,artist_name:n.artist_name,audio_key:n.audio.key,paid_flag:n.paid_flag,price:n.paid_flag?i:0,cover_key:n.cover&&n.cover.key||null,description:n.description||null,enable_download:n.enableDownload||!1,magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.publishAt,hashtags:e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],prior_sale_activated:n.prior_sale_activated||null,first_served_sales_count:n.prior_sale_activated?e.note.first_served_sales_count:null},e.currentUser.turnoff_comment_available&&(r.disable_comment=e.settings.enable_comment===!1),o.save(r,function(n){var i,a;return n.error?(alert(n.error.message),void(e.afterSubmit=!1)):e.settings.reserved===!0?t.go("showTextNoteFriendly",{urlname:n.data.user.urlname,key:n.data.key}):(r.limited===!0&&(a=e.settings.magazineIds,n.data.is_limited=!0,n.data.limited_note_include_magazines=function(){var t,n,r;for(r=[],t=0,n=a.length;n>t;t++)i=a[t],r.push(e.settings.magChecks[i].magazine);return r}()),e.noteModel.notes.unshift(n.data),e.note={},e.settings.hashtag.list=null,$("div.cover-image").css("background","#f8f9fa"),$('form[name="soundNoteForm"]').find("div.mejs-audio").remove(),!0)},function(){return console.log("Error occurred")})):void 0},e.deleteSoundFile=function(){return e.note.audio=null,$("div.soundnote-edit").length>0?$("div.soundnote-edit").find("div.mejs-audio").remove():$("div.mejs-audio").remove(),!0},e.deleteSoundCover=function(){return e.note.cover=null,e.note.audio.cover=null,$("div.soundnote-edit").length>0?$("div.soundnote-edit").find("div.cover-image").css("background","#f8f9fa"):$("div.cover-image").css("background","#f8f9fa"),!0},e.initMovieNote=function(){return e.note={},e.settings.hashtag.list=null},e.noMovieUrlChange=function(){var t,n;return n=e.note.movieUrl,e.note.external_url=(t=n.match("youtube.com/watch\\?v=([a-zA-Z-0-9_-]+)")||n.match("youtube.com/embed/([a-zA-Z-0-9_-]+)")||n.match("youtu.be/([a-zA-Z-0-9_-]+)"))?"https://www.youtube.com/embed/"+t[1]:(t=n.match("vimeo.com/([0-9]+)")||n.match("player.vimeo.com/video/([0-9]+)"))?"https://player.vimeo.com/video/"+t[1]:(t=n.match("instagram.com/p/([a-zA-Z-0-9_-]+)"))?"https://instagram.com/p/"+t[1]+"/embed/":(t=n.match("vine.co/v/([a-zA-Z-0-9_-]+)"))?"https://vine.co/v/"+t[1]+"/embed/simple":null},e.saveMovieNoteDraft=function(){var t,n;e.afterSubmit||_()||(t=v.getMessage(e.note,e.settings),t&&alert(t),e.note.name&&e.note.external_url&&(e.afterSubmit=!0,e.settings.normalize(),n={status:"draft",name:e.note.name,external_url:e.note.external_url,description:e.note.description,price:e.note.price,magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.publishAt},n.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],g.save(n,function(t){return e.afterSubmit=!1,t.error?void alert(t.error.message):e.initMovieNote()},function(){console.log("Error occurred"),e.afterSubmit=!1})))},e.createMovieNote=function(){var n;if(!e.afterSubmit&&e.note.name&&e.note.external_url&&!_())return e.afterSubmit=!0,e.settings.normalize(),n={name:e.note.name,external_url:e.note.external_url,description:e.note.description,price:e.note.price,hashtags:e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.publishAt},e.currentUser.turnoff_comment_available&&(n.disable_comment=e.settings.enable_comment===!1),s.save(n,function(r){var i,a;return r.error?(alert(r.error.message),void(e.afterSubmit=!1)):e.settings.reserved===!0?t.go("showTextNoteFriendly",{urlname:r.data.user.urlname,key:r.data.key}):(n.limited===!0&&(a=e.settings.magazineIds,r.data.is_limited=!0,r.data.limited_note_include_magazines=function(){var t,n,r;for(r=[],t=0,n=a.length;n>t;t++)i=a[t],r.push(e.settings.magChecks[i].magazine);return r}()),e.noteModel.notes.unshift(r.data),e.afterSubmit=!1,e.initMovieNote())},function(){return console.log("Error occurred"),e.afterSubmit=!1})},e.initImageNote=function(){return e.note=e.note||{},e.note.paid_flag=!1,e.note.pictures=[]},e.saveImageNoteDraft=function(){var t,n,r,i,a,o;if(!e.afterSubmit&&!_()&&(t=v.getMessage(e.note,e.settings),t&&alert(t),0!==e.note.name.length)){for(o=e.note.pictures,i=0,a=o.length;a>i;i++)if(r=o[i],null!=r.caption&&r.caption.length>255)return alert("\u753b\u50cf\u306e\u8aac\u660e\u306f255\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");e.settings.normalize(),n={status:"draft",name:e.note.name,images:e.note.pictures,paid_flag:e.note.paid_flag,price:e.note.price,magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.publishAt},n.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.afterSubmit=!0,m.save(n,function(t){return e.afterSubmit=!1,t.error?void alert(t.error.message):(e.note={paid_flag:!1,pictures:[]},e.showPayImageMsg=!1,e.settings.hashtag.list=null)},function(){e.afterSubmit=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})}},e.createImageNote=function(){var n,r,i,o,s;if(!e.afterSubmit&&!_()){if(e.afterSubmit=!0,0===e.note.name.length)return void(e.afterSubmit=!1);for(s=e.note.pictures,i=0,o=s.length;o>i;i++)if(r=s[i],null!=r.caption&&r.caption.length>255)return e.afterSubmit=!1,alert("\u753b\u50cf\u306e\u8aac\u660e\u306f255\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");return e.settings.normalize(),n={status:"published",name:e.note.name,images:e.note.pictures,paid_flag:e.note.paid_flag,price:e.note.price,hashtags:e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.publishAt,prior_sale_activated:e.note.prior_sale_activated||null,first_served_sales_count:e.note.prior_sale_activated?e.note.first_served_sales_count||null:void 0},e.currentUser.turnoff_comment_available&&(n.disable_comment=e.settings.enable_comment===!1),a.save(n,function(r){var i,a;return r.error?(alert(r.error.message),void(e.afterSubmit=!1)):e.settings.reserved===!0?t.go("showTextNoteFriendly",{urlname:r.data.user.urlname,key:r.data.key}):(n.limited===!0&&(a=e.settings.magazineIds,r.data.is_limited=!0,r.data.limited_note_include_magazines=function(){var t,n,r;for(r=[],t=0,n=a.length;n>t;t++)i=a[t],r.push(e.settings.magChecks[i].magazine);return r}()),e.noteModel.notes.unshift(r.data),e.note={paid_flag:!1,pictures:[]},e.afterSubmit=!1,e.showPayImageMsg=!1,e.settings.hashtag.list=null)})}},e.onDragAreaClicked=function(e){return angular.element(e).click(),null},e.onNoteImagesSelect=function(t){var r,i,a,o;if(r=e.note.pictures.length+t.length-y,r>0)return alert("\u6295\u7a3f\u3067\u304d\u308b\u753b\u50cf\u306f30\u679a\u307e\u3067\u3067\u3059\u3002\n"+r+"\u679a\u591a\u3044\u306e\u3067\u3001\u6570\u3092\u6e1b\u3089\u3057\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),t=[],null;for(a=0,o=t.length;o>a;a++)i=t[a],e.upload=n.upload({url:"/api/v1/image_upload/note_picture",file:i}).success(function(t){return null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):(e.note.pictures.push(t.data),void e.note.pictures.sort(function(e,t){var n,r,i,a,o,s,l,c;if(r=function(e){var t;return t=new Number(e),isFinite(t)?t:e},a=e.filename.replace(/\s/g,"").split(/(\d+)/).map(r),s=t.filename.replace(/\s/g,"").split(/(\d+)/).map(r),i=a.length,o=s.length,i!==o)return i-o;for(n=l=0,c=i-1;c>=0?c>=l:l>=c;n=c>=0?++l:--l){if(s[n]<a[n])return 1;if(s[n]>a[n])return-1}return 0}))});t=[]},e.imageMoveUpmost=function(e){var t;return t=w(e),k(t),b(0,e)},e.imageMoveUp=function(e){var t;return t=w(e),0>=t?void 0:(k(t),b(t-1,e))},e.imageMoveDown=function(t){var n;return n=w(t),n>=e.note.pictures.length-1?void 0:(k(n),b(n+1,t))},e.imageRemove=function(t){var n;return n=w(t),k(n),e.note.pictures.length<=1?e.isPaidImageNote=!1:void 0},e.raisePayFlag=function(t){return t.paid_flag!==!0?t.pictures.length>=1?t.paid_flag=!0:e.showPayImageMsg=!0:void 0},e.raiseSoundPayFlag=function(t,n,r){return null!=r&&r.preventDefault(),n?(e.note.enableDownload=!0,$("#downloadable").attr("checked","checked").attr("disabled","disabled")):($("#downloadable").removeAttr("disabled").removeAttr("checked"),e.note.enableDownload=!1),t.paid_flag=!!n},w=function(t){return e.note.pictures.indexOf(t)},k=function(t){return e.note.pictures.splice(t,1)},b=function(t,n){return e.note.pictures.splice(t,0,n)}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("PagesCtrl",["$rootScope","$scope","$location","$state","$stateParams","$resource","$anchorScroll","Auth","User","Title",function(e,t,n,r,i,a,o,s,l,c){return t.initHelp=function(){return c.set("note\u306e\u4f7f\u3044\u304b\u305f")},t.initFaq=function(){var e;return"/faq"===n.path()&&n.search().is_app_access&&(t.is_app_access=!0),e=location.hash.replace("#",""),e&&(n.hash(),o()),c.set("\u3088\u304f\u3042\u308b\u8cea\u554f")},t.initPrivacy=function(){return c.set("\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc")},t.initTerm=function(){return c.set("\u3054\u5229\u7528\u898f\u7d04")},t.linkTo=function(e){return location.href=e},t.switchTab=function(e){return t.tab=e},t.initTokusyo=function(){return c.set("\u7279\u5b9a\u5546\u53d6\u5f15\u6cd5\u306b\u57fa\u3065\u304f\u8868\u793a"),null!=i.urlname?l.get({urlname:i.urlname},function(e){return e.error?("not_found"===e.error.code&&r.go("_404",null,{location:!1}),void(t.error=e.error)):(t.user=e.data,t.user.creator_name=t.user.nickname||t.user.urlname)}):s.then(function(e){return e.error?(t.error=e.error,void(t.isLoggedIn=!1)):(t.user=e.data,t.isLoggedIn=!0)})},t.initLanding=function(){var e;return s.then(function(e){return e.error?(t.error=e.error,void(t.isLoggedIn=!1)):r.go("home.home")}),e=location.hash.replace("#",""),setTimeout(function(){return n.hash(),o()},100)}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("PremiumCtrl",["$scope","$state","Title","Auth","Subscription",function(e,t,n,r,i){return n.set("\u30d7\u30ec\u30df\u30a2\u30e0\u4f1a\u54e1"),e.purchasable=!0,e.initPremiumEntry=function(){return r.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,e.isLoggedIn=!0,e.currentUser.is_premium_user?i.get({type:"PremiumPlan"}).$promise.then(function(t){return t.data.subscriptions.length&&null===t.data.subscriptions[0].canceled_at?e.purchasable=!1:void 0}):void 0)})},e.onClick=function(){return e.isLoggedIn&&!e.purchasable?alert("\u65e2\u306b\u30d7\u30ec\u30df\u30a2\u30e0\u4f1a\u54e1\u3067\u3059\u3002"):t.go("signup",{redirectPath:"/premium"})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("RecommendCtrl",["$scope","$controller","$state","Auth",function(e,t,n,r){return angular.extend(this,t("TopCtrl",{$scope:e})),e.initRecommend=function(){return r.then(function(t){return t.error?n.go("home.home"):e.init()})}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("SessionsCtrl",["$scope","$location","$window","$stateParams","$http","$resource","$timeout","$upload","$state","Cookie","EcService","CurrentUserAPI","CurrentUser","UserAgent","TagList","MyEmail","AutoHideNotification","Auth","TempAuth","PickUrlname","GuestEmailCheck",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_){var w,k;return e.submitted=!1,e.activation_status="activating",e.$location=t,e.$window=n,e.token=t.search().token,w=t.search().email,k=t.search().via,w&&"email"===k&&(e.email=encodeURI(w).replace("%20","+"),_.get({email:e.email},function(){return function(n){return"note_registerd"===n.data.status||"cakes_registerd"===n.data.status?e.guest_status=n.data.status:(e.via="email",e.hv=t.search().hv)}}(this),function(){return function(e){return console.log(e.data),alert("\u304a\u624b\u6570\u3067\u3059\u304c\u3001\u6642\u9593\u3092\u7f6e\u3044\u3066\u304b\u3089\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044")}}(this))),e.goToRedirectPath=function(){return n.location.href=t.search().redirectPath||"/recommend"},e.login_submit=function(){var t;if(e.login_form.$valid)return e.login&&e.login.length>0?e.password&&e.password.length>0?(e.loginError="",e.logining=!0,t={login:e.login,password:e.password,follow:r.follow,magazine_follow:r.magazineFollow,likable_id:r.likable_id,likables:r.likables},i({method:"POST",url:"/api/v1/sessions/sign_in",data:t,timeout:3e4}).success(function(n){return e.logining=!1,n.error?e.loginError=t.login.indexOf("@")>0?n.error.message.match(/cakes user/)?"cakes_user":"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304a\u3088\u3073\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002":"\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":location.href=r.redirectPath?r.redirectPath:"/"}).error(function(){return e.logining=!1,e.loginError="\u3057\u3070\u3089\u304f\u305f\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002"}),"iPhone"===h.short||"iPad"===h.short?(scrollBy(0,-1),o(function(){return scrollBy(0,1)},200)):void 0):e.loginError="\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u5165\u529b\u4e0b\u3055\u3044\u3002":e.loginError="\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3082\u3057\u304f\u306f\nnote ID\u3092\u3054\u5165\u529b\u4e0b\u3055\u3044\u3002"},e.goHome=function(){return location.href="/"},e.entry_submit=function(){var t,a,s,l;return a=!1,null==e.email||0===e.email.trim().length?(a=!0,e.emailRequired=!0):-1===e.email.search(/^.+@.+\..{2,}$/)?(a=!0,e.emailPattern=!0):(e.emailRequired=!1,e.emailPattern=!1),null==e.password||0===e.password.trim().length?(a=!0,e.passwordRequired=!0):e.passwordRequired=!1,e.nourlname||(null==e.urlname||0===e.urlname.trim().length?(a=!0,e.urlnameRequired=!0):e.urlnameRequired=!1,e.urlnameStartedWithUnderScore="_"===(null!=(l=e.urlname)?l.charAt(0):void 0)),null==e.terms||e.terms!==!0?(a=!0,e.noAgreement=!0):e.noAgreement=!1,!a&&e.entry_form.$valid?(e.sending=!0,s={email:e.email,password:e.password,password_confirmation:e.password,urlname:e.urlname,nickname:e.nickname,follow:r.follow,magazine_follow:r.magazineFollow,likable_id:r.likable_id,likables:r.likables,redirect_path:r.redirectPath,urlname_code:c.get("urlnameCode"),captcha:e.captcha,captcha_key:$("#captcha_key").val(),provider:null!=e.auth?e.auth.provider:null,from:r.from,note_key:r.nkey,via:e.via,hv:e.hv,token:r.token},t=n.document.querySelector("#g-recaptcha-response"),t&&(s.g_recaptcha_response=t.value),i({method:"POST",url:"/api/v1/sessions/sign_up",data:s,timeout:3e4}).success(function(t){return t.error?"duplicate_email"===t.error.code?(e.emailDuplicate=!0,e.emailDuplicateCakes=!!t.error.message.match(/cakes user/)):"duplicate_urlname"===t.error.code?e.urlnameDuplicate=!0:"invalid"===t.error.code?alert(t.error.message):"invalid_email_pattern"===t.error.code&&(e.emailPattern=!0):(c.remove("urlname"),c.remove("urlnameCode"),e.nourlname&&"email"===e.via?e.submitted=101:e.redirectAfterSignup()),e.sending=!1}).error(function(t,r){return 403===r&&("Captcha required"===t.error?n.location.href="/signup":alert("Captcha\u304c\u4e0d\u6b63\u3067\u3059\u3002")),e.sending=!1}),"iPhone"===h.short||"iPad"===h.short?(scrollBy(0,-1),o(function(){return scrollBy(0,1)},200)):void 0):void 0},e.removeAuth=function(){return y["delete"](null,function(t){return t.error?void 0:e.auth=null},function(){return console.log("Error occurred")})},e.logout=function(){return i({method:"POST",url:"/api/v1/sessions/sign_out",timeout:3e4}).success(function(){return u.clearOrder(),location.href="/"}).error(function(){return console.log("Error occurred")})},e.initLogin=function(){return v.then(function(e){return e.error?void 0:e.data.id>0?l.go("home.home"):void 0})},e.init_activate=function(){return v.then(function(e){return e.data.email_confirmed_flag?l.go("home.home"):void 0}),i({method:"POST",url:"/api/v1/sessions/activate",data:{token:r.token},timeout:3e4}).success(function(t){return t.error?"invalid"===t.error.code?(e.activation_status="error",console.log("Error occurred")):void 0:(e.activation_status="success",location.href=r.redirectPath&&r.redirectPath.search(/^\/[^\/]/)>=0?r.redirectPath:"/")})},e.initUpdateEmail=function(){return e.activationStatus="updating",f.save({action:"confirm",token:r.token},function(){return g.success("","\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),setTimeout(function(){return location.href="/settings/account"},2e3)},function(){return g.error("","\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u66f4\u65b0\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"),setTimeout(function(){return location.href="/settings/account"},2e3)})},e.init_entry=function(){return v.then(function(e){return e.error?void 0:e.data.id>0?l.go("home.home"):void 0}),e.nourlname=!0,r.urlname&&r.code&&(c.put("urlname",r.urlname),c.put("urlnameCode",r.code)),r.page?void(e.submitted=1):y.get(null,function(t){var n;return t.error?void(e.urlname=c.get("urlname")):(n=t.data,e.email=n.email,e.auth=n,e.urlname=e.nourlname?void 0:c.get("urlname")||n.nickname)})},e.initInterests=function(){return e.interests=[],e.tags=[],m.get({kind:"genres"},function(t){return e.tags=t.data.tags},function(){return console.error("Error occurred")})},e.hasInterest=function(t){return e.interests.indexOf(t)>-1},e.toggleInterest=function(t){var n;return n=e.interests.indexOf(t),n>-1?e.interests.splice(n,1):e.interests.push(t)},e.redirectAfterSignup=function(){return location.href=r.redirectPath?"/follow_recommend?redirectPath="+t.search().redirectPath:"/follow_recommend"},e.skipInterests=function(){return e.submitted=2,e.user=e.currentUser},e.submitInterests=function(){return e.interests&&0===e.interests.length?void 0:m.save({kind:"interests",tag_ids:e.interests.map(function(e){return e.id})},function(){return e.skipInterests()},function(){return location.href="/"})},e.onFileSelect=function(e,t){switch(t){case"profile":case"wallpaper":return s.upload({url:"/api/v1/image_upload/"+t,file:e[0]}).success(function(e){return e.error?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):$("img.circle").attr("src",e.data.url)})}},e.initProfile=function(){return p.then(function(t){var n;if(!t.error)return n=t.data,e.currentUser=n,e.user||(e.user={}),e.user.creator_name=n.nickname})},e.editProfile=function(){var t;return e.user.profile.length>140?e.profileError="\u81ea\u5df1\u7d39\u4ecb\u306f140\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002":0===e.user.profile.length?e.profileError="\u81ea\u5df1\u7d39\u4ecb\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002":(e.profileError="",e.user.profile=e.user.profile.replace(/\r|\n/g,""),t={nickname:e.user.creator_name,profile:e.user.profile},d.update(t,function(t){return t.error?void(e.profileError="\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u306e\u767b\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"):e.redirectAfterSignup()},function(){res.error&&(e.profileError="\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u306e\u767b\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))},e.sendPasswordResetEmail=function(t){return e.send_password_clicked=!0,e.resetPasswordForm.$invalid?void 0:(e.error=!1,i({method:"POST",url:"/api/v1/sessions/reset_password",data:{email:t},timeout:3e4}).success(function(t){return t.error?void(e.error=t.error.message):(e.logining=!1,e.emailSent=!0,e.send_password_clicked=!1)}).error(function(){return e.logining=!1,e.error="\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002",e.send_password_clicked=!1}))},e.checkPasswordResetToken=function(){return e.error=!1,i({method:"POST",url:"/api/v1/sessions/check_token",data:{token:r.token},timeout:3e4}).success(function(t){return e.logining=!1,t.error?e.invalidTokenError=!0:void 0}).error(function(){})},e.updatePassword=function(t,n){return e.form.$valid?(e.error=!1,e.success=!1,i({method:"POST",url:"/api/v1/sessions/update_password",data:{password:t,password_confirmation:n,token:r.token},timeout:3e4}).success(function(){return e.logining=!1,e.success=!0}).error(function(){return e.logining=!1,e.error="\u5931\u6557\u3057\u307e\u3057\u305f\u3002"})):void 0},e.pickUsernameSubmit=function(){return e.error=null,e.pickUsername.$valid?e.terms?(e.sending=!0,b.save({urlname:e.urlname},function(t){return e.sending=!1,t.error?void(e.error=t.error.message):location.href="/signup?page=1"},function(){return e.sending=!1,console.log("Error occurred")})):void(e.noAgreement=!0):void 0}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("SettingCtrl",["$window","$scope","$stateParams","$state","$resource","$http","$q","CurrentUserAPI","User","MyCreditCard","PurchaseHistory","Auth","AutoHideNotification","Title","OAuth","MyNoticeSettings","MyFollowNoticeSetting","MyPurchaseNoticeSetting","MyCommentNoticeSetting","MyLikeNoticeSetting","MyNewsletterSetting","MyCommentToNoticeSetting","MyMagazineNoteAddNoticeSetting","MyFollowingMagazineNoteAddNoticeSetting","MyPurchaseMagazineNoteAddNoticeSetting","MyPassword","MyEmail","BankAccount","Bank","BankBranch","Withdrawal","SubscriptionHistory","UserMessage","MySettings","MyUserSettings","MySupportBox","PickUrlname","MyPremium","Popeye","$location","EcHistoryOrders","EcService","FlashModal","$timeout","MessageModal","GMOTokenAuth",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w,k,x,C,S,T,A,M,E,P,N,D,z,L,I,B,O,F,H,R,j,U,q,W,G){var Y,V,K,J,X;return t.currentUser={},t.isLoggedIn=null,t.user={},t.editMode=!1,t.creditCard={},Y=new Date,V=Y.getMonth()%12+1,J=Y.getFullYear(),t.months=[1,2,3,4,5,6,7,8,9,10,11,12],t.years=function(){X=[];for(var e=J,t=J+10;t>=J?t>=e:e>=t;t>=J?e++:e--)X.push(e);return X}.apply(this),t.loaded=null,t.errorMsgs=[],h.set("\u30a2\u30ab\u30a6\u30f3\u30c8\u8a2d\u5b9a"),t.toggleUserSetting=function(e){var t;switch(e.type){case"SupportEnableSetting":return t=!e.value,L.save({support_enabled:t},function(t){return e.value=t.data.status},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")});case"PromotionAllowSetting":return t=!e.value,L.save({promotion_allowed:t},function(t){return e.value=t.data.status},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")});case"CommentEnableSetting":return t=!e.value,L.save({comment_enabled:t},function(t){return e.value=t.data.status},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")});case"PurchaseGuestAllowSetting":return t=!e.value,L.save({purchase_guest_allowed:t},function(t){return e.value=t.data.status},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")});case"SerifEnableSetting":return t=!e.value,L.save({serif_enabled:t},function(t){return e.value=t.data.status},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")});case"OthersRelatedNoteEnableSetting":return t=!e.value,L.save({others_related_note_enabled:t},function(t){return e.value=t.data.status},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})}},K=!1,t.toggleNoticeSetting=function(e){if(!K)switch(K=!0,e.type){case"NewsletterSetting":return _.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"PurchaseNoticeSetting":return v.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"FollowNoticeSetting":return g.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"CommentNoticeSetting":return y.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"LikeNoticeSetting":return b.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"CommentToNoticeSetting":return w.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"MagazineNoteAddNoticeSetting":return k.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"FollowingMagazineNoteAddNoticeSetting":return x.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"PurchaseMagazineNoteAddNoticeSetting":return C.save(null,function(t){return e.send_flag=t.data.status,K=!1});case"StockPhotoNoticeSetting":return MyStockPhotoNoticeSetting.save(null,function(t){return e.send_flag=t.data.status,K=!1})}},t.initAccountSetting=function(){return t.providers={},t.supportAreaDescription="\u8a18\u4e8b\u4e0b\u306e\u300c\u30b5\u30dd\u30fc\u30c8\u300d\u306e\u6848\u5185\u30a8\u30ea\u30a2\u306e\u8aac\u660e\u6587\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002\u8aac\u660e\u6587\u306e\u8ffd\u52a0\u5f8c\u306f\u6587\u7ae0\u306e\u6a2a\u306b\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u753b\u50cf\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002(140\u6587\u5b57\u4ee5\u5185)",t.likeAreaDescription="\u8aad\u8005\u304c\u300c\u30b9\u30ad\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u6642\u306b\u3001\u8868\u793a\u3055\u308c\u308b\u30ea\u30a2\u30af\u30b7\u30e7\u30f3\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3059\u3002\u8907\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u62bc\u3055\u308c\u308b\u305f\u3073\u306b\u30e9\u30f3\u30c0\u30e0\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u6700\u592710\u500b\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002",t.purchaseAreaDescription="\u8aad\u8005\u304c\u30ce\u30fc\u30c8\u30fb\u30de\u30ac\u30b8\u30f3\u3092\u8cfc\u5165\u3057\u305f\u6642\u3001\u3042\u308b\u3044\u306f\u30b5\u30dd\u30fc\u30c8\u3092\u3057\u305f\u6642\u306b\u8868\u793a\u3055\u308c\u308b\u304a\u793c\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u753b\u50cf\u3068\u4e00\u7dd2\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002(140\u6587\u5b57\u4ee5\u5185)",d.then(function(e){return e.error?(t.error=e.error,void(t.isLoggedIn=!1)):(t.currentUser=e.data,t.isLoggedIn=!0,t.emailFormData={email:t.currentUser.email},t.urlnameFormData={urlname:t.currentUser.urlname},t.nicknameFormData={nickname:t.currentUser.nickname},m.get(null,function(e){var n,r,i,a;
if(!e.error){for(a=e.data.authentications,r=0,i=a.length;i>r;r++)n=a[r],t.providers[n.provider]=n;return z.get(null,function(e){return t.notice_settings=e.data.notice_settings,t.user_settings=e.data.user_settings})}},function(){return console.log("Error occurred")}))})},t.removeProvider=function(e){return m["delete"]({provider:e},function(){return delete t.providers[e]},function(){return console.log("Error occurred")})},t.initCreditCardSetting=function(){return d.then(function(e){return e.error?(t.error=e.error,void(t.isLoggedIn=!1)):(t.currentUser=e.data,t.isLoggedIn=!0,c.get(null,function(e){return t.loaded=!0,null!=e.error?(t.creditCard.expiryMonth=V,void(t.creditCard.expiryYear=t.years[0])):t.creditCard=e.data},function(){return p.error("","\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))})},t.initPremiumSetting=function(){return d.then(function(e){return e.error?(t.error=e.error,void(t.isLoggedIn=!1)):(t.currentUser=e.data,t.isLoggedIn=!0,t.currentUser.is_premium_user?O.get().$promise.then(function(e){return t.premiumStatus=e.data}):void r.go("settings.home"))})},t.toggleEditMode=function(e){return t.editMode=!!e,t.editMode?(t.currentCreditCard=angular.copy(t.creditCard),t._email=t.currentUser.email,t._profile=t.currentUser.profile,t._nickname=t.currentUser.nickname,t.creditCard=t.creditCard,t.creditCard.number=""):void 0},t.cancelCreditCardEdit=function(){return t.creditCard=t.currentCreditCard,t.editMode=!1},t.deleteCard=function(){return confirm("\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")?c["delete"](null,function(e){return e.error?void("invalid"===e.error.code&&alert(e.error.message)):t.creditCard=null}):void 0},t.setEditMode=function(e){return t.currentUserBackup=angular.copy(t.currentUser),"email"===e?t.editEmail=!0:"password"===e?t.editPassword=!0:"tokusyo"===e?t.editTokusyo=!0:"urlname"===e?t.editUrlname=!0:"nickname"===e?t.editNickname=!0:"support_box_appeal"===e?t.editSupportBoxAppeal=!0:"like_appeal"===e?t.editLikeAppeal=!0:"purchase_appeal"===e?t.editPurchaseAppeal=!0:void 0},t.cancelEditMode=function(e){return t.currentUser=t.currentUserBackup,t.tokusyo_ok_clicked=!1,"email"===e?(t.editEmail=!1,t.emailFormData={email:t.currentUser.email}):"password"===e?t.editPassword=!1:"tokusyo"===e?t.editTokusyo=!1:"urlname"===e?t.editUrlname=!1:"nickname"===e?t.editNickname=!1:"support_box_appeal"===e?t.editSupportBoxAppeal=!1:"like_appeal"===e?t.editLikeAppeal=!1:"purchase_appeal"===e?t.editPurchaseAppeal=!1:void 0},t.updatePassword=function(){return t.password_ok_clicked=!0,t.accountForm.$invalid?void 0:S.save({old_password:t.$parent.currentUser.password,new_password:t.$parent.currentUser.new_password},function(e){return e.error?void p.error("","\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"):(p.success("","\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002"),t.editPassword=!1,t.$parent.currentUser.new_password=null,t.$parent.currentUser.password=null,t.password_ok_clicked=!1)},function(){return console.log("Error occurred")})},t.updateUrlname=function(){return t.urlname_ok_clicked=!0,t.urlnameForm.$invalid?void 0:B.save({urlname:t.urlnameFormData.urlname},function(e){return t.sending=!1,e.error?void(t.error=e.error.message):(t.currentUser=e.data,t.editUrlname=!1)})},t.updateNickname=function(){var e;return t.nickname_ok_clicked=!0,t.nicknameForm.$invalid?void 0:(e={nickname:t.nicknameFormData.nickname},s.update(e,function(e){return t.sending=!1,e.error?void(t.error=e.error.message):(t.currentUser=e.data,t.editNickname=!1)}))},t.updateEmail=function(){return t.email_ok_clicked=!0,t.emailForm.$invalid?void 0:T.save({email:t.emailFormData.email},function(e){return e.error?void((e.error.code="duplicate_email")?p.error("","\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u65e2\u306b\u5b58\u5728\u3057\u307e\u3059\u3002"):p.error("","\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u3059\u3002")):(p.success("","\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f\u3002"),t.editEmail=!1)})},t.updateTokusyo=function(){return t.tokusyo_ok_clicked=!0,t.tokusyoForm.$invalid?void 0:s.update({userId:t.user.id},{tokusyo_name:t.currentUser.tokusyo_name,tokusyo_contact:t.currentUser.tokusyo_contact},function(e){return p.success("","\u7279\u5546\u6cd5\u8868\u8a18\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),t.toggleEditMode(!1),t.currentUser.tokusyo_name=e.data.tokusyo_name,t.currentUser.tokusyo_contact=e.data.tokusyo_contact,t.currentUserBackup=angular.copy(t.currentUser),t.cancelEditMode("tokusyo")},function(){return p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")})},t.updateSupportBoxAppeal=function(){return t.supportBoxAppealForm.$invalid?void 0:I.save({userId:t.user.id,kind:"appeal",support_box_appeal_text:t.currentUser.support_box_appeal_text},function(e){return p.success("","\u30b5\u30dd\u30fc\u30c8\u30a8\u30ea\u30a2\u306e\u8aac\u660e\u6587\u3092\u5909\u66f4\u3057\u307e\u3057\u305f"),t.currentUserBackup=angular.copy(t.currentUser),q(function(){return t.currentUser.support_box_appeal_text=e.data.user_appeal_messages}),t.cancelEditMode("support_box_appeal")},function(){return p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")})},t.updatePurchaseAppeal=function(){return t.purchaseAppealForm.$invalid?void 0:I.save({userId:t.user.id,kind:"purchase",support_box_appeal_text:t.currentUser.purchase_appeal_text},function(e){return p.success("","\u8cfc\u5165\u304a\u793c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5909\u66f4\u3057\u307e\u3057\u305f"),t.currentUserBackup=angular.copy(t.currentUser),q(function(){return t.currentUser.purchase_appeal_text=e.data.user_appeal_messages}),t.cancelEditMode("purchase_appeal")},function(){return p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")})},t.setDefaultAppealText=function(){return t.currentUser.support_box_appeal_text=e.PREFETCH.NOTE.default_support_appeal_text,t.currentUser.like_appeal_text="",t.currentUser.purchase_appeal_text=""},t.confirmDeleteSupportAppealText=function(){return e.confirm("\u30b5\u30dd\u30fc\u30c8\u30a8\u30ea\u30a2\u306e\u8aac\u660e\u6587\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")?I["delete"]({userId:t.user.id,kind:"appeal"},function(){return p.success("","\u30b5\u30dd\u30fc\u30c8\u30a8\u30ea\u30a2\u306e\u8aac\u660e\u6587\u3092\u524a\u9664\u3057\u307e\u3057\u305f"),t.currentUserBackup=angular.copy(t.currentUser),t.currentUser.support_box_appeal_text=[{kind:"appeal",text:null}]},function(){return p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}):void 0},t.confirmDeletePurchaseAppealText=function(){return e.confirm("\u8cfc\u5165\u304a\u793c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")?I["delete"]({userId:t.user.id,kind:"purchase"},function(){return p.success("","\u8cfc\u5165\u304a\u793c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u524a\u9664\u3057\u307e\u3057\u305f"),t.currentUserBackup=angular.copy(t.currentUser),t.currentUser.purchase_appeal_text=[{kind:"purchase",text:null}]},function(){return p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}):void 0},t.updateLikeAppeal=function(){return t.likeAppealForm.$invalid?void 0:I.save({userId:t.user.id,kind:"like",support_box_appeal_text:t.currentUser.like_appeal_text},function(e){return p.success("","\u30b9\u30ad\u3078\u306e\u8fd4\u4e8b\u3092\u5909\u66f4\u3057\u307e\u3057\u305f"),t.currentUserBackup=angular.copy(t.currentUser),q(function(){return t.currentUser.like_appeal_text=e.data.user_appeal_messages}),t.cancelEditMode("like_appeal")},function(e){return e.data.error&&e.data.error.toLowerCase().indexOf("Duplicate text")?p.error("","\u30b9\u30ad\u3078\u306e\u8fd4\u4e8b\u306b\u91cd\u8907\u304c\u3042\u308a\u307e\u3059"):p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")})},t.confirmDeleteLikeAppealText=function(){return e.confirm("\u30b9\u30ad\u3078\u306e\u8fd4\u4e8b\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")?I["delete"]({userId:t.user.id,kind:"like"},function(){return p.success("","\u30b9\u30ad\u3078\u306e\u8fd4\u4e8b\u3092\u524a\u9664\u3057\u307e\u3057\u305f"),t.currentUserBackup=angular.copy(t.currentUser),t.currentUser.like_appeal_text=null},function(){return p.error("","\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}):void 0},t.showLikeAppealArea=function(){return t.currentUser.like_appeal_text?Object.keys(t.currentUser.like_appeal_text).length>0:void 0},t.updateAccountSetting=function(){return t._email===t.currentUser.email&&null===t.currentUser.password&&t._profile===t.currentUser.profile&&t._nickname===t.currentUser.nickname?void t.toggleEditMode(!1):t.currentUser.profile.length>500?void(t.profileLengthError=!0):(t.profileLengthError=!1,s.update({userId:t.user.id},{email:t.currentUser.email,password:t.currentUser.password,nickname:t.currentUser.nickname,profile:t.currentUser.profile},function(){return p.success("","\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),t.toggleEditMode(!1)},function(){return p.error("","\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))},t.updateCreditCardSetting=function(){var e;return e=new c,e.number="000000000000"+t.creditCard.number.substr(-4,4),e.expiryMonth=t.creditCard.expiryMonth,e.expiryYear=t.creditCard.expiryYear,e.name=t.creditCard.name,G.getToken(t.creditCard.number,t.creditCard.expiryYear.toString()+(t.creditCard.expiryMonth<10?"0"+t.creditCard.expiryMonth.toString():t.creditCard.expiryMonth.toString()),t.creditCard.cvc,t.creditCard.name,function(n){return e.token=n.tokenObject.token,e.$save(null,function(){return p.success("","\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),t.toggleEditMode(!1),t.creditCard.number="************"+t.creditCard.number.substr(-4,4),t.creditCard.cvc=null,t.errorMsgs=[]},function(e){return p.error("","\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),t.errorMsgs=e.data.error})})},t.updateDatespan=function(e,t){return H.url("/settings/purchase_history?date="+e.span+("&type="+t)).replace()},t.initPurchaseHistory=function(){return t.purchaseTypes=[{key:"note_magazine",label:"\u30ce\u30fc\u30c8\u30fb\u30de\u30ac\u30b8\u30f3"}],t.ecService=j,d.then(function(e){return e.error?(t.error=e.error,void(t.isLoggedIn=!1)):(t.currentUser=e.data,t.isLoggedIn=!0,Y=n.date,t.currentUser.is_item_purchased?(t.purchaseTypes.push({key:"item",label:"\u30a2\u30a4\u30c6\u30e0"}),t.purchaseType=t.setPurchaseType(n.type)):t.purchaseType="note_magazine","note_magazine"===t.purchaseType?u.get({datespan:Y},function(e){return null!=e.error?void(t.error=e.error):(t.purchaseHistory=e.data.payments,t.datespans=e.data.datespans,N.get({datespan:Y},function(e){var n,r,i,a,o,s,l,c,u;if(null!=e.error)return void(t.error=e.error);for(t.subscriptionHistory=e.data.subscriptions,c=e.data.datespans,a=0,s=c.length;s>a;a++){for(r=c[a],n=!1,u=t.datespans,o=0,l=u.length;l>o;o++)i=u[o],r.span===i.span&&(n=!0);n||t.datespans.push(r)}return t.datespans=t.datespans.sort(function(e,t){return e.span-t.span}),t.processDatespans(Y)},function(){return p.error("","\u8cfc\u8aad\u5c65\u6b74\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))},function(){return p.error("","\u8cfc\u5165\u5c65\u6b74\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}):"item"===t.purchaseType?R.get({datespan:Y},function(e){return e.error?void(t.error=e.error):(t.orderHistory=e.data.orders.orders,t.datespans=e.data.datespans,t.processDatespans(Y))},function(){return p.error("","\u8cfc\u5165\u5c65\u6b74\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}):void 0)})},t.processDatespans=function(e){return t.datespans.length>0?(t.datespan=t.datespans[t.datespans.length-1],angular.forEach(t.datespans,function(n){return n.span===e?t.datespan=n:void 0})):void 0},t.setPurchaseType=function(e){return"item"===e?e:"note_magazine"},t.showReceipt=function(e,t,n){var r;r=F.openModal({templateUrl:"/templates/modal/receipt_address",controller:["$scope","$rootScope",function(i){return i.data={},i.close=function(){return r.close()},i.receipt=function(){var a,o,s,l,c;if(i.data.userAddress.length>0){o=document.createElement("form"),o.setAttribute("target","_blank"),o.setAttribute("method","post"),a="item"===n?"print_ec":"print",o.setAttribute("action","receipt/"+a),c={order_id:e,userAddress:i.data.userAddress,datespan:t};for(l in c)c.hasOwnProperty(l)&&(s=document.createElement("input"),s.setAttribute("type","hidden"),s.setAttribute("name",l),s.setAttribute("value",c[l]),o.appendChild(s));document.body.appendChild(o),o.submit()}else alert("Address cant be blank");return r.close()}}]})},t.initCreatorSetting=function(){},t.initBanks=function(){return t.bankAccount={corporate_flag:!1},t.isLoggedIn=!1,d.then(function(e){return e.error?void(t.isLoggedIn=!1):e.data.no_urlname_user?void(location.href="/"):(t.isLoggedIn=!0,A.get(null,function(e){return e.error?void 0:(t.bankAccount=e.data,$("#bank_search_autocomplete_value").val(e.data.bank_name),$("#branch_search_autocomplete_value").val(e.data.branch_name))},function(){return console.log("Error occurred")}))})},t.bankRequest=function(e){return e=e.replace(/\u9280\u884c$/g,""),e=encodeURI(e),a.get("./api/v1/banks?keyword="+e)},t.bankResponse=function(e){var n,r;return n=e.data.banks||[],t.banks=n.map(function(e){return e.name}),r=t.banks,t.bankAccount.bank_code=1===r.length?r[0].bank_code:null,n},t.bankSelected=function(e){return e&&e.originalObject?(t.bankAccount.bank_name=e.originalObject.name||"",t.bankAccount.bank_code=e.originalObject.bank_code||""):void 0},t.branchRequest=function(e){return t.bankAccount.bank_name&&0!==t.bankAccount.bank_name.length?a.get("./api/v1/banks/"+t.bankAccount.bank_code+"/branches?keyword="+e.replace(/\u652f\u5e97$/g,"")):o.defer().promise},t.branchResponse=function(e){var n,r;return n=e.data.bank.branches||[],t.branches=n.map(function(e){return e.name}),r=t.branches,t.bankAccount.branch_code=1===r.length?r[0].branch_code:null,n},t.branchSelected=function(e){return t.bankAccount.branch_name=e.originalObject.name||"",t.bankAccount.branch_code=e.originalObject.branch_code||""},t.saveBankAccount=function(){return t.ok_clicked=!0,A.save(t.bankAccount,function(e){return e.error?("not_found"===e.error.code&&alert("\u9280\u884c\u307e\u305f\u306f\u652f\u5e97\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u9280\u884c\u30b3\u30fc\u30c9\u3068\u652f\u5e97\u30b3\u30fc\u30c9\u3092\u518d\u5ea6\u3054\u78ba\u8a8d\u4e0b\u3055\u3044\u3002"),void alert("\u30a8\u30e9\u30fc\u767a\u751f\u3057\u307e\u3057\u305f\u3002")):alert("\u4fdd\u5b58\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002")},function(){return console.log("Error occurred")})},t.initSendMessage=function(){return h.set("\u304a\u554f\u5408\u305b"),t.creator_name=n.urlname,d.then(function(e){return e.error?(t.error=e.error,t.isLoggedIn=!1):(t.sendMessageForm={},t.currentUser=e.data,t.isLoggedIn=!0,t.status="input")})},t.sendMessage=function(e){return t.sending||!n.urlname||(t.ok_clicked=!0,e.$invalid)?void 0:(t.sending=!0,l.get({urlname:n.urlname},function(e){var n;return n=e.data,D.save({user_id:n.id},{to_user_id:n.id,sender_name:t.sendMessageForm.senderName,body:t.sendMessageForm.message},function(e){return e.error&&"blocked"===e.error.code?void alert(e.error.message):(t.sending=!1,t.status="success")},function(){return t.sending=!1,t.status="error"})}))},t.initWithdraw=function(){return d.then(function(e){return e.error?t.isLoggedIn=!1:(t.currentUser=e.data,t.isLoggedIn=!0)})},t.submitWithdrawal=function(n){return"asp"!==e.PREFETCH.NOTE.mode||confirm("\u9000\u4f1a\u624b\u7d9a\u304d\u3092\u9032\u3081\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")?(t.withdrawalError=null,P.save({reason:n},function(n){return n.error?void(t.withdrawalError="invalid"===n.error.code?n.error.message:n.error.message):"asp"===e.PREFETCH.NOTE.mode?(W.show({message:"\u9000\u4f1a\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"}),q(function(){return function(){return location.href="/"}}(this),2e3)):location.href="/"},function(){return t.withdrawalError="\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u3002\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u7f6e\u3044\u3066\u304b\u3089\u518d\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044"})):void 0}}])}.call(this),function(){"use strict";angular.module("noteApp").controller("TimelineCtrl",["$scope","$rootScope","$resource","$state","$stateParams","Popeye","$anchorScroll","$document","$location","$timeout","Note","LikedNote","HomeTimeLine","MagazineNoteTimeLine","MagazineNotes","Auth","Bridge","UserTimelineStash","TimelineStash","Pageview","ArriveHistory","DraftTimeline","ReservedTimeline","HashtagTimeLine","CategoryTimeLine","PickupTimeLine","CustomDomainContext","Admin","Hashtag","Title","$window",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w,k,$,x,C,S,T,A,M){var E,P,N;return E=function(){return"home.home"===r.current.name},P=function(){return"creator.home"===r.current.name},e.captureCurrentFocusNote=function(t){return E()||P()?e.currentFocusNoteKey=t:void 0},t.$on("$RemoveNoteFromMagazine",function(t,n){var i,a,o,s,l,c;if("magazine.home"===r.current.name||"magazine.homeShort"===r.current.name){for(o=null,c=e.noteModel.notes,s=0,l=c.length;l>s;s++)if(a=c[s],a.key===n){o=a;break}return o?(i=e.noteModel.notes.indexOf(o),e.noteModel.notes.splice(i,1)):void 0}}),t.$on("$stateChangeStart",function(n,r){return E()?(t.scrollPosNoteKey=e.currentFocusNoteKey,y.stash(e.noteModel)):P()?(t.scrollPosNoteKey=e.currentFocusNoteKey,v.stash(e.noteModel,i.urlname)):("home.home"!==r.name&&"timeline"!==r.name&&y.clear(),"creator.home"!==r.name?v.clear():void 0)}),e.$location=l,e.currentUser={},e.noteModel={notes:[]},e.isLoggedIn=null,e.$location=l,"pickups"===r.current.name&&(e.pickups=[{engName:"sort1",name:"\u30eb\u30fc\u30eb1"},{engName:"sort2",name:"\u30eb\u30fc\u30eb2"},{engName:"sort3",name:"\u30eb\u30fc\u30eb3"}]),e.txtBlack=function(t){return e.selectedTL===t?"txt-black":void 0},e.txtBlackMyNoteFilter=function(t){return e.selectedMyNoteFilter===t?"txt-black":void 0},e.$on("$scrollBottom",function(t,n){return"home.home"===n.current.name?e.nextPage("home"):"creator.home"===n.current.name||"cdCreator.home"===n.current.name?e.nextPage("user"):"hashtag.home"===n.current.name?e.nextPage("hashtag"):"categories"===n.current.name?e.nextPage("category"):"magazine.home"!==n.current.name&&"magazine.homeShort"!==n.current.name||"list"===n.params.view?"magazine.home"!==n.current.name&&"magazine.homeShort"!==n.current.name||"list"!==n.params.view?"pickups"===n.current.name?e.nextPage("pickup"):void 0:e.nextPage("magazine_note_list"):e.nextPage("magazine_note")}),e.initDraftTimeline=function(t){return f.then(function(n){var i;return n.error?(e.error=n.error,void(e.isLoggedIn=!1)):(e.currentUser=n.data,e.isLoggedIn=!0,"reserved"===t&&e.currentUser.reserved_posting_available!==!0&&r.go("creator.drafts",{urlname:r.params.urlname}),e.loading=!0,i="reserved"===t?k:w,i.get({note_intro_only:!0},function(t){return t.error?void(e.error=t.error):(e.selectedTL="my",e.selectedMyNoteFilter="not_open",e.noteModel.notes=t.data.notes,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.draftTimeline="drafts.home"===r.current.name,e.reservedTimeline="drafts.reserved"===r.current.name,e.loading=!1)}))})},e.initMagazineNoteTimeline=function(){return e.key=r.params.key,e.urlname=r.params.urlname,S.isCdAccess()&&"cdMagazine.home"===r.current.name&&(e.key=window.PREFETCH.NOTE.customDomain.key,e.urlname=window.PREFETCH.NOTE.customDomain.urlname),f.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,g.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,h.get({magazine_key:e.key,note_intro_only:!0},function(t){var n,r,i,a,o,s,l,u,d;if(e.loading=!1,t.error)return void(e.error=t.error);for(u=t.data.notes,a=0,s=u.length;s>a;a++)r=u[a],e.noteModel.notes.push(r);for(e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,g.magazineNotes=e.noteModel.notes,g.magazine?e.magazine=g.magazine:e.$on("$MagazineLoaded",function(){return e.magazine=g.magazine}),i=[],d=t.data.notes,o=0,l=d.length;l>o;o++)n=d[o],i.push(n.id);return T.isAdminCheck!==!0?c(function(){return b.save({ids:i})},1e4,!1):void 0})})},e.initMagazineNoteList=function(t){return e.key=r.params.key,e.urlname=r.params.urlname,t=t||1,f.then(function(n){return n.error?(e.error=n.error,e.isLoggedIn=!1):(e.currentUser=n.data,g.currentUser=n.data,e.isLoggedIn=!0),m.get({magazine_key:r.params.key,list:!0,page:t},function(t){return t.error?void console.log("\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"):(e.noteModel.notes=t.data.notes,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page)},function(){console.log("\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}),g.magazine?e.magazine=g.magazine:e.$on("$MagazineLoaded",function(){return e.magazine=g.magazine})})},e.nextMagazineNoteList=function(t){return t=t||1,m.get({magazine_key:r.params.key,list:!0,page:t},function(t){var n,r,i,a;if(e.loading=!1,t.error)return void console.log("\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002");for(e.noteModel.notes=e.noteModel.notes||[],a=t.data.notes,r=0,i=a.length;i>r;r++)n=a[r],e.noteModel.notes.push(n);return e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page},function(){console.log("\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})},e.$on("$MagazineNoteTimelineReload",function(){return e.loading=!0,e.noteModel.notes=[],h.get({magazine_key:r.params.key,note_intro_only:!0},function(t){var n,r,i,a;if(e.loading=!1,t.error)return void(e.error=t.error);for(a=t.data.notes,r=0,i=a.length;i>r;r++)n=a[r],e.noteModel.notes.push(n);return e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,g.magazineNotes=e.noteModel.notes,g.magazine?e.magazine=g.magazine:e.$on("$MagazineLoaded",function(){return e.magazine=g.magazine})})}),e.initHomeTimeline=function(){return r.includes("home.libraries.*")||"home.magazines"===r.current.name?void 0:f.then(function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,g.currentUser=t.data,e.isLoggedIn=!0,N(r.current.name)?void 0:(e.loading=!0,p.get({note_intro_only:!0},function(t){var n,r,i,a,o,s,l,u,d;if(e.selectedTL="feed",e.loading=!1,t.error)return void(e.error=t.error);for(u=t.data.notes,a=0,s=u.length;s>a;a++)n=u[a],e.noteModel.notes.push(n);for(e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,i=[],d=t.data.notes,o=0,l=d.length;l>o;o++)r=d[o],i.push(r.id);return e.timeline_type="home",T.isAdminCheck!==!0?c(function(){return b.save({ids:i,page:1})},1e4,!1):void 0})))})},e._initUserTimeline=function(t,n){return f.then(function(i){return i.error?(e.error=i.error,e.isLoggedIn=!1):(e.currentUser=i.data,g.currentUser=i.data,e.isLoggedIn=!0),N(r.current.name)?void 0:(e.loading=!0,u.get({note_intro_only:!0,urlname:t,me:n&&n.me},function(n){var r,i,a,o,s;if(e.loading=!1,n.error)return void(e.error=n.error);for(e.noteModel.notes=n.data.notes,e.noteModel.firstPage=n.data.first_page,e.noteModel.lastPage=n.data.last_page,e.noteModel.nextPage=n.data.next_page,_.save({arrival_urlname:t}),i=[],s=n.data.notes,a=0,o=s.length;o>a;a++)r=s[a],i.push(r.id);return T.isAdminCheck!==!0?c(function(){return b.save({ids:i})},1e4,!1):void 0}))})},e.initUserTimeline=function(){var n;return n=S.isCdAccess()?S.key:i.urlname,e._initUserTimeline(n),e.selectedTL="feed",t.urlname_for_message=i.urlname,t.urlname_for_tokusyo=i.urlname},e.nextPage=function(t){var n,a,o;if(!e.loading&&e.noteModel.nextPage)return e.loading=!0,"user"===t?(o=S.isCdAccess()&&"cdCreator.home"===r.current.name?S.key:i.urlname,u.get({note_intro_only:!0,urlname:o,page:e.noteModel.nextPage},function(t){var n,r,i,a,o;if(e.loading=!1,t.error)return void(e.error=t.error);for(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,r=[],o=t.data.notes,i=0,a=o.length;a>i;i++)n=o[i],r.push(n.id);return T.isAdminCheck!==!0?c(function(){return b.save({ids:r})},1e4,!1):void 0})):"home"===t?p.get({since_created_at:e.noteModel.next_since_created_at,note_intro_only:!0,page:e.noteModel.nextPage},function(t){var n,r,i,a,o,s,l,u,d,p,h,m;if(e.loading=!1,t.error)return void(e.error=t.error);for(i={},p=e.noteModel.notes,a=0,l=p.length;l>a;a++)n=p[a],n.key&&(i[n.key]=!0);for(h=t.data.notes,o=0,u=h.length;u>o;o++)n=h[o],i[n.key]||e.noteModel.notes.push(n);for(e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,r=[],m=t.data.notes,s=0,d=m.length;d>s;s++)n=m[s],r.push(n.id);return T.isAdminCheck!==!0?c(function(){return b.save({ids:r,page:e.noteModel.nextPage})},1e4,!1):void 0}):"magazine_note"===t?h.get({magazine_key:r.params.key,note_intro_only:!0,page:e.noteModel.nextPage},function(t){var n,r,i,a,o;if(e.loading=!1,t.error)return e.error=t.error,void alert(e.error.message);for(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,g.magazineNotes=e.noteModel.notes,r=[],o=t.data.notes,i=0,a=o.length;a>i;i++)n=o[i],r.push(n.id);return T.isAdminCheck!==!0?c(function(){return b.save({ids:r})},1e4,!1):void 0}):"hashtag"===t?(n="new"===i.f||"recently"===i.f||"trend"===i.f?i.f:"new",$.get({hashtag:i.hashtag,note_intro_only:!0,page:e.noteModel.nextPage,f:n},function(t){return e.loading=!1,t.error?(e.error=t.error,void alert(e.error.message)):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page)})):"category"===t?x.get({note_intro_only:!0,category:i.category,page:e.noteModel.nextPage,sort:i.sort,method:i.method},function(t){return e.loading=!1,t.error?(e.error=t.error,void alert(e.error.message)):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,void(e.noteModel.nextPage=t.data.next_page))}):"magazine_note_list"===t?e.nextMagazineNoteList(e.noteModel.nextPage):"draft"===t||"reserved"===t?(a="reserved"===t?k:w,a.get({note_intro_only:!0,page:e.noteModel.nextPage},function(t){var n,r,i,a,o,s;if(e.loading=!1,t.error)return void(e.error=t.error);for(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,r=[],o=t.data.notes,s=[],i=0,a=o.length;a>i;i++)n=o[i],s.push(r.push(n.id));return s})):"pickup"===t?C.get({note_intro_only:!0,pickup_key:i.pickup_key,page:e.noteModel.nextPage},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,void(e.noteModel.nextPage=t.data.next_page))}):void 0},e.deleteDraftNote=function(r){var i,o;return o=e,i=a.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$scope",function(e){return e.draft=!0,e.ok=function(){return n("/api/v1/text_notes/draft_delete")["delete"]({id:r.id},function(){var e;return i.close(),e=o.noteModel.notes.indexOf(r),o.noteModel.notes.splice(e,1),t.$broadcast("$DeleteNoteDraftSuccessfully")},function(){return console.log("Error occurred")})},e.cancel=function(){return i.close()}}]})},e.deleteNote=function(t){var r,i;return i=e,r=a.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$scope",function(e){return e.ok=function(){return n("/api/v1/notes/"+t.id)["delete"]({},function(){var e;return r.close(),e=i.noteModel.notes.indexOf(t),i.noteModel.notes.splice(e,1)},function(){return console.log("Error occurred")})},e.cancel=function(){return r.close()}}]})},e.alert_need_to_purchase_pay_magazine=function(e){var t,n,r,i;for(n=[],r=0,i=e.length;i>r;r++)t=e[r],n.push("\u300c"+t.name+"\u300d\u30de\u30ac\u30b8\u30f3");return alert(n.length>1?"\u3053\u306e\u30ce\u30fc\u30c8\u306b\u300c\u30b9\u30ad\u300d\u3092\u4ed8\u3051\u308b\u306b\u306f\u3001"+n+"\u306e\u3044\u305a\u308c\u304b\u3092\u8cfc\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002":"\u3053\u306e\u30ce\u30fc\u30c8\u306b\u300c\u30b9\u30ad\u300d\u3092\u4ed8\u3051\u308b\u306b\u306f\u3001"+n+"\u3092\u8cfc\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002")},e.hideAnnounce=function(t){var n;if(t)return n=e.noteModel.notes.indexOf(t),e.noteModel.notes.splice(n,1)},N=function(n){var r;return r=null,"home.home"===n?r=y.stashPop():"creator.home"===n&&(r=v.stashPop(i.urlname)),r?(e.noteModel=angular.copy(r),y.clear(),v.clear(),c(function(){return t.scrollPosNoteKey?(l.hash(t.scrollPosNoteKey),o(),l.hash("")):void 0},10),e.loading=!1,!0):!1},e.initHashtagInfo=function(){var t;return t=i.hashtag,A.get({hashtag:t},function(t){return e.relatedHashtags=t.data.relatedHashtags,e.relatedContests=t.data.relatedContests},function(e){return console.log(e)})},e.initHashtagTimeline=function(){var t;return e.initHashtagInfo(),e.loading?void 0:(t="new"===i.f||"recently"===i.f||"trend"===i.f?i.f:"new",M.set("\u300c#"+i.hashtag+"\u300d\u306e"+("trend"===t?"\u4eba\u6c17":"\u65b0\u7740")+"\u30bf\u30b0\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002"),e.noteModel.notes=[],e.noteModel.firstPage=null,e.noteModel.lastPage=null,e.noteModel.nextPage=null,e.hashtag=i.hashtag,e.f=t,e.search=i.search||"off",e.rssPath=""+l.path()+"/rss",f.then(function(n){return n.error?(e.error=n.error,e.isLoggedIn=!1):(e.currentUser=n.data,g.currentUser=n.data,e.isLoggedIn=!0),e.loading=!0,$.get({hashtag:i.hashtag,note_intro_only:!0,f:t,search:"on"===i.search?"on":"off"},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.count=t.data.hashtag.count,e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page)})}))},e.categoryTransition=function(t,n){return!n&&null===i.sort||"new"===n&&"new"===i.sort?void 0:(e.categ_sort=i.sort||"trend",r.go("categories",{category:t,sort:n},{reload:!0}))},e.pickupTransition=function(t){return e.pickup_key=t||"sort1",r.go("pickups",{pickup_key:e.pickup_key},{reload:!0})},e.initCategoryTimeline=function(){var t;if(!e.loading)return e.noteModel.notes=[],e.noteModel.firstPage=null,e.noteModel.lastPage=null,e.noteModel.nextPage=null,e.categ_sort=i.sort||"trend",e.category=i.category,e.rssPath=""+l.path()+"/rss",t={manga:"\u30de\u30f3\u30ac",column:"\u30b3\u30e9\u30e0",novel:"\u5c0f\u8aac",photo:"\u5199\u771f",music:"\u97f3\u697d",business:"\u30d3\u30b8\u30cd\u30b9",lifestyle:"\u30e9\u30a4\u30d5\u30b9\u30bf\u30a4\u30eb",tech:"\u30c6\u30af\u30ce\u30ed\u30b8\u30fc",entertainment:"\u30a8\u30f3\u30bf\u30e1"},f.then(function(n){return n.error?(e.error=n.error,e.isLoggedIn=!1):(e.currentUser=n.data,g.currentUser=n.data,e.isLoggedIn=!0),e.loading=!0,x.get({note_intro_only:!0,category:i.category,sort:i.sort,method:i.method},function(n){return e.loading=!1,n.error?void(e.error=n.error):(e.noteModel.notes=e.noteModel.notes.concat(n.data.notes),e.noteModel.firstPage=n.data.first_page,e.noteModel.lastPage=n.data.last_page,e.noteModel.nextPage=n.data.next_page,M.set("\u300c"+t[i.category]+"\u300d\u30ab\u30c6\u30b4\u30ea\u306e"+("trend"===e.categ_sort?"\u4eba\u6c17":"\u65b0\u7740")+"\u306e\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002"))},function(n){return console.log(n),M.set("\u300c"+t[i.category]+"\u300d\u30ab\u30c6\u30b4\u30ea\u306e"+("trend"===e.categ_sort?"\u4eba\u6c17":"\u65b0\u7740")+"\u306e\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")
})})},e.initPickupTimeline=function(){return e.loading?void 0:(e.noteModel.notes=[],e.noteModel.firstPage=null,e.noteModel.lastPage=null,e.noteModel.nextPage=null,e.pickup_sort=i.pickup_key||"sort1",f.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,g.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,C.get({note_intro_only:!0,pickup_key:i.pickup_key,sort:i.sort,method:i.method},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,M.set("\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002"))})}))},"home.home"===r.current.name?t.$on("createNoteFromNavBar",function(t,n){return e.noteModel.notes.unshift(n)}):"drafts.home"===r.current.name?t.$on("createNoteDraftFromNavBar",function(t,n){return e.noteModel.notes.unshift(n)}):void 0}])}.call(this),function(){"use strict";angular.module("noteApp").controller("TopCtrl",["$scope","$state","$filter","$rootScope","$location","TopArticle","SpTopStash","Title","$window",function(e,t,n,r,i,a,o,s,l){var c,u,d,p,h,m,f,g;return e.articles=[],e.page=null,e.lastPage=null,e.nextPage=null,e.loading=!1,e.stopLoading=!1,"/"!==i.path()&&(e.rssPath=""+i.path()+"/rss"),e.currentUser=l.PREFETCH.NOTE.user,0===Object.keys(e.currentUser).length&&(e.currentUser=null),null===e.currentUser&&"/"===i.path()&&(e.rssPath="/recommend/rss"),e.isImage=function(e){return"ImageNote"===e.type||"TalkNote"===e.type},c=function(t){var n,r,i,a,o,s,l,c,u;for(n=[],i=function(){var e,t,r;for(e=t=0,r=n.length;r>=0?r>t:t>r;e=r>=0?++t:--t)if(n[e].imgPair&&1===n[e].imageNotes.length)return e;return-1},s=0,c=t.length;c>s;s++)r=t[s],e.isImage(r)===!0?(o=i(),-1===o?n.push({imgPair:!0,imageNotes:[r]}):n[o].imageNotes.push(r)):n.push(r);for(a=l=0,u=n.length;u>=0?u>l:l>u;a=u>=0?++l:--l)n[a].imgPair&&1===n[a].imageNotes.length&&(n[a]=n[a].imageNotes[0],n[a].singleImg=!0);return n},m=function(e,t,r,i){var a,o,s,l,c,u,d,p,h,m,f,g,v;if(!e)return"";for(t||(t=20),r||(r=3),i||(i="..."),h=[],f=e.split(/\n/g),u=0,s=function(){return l<f.length-1},a=function(){var e;return e=h[h.length-1],h[h.length-1]="\n"===e?i:e+i},l=g=0,v=f.length;v>=0?v>g:g>v;l=v>=0?++g:--g)if(m=f[l]){if(d=Math.ceil(m.length/t),o=u,u+=d,u>=r){p=r-o,p?(c=p*t-1,m.length>c?m=n("truncateWithLink")(m,c,i):s()&&(m+=i),h.push(m)):a();break}s()&&(m+="\n"),h.push(m)}else{if(u===r){s()&&a();break}u&&r>u&&(u+=1,s()&&h.push("\n"))}return h.join("")},d=new Date,h=new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours()),p=13,f=window.innerWidth,g=Math.round((r.isPC&&f>=580?560:f-20)/p),u=0,e.getArticles=function(){var n;return e.loading=!0,e.page=e.page?e.page+1:1,n={page:e.page},a.get(n,function(n){var i,a,l,d,p,f,v;if(n.data&&n.data.articles.length){for(v=n.data.articles,p=0,f=v.length;f>p;p++)i=v[p],("TextNote"===i.type||"cakes"===i.type)&&(d=i.image||i.first_picture||i.eyecatch_image_url?7:0,d=(i.image||i.first_picture||i.eyecatch_image_url)&&r.isPC?14:d,a=g-d,l=r.isPC?5:3,i.body=m(i.body,a,l));e.articles=e.articles.concat(c(n.data.articles)),o.stash({articles:e.articles,page:e.page,lastPage:n.data.last_page,stamp:h}),"home.recommend"===t.current.name&&s.set("\u304a\u3059\u3059\u3081\u306e\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")}return e.lastPage=n.data.last_page,e.loading=!1,u+=1,e.stopLoading=u%3===0})},e.init=function(){var t;return t=o.stashPop(),t&&t.hasOwnProperty("articles")&&t.stamp.getTime()===h.getTime()?(e.articles=t.articles,e.page=t.page,e.lastPage=t.lastPage,o.stash(t)):e.getArticles()},e.$on("$scrollBottom",function(){return e.lastPage||e.loading||e.stopLoading?void 0:e.getArticles()})}])}.call(this),function(){"use strict";angular.module("noteApp").controller("UserCtrl",["$scope","$rootScope","$state","$stateParams","$upload","$filter","$q","$window","User","Following","Auth","Bridge","CurrentUserAPI","Title","OAuth","MyMagazine","MyFollowingMagazine","UserPickupMagazine","EditableMagazine","CustomDomainContext",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b){var _,w,k,$,x,C,S,T;return e.currentUser={},e.user={},e.isLoggedIn=null,e.collapsed=!0,e.loaded=!1,e.$state=n,e.$window=s,"home.home"===n.current.name&&h.set(),e.$on("$DeleteNoteDraftSuccessfully",function(){return e.user.draft_count-=1}),e.initUser=function(){return e.isCdAccess=b.isCdAccess(),u.then(function(i){var a;return i.error?(e.error=i.error,e.isLoggedIn=!1):(e.currentUser=i.data,e.isLoggedIn=!0),a={},e.isCdAccess&&"cdCreator"===n.current.name.slice(0,9)?a.urlname=b.key:(null!=r.urlname||e.currentUser.urlname||e.currentUser.id)&&(r.urlname||e.currentUser.urlname?a.urlname=r.urlname||e.currentUser.urlname:a.id=e.currentUser.id),a.urlname||a.id?l.get(a,function(r){var i;return r.error?("not_found"===r.error.code&&n.go("_404",null,{location:!1}),void(e.error=r.error)):!e.isCdAccess&&r.data.custom_domain&&"creator.home"===n.current.name?(i=r.data.custom_domain.tls?"https":"http",s.location.href=""+i+"://"+r.data.custom_domain.host):(e.user=r.data,d.user=e.user,e.user.profile&&e.user.profile.length>120&&(e.fold_profile_text=!0),t.$broadcast("$UserLoaded"),e.loaded=!0,e.user.creator_name=e.user.nickname||e.user.urlname,e.isOwner=e.currentUser&&e.user.id===e.currentUser.id,"creator.home"===n.current.name||"cdCreator.home"===n.current.name?h.set(null!=e.user.nickname?""+e.user.nickname+" ("+e.user.urlname+")":e.user.urlname):"home.recommend"!==n.current.name?h.set():void 0)}):void 0})},e.switchTab=function(t){return e.tabkind=t},e.unfold_profile_text=function(){return e.fold_profile_text=!1},e.onFileSelect=function(n,r){switch(r){case"profile":case"wallpaper":return i.upload({url:"/api/v1/image_upload/"+r,file:n[0]}).success(function(n){return null!=n.error&&"file_size_limit_exceeded"===n.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=n.error&&"file_type_not_allowed"===n.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):(e.user["user_"+r+"_image_path"]=n.data.url,"profile"===r?t.$broadcast("$ProfileImageChanged",n.data.url):void 0)})}},e.$on("$UserFollowed",function(t,n){return e.currentUser.id===e.user.id?e.user.following_count++:e.user.id===n?(e.user.follower_count++,e.user.is_following=!0):void 0}),e.$on("$UserUnFollowed",function(t,n){return e.currentUser.id===e.user.id?e.user.following_count--:e.user.id===n?(e.user.follower_count--,e.user.is_following=!1):void 0}),S="",T="",e.enterUserProfileEdit=function(){return S=e.user.creator_name||"",T=e.user.profile||"",e.edit=!0},e.quitUserProfileEdit=function(){return e.user.creator_name=S,e.user.profile=T,e.edit=!1},e.saveUserProfile=function(){var t;return e.user.creator_name.length>0||(e.user.creator_name=e.user.urlname),e.user.profile&&e.user.profile.length>140?void(e.profileMaxLengthError=!0):(e.profileMaxLengthError=!1,e.user.profile&&(e.user.profile=e.user.profile.replace(/\r|\n/g,"")),t={nickname:e.user.creator_name,profile:e.user.profile},p.update(t,function(){return e.edit=!1}))},x=function(e,t){var n;return n=o.defer(),e.get(t,function(e){return e.error?void console.log(e.error):n.resolve(e.data)},function(){return n.reject("Failed to get my magazine")}),n.promise},$=function(e){return x(g,e)},C=function(e){return x(f,e)},k=function(e){return x(y,e)},_=function(t){var n,r,i,a;for(a=e._magazines,n=0,r=a.length;r>n;n++)if(i=a[n],t.id===i.id)return!0;return!1},e.switchMagazineFilter=function(t){return"follow"===t?$().then(function(t){return e.magazineFilter="follow",e.magazines=t.magazines,e.followingMagazineIsLastPage=t.last_page,e.followingMagazineNextPage=t.next_page,e.filterListShow=!1},function(e){return console.error(e)}):"my"===t?C().then(function(t){return e.magazineFilter="my",e.magazines=t.magazines,e.followingMagazineIsLastPage=t.last_page,e.followingMagazineNextPage=t.next_page,e.filterListShow=!1},function(e){return console.error(e)}):"editable"===t?k().then(function(t){return e.magazineFilter="editable",e.magazines=t.magazines,e.followingMagazineIsLastPage=t.last_page,e.followingMagazineNextPage=t.next_page,e.filterListShow=!1},function(e){return console.error(e)}):(e._magazines=[],C({includes_editable:!0}).then(function(t){return e._magazines=t.magazines,$()},function(){return console.error(error)}).then(function(t){var n,r,i,a;for(a=t.magazines,r=0,i=a.length;i>r;r++)n=a[r],_(n)||e._magazines.push(n);return e.magazineFilter="all",e.magazines=e._magazines,e._magazines=null,e.followingMagazineIsLastPage=t.last_page,e.followingMagazineNextPage=t.next_page,e.filterListShow=!1},function(){return console.error(error)}))},e.initMyMagazine=function(){return u.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1,void(window.location.href="/")):(e.currentUser=t.data,e.isLoggedIn=!0,e.switchMagazineFilter("all"))})},e.initUserPickupMagazines=function(){var n;return n=function(){return v.get({urlname:b.isCdAccess()?b.key:r.urlname},function(n){var r;return n.error?void console.log(n.error):(r=t.isPC?2:5,e.magazines=a("limitTo")(n.data.magazines,r))},function(){return console.error("Failed to get magazines")})},u.then(function(t){return t.error?e.isLoggedIn=!1:(e.currentUser=t.data,e.isLoggedIn=!0),e.user.urlname?n():e.$on("$UserLoaded",function(){return n()})})},e.$on("$UserPickupMagazinesReloadStart",function(){return e.initUserPickupMagazines()}),e.$on("$scrollBottom",function(t,n){switch(n.current.name){case"home.magazines":if(!e.magazineFilter)return;if("my"===e.magazineFilter)return;if("all"===e.magazineFilter||"follow"===e.magazineFilter)return e.loadNextPage("magazines_"+e.magazineFilter)}}),e.loadNextPage=function(t){if("magazines_follow"===t||"magazines_all"===t){if(e.followingMagazineIsLastPage)return;if(e.loading)return;return e.loading=!0,g.get({page:e.followingMagazineNextPage},function(t){return t.error?void console.log(t.error):(e.magazines=e.magazines.concat(t.data.magazines),e.followingMagazineIsLastPage=t.data.last_page,e.followingMagazineNextPage=t.data.next_page,e.loading=!1)},function(){return console.error("Failed to get my magazine"),e.loading=!1})}},w=function(e){var t;return e&&e.length>0?(t=e.match(/\/i\/(.*)/),null!=t&&t.length>1&&t[1].length>0?t[1]:"feeds"):"feeds"}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("a",["$location","CustomDomainContext",function(e,t){return{restict:"E",link:function(n,r,i){var a,o,s,l;if(t.isCdAccess()&&i.href&&!i.uiSref&&!i.contentLink){if("http"===i.href.slice(0,4)||"mailto"===i.href.slice(0,6)||"#"===i.href[0]||"/"===i.href)return;if(o=function(){var t,n,r;if("/"===i.href[0])return i.href;for(l=e.path().split("/"),r=i.href.split("/"),t=0,n=r.length;n>t;t++)s=r[t],l.push(s);return l.join("/")}(),a=function(e){var t,n,r,i;for(t=[/^\/(n|n_alias)\/(n[a-zA-Z0-9_]{12}(\?.*){0,}$)/,/^\/(m|m_alias)\/(m[a-zA-Z0-9_]{12}(\?.*){0,}$)/],r=0,i=t.length;i>r;r++)if(n=t[r],e.match(n))return!0;return!1},!a(o))return r[0].href=""+t.getNoteBaseUrl()+o}}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("addToMagazineModal",["Popeye","$state","$stateParams",function(e,t,n){return{restrict:"A",replace:!0,scope:{note:"=",initAction:"=",control:"=",state:"@",canMultipleLimitedNote:"@"},link:function(r,i){var a;return"add_to_magazine"===r.initAction&&i.click(),a=["$scope","$rootScope","MyMagazine","MagazineNote","OurMagazine","OurMagazineNote",function(i,a,o,s,l,c){var u,d,p;for(d in r.$$isolateBindings)i[d]=r[d];return i.expanded=!1,i.ok=function(){var r,o,s,l,c;if(("magazine.home"===t.current.name||"magazine.homeShort"===t.current.name)&&(o=n.key))for(c=i.magazines,s=0,l=c.length;l>s;s++)r=c[s],r.key!==o||r.selected||a.$broadcast("$RemoveNoteFromMagazine",i.note.key);return e.closeCurrentModal()},u=function(e,t,n,r){return e.is_jointly_managed===!0?c.save({magazine_key:t.magazine_key,note_id:t.note_id},n,r):s.put({magazine_key:t.magazine_key,note_key:t.note_key},n,r)},p=function(e,t,n){return e.is_jointly_managed===!0?c["delete"](t,n):s["delete"](t,n)},i.select=function(e){var t,n,a,o,s,l,c,d,h;if(e.selected){if(i.note.price>0&&i.note.is_limited&&(a=confirm("\u30de\u30ac\u30b8\u30f3\u8cfc\u5165\u8005\u4ee5\u5916\u3082\u8cb7\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f"),!a))return;return p(e,{magazine_key:e.key,note_key:i.note.key},function(t){if(t.error)return void alert(t.error.message);if(i.note.is_limited=!1,e.selected=!1,t.data.delete_limited_note){if("true"===r.canMultipleLimitedNote)return 0===t.data.limited_note_included_magazine_keys.length?i.has_limited_publish_note_magazines=[]:i.note.is_limited=!0;if(e.price>0&&0===i.note.price)return i.has_limited_publish_note_magazine=null;if(e.price>0&&i.note.price>0)return i.has_limited_sell_note_magazine=null}})}for(t=!1,d=i.magazines,o=0,l=d.length;l>o;o++)n=d[o],n.selected&&0===n.price&&(t=!0);if(e.price>0&&t&&0===i.note.price){if(!confirm("\u3053\u306e\u30ce\u30fc\u30c8\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u4ed6\u306e\u30de\u30ac\u30b8\u30f3\uff08\u81ea\u5206\u4ee5\u5916\u306e\u30de\u30ac\u30b8\u30f3\u3082\u542b\u3080\uff09\u304b\u3089\u5916\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\u3002"))return;for(h=i.magazines,s=0,c=h.length;c>s;s++)n=h[s],n.selected=!1}return u(e,{magazine_key:e.key,note_key:i.note.key,note_id:i.note.id},function(t){var a,o,s,l;if(t.error)return void alert(t.error.message);if(e.selected=!0,t.data.add_limited_note){if("true"===r.canMultipleLimitedNote){for(i.has_limited_publish_note_magazines=[],s=i.magazines,l=[],a=0,o=s.length;o>a;a++)n=s[a],l.push(n.price>0?0===i.note.price?i.has_limited_publish_note_magazines.push(n):i.note.price>0?i.has_limited_sell_note_magazine=n:void 0:void 0);return l}if(e.price>0){if(0===i.note.price)return i.has_limited_publish_note_magazine=e;if(i.note.price>0)return i.has_limited_sell_note_magazine=e}}},function(e){return"Not Found"===e.data.error&&alert("\u3053\u306e\u30ce\u30fc\u30c8\u306f\u30de\u30ac\u30b8\u30f3\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002"),"Too Many notes"===e.data.error?alert("\u30de\u30ac\u30b8\u30f3\u306b\u767b\u9332\u3067\u304d\u308b\u30ce\u30fc\u30c8\u306f100\u500b\u307e\u3067\u3067\u3059\u3002"):void 0})},i.initAddToMagazineModal=function(){return i.magazines=[],i.container={},i.loading=!0,o.get({note_key:i.note.key,includes_editable:!0,addable_only:!0},function(e){var t,n,a,o,s,l,c,u,d,p,h,m,f;for(i.loading=!1,i.magazines=e.data.magazines,i.has_limited_publish_note_magazine=null,i.has_limited_sell_note_magazine=null,i.has_limited_publish_note_magazines=[],i.limited_note_included_magazine_keys=e.data.limited_note_included_magazine_keys,d=i.magazines,a=0,l=d.length;l>a;a++)n=d[a],n.selected=n.selected||!1;if("true"!==r.canMultipleLimitedNote){for(h=i.magazines,f=[],s=0,u=h.length;u>s;s++)t=h[s],f.push(t.key===e.data.limited_note_included_magazine_key?0===i.note.price?i.has_limited_publish_note_magazine=t:i.note.price>0?i.has_limited_sell_note_magazine=t:void 0:void 0);return f}if(i.limited_note_included_magazine_keys.length>0){for(p=i.magazines,m=[],o=0,c=p.length;c>o;o++)t=p[o],m.push(t.price>0?0===i.note.price?i.has_limited_publish_note_magazines.push(t):i.note.price>0&&-1!==i.limited_note_included_magazine_keys.indexOf(t.key)?i.has_limited_sell_note_magazine=t:void 0:void 0);return m}},function(){return i.loading=!1,console.log("error")})},i.cancel=function(){return e.closeCurrentModal()},i.quickClose=function(){return a.isNoteEditing=!1,window.location="/notes/"+i.note.key,e.closeCurrentModal()},i.createAdhocMagazine=function(){var e;return i.focusInput=!1,i.submit=!0,i.container.addToMagazineForm.$invalid?void 0:(e={name:i.container.name,status:"public"},o.save(e,function(e){return e.error&&"magazine_count_exceeded"===e.error.code?void alert("\u4f5c\u6210\u53ef\u80fd\u306a\u30de\u30ac\u30b8\u30f3\u306f"+i.user.max_magazine_add_count+"\u500b\u307e\u3067\u3067\u3059\u3002"):(i.magazines.push(e.data),i.container.expanded=!1)},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}))}}],i.on("click",function(){var t,n;return t=window.PREFETCH.NOTE.user,0===Object.keys(t).length&&(t=null),n=e.openModal(null===t?{templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","$location","$state",function(e,t,r){return e.checkout_type="magazineAdd",e.pageTo=function(e){var i;return i=0===r.current.name.lastIndexOf("cd",0)?t.absUrl():t.path(),r.go(e,{redirectPath:i}),n.close()}}]}:{templateUrl:"/templates/modal/add_to_magazine",controller:a})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("addressAutocomplete",["Address","$timeout",function(e,t){return{restrict:"A",require:"ngModel",scope:{prefectureCode:"=",address:"="},link:function(n,r,i,a){var o;return o={},r.on("keyup",function(){var r;return r=a.$viewValue,r&&(r=r.replace(/[\uff10-\uff19]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}).replace(/\D/g,""),7===r.length)?(t.cancel(o),o=t(function(){return function(){return e.get({zipcode:r}).$promise.then(function(e){return e.data?(n.prefectureCode=""+e.data.prefectureCode,n.address=""+e.data.city+e.data.town,a.$setViewValue(e.data.zipCode),a.$render()):void 0})}}(this),1e3)):void 0})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("advancedPostSetting",function(){return{templateUrl:"/templates/common/advanced_post_setting",restrict:"A",scope:{note:"=",user:"=",magazines:"=",data:"=",reservation:"=",relatedNotes:"=",categories:"="},controller:["$scope","$rootScope","$filter","$state","$window","$timeout","MyMagazine","Note","Category","$upload","MessageModal",function(e,t,n,r,i,a,o,s,l,c,u){var d,p,h,m,f,g,v,y;return e.data.reserved=!1,e.data.reserve={yearMonth:null,day:null,time:null},e.data.magazineIds=[],e.data.magChecks={},e.data.limited=e.note.is_limited===!0,e.data.category_id=e.categories?e.note.category_id||e.categories[0].id:null,e.data.ogp=!1,e.isReadyCropper=!1,e.croppedImageUrl=null,e.hasCroppedImage=!1,e.$window=i,!e.note.meta_datum||"published"!==e.note.status&&"reserved"!==e.note.status?(e.imageUrl=e.note.eyecatch?e.note.eyecatch:null,y=$("div.note-name").find('div[contenteditable="true"]').text().trim(),f=$("div.note-lead").find('div[contenteditable="true"]').text(),f=""===f?null:f.trim(),g={title:y,url:null,image:e.imageUrl,description:f},e.data.meta_datum={title:y,og:g}):(e.data.meta_datum=e.note.meta_datum,e.note.eyecatch&&(e.imageUrl=e.note.eyecatch,e.croppedImageUrl=e.note.meta_datum.og.image,e.hasCroppedImage=!0)),e.data.limitedConfigurable=!1,e.data.limitedDisabled=!1,e.data.enable_comment=void 0===e.note.disable_comment||e.note.disable_comment===!1,void 0===e.note.paid_flag&&(e.note.paid_flag=!1),e.data.normalize=function(){var t,n;if(e.data.limited&&!e.user.can_multiple_limited_note&&1!==e.data.magazineIds.length){t=null;for(n in e.data.magChecks)if(e.data.magChecks[n].checked&&e.data.magChecks[n].paid){t=e.data.magChecks[n].id;break}return t?e.data.magazineIds=[t]:e.data.limited=!1}},e.visible="asp_manage"===i.PREFETCH.NOTE.mode,e.magListVisible=!1,e.reservable=e.user.reserved_posting_available&&"published"!==e.note.status,e.publishAtEditable="published"===e.note.status&&"asp_manage"===window.PREFETCH.NOTE.mode,e.calendar={from:null,to:null,yearMonth:[],days:[],times:[]},e.can_sell_on_first_come_note=e.user.can_sell_on_first_come_note,e.generateCanvas=function(t){return e.canvas=document.createElement("canvas"),e.canvas.width=t.width,e.canvas.height=t.height,e.contextCanvas=e.canvas.getContext("2d"),e.contextCanvas.clearRect(0,0,0,0),e.contextCanvas.drawImage(t,0,0,t.width,t.height)},e.generateCropper=function(t){var n,r,i;return r=300,n=document.getElementById("cropImage"),e.cropper&&(e.cropper.destroy(),e.contextCropper.clearRect(0,0,0,0)),i=t.height*r/t.width,a(function(){return n.width=r,n.height=i,e.contextCropper=n.getContext("2d"),e.contextCropper.drawImage(t,0,0,t.width,t.height,0,0,r,i),e.cropper=new Cropper(n,{zoomable:!1}),e.cropper.reducedScale=t.width/r})},d=function(e){return("0"+e).substr(-2)},e.data.isPr=!1,e.data.catchCopy=null,e.data.sponseredBy=null,e.data.editedPublishAt=!1,e.data.isLoginRequired=null,null!=e.note.additional_attr&&(null!=e.note.additional_attr.is_pr&&(e.data.isPr=e.note.additional_attr.is_pr),null!=e.note.additional_attr.catch_copy&&(e.data.catchCopy=e.note.additional_attr.catch_copy),null!=e.note.additional_attr.sponsered_by&&(e.data.sponseredBy=e.note.additional_attr.sponsered_by),null!=e.note.additional_attr.is_login_required&&(e.data.isLoginRequired=e.note.additional_attr.is_login_required)),e.publishAtEditable&&(v=new Date(i.PREFETCH.NOTE.published_at_from_year,0),e.data.newPublishAt=moment(e.note.publish_at,"YYYY-MM-DD HH:mm:ss Z").toDate(),e.publishAtRange={startAt:v,endAt:new Date}),e.publishAtEditable&&null!=e.note.additional_attr&&null!=e.note.additional_attr.edited_publish_at&&(e.data.editedPublishAt=e.note.additional_attr.edited_publish_at),p=function(){var t,n,r,i,a;for(t=0,a=e.data.magazineIds,r=0,i=a.length;i>r;r++)n=a[r],e.data.magChecks[n].paid&&(t+=1);return t},m=function(t){var n;return n=e.data.magChecks[t].magazine,n.is_suspended},h=function(t){return m(t)?!1:e.note.paid_flag===!1&&e.user.can_multiple_limited_note&&e.data.magChecks[t].paid},e.init=function(){var n,r,a,o,s,l,c,u,h;for(s=function(){return e.data.limitedConfigurable=e.user.is_premium&&e.note.paid_flag&&p()>0,e.data.limitedDisabled=e.data.magazineIds.length>1||1!==p(),e.magListVisible=e.data.magazineIds.length>0,"asp_manage"!==i.PREFETCH.NOTE.mode&&(e.visible=e.magListVisible||e.note.is_reserved||e.note.hashtag&&e.note.hashtag_notes.length),e.onLimitedChecked()},o=function(){var n,r,i,a,o,l,c,u,p,h,m,f,g,v,y,b,_,w,k;for(e.calendar.from=t.availableReservationPeriod.from,e.calendar.to=t.availableReservationPeriod.to,r=c=y=e.calendar.from.getMonth()+1;12>=y?12>=c:c>=12;r=12>=y?++c:--c)e.calendar.yearMonth.push(e.calendar.from.getFullYear()+"-"+d(r));for(r=u=1,b=e.calendar.to.getFullYear()-e.calendar.from.getFullYear();b>=1?b>u:u>b;r=b>=1?++u:--u)for(i=p=1;12>=p;i=++p)e.calendar.yearMonth.push(e.calendar.from.getFullYear()+r+"-"+d(i));for(r=h=1,_=e.calendar.to.getMonth()+1;_>=1?_>=h:h>=_;r=_>=1?++h:--h)e.calendar.yearMonth.push(e.calendar.to.getFullYear()+"-"+d(r));if(e.note.is_reserved===!0){for(e.data.reserved=!0,n=e.reservation,e.data.limited=n.limited,w=n.magazines,g=0,m=w.length;m>g;g++)for(l=w[g],e.data.magazineIds.push(l.id),e.data.magChecks[l.id].checked=!0,k=e.magazines,v=0,f=k.length;f>v;v++)if(a=k[v],l.id===a.id){a.selected=!0;break}return o=moment(n.publish_at,"YYYY-MM-DD HH:mm:ss Z").toDate(),e.data.reserve.yearMonth=o.getFullYear()+"-"+d(o.getMonth()+1),e.data.reserve.day=d(o.getDate()),e.data.reserve.time=d(o.getHours())+":"+d(o.getMinutes()),e.onDateChange(),e.setPublishAt(),s()}return e.data.reserve.yearMonth=e.calendar.yearMonth[0],e.data.reserve.day=e.calendar.from.getDate(),e.onDateChange(),e.data.reserve.time=e.calendar.times[0],s()},h=e.magazines,c=0,u=h.length;u>c;c++)n=h[c],n.selected&&e.data.magazineIds.push(n.id),e.data.magChecks[n.id]={id:n.id,paid:n.price>0,checked:n.selected,magazine:n,disabled:!1,visible:!0};return e.reservable?(r=new Date,l=new Date(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours()),a=t.availableReservationPeriod,a&&a.stamp.getTime()===l.getTime()?o():$.get("api/v1/reserved_note/period",function(e){return e=JSON.parse(e),t.availableReservationPeriod={from:new Date(e.from),to:new Date(e.to),stamp:l},o()})):s()},e.onDateChange=function(){var t,n,r,i,a,o,s,l,c,u,p,h,m,f,g,v,y,b,_;if(e.data.reserve.yearMonth){for(e.calendar.days=[],e.calendar.times=[],g=e.data.reserve.yearMonth.split("-"),f=Number(g[0]),h=Number(g[1]),t=Number(e.data.reserve.day),m=new Date,o=function(){return 1===new Date(f,1,29).getMonth()},s=function(){return-1!==[2,4,6,9,11].indexOf(h)},a=function(){return f===e.calendar.from.getFullYear()&&h===e.calendar.from.getMonth()+1},l=function(){return f===e.calendar.to.getFullYear()&&h===e.calendar.to.getMonth()+1},n=a()?e.calendar.from.getDate():1,u=s()?30:31,o()&&2===h&&(u=29),o()||2!==h||(u=28),l()&&(u=e.calendar.to.getDate()),r=a()&&t===e.calendar.from.getDate()?e.calendar.from.getHours():0,i=v=n;u>=n?u>=v:v>=u;i=u>=n?++v:--v)e.calendar.days.push(d(i));for(i=y=r;23>=r?23>=y:y>=23;i=23>=r?++y:--y)for(p=r&&i===r&&m.getMinutes()>=30?[30]:[0,30],b=0,_=p.length;_>b;b++)c=p[b],e.calendar.times.push(d(i)+":"+d(c));return e.data.reserve.time&&-1===e.calendar.times.indexOf(e.data.reserve.time)&&e.calendar.times.splice(0,0,e.data.reserve.time),e.setPublishAt()}},e.setPublishAt=function(){var t,n,r,i,a,o,s;return e.data.reserve.yearMonth&&e.data.reserve.day&&e.data.reserve.time?(s=e.data.reserve.yearMonth.split("-"),a=e.data.reserve.time.split(":"),o=Number(s[0]),i=Number(s[1])-1,t=Number(e.data.reserve.day),n=Number(a[0]),r=Number(a[1]),e.data.publishAt=new Date(o,i,t,n,r)):void 0},e.onMagazineChecked=function(t){var n,r,i,a,o;if(r=function(t){var n;return n=e.data.magazineIds.indexOf(t),-1!==n?e.data.magazineIds.splice(n,1):void 0},e.data.magChecks[t.id].checked?e.data.magazineIds.push(t.id):r(t.id),e.data.magazineIds.length){for(o=e.data.magazineIds,i=0,a=o.length;a>i;i++)if(n=o[i],e.data.magChecks[n].paid){if(e.note.paid_flag?e.data.limitedDisabled=e.data.magazineIds.length>1||1!==p():e.data.limited=!0,e.data.limited)for(n in e.data.magChecks)e.data.magChecks[n].checked&&m(n)||Number(n)===t.id&&m(n)||Number(n)===t.id||h(n)||(e.data.magChecks[n].disabled=!0,e.data.magChecks[n].checked=!1,r(Number(n)));break}}else{for(n in e.data.magChecks)Number(n)===t.id&&m(n)||(e.data.magChecks[n].disabled=e.data.magChecks[n].checked===!1&&m(n));e.data.limited=!1,e.data.limitedDisabled=!1}return e.data.limitedConfigurable=e.user.is_premium&&e.note.paid_flag&&p()>0},e.onLimitedChecked=function(){var t,n,r,i;if(e.data.limited){r=[];for(t in e.data.magChecks)e.data.magChecks[t].checked&&m(t)||e.data.magChecks[t].checked||h(t)||r.push(e.data.magChecks[t].disabled=!0);return r}i=[];for(t in e.data.magChecks)n=e.data.magChecks[t].magazine,i.push(e.data.magChecks[t].disabled=e.data.magChecks[t].checked===!1&&m(t));return i},e.onReservedFlagChanged=function(){return e.data.reserved?(e.data.reserve.yearMonth=e.calendar.yearMonth[0],e.onDateChange(),e.data.reserve.time=e.calendar.times[0],e.data.reserve.day=e.calendar.days[0],e.setPublishAt()):e.data.publishAt=null},e.toggleOgpSetting=function(){return e.data.ogp=!e.data.ogp,e.data.ogp&&!e.isReadyCropper&&e.data.meta_datum.og.image?e.genImageForCropper(e.imageUrl):void 0},e.execCrop=function(){var t;return t=e.cropper.getData(),e.canvas.toBlob(function(){return function(n){return c.upload({url:"/api/v2/image_upload/ogp_image",fileName:"note_"+e.note.id+"_ogp.jpg",file:n,data:{note_id:e.note.id,x:Math.round(t.x*e.cropper.reducedScale),y:Math.round(t.y*e.cropper.reducedScale),height:Math.round(t.height*e.cropper.reducedScale),width:Math.round(t.width*e.cropper.reducedScale)}}).success(function(t){return angular.element(".cropper-container").hide(),e.croppedImageUrl=t.data.url,e.data.meta_datum.og.image=t.data.url}).error(function(){return u.show({title:"\u30a8\u30e9\u30fc",message:"\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"})})}}(this),"image/jpeg")},e.initCrop=function(){return e.croppedImageUrl=null,e.data.meta_datum.og.image=null,angular.element(".cropper-container").show(),e.imageUrl?e.genImageForCropper(e.imageUrl):void 0},e.ogpImageFileUpload=function(t){var n;return null==t&&(t=".jpg,.gif,.png,image/gif,image/jpeg,image/png"),n=document.createElement("input"),n.setAttribute("style","display: none"),n.setAttribute("type","file"),n.setAttribute("accept",t),n.onchange=function(){return function(t){var n,r;return r=new FileReader,r.onload=function(t){return a(function(){return e.fileUploadImage={source:t.target.result,mime:n.type,name:n.name},e.genImageForCropper(t.target.result)})},(n=t.target.files[0])?r.readAsDataURL(n):void 0}}(this),n.click()},e.genImageForCropper=function(t){var n;return n=new Image,n.onload=function(){return function(){return e.hasCroppedImage||(a(function(){return e.croppedImageUrl=null}),e.generateCropper(n),e.generateCanvas(n),e.isReadyCropper=!0),e.hasCroppedImage=!1}}(this),n.crossOrigin="anonymous",n.src=t},e.addNewMagazine=function(){var t,n;return t=prompt("\u30de\u30ac\u30b8\u30f3\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),t?t.length>30?void alert("\u30de\u30ac\u30b8\u30f3\u540d\u306f30\u6587\u5b57\u4ee5\u5185\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):(n={name:t,status:"public"},o.save(n,function(t){return t.error&&"magazine_count_exceeded"===t.error.code?void alert("\u4f5c\u6210\u53ef\u80fd\u306a\u30de\u30ac\u30b8\u30f3\u306f"+e.user.max_magazine_add_count+"\u500b\u307e\u3067\u3067\u3059\u3002"):(e.data.magChecks[t.data.id]={id:t.data.id,paid:t.data.price>0,checked:!1,magazine:t.data,disabled:e.data.limited===!0,visible:!0},e.magazines.push(t.data))},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})):void 0},e.switchVisibility=function(){return e.visible=!e.visible},e.switchMagListVisibility=function(){return e.magListVisible=!e.magListVisible},e.isSelectedMagazine=function(e){return e.selected===!0},e.isUnselectedPaidMagazine=function(e){return e.price>0&&!e.selected},e.isUnselectedFreeMagazine=function(e){return 0===e.price&&!e.selected},a(function(){return e.init()})}]}})}.call(this),function(){"use strict";var e,t,n=[].slice;t=["$rootScope","$scope","$state","$window","Author","AuthorContent"],e=function(){function e(e,t,n,r,i,a){this.$rootScope=e,this.$scope=t,this.$state=n,this.$window=r,this.Author=i,this.AuthorContent=a,this.checkEnabled(),this.initProps(),this.setCallbacks(),this.load()}return e.prototype.checkEnabled=function(){return this.$window.PREFETCH.NOTE.enable_authors?void 0:this.$state.go("home.home")},e.prototype.initProps=function(){return this.displayMode="view",this.currentTab="home",this.currentPage=1,this.isLastPage=!1,this.isLoading=!1,this.isPC=this.$rootScope.isPC,this.urlname=this.$state.params.urlname},e.prototype.setCallbacks=function(){return this.$scope.$on("$scrollBottom",function(e){return function(){return e.paging()}}(this))},e.prototype.isCurrentTabFor=function(e){return this.currentTab===e},e.prototype.load=function(){return this.isLoading=!0,this.Author.get({urlname:this.urlname}).$promise.then(function(e){return function(t){return e.author=t.data,e.loadContents()}}(this)).then(function(e){return function(t){return e.notes=t.data.contents,e.isLoading=!1}}(this))["catch"](function(e){return function(){return e.isLoading=!1}}(this))},e.prototype.loadContents=function(){var e;return e=this.currentPage,this.AuthorContent.get({urlname:this.urlname,page:e}).$promise},e.prototype.paging=function(){return this.isLoading||this.isLastPage?void 0:(this.isLoading=!0,this.currentPage+=1,this.loadContents().then(function(e){return function(t){return e.notes=e.notes.concat(t.data.contents),e.isLoading=!1,e.isLastPage=t.data.isLastPage}}(this))["catch"](function(e){return function(){return e.isLoading=!1}}(this)))},e}(),angular.module("noteApp").directive("authorHome",function(){return{restrict:"E",scope:{},templateUrl:"/templates/authors/show",controller:n.call(t).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){var r,i;this.$scope=e,this.$timeout=t,this.ManageAuthorSearches=n,r={},i=function(e){return function(){return e.searchText}}(this),this.$scope.$watch(i,function(e){return function(t){return e.isNotFound=!1,e.suggests=[],!t||t.length<2?void 0:(e.$timeout.cancel(r),r=e.$timeout(function(){return e.ManageAuthorSearches.get({q:t}).$promise.then(function(t){return e.suggests=t.data.authors.contents.slice(0,10).filter(function(t){return!e.isAddedAuthor(t.id)}),e.isNotFound=e.searchText&&e.searchText.length>=2&&0===e.suggests.length})},1e3))}}(this))}return e.inject=["$scope","$timeout","ManageAuthorSearches"],e.prototype.addItem=function(e){return this.searchText=null,this.suggests=[],this.authors.push(e),this.onChanged()?this.onChanged()():void 0
},e.prototype.isAddedAuthor=function(e){var t;return t=this.authors.filter(function(t){return t.id===e}),t.length>0},e.prototype.removeItem=function(e){return this.authors=this.authors.filter(function(t){return t.id!==e}),this.onChanged()?this.onChanged()():void 0},e}(),angular.module("noteApp").directive("authorInput",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/author_setting",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{authors:"=",onChanged:"&"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$upload=e,this.$window=t,this.ManageAuthor=n,this.Popeye=r,this.UrlPattern=i}return e.inject=["$upload","$window","ManageAuthor","Popeye","UrlPattern"],e.prototype.open=function(){return this.Popeye.openModal({templateUrl:"/templates/modal/author",controller:["$scope",function(e){return function(t){return t.author=$.extend(!0,{},e.author),t.afterSave=e.afterSave,t.submitting=!1,t.type=e.type,t.imageFile=null,t.$upload=e.$upload,t.$window=e.$window,t.ManageAuthor=e.ManageAuthor,t.Popeye=e.Popeye,t.UrlPattern=e.UrlPattern,t.uploadImage=function(e){var n;return n={url:"/api/v2/images",data:{author_id:e,file:t.imageFile,kind:"tmp_author_profile"}},t.$upload.upload(n)},t.saveAuthor=function(){var e,n;return t.submitting=!0,n=function(e,n){return t.ManageAuthor.update({id:e.id},{author:e,tmp_author_profile_key:n}).$promise},e="new"===t.type?t.ManageAuthor.save({author:t.author}).$promise.then(function(e){return t.author=e.data,t.imageFile?t.uploadImage(t.author.id).then(function(e){return t.author.imageUrl=e.data.data.url,n(t.author,e.data.data.key)}):void 0}):"edit"===t.type?t.imageFile?t.uploadImage(t.author.id).then(function(e){return t.author.imageUrl=e.data.data.url,n(t.author,e.data.data.key)}):n(t.author):void 0,e?e.then(function(){return t.submitting=!1,t.afterSave(t.author),t.close()})["catch"](function(e){return t.submitting=!1,alert(e.data.data.join("\n"))}):void 0},t.selectFile=function(){return document.getElementById("author-select-file").click()},t.onFileSelect=function(e){var n,r;return n=["image/jpeg","image/png","image/gif"],-1===n.indexOf(e[0].type)?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):e[0].size>5242880?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):(t.imageFile=e[0],r=new FileReader,r.readAsDataURL(e[0]),r.onload=function(e){return t.author.imageUrl=e.target.result,t.$apply()})},t.close=function(){return t.Popeye.closeCurrentModal()}}}(this)]})},e}(),angular.module("noteApp").directive("authorModal",function(){return{restrict:"A",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{afterSave:"=",author:"=",type:"@"},scope:{},link:function(e,t){return t.on("click",function(){return e.$ctrl.open()})}}})}.call(this),function(){"use strict";var e,t,n=[].slice;t=["$http","$state","$scope","$window","Author"],e=function(){function e(e,t,n,r,i){this.$http=e,this.$state=t,this.$scope=n,this.$window=r,this.Author=i,this.checkEnabled(),this.initProps(),this.setCallbacks(),this.loadAuthors()}return e.prototype.checkEnabled=function(){return window.PREFETCH.NOTE.enable_authors?void 0:this.$state.go("home.home")},e.prototype.initProps=function(){return this.authors=[],this.isLoading=!1,this.nextUrl=null},e.prototype.loadAuthors=function(){return this.isLoading=!0,this.Author.get().$promise.then(function(e){return function(t){return e.recieveAuthors(t.data)}}(this))},e.prototype.setCallbacks=function(){return this.$scope.$on("$scrollBottom",function(e){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.nextUrl&&!this.isLoading?(this.isLoading=!0,this.$http.get(this.nextUrl).then(function(e){return function(t){return e.recieveAuthors(t.data.data)}}(this))):void 0},e.prototype.recieveAuthors=function(e){var t,n,r;return t=e.authors,n=e.nextUrl,r=e.totalCount,this.authors=this.authors.concat(t),this.nextUrl=n,this.totalCount=r,this.isLoading=!1},e}(),angular.module("noteApp").directive("authors",function(){return{restrict:"E",scope:{},templateUrl:"/templates/authors/index",controller:n.call(t).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("unBlockUser",["Block",function(e){var t;return t={restrict:"A",scope:{user:"="},link:function(t,n){return n.on("click",function(){return e["delete"]({id:t.user.id},function(e){return e.error?void alert(e.error.message):(t.user.isBlocked=!1,alert("\u30d6\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3057\u307e\u3057\u305f\u3002"))})})}}}]),angular.module("noteApp").directive("blockUser",["Block",function(e){var t;return t={restrict:"A",scope:{user:"="},link:function(t,n){return n.on("click",function(){return e.save({id:t.user.id},function(e){return e.error?void alert(e.error.message):(t.user.isBlocked=!0,alert("\u30d6\u30ed\u30c3\u30af\u3057\u307e\u3057\u305f\u3002"))})})}}}])}.call(this),function(){"use strict";var e;angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/breadCrumbs.html",'<div class="breadcrumb">\n  <ul ng-if="$ctrl.breadCrumbs.length > 1">\n    <li ng-repeat="breadCrumb in $ctrl.breadCrumbs" style="display: inline-block;">\n      <a class="breadcrumb-item home" ng-if="breadCrumb.path == \'/\'" ng-href="{{breadCrumb.path}}"></a>\n      <a class="breadcrumb-item" ng-if="breadCrumb.path && breadCrumb.path != \'/\'" ng-href="{{breadCrumb.path}}">{{breadCrumb.label}}</a>\n      <span class="breadcrumb-item" ng-if="breadCrumb.path == null && breadCrumb.label != \'Top\'">{{breadCrumb.label}}</span>\n    </li>\n  </ul>\n</div>')}]),e=function(){function e(e,t,n,r,i,a,o,s){var l;this.$scope=e,this.$state=t,this.BreadCrumbsService=n,this.rootScope=r,this.$timeout=i,this.$sce=a,this.$q=o,this.$window=s,l=this,this.breadCrumbs=[],this.$scope.$on("$stateChangeSuccess",function(e){return function(t,n,r,i,a){return e.getBreadCrumbData(t,n,r,i,a).then(function(){var t;return n.data&&n.data.setTitle&&e.breadCrumbs.length>0?(t=e.breadCrumbs[e.breadCrumbs.length-1].label,n.data.resolveTitle(t)):void 0},function(){return n.data&&n.data.setTitle?n.data.rejectTitle():void 0})}}(this))}return e.$inject=["$scope","$state","BreadCrumbsService","$rootScope","$timeout","$sce","$q","$window"],e.prototype.getBreadCrumbData=function(e,t,n){return this.$q(function(e){return function(r,i){var a,o,s,l;return o=e.$state.href(t.name,n),s=t.name.split("."),l="static"===s[0]&&s.length>1?s.slice(1,s.length).join("_"):s.join("_"),"search"===l?(e.breadCrumbs=[{label:"Top",path:"/"},{label:n.q?e.$sce.trustAsHtml(n.q):"\u691c\u7d22"}],r()):(a={state:l,state_params:e.stateParams(l,n)},o&&-1!==e.$window.PREFETCH.staticPage.paths.indexOf(o)&&(a.path=o),e.BreadCrumbsService.get(a,function(t){var n;return"hashtag_detail"===l&&t.data.breadCrumbs.length>1?(n=t.data.breadCrumbs[t.data.breadCrumbs.length-1],e.breadCrumbs=[{label:"Top",path:"/"},{label:"#"+n.label,path:null}]):e.breadCrumbs=t.data.breadCrumbs,r()},function(){return i()}))}}(this))},e.prototype.stateParams=function(e,t){switch(e){case"author_detail":return{urlname:t.urlname};case"hashtag_detail":return{name:t.hashtag};case"magazine_detail":return{key:t.key};case"category_detail":return{category:t.category};case"article_detail":return{slug:t.slug};default:return{}}},e}(),angular.module("noteApp").directive("breadCrumbs",function(){return{restrict:"E",scope:{},replace:!0,templateUrl:"common/renewal/breadCrumbs.html",controller:e,controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$scope=e,this.$timeout=t,this.BundleUtils=n,this.initProps(),this.setCallbacks()}return e.inject=["$scope","$timeout","BundleUtils"],e.prototype.addItem=function(e){var t;return t=this.BundleUtils.createBundleContent(this.bundle,e),this.searchText=null,this.suggests=[],this.bundle.bundleContents.push(t)},e.prototype.datetimeFormat=function(e){return moment(e).format("YYYY/MM/DD HH:mm")},e.prototype.initProps=function(){},e.prototype.removeItem=function(e){return this.bundle.bundleContents=this.bundle.bundleContents.filter(function(t){return function(n){return!t.BundleUtils.isEqBundleContent(n,e)}}(this))},e.prototype.setCallbacks=function(){var e,t;return e={},t=function(e){return function(){return e.searchText}}(this),this.$scope.$watch(t,function(t){return function(n){return t.isNotFound=!1,t.suggests=[],!n||n.length<2?void 0:(t.$timeout.cancel(e),e=t.$timeout(function(){return t.BundleUtils.getSearches(t.bundle.type).get({context:t.BundleUtils.searchContext(t.bundle.type),q:t.searchText,bundle:!0}).$promise.then(function(e){return t.suggests=t.BundleUtils.filterSuggests(t.bundle.bundleContents,e.data),t.isNotFound=t.searchText&&t.searchText.length>=2&&0===t.suggests.length})},1e3))}}(this))},e}(),angular.module("noteApp").directive("bundleContentInput",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/bundle_content_setting",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{bundle:"=",contentTypeName:"="}}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n,r,i,a){this.$scope=e,this.$timeout=n,this.BundleUtils=r,this.Searches=i,this.Popeye=a,this.closeGalleryModal=t(this.closeGalleryModal,this),this.addItems=t(this.addItems,this),this.addedImageIds=[]}return e.inject=["$scope","$timeout","BundleUtils","Searches","Popeye"],e.prototype.addItems=function(e){return angular.forEach(e,function(e){return function(t){var n;return n=e.BundleUtils.createBundleContent(e.bundle,t),e.bundle.bundleContents.push(n)}}(this))},e.prototype.openGalleryModal=function(){return this.addedImageIds=this.bundle.bundleContents.map(function(e){return e.contentableId}),this.galleryModalOpened=!0},e.prototype.closeGalleryModal=function(){return this.galleryModalOpened=!1},e.prototype.datetimeFormat=function(e){return moment(e).format("YYYY/MM/DD HH:mm")},e.prototype.initProps=function(){},e.prototype.removeItem=function(e){return this.bundle.bundleContents=this.bundle.bundleContents.filter(function(t){return function(n){return!t.BundleUtils.isEqBundleContent(n,e)}}(this))},e}(),angular.module("noteApp").directive("bundleContentInstagram",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/bundle_content_instagram",controller:n.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{bundle:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){this.initProps()}return e.inject=[],e.prototype.daysOfMonths=function(e){var t,n,r;return n=e.year,t=e.month,function(){r=[];for(var e=1,i=moment({year:n,month:t}).endOf("month").date();i>=1?i>=e:e>=i;i>=1?e++:e--)r.push(e);return r}.apply(this).map(function(e){return{day:e,text:moment({year:n,month:t,day:e}).format("DD\u65e5")}})},e.prototype.getSelected=function(e,t){return{yearMonth:this.yearMonths.filter(function(e){var n,r;return r=e.year,n=e.month,r===t.year&&n===t.month})[0],day:e.filter(function(e){var n;return n=e.day,n===t.day})[0],time:this.times.filter(function(e){var n,r;return n=e.hour,r=e.minute,n===t.hour&&r===t.minute})[0]}},e.prototype.initProps=function(){var e,t,n;return n=this.bundleContent,t=n.startedAt,e=n.endedAt,this.yearMonths=this.initYearMonths(),this.startedAtDays=this.daysOfMonths(t),this.endedAtDays=this.daysOfMonths(e),this.times=this.initTimes(),this.selectedStartedAt=this.getSelected(this.startedAtDays,t),this.selectedEndedAt=this.getSelected(this.endedAtDays,e)},e.prototype.initTimes=function(){var e,t;return e=1439,function(){t=[];for(var n=0;e>=0?e>=n:n>=e;e>=0?n++:n--)t.push(n);return t}.apply(this).map(function(e){var t;return t=moment({hour:0,minute:0}).add({minute:e}),{hour:t.hour(),minute:t.minute(),text:t.format("HH:mm")}})},e.prototype.initYearMonths=function(){return[0,1,2,3,4,5,6,7,8,9,10,11,12].map(function(e){var t;return t=moment().add({month:e}),{year:t.year(),month:t.month(),text:t.format("YYYY\u5e74MM\u6708")}})},e.prototype.onDatetimeChange=function(e){switch(e){case"startedAt":return this.startedAtDays=this.daysOfMonths(this.selectedStartedAt.yearMonth),this.bundleContent.startedAt=this.selectedToDatetime(this.selectedStartedAt);case"endedAt":return this.endedAtDays=this.daysOfMonths(this.selectedEndedAt.yearMonth),this.bundleContent.endedAt=this.selectedToDatetime(this.selectedEndedAt)}},e.prototype.selectedToDatetime=function(e){var t,n,r;return r=e.yearMonth,t=e.day,n=e.time,{year:r.year,month:r.month,day:t.day,hour:n.hour,minute:n.minute}},e}(),angular.module("noteApp").directive("bundleContentTimeSetting",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/bundle_content_time_setting",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{bundleContent:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.BundleUtils=e,this.ManageBundle=t,this.Popeye=n,this.$window=r}return e.inject=["BundleUtils","ManageBundle","Popeye","$window"],e.prototype.open=function(){return this.Popeye.openModal({templateUrl:"/templates/modal/bundle_edit",controller:["$scope",function(e){return function(t){return t.fetchBundleDetail=function(){return t.ManageBundle.get({id:t.bundle.id}).$promise},t.afterUpdate=e.afterUpdate,t.bundle=$.extend(!0,{},e.bundle),t.imageFile=null,t.submitting=!1,t.BundleUtils=e.BundleUtils,t.ManageBundle=e.ManageBundle,t.Popeye=e.Popeye,t.$window=e.$window,t.contentTypeName=function(){switch(this.bundle.type){case"hybrid":return"\u30b3\u30f3\u30c6\u30f3\u30c4";default:return"\u8a18\u4e8b"}}.call(e),t.fetchBundleDetail().then(function(e){return t.bundle=t.BundleUtils.decode(e.data)}),t.close=function(){return t.Popeye.closeCurrentModal()},t.save=function(){var e,n,r;return t.submitting=!0,e=t.BundleUtils.encode(t.bundle),0===t.bundle.bundleContents.length&&(t.$window.confirm("\u8a18\u4e8b\u306e\u6570\u304c0\u4ef6\u3067\u3059\u304c\u4fdd\u5b58\u3057\u307e\u3059\u304b\uff1f")||t.close),r=t.imageFile?(n={bundleId:t.bundle.id,imageFile:t.imageFile},t.BundleUtils.uploadImage(n).then(function(n){return t.bundle.imageUrl=n.data.data.url,t.ManageBundle.update({id:t.bundle.id},{bundle:e,tmp_bundle_image_key:n.data.data.key}).$promise})):t.ManageBundle.update({id:t.bundle.id},{bundle:e}).$promise,r.then(t.fetchBundleDetail).then(function(e){return t.afterUpdate(t.BundleUtils.decode(e.data)),angular.forEach(t.bundle.bundleContents,function(e){return e.style={}}),t.Popeye.closeCurrentModal(),t.submitting=!1}).then(function(){return t.ManageBundle.deleteCache({id:t.bundle.id})})["catch"](function(e){return t.submitting=!1,alert(e.data.data.join("\n"))})},t.selectFile=function(){return document.getElementById("bundle-edit-select-file").click()},t.onFileSelect=function(e){var n,r;return n=["image/jpeg","image/png","image/gif"],-1===n.indexOf(e[0].type)?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):e[0].size>5242880?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):(t.imageFile=e[0],r=new FileReader,r.readAsDataURL(e[0]),r.onload=function(e){return t.bundle.imageUrl=e.target.result,t.$apply()})}}}(this)]})},e}(),angular.module("noteApp").directive("bundleEditModal",function(){return{restrict:"A",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{afterUpdate:"=",bundle:"="},scope:{},link:function(e,t){return t.on("click",function(){return e.$ctrl.open()})}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$scope=e,this.$timeout=t,this.BundleUtils=n,this.searchType="note",this.initProps(),this.setCallbacks()}return e.inject=["$scope","$timeout","BundleUtils"],e.prototype.addItem=function(e){var t;return t=this.BundleUtils.createHybridBundleContent(this.searchType,e),this.searchText=null,this.suggests=[],this.bundle.bundleContents.push(t)},e.prototype.datetimeFormat=function(e){return moment(e).format("YYYY/MM/DD HH:mm")},e.prototype.initProps=function(){},e.prototype.removeItem=function(e){return this.bundle.bundleContents=this.bundle.bundleContents.filter(function(t){return function(n){return!t.BundleUtils.isEqBundleContent(n,e)}}(this))},e.prototype.setCallbacks=function(){var e,t;return e={},t=function(e){return function(){return e.searchText}}(this),this.$scope.$watch(t,function(t){return function(n){return t.isNotFound=!1,t.suggests=[],!n||n.length<2?void 0:(t.$timeout.cancel(e),e=t.$timeout(function(){return t.BundleUtils.getHybridSearches(t.searchType).get({context:t.BundleUtils.searchContext(t.searchType),q:t.searchText,bundle:!0}).$promise.then(function(e){return t.suggests=t.BundleUtils.filterSuggests(t.bundle.bundleContents,e.data),t.isNotFound=t.searchText&&t.searchText.length>=2&&0===t.suggests.length})},1e3))}}(this))},e}(),angular.module("noteApp").directive("bundleHybridContentInput",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/bundle_hybrid_content_setting",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{bundle:"=",contentTypeName:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.Popeye=e,this.BundleUtils=t,this.ManageBundle=n,this.$window=r}return e.inject=["Popeye","BundleUtils","ManageBundle","$window"],e.prototype.open=function(){return this.Popeye.openModal({templateUrl:"/templates/modal/bundle_new",controller:["$scope",function(e){return function(t){return t.afterCreate=e.afterCreate,t.bundle={bundleKey:"",bundleContents:[],imageUrl:e.$window.PREFETCH.NOTE.defaultImage.profile,name:"",type:"note_manual"},t.imageFile=null,t.submitting=!1,t.typeOptions=[{text:"note",value:"note_manual"},{text:"instagram",value:"instagram"},{text:"hybrid",value:"hybrid"}],t.BundleUtils=e.BundleUtils,t.ManageBundle=e.ManageBundle,t.Popeye=e.Popeye,t.save=function(){var e;return t.submitting=!0,e=t.BundleUtils.encode(t.bundle),t.ManageBundle.save({bundle:e}).$promise.then(function(n){var r;return t.bundle=n.data,t.imageFile?(r={bundleId:t.bundle.id,imageFile:t.imageFile},t.BundleUtils.uploadImage(r).then(function(n){return e=t.BundleUtils.encode(t.bundle),t.bundle.imageUrl=n.data.data.url,t.ManageBundle.update({id:t.bundle.id},{bundle:e,tmp_bundle_image_key:n.data.data.key})})):void 0}).then(function(){return t.afterCreate(t.bundle),t.Popeye.closeCurrentModal(),t.submitting=!1})["catch"](function(e){return t.submitting=!1,alert(e.data.data.join("\n"))})},t.selectFile=function(){return document.getElementById("bundle-new-select-file").click()},t.onFileSelect=function(e){var n,r;return n=["image/jpeg","image/png","image/gif"],-1===n.indexOf(e[0].type)?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):e[0].size>5242880?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):(t.imageFile=e[0],r=new FileReader,r.readAsDataURL(e[0]),r.onload=function(e){return t.bundle.imageUrl=e.target.result,t.$apply()})},t.close=function(){return t.Popeye.closeCurrentModal()}}}(this)]})},e}(),angular.module("noteApp").directive("bundleNewModal",function(){return{restrict:"A",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{afterCreate:"="},scope:{},link:function(e,t){return t.on("click",function(){return e.$ctrl.open()})}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$q=t,this.Bundle=n,this.$window=r,this.finishedFetch=!1,this.isPC=e.isPC,this.fetchBundle(),this.page=1,this.contents=[]}return e.inject=["$rootScope","$q","Bundle","$window"],e.prototype.fetchBundle=function(e){var t;return null==e&&(e=null),this.kind&&this.size?(t={},t.id=this.kind,t.page=this.page,t.per=this.size,t.filter=this.filter,t.image_size=this.imageSize,this.params&&this.params.excepts&&(t["excepts[]"]=this.params.excepts),this.Bundle.get(t,function(t){return function(n){var r,i,a,o;for(t.bundle=n.data,o=t.bundle.contents,i=0,a=o.length;a>i;i++)r=o[i],t.contents.push(r);return t.finishedFetch=!0,t.afterFetch&&t.afterFetch(),e?e.resolve():void 0}}(this),function(){return function(t){return console.log(t),e?e.reject(t):void 0}}(this))):void 0},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.bundle.isLastPage?void 0:(this.page++,this.fetchBundle(e),e.promise)},e.prototype.toDate=function(e){return new Date(e)},e.prototype.sendEvent=function(e){return this.$window.ga?this.params&&this.params.ga&&this.params.ga.labelPrefix?this.$window.ga("send","event","recommend","click",""+this.params.ga.labelPrefix+"_recommend_"+(e+1)):this.$window.ga("send","event","bundle","click","bundle_"+this.bundle.bundleKey+"_"+(e+1)):void 0},e}(),angular.module("noteApp").directive("bundleView",["$compile","$templateRequest",function(n,r){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{tmpl:"@",kind:"@",size:"@",slickConfig:"=",methods:"=",afterFetch:"&",filter:"@",params:"=",imageSize:"@"},link:function(e,t){return r("/templates"+e.$ctrl.tmpl).then(function(r){return t.html(r),n(t.contents())(e)},function(e){return console.log("$templateRequest: not OK",e)})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("cancelPremiumModal",["$rootScope","$state","$window","Popeye","PremiumSubscription",function(e,t,n,r,i){return{restrict:"A",scope:{user:"="},link:function(e,t){return t.on("click",function(){return i.check_cancelable(function(t){var a;return t.error?void alert("invalid"===t.error.code?"\u65e2\u306b\u30ad\u30e3\u30f3\u30bb\u30eb\u6e08\u307f\u3067\u3059\u3002":"\u30ad\u30e3\u30f3\u30bb\u30eb\u53ef\u5426\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"):(e.cancelCheck=t.data,a=r.openModal({templateUrl:"/templates/modal/cancel_premium",controller:["$scope","Cookie",function(t,r){return t.user=e.user,t.expires_at=e.cancelCheck.expires_at,t.premium_plan=e.cancelCheck.premium_plan,t.cancelable=e.cancelCheck.cancelable,t.subscribable_magazines=e.cancelCheck.subscribable_magazines,t.pay_jm_magazines=e.cancelCheck.pay_jm_magazines,t.magazine_count_safe=e.cancelCheck.magazine_count_safe,t.max_magazine_count=e.cancelCheck.max_magazine_count,t.state="check",t.changeState=function(e){return t.state=e},t.execute=function(){return t.submitting=!0,i["delete"]({premium_plan_key:t.premium_plan.key},function(e){return e.error?(alert("\u30d7\u30ec\u30df\u30a2\u30e0\u4f1a\u54e1\u89e3\u7d04\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),void(t.submitting=!1)):(t.dismiss(),t.submitting=!1,r.put("rd_flash","premium_cancellation"),n.location.reload())},function(){return alert("\u30d7\u30ec\u30df\u30a2\u30e0\u4f1a\u54e1\u89e3\u7d04\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),t.submitting=!1})},t.dismiss=function(){return a.close()}}]}))})})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$window=e,this.Title=t,this.CategoryIndex=n,this.Category=r,this.currentUser=this.$window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.contents=null,this.Title.set("\u6ce8\u76ee\u30ab\u30c6\u30b4\u30ea",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002"),this.getCategories(),this.getCategoryContents()}return e.inject=["$window","Title","CategoryIndex","Category"],e.prototype.getCategories=function(){return this.Category.get({camelize:!1},function(e){return function(t){return e.categories=t.data.categories}}(this),function(e){return console.log(e)})},e.prototype.getCategoryContents=function(){return this.CategoryIndex.get({camelize:!1}).$promise.then(function(e){return function(t){return e.contents=t.data}}(this),function(e){return console.log(e)})},e.prototype.showEyecatch=function(e,t){return 2>=e?!0:t?!0:!1},e}(),angular.module("noteApp").directive("categories",function(){return{restrict:"E",scope:{},templateUrl:"/templates/categories/index.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("checkoutFlowModal",["Popeye","$http","$resource","$state","$window","CurrentUserAPI","MyCreditCard","SignUp","Note","Magazine","MagazinePurchase","MagazineSubscription","PremiumSubscription","ActivationResend","TempAuth","CouponApply","NotePurchase","Support","NotePurchaseWithSupport","MagazinePurchaseWithSupport","FacebookPixel","CustomDomainContext","ContentLink",function(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w,k){var x;return x={restrict:"A",scope:{note:"=",user:"=",magazine:"=",checkoutType:"=",purchaseType:"=",targetId:"=",initAction:"=",advancePurchase:"=",viaContentType:"@",viaContentId:"@",viaContentKey:"@"},link:function(n,l){return l.on("click",function(){var l;if("subscription"!==n.checkoutType||!n.magazine||!n.magazine.is_pre_suspended||confirm("\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f"+n.magazine.suspended_at+"\u306b\u505c\u6b62\u3057\u307e\u3059\u3002\u305d\u308c\u3067\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f"))return l=e.openModal({templateUrl:"/templates/modal/checkout_flow",controller:["$scope","$filter","$location","Cookie","CustomDomainContext",function(e,c,w,x,C){var S,T,A,M,E,P,N,D,z;return e.checkout_type=n.checkoutType,e.purchase_type=n.purchaseType||"note",e.advancePurchase=n.advancePurchase||"",e.support={},e.support.amount="",e.support.withSupport=!1,e.support.messageLength=0,e.support.kind="s100",e.is_purchase_landing=null!==w.path().match(/purchaselanding/),N=n.viaContentType||"Unknown",E=n.viaContentId||1,P=n.viaContentKey,"note"===e.purchase_type?(e.note=n.note,e.user=e.note.user):"magazine"===e.purchase_type?(e.note=n.note,e.magazine=n.magazine,e.user=n.magazine.user,e.magazine.price>5400&&(e.magazine_over_priced_for_carrier=!0)):"support"===e.purchase_type?(e.user=n.user,e.support.price=0,e.support.withSupport=!0,e.support.confirmCheckout=function(){return e.support.price=M(e.support.amount),e.support.price?(e.support.text=S(e.support.text),e.pageTo("confirm_support")):void 0},e.support.submit=function(){var t,n;if(!e.submitting)switch(e.submitting=!0,e.paymentMethod){case"creditcard":return n={urlname:e.user.urlname,amount:e.support.price,via_content_type:N,via_content_id:E,payment_method:e.paymentMethod},e.support.messageLength>0&&(n.message=e.support.text),v.save(n,function(t){var n;return t.error?(e.support.error_msg="payment_error_message"===t.error.code?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"invalid"===(n=t.error.code)||"blocked"===n||"oneshot_already_bought_by_magazine"===n||"oneshot_already_subscribed"===n||"oneshot_limited"===n?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)):(e.pageTo("confirm_checkout"),e.support.finish_submit=!0)},function(){return e.support.error_msg="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",e.submitting=!1});case"docomo":case"au":case"softbank":return t=new v,t.amount=e.support.price,t.via_content_type=N,t.via_content_id=E,t.payment_method=e.paymentMethod,t.return_domain=""+location.protocol+"//"+C.getNoteHost(),t.return_url=location.href,e.support.messageLength>0&&(t.message=e.support.text),t.$save({urlname:e.user.urlname},function(e){var t;return t=$("<form action='"+e.data.carrier_payment.start_url+"' method='post'>"),t.append($("<input type='hidden' name='AccessID' value='"+e.data.carrier_payment.access_id+"'>")),t.append($("<input type='hidden' name='Token' value='"+e.data.carrier_payment.token+"'>")),$("body").append(t),t.submit()},function(){return alert("\u6c7a\u6e08\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1});default:return alert("\u4e0d\u6b63\u306a\u6c7a\u6e08\u65b9\u6cd5\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002"),e.submitting=!1}}):"premium"===e.purchase_type&&(e.user=n.user,e.premium={agreement:!1},p.get(null,function(t){return e.premium.plan=t.data.premium_plans[0]})),e.support.changeSupportKind=function(t){e.support.kind=t||"s100"},e.initAction=n.initAction,T=new Date,A=T.getMonth()%12+1,D=T.getFullYear(),e.months=[1,2,3,4,5,6,7,8,9,10,11,12],e.years=function(){z=[];for(var e=D,t=D+10;t>=D?t>=e:e>=t;t>=D?e++:e--)z.push(e);return z}.apply(this),e.creditCard={},e.creditCard.expiryMonth=A,e.creditCard.expiryYear=D,e.initEntry=function(){return m.get(null,function(t){var n;if(!t.error)return n=t.data,e.auth=n,e.urlname=n.nickname,e.email=n.email})},e.initModal=function(){return a.get({additionals:!0},function(t){return t.error?e.page="login_or_signup":(e.currentUser=t.data,e.page=e.currentUser.email_confirmed_flag?"confirm_checkout":"activate_email","subscription"!==e.checkout_type&&e.currentUser.last_payment_method?e.selectPaymentMethod(e.currentUser.last_payment_method):e.currentUser.can_checkout&&e.selectPaymentMethod("creditcard"),e.advancePurchase?(e.payment_method_radio="on",e.selectSubscriptionPaymentMethod("carrier"),e.payment_method_carrier_disabled=!1):(e.payment_method_carrier_disabled=!0,e.payment_method_convenience_disabled=!0,e.payment_method_monthly_carrier_disabled=!0))})},e.loginWithSNS=function(e){switch(x.put("redirectPath",location.pathname+"?modal=fan"),e){case"facebook":return location.href="/auth/facebook";case"twitter":return location.href="/auth/twitter?x_auth_access_type=read"}},e.dismiss=function(){return l.close()},e.pageTo=function(t){var i,a;switch(t){case"signup":return"support"===e.purchase_type?n.viaContentKey?r.go("signup",{nourlname:!0,redirectPath:"/notes/"+n.viaContentKey}):r.go("signup",{nourlname:!0}):"note"===e.purchase_type?r.go("signup",{nourlname:!0,redirectPath:"/notes/"+e.note.key}):"magazine"===e.purchase_type&&r.go("signup",{nourlname:!0,redirectPath:"/"+e.magazine.user.urlname+"/m/"+e.magazine.key}),e.dismiss();case"select_payment_method":if(null==e.paymentMethod&&e.selectPaymentMethod("creditcard"),e.support.price=M(e.support.amount),e.support.withSupport&&0===e.support.price)return;return e.page=t;case"login":return a=C.isCdAccess()?(i=C.getBaseUrl(),"note"===e.purchase_type?""+i+"/n/"+e.note.key:"magazine"===e.purchase_type?i:void 0):w.path(),"magazine"===e.purchase_type||"note"===e.purchase_type?a+="?modal=true":"support"===e.purchase_type&&(a+="?modal=support"),r.go("login",{redirectPath:a}),e.dismiss();default:return e.page=t}},e.modalLoginSubmit=function(r,i){return e.sending?void 0:(e.sending=!0,t({method:"POST",url:"/api/v1/sessions/sign_in",data:{login:r,password:i},timeout:3e4}).success(function(t){return t.error&&"auth"===t.error.code?(e.sending=!1,void(e.loginError="\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304a\u3088\u3073\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002")):t.error?(e.sending=!1,void(e.loginError="\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")):void("support"===e.purchase_type?location.href="/"+e.user.urlname+"/n/"+n.viaContentKey+"?modal=support":"note"===e.purchase_type?location.href="/"+e.note.user.urlname+"/n/"+e.note.key+"?modal=true":"magazine"===e.purchase_type&&(location.href="/"+e.magazine.user.urlname+"/m/"+e.magazine.key+"?modal=true"))}).error(function(){return e.sending=!1,e.loginError="\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304a\u3088\u3073\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002"}))},e.modalEntrySubmit=function(t,n,r){var i;return e.sending=!0,i={urlname:r,email:t,password:n,password_confirmation:n,redirect_path:location.pathname+"?modal=fan"},s.save(i,function(t){if(!t.error)return e.page="email_sent",e.sending=!1;switch(e.sending=!1,t.error.code){case"duplicate_urlname":alert(t.error.message);
break;case"duplicate_email":e.emailDuplicate=!0;break;case"internal":alert(t.error.message)}})},e.updateCreditcard=function(){var t;return t=new o,t.number=e.creditCard.number,t.expiryMonth=e.creditCard.expiryMonth,t.expiryYear=e.creditCard.expiryYear,t.name=e.creditCard.name,t.cvc=e.creditCard.cvc,e.creditCardError=null,e.isUpdatingCreditcard=!0,t.$save(null,function(t){return e.isUpdatingCreditcard=!1,e.creditCard=t,e.currentUser.can_checkout=!0,e.paymentMethod="creditcard",e.paymentMethodName=e.getPaymentMethodName(e.paymentMethod),e.page="confirm_creditcard"},function(){return e.isUpdatingCreditcard=!1,e.creditCardError="\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044 "})},e.confirmCreditcard=function(){return o.get(null,function(t){return e.creditCard=t.data})},e.confirmCheckout=function(){var t,n,a,o;if(e.useCoupon&&e.couponCode&&!e.couponApplied)return void(e.couponError="\u9069\u7528\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002");switch(t=function(){return C.isCdAccess()&&"magazine"===C.type&&C.key===e.magazine.key?r.go("cdMagazine.home",{},{reload:!0}):k.go("magazine",e.magazine,{reload:!0})},e.checkout_type){case"oneshot":if(e.submitting=!0,"note"===e.purchase_type)switch(e.paymentMethod){case"creditcard":return e.support.withSupport?(a=new y,a.support_price=e.support.price,a.via_content_type=N,a.via_content_id=E,e.support.messageLength>0&&(a.message=e.support.text)):a=new g,a.noteId=e.note.id,a.check_price=e.note.price,a.payment_method=e.paymentMethod,a.is_prior_sale=e.note.prior_sale===!0,a.$save(null,function(t){var n,i,a;return t.error?(e.error_sentence="payment_error_message"===t.error.code?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3044\u305f\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"note_price_changed"===(i=t.error.code)?t.error.message:"blocked"===(a=t.error.code)||"oneshot_already_bought_by_magazine"===a||"oneshot_already_subscribed"===a||"oneshot_limited"===a?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3044\u305f\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)):(n=t.data.content_key,_.trackPurchase({id:e.note.id,price:e.note.price,type:e.note.type}),e.note.can_read=!0,e.dismiss(),e.submitting=!1,x.put("rd_flash","note_purchase"),C.isCdAccess()&&"magazine"===C.type&&-1!==e.note.belonging_magazine_keys.indexOf(C.key)||C.isCdAccess()&&"creator"===C.type&&e.note.user.urlname===C.key?r.go("cdMyNote",{key:e.note.key},{reload:!0}):k.go("note",e.note,{reload:!0}))},function(){return e.error_sentence="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",e.submitting=!1});case"docomo":case"au":case"softbank":return e.support.withSupport?(a=new y,a.support_price=e.support.price,a.via_content_type=N,a.via_content_id=E,e.support.messageLength>0&&(a.message=e.support.text)):a=new g,a.noteId=e.note.id,a.check_price=e.note.price,a.payment_method=e.paymentMethod,a.return_domain=""+location.protocol+"//"+C.getNoteHost(),a.return_url=location.href,a.is_prior_sale=e.note.prior_sale===!0,a.$save(null,function(e){var t;return e.error?alert(e.error.message):(t=$("<form action='"+e.data.carrier_payment.start_url+"' method='post'>"),t.append($("<input type='hidden' name='AccessID' value='"+e.data.carrier_payment.access_id+"'>")),t.append($("<input type='hidden' name='Token' value='"+e.data.carrier_payment.token+"'>")),$("body").append(t),t.submit())},function(){return alert("\u6c7a\u6e08\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1});default:return alert("\u4e0d\u6b63\u306a\u6c7a\u6e08\u65b9\u6cd5\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002"),e.submitting=!1}else if("magazine"===e.purchase_type)switch(e.paymentMethod){case"creditcard":return e.support.withSupport?(n=new b,n.support_price=e.support.price,n.via_content_type=N,n.via_content_id=E,e.support.messageLength>0&&(n.message=e.support.text)):n=new u,n.magazine_key=e.magazine.key,n.check_price=e.magazine.price,n.payment_method=e.paymentMethod,n.$save(null,function(n){var r,i;return n.error?(e.error_sentence="payment_error_message"===(r=n.error.code)||"suspended"===r?n.error.message:n.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"blocked"===(i=n.error.code)?n.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)):(e.dismiss(),e.submitting=!1,x.put("rd_flash","magazine_purchase"),_.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Magazine"}),null!=e.note&&e.note.is_limited?k.go("note",e.note,{reload:!0}):t())},function(){return e.error_sentence="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",e.submitting=!1});case"docomo":case"au":case"softbank":return e.support.withSupport?(n=new b,n.support_price=e.support.price,n.via_content_type=N,n.via_content_id=E,e.support.messageLength>0&&(n.message=e.support.text)):n=new u,n.check_price=e.magazine.price,n.magazine_key=e.magazine.key,n.payment_method=e.paymentMethod,n.return_domain=""+location.protocol+"//"+C.getNoteHost(),n.return_url=r.is("magazine.home")?location.href:""+location.protocol+"//"+location.host+"/"+e.magazine.user.urlname+"/m/"+e.magazine.key,n.$save(null,function(e){var t;return e.error?alert(e.error.message):(t=$("<form action='"+e.data.carrier_payment.start_url+"' method='post'>"),t.append($("<input type='hidden' name='AccessID' value='"+e.data.carrier_payment.access_id+"'>")),t.append($("<input type='hidden' name='Token' value='"+e.data.carrier_payment.token+"'>")),$("body").append(t),t.submit())},function(){return alert("\u6c7a\u6e08\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1});default:return alert("\u4e0d\u6b63\u306a\u6c7a\u6e08\u65b9\u6cd5\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002"),e.submitting=!1}break;case"subscription":if(e.submitting=!0,"magazine"===e.purchase_type)switch(e.paymentMethod){case"creditcard":case"serialcode":return o={magazine_key:e.magazine.key,payment_method:e.paymentMethod,coupon_applied:e.couponApplied,serial_code_applied:e.serialCodeApplied},e.serialCodeApplied&&(o.serial_code=e.couponCode),d.put(o,function(n){var r;return n.error?(alert("blocked"===(r=n.error.code)||"payment_error_message"===r||"suspended"===r?n.error.message:"\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u8aad\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),void l.close()):(e.noCreditCardWhenCoupon||e.dismiss(),e.submitting=!1,x.put("rd_flash","magazine_subscription"),_.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Subscription"}),null!=e.note&&e.note.is_limited?k.go("note",e.note,{reload:!0}):t())},function(){return alert("\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u8aad\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")});case"monthly_au":case"monthly_docomo":case"monthly_softbank":return e.usingCoupon===!0?void alert("\u30b9\u30de\u30db\u306e\u6599\u91d1\u3068\u4e00\u7dd2\u306b\u304a\u652f\u6255\u3044\u306e\u5834\u5408\u306f\u30af\u30fc\u30dd\u30f3\u3092\u3054\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002"):(o={magazine_key:e.magazine.key,payment_method:e.paymentMethod},d.put(o,function(e){var t;return t=$("<form action='"+e.data.start_url+"' method='post'>"),t.append($("<input type='hidden' name='AccessID' value='"+e.data.access_id+"'>")),t.append($("<input type='hidden' name='Token' value='"+e.data.token+"'>")),$("body").append(t),t.submit()},function(){return alert("\u6c7a\u6e08\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1}));case"docomo":case"au":case"softbank":return n=new u,n.check_price=e.magazine.price,n.magazine_key=e.magazine.key,n.payment_method=e.paymentMethod,n.return_domain=""+location.protocol+"//"+C.getNoteHost(),n.subscribable=1,n.advance_purchase=e.advancePurchase,n.return_url=r.is("magazine.home")?location.href:""+location.protocol+"//"+location.host+"/"+e.magazine.user.urlname+"/m/"+e.magazine.key,n.$save(null,function(e){var t;return t=$("<form action='"+e.data.carrier_payment.start_url+"' method='post'>"),t.append($("<input type='hidden' name='AccessID' value='"+e.data.carrier_payment.access_id+"'>")),t.append($("<input type='hidden' name='Token' value='"+e.data.carrier_payment.token+"'>")),$("body").append(t),t.submit()},function(){return alert("\u6c7a\u6e08\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1});case"convenience":return n=new u,n.check_price=e.magazine.price,n.magazine_key=e.magazine.key,n.payment_method=e.paymentMethod,n.subscribable=1,n.advance_purchase=e.advancePurchase,n.convenience=e.selectedConvenience,n.customer_name_last=customer_name_last.value,n.customer_name_first=customer_name_first.value,n.customer_name_last_kana=customer_name_last_kana.value,n.customer_name_first_kana=customer_name_first_kana.value,n.tel_no=customer_tel_no.value,n.$save(null,function(n){return n.error?(e.error_sentence=n.error.message,void(e.submitting=!1)):(e.dismiss(),e.submitting=!1,x.put("rd_flash","magazine_subscription_convenience_purchase"),_.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Subscription"}),t())},function(){return alert("\u6c7a\u6e08\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1});default:return alert("\u4e0d\u6b63\u306a\u6c7a\u6e08\u65b9\u6cd5\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002"),e.submitting=!1}else if("premium"===e.purchase_type)switch(e.paymentMethod){case"creditcard":return p.put({premium_plan_key:e.premium.plan.key},function(t){var n;return t.error?(e.error_sentence="payment_error_message"===t.error.code?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"blocked"===(n=t.error.code)?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)):(e.dismiss(),e.submitting=!1,x.put("rd_flash","premium_subscription"),i.location.href="/settings/premium")},function(){return e.error_sentence="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",e.submitting=!1});default:return alert("\u4e0d\u6b63\u306a\u6c7a\u6e08\u65b9\u6cd5\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002"),e.submitting=!1}}},e.confirmPurchaseAndSupport=function(){return e.support.price=M(e.support.amount),e.support.price?(e.support.text=S(e.support.text),e.page="confirm_purchase_and_support"):void 0},e.resendActivateMail=function(){var t;if(!e.activate_mail_sending)return e.activate_mail_sending=!0,t="/","note"===e.purchase_type?t="/"+n.note.user.urlname+"/n/"+e.note.key:"magazine"===e.purchase_type&&(t="/"+n.magazine.user.urlname+"/m/"+e.magazine.key),h.save({redirect_path:t},function(){return e.activate_mail_sending=!1,e.resendActivateMailFinished=!0,e.page="email_sent"},function(){return e.activate_mail_sending=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7f6e\u3044\u3066\u518d\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")})},e.useCoupon=function(){return e.usingCoupon=!0},e.applyCoupon=function(){var t;return t=(e.couponCode||"").trim(),0===t.length?e.couponError="\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002":(e.submitting=!0,void f.save({code:t,magazine_key:e.magazine.key},function(t){return e.submitting=!1,e.magazine.free_subscription_ended_at=t.data.discount.free_subscription_ended_at,e.magazine.discount_amount=t.data.discount.amount,e.serialCodeApplied=t.data.is_subscription_serial===!0,e.paymentMethod="creditcard",e.selectSubscriptionPaymentMethod(e.paymentMethod),e.serialCodeApplied?e.paymentMethod="serialcode":(e.magazine.discount_price=t.data.discount.price,e.magazine.extended_payment_date=t.data.discount.payment_started_at,e.magazine.reserved_free_subscription_ended_at=t.data.discount.reserved_free_subscription_ended_at),e.couponApplied=!0},function(t){switch(t.data.error){case"Already subscribed":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u65e2\u306b\u8cfc\u8aad\u6e08\u307f\u3067\u3059\u3002";break;case"unsubscribable":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u5b9a\u671f\u8cfc\u8aad\u30de\u30ac\u30b8\u30f3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002";break;case"forbidden":e.couponError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Serial code had expired":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u5931\u52b9\u3057\u3066\u3044\u307e\u3059\u3002";break;case"Serial code had been used":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Already coupon used":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306b\u4ed6\u306e\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Already coupon code used":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Not found":e.couponError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Not the first subscription":e.couponError="\u30af\u30fc\u30dd\u30f3\u306f\u65b0\u898f\u8cfc\u8aad\u6642\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002";break;default:e.couponError="\u30af\u30fc\u30dd\u30f3\u306e\u9069\u7528\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"}return e.submitting=!1}))},e.selectPaymentMethod=function(t){return-1!==t.search(/^(creditcard|au|softbank|docomo|convenience|monthly_au|monthly_docomo|monthly_softbank)$/)?(e.paymentMethod=t,e.paymentMethodName=e.getPaymentMethodName(e.paymentMethod)):e.paymentMethod=null},e.selectSubscriptionPaymentMethod=function(t){if("creditcard"===t)e.payment_method_carrier_disabled=!0,e.payment_method_convenience_disabled=!0,e.payment_method_monthly_carrier_disabled=!0;else{if("carrier"===t)return e.payment_method_carrier_disabled=!1,e.payment_method_convenience_disabled=!0,e.payment_method_monthly_carrier_disabled=!0,void e.selectPaymentMethod(e.payment_method_carrier?e.payment_method_carrier:"docomo");if("monthly_carrier"===t)return e.paymentMethod="monthly_carrier",e.payment_method_carrier_disabled=!0,e.payment_method_convenience_disabled=!0,void(e.payment_method_monthly_carrier_disabled=!1);"monthly_docomo"===t||"monthly_au"===t||"monthly_softbank"===t||("convenience"===t?(e.payment_method_carrier_disabled=!0,e.payment_method_convenience_disabled=!1,e.payment_method_monthly_carrier_disabled=!0):e.payment_method_carrier=t)}return e.selectPaymentMethod(t)},e.getPaymentMethodName=function(e){var t;return t={creditcard:"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9",docomo:"docomo",au:"au",softbank:"SoftBank",monthly_au:"monthly_au",monthly_softbank:"monthly_softbank",monthly_docomo:"monthly_docomo"},t[e]},e.getFullPaymentMethodName=function(e){var t;return t={creditcard:"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9",docomo:"\u30c9\u30b3\u30e2 \u30b1\u30fc\u30bf\u30a4\u6255\u3044",au:"au\u304b\u3093\u305f\u3093\u6c7a\u6e08",softbank:"\u30bd\u30d5\u30c8\u30d0\u30f3\u30af\u307e\u3068\u3081\u3066\u652f\u6255\u3044",monthly_au:"au\u304b\u3093\u305f\u3093\u6c7a\u6e08\u5b9a\u671f\u8cfc\u8aad",monthly_docomo:"\u30c9\u30b3\u30e2\u5b9a\u671f\u8cfc\u8aad\u30b5\u30fc\u30d3\u30b9"},t[e]},e.support.hoge=function(){return e.support.kind="sfree"},e.onConveniChange=function(t){return e.selectedConvenience=t},M=function(t){if(!e.support.withSupport)return 0;switch(""!==e.support.error_msg&&(e.support.error_msg=""),e.support.kind){case"s100":return 100;case"s500":return 500;case"sfree":return/^[1-9][0-9]*$/.test(t)?100>t||t>1e4?void(e.support.error_msg="100\u5186\u304b\u308910000\u5186\u306e\u9593\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u4e0b\u3055\u3044\u3002"):t:void(e.support.error_msg="\u6570\u5b57\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044");default:return 0}},S=function(t){return t=(t||"").trim(),t=c("stripTags")(t),e.support.messageBoxOpened||(t=""),t}}]})}),"support"===n.purchaseType&&"support_modalopen"===n.initAction&&l.click(),"support"!==n.purchaseType&&"modalopen"===n.initAction?l.click():void 0}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("choiceNotePayTypeModal",["Popeye","$http","TextNote",function(e){var t;return t={restrict:"A",scope:{noteId:"=",noteKey:"=",noteBody:"=",noteName:"=",noteSeparator:"=",notePrice:"="},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/choice_note_pay_type",controller:["$scope",function(e){return e.noteId=t.noteId,e.noteKey=t.noteKey,e.noteBody=t.noteBody,e.noteName=t.noteName,e.noteSeparator=t.noteSeparator,e.notePrice=t.notePrice}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("commentArea",["Auth","Comment","Bridge","$rootScope","Popeye","$resource","$location","$window","OpenPickUrlnameModalService",function(e,t,n,r,i,a,o,s,l){var c;return c={templateUrl:"/templates/comments/area",restrict:"A",scope:{note:"=",comments:"=",totalCommentCount:"="},link:function(a){var c;return c=999999999999,a.commentForm={},a.editing=!1,a.redirectPath=o.path(),a.show_sp_enter=!1,a.commentFormFocus=function(){return a.show_sp_enter=!0},a.commentFormBlur=function(){return a.commentForm.body?void 0:a.show_sp_enter=!1},e.then(function(e){a.currentUser=e.error?null:e.data,a.read_more=function(){var e,n,r,i,o;for(o=a.comments,r=0,i=o.length;i>r;r++)e=o[r],c>e.id&&(c=e.id);return n={commentables:"note",commentableId:a.note.id,max_id:c,limit:20},t.get(n,function(t){var n,r,i,o;if(!t.error){for(i=t.data.comments,o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(a.comments.unshift(e));return o}})},a.checkNoUrlnameUser=function(){var e;return a.currentUser.no_urlname_user?(e=function(){return function(){return s.location.href=location.href+"?scrollpos=comment",s.location.reload()}}(this),l.open(e,"note"),!0):!1},a.createComment=function(){var e,i,o,s;if(a.commentForm.body&&!s)return s=!0,e="__SENDING__",i={id:e,is_liked:!1,is_my_comment:!0,like_count:0,created_at:moment().format(),comment:a.commentForm.body,likes:[],user:n.currentUser},a.totalCommentCount+=1,a.comments.push(i),o=angular.copy(a.commentForm.body),a.commentForm.body=null,t.save({commentables:"note",commentableId:a.note.id},{comment:o},function(t){var n,o,l,c;if(t.error)return a.comments.pop(),"not_found"===t.error.code?alert("\u30b3\u30e1\u30f3\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30ce\u30fc\u30c8\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):"temporary_limited"===t.error.code?alert("\u4e00\u6642\u7684\u306b\u30b3\u30e1\u30f3\u30c8\u304c\u6295\u7a3f\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002"):"action_limited"===t.error.code?alert(t.error.message):"comment_too_long"===t.error.message?(alert("\u30b3\u30e1\u30f3\u30c8\u306f500\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),a.commentForm.body=i.comment):alert("\u30b3\u30e1\u30f3\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),r.$broadcast("$commentSubmissionEnd",{blur:!1}),a.show_sp_enter=!1,void(s=!1);for(c=a.comments,o=0,l=c.length;l>o;o++)n=c[o],n.id===e&&(n.id=t.data.comment.id);return a.show_sp_enter=!1,s=!1})},a.deleteComment=function(e,n){return i.openModal({templateUrl:"/templates/modal/comment_delete_confirm",controller:["$scope",function(r){return r.ok=function(){return t["delete"]({commentables:"note",commentableId:e.id,commentId:n.id},function(){var e;return i.closeCurrentModal(),e=a.comments.indexOf(n),a.comments.splice(e,1),a.totalCommentCount-=1})},r.cancel=function(){return i.closeCurrentModal()}}]})},a.startEditing=function(e){a.editing=!0,angular.forEach(a.comments,function(t,n){return t.editing=!1,n===a.comments.length-1?e.editing=!0:void 0}),e.draft=e.comment},a.stopEditing=function(e){return a.editing=!1,e.editing=!1},a.updateComment=function(e,n){var i,o,s,l;if(i=a.comments.filter(function(t){return t.id===Number(e)})[0],i&&!l){if(l=!0,s=angular.copy(i.draft),""===s)return void a.deleteComment({id:n},i);if(a.stopEditing(i),o=i.comment,o!==s)return i.comment=s,t.update({commentables:"note",commentableId:a.note.id,commentId:i.id},{id:i.id,comment:s},function(e){return e.error?(i.comment=o,i.editing=!0,"not_found"===e.error.code?alert("\u30b3\u30e1\u30f3\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30ce\u30fc\u30c8\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):"temporary_limited"===e.error.code?alert("\u4e00\u6642\u7684\u306b\u30b3\u30e1\u30f3\u30c8\u304c\u6295\u7a3f\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002"):"comment_too_long"===e.error.message?(alert("\u30b3\u30e1\u30f3\u30c8\u306f500\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),i.draft=s):alert("\u30b3\u30e1\u30f3\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),void r.$broadcast("$commentSubmissionEnd",{blur:!1})):l=!1})}}})}}}])}.call(this),function(){"usestrict";var e,t,n=[].slice;t=["$state","$interval","ContentLink"],e=function(){function e(){var e,n,r,i,a,o,s;for(n=o=0,s=t.length;s>o;n=++o)a=t[n],this[a]=arguments[n];e=0,i=300,r=this.$interval(function(t){return function(){return e+=1,t.targetContent="note"===t.type?t.note:"magazine"===t.type?t.magazine:"user"===t.type?t.user:"item"===t.type?t.item:void 0,t.targetContent&&Object.keys(t.targetContent).length>0?(t.init(),t.$interval.cancel(r)):e>i?(t.error="Missing content: "+t.type,console.error(t.error),t.$interval.cancel(r)):void 0}}(this),100)}return e.prototype.init=function(){var e,t,n;n={},"note"===this.type&&this.magazine&&(n.magazine=this.magazine),t=this.ContentLink.getLinkContext(this.type,this.targetContent,n),this.linkMethod=t.linkMethod;for(e in this.params)t.stateParams[e]=this.params[e];return this.hasNoAdditionalMenu&&(t.stateParams.creator_urlname=null),this.href="state"===this.linkMethod?""+t.toState+"("+JSON.stringify(t.stateParams)+")":t.url},e}(),angular.module("noteApp").directive("contentLink",function(){return{restrict:"E",scope:{},template:'<a ng-if="$ctrl.linkMethod == \'state\' && !$ctrl.analytics" ng-attr-class="{{::$ctrl.styleClass}}" ng-attr-id="{{::$ctrl.styleId}}" ng-attr-ng-class="{{::$ctrl.attrs.ngClass}}" ui-sref="{{::$ctrl.href}}" ng-attr-ui-sref-active="{{::$ctrl.activeClass}}" ng-attr-target="{{::$ctrl.target}}" data-content-link="true" ng-transclude></a> <a ng-if="$ctrl.linkMethod == \'state\' && $ctrl.analytics" analytics-on="{{::$ctrl.analytics.on}}" analytics-event="{{::$ctrl.analytics.event}}" analytics-category="{{::$ctrl.analytics.category}}" analytics-label="{{::$ctrl.analytics.label}}" ng-attr-class="{{::$ctrl.styleClass}}" ng-attr-id="{{::$ctrl.styleId}}" ng-attr-ng-class="{{::$ctrl.attrs.ngClass}}" ui-sref="{{::$ctrl.href}}" ng-ui-sref-active="{{::$ctrl.activeClass}}" ng-attr-target="{{::$ctrl.target}}" data-content-link="true" ng-transclude></a> <a ng-if="$ctrl.linkMethod == \'http\' && !$ctrl.analytics" ng-attr-class="{{::$ctrl.styleClass}}" ng-attr-id="{{::$ctrl.styleId}}" ng-attr-ng-class="{{::$ctrl.attrs.ngClass}}" href="{{::$ctrl.href}}" ng-attr-target="{{::$ctrl.target}}" data-content-link="true" ng-transclude></a> <a ng-if="$ctrl.linkMethod == \'http\' && $ctrl.analytics" analytics-on="{{::$ctrl.analytics.on}}" analytics-event="{{::$ctrl.analytics.event}}" analytics-category="{{::$ctrl.analytics.category}}" analytics-label="{{::$ctrl.analytics.label}}" ng-attr-class="{{::$ctrl.styleClass}}" ng-attr-id="{{::$ctrl.styleId}}" ng-attr-ng-class="{{::$ctrl.attrs.ngClass}}" href="{{::$ctrl.href}}" ng-attr-target="{{::$ctrl.target}}" data-content-link="true" ng-transclude></a>',transclude:!0,bindToController:{type:"@",note:"=",magazine:"=",user:"=",item:"=",params:"=",attrs:"=",hasNoAdditionalMenu:"=",analytics:"=",target:"@",styleId:"@",styleClass:"@",activeClass:"@"},controller:n.call(t).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){this.Title=e,this.Contest=t,this.Title.set("\u52df\u96c6\u4e2d\u306e\u304a\u984c\u30fb\u30b3\u30f3\u30c6\u30b9\u30c8",null,"note\uff08\u30ce\u30fc\u30c8\uff09"),this.CATEGORIES={all:"all",contest:"contest",theme:"theme"},this.STATES={opened:"opened",closed:"closed",finished:"finished"},this.contests={},this.contestCategories=[],this.getContests()}return e.inject=["Title","Contest"],e.prototype.getContests=function(){return this.Contest.get({camelize:!1}).$promise.then(function(e){return function(t){return e.setContests(t.data.contests)}}(this),function(e){return console.log(e)})},e.prototype.setContests=function(e){var t,n,r;for(this.initContests(),n=0,r=e.length;r>n;n++)t=e[n],this.contests[t.category][t.state].push(t),this.contests[this.CATEGORIES.all][t.state].push(t);return this.sortByDisplayCategory()},e.prototype.sortByDisplayCategory=function(){return this.contestCategories=[{title:"\u958b\u50ac\u4e2d\u306e\u30b3\u30f3\u30c6\u30b9\u30c8",contests:this.contests.contest.opened},{title:"\u958b\u50ac\u4e2d\u306e\u304a\u984c",contests:this.contests.theme.opened},{title:"\u5be9\u67fb\u4e2d\u306e\u30b3\u30f3\u30c6\u30b9\u30c8",contests:this.contests.contest.closed},{title:"\u5be9\u67fb\u4e2d\u306e\u304a\u984c",contests:this.contests.theme.closed},{title:"\u7d42\u4e86\u6e08\u307f",contests:this.contests.all.finished}]},e.prototype.initContests=function(){var e,t,n,r,i,a;this.contests={},i=this.CATEGORIES,a=[];for(t in i)e=i[t],this.contests[e]={},a.push(function(){var t,i;t=this.STATES,i=[];for(n in t)r=t[n],i.push(this.contests[e][r]=[]);return i}.call(this));return a},e}(),angular.module("noteApp").directive("contests",function(){return{restrict:"E",templateUrl:"/templates/contests/index.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("convenienceStorePurchaseModal",["Popeye","$http","$resource","$state","ConvenienceStoreMagazineUnpaid",function(e,t,n,r,i){var a;return a={restrict:"A",scope:{magazineKey:"="},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/convenience_store_purchase_confirm",controller:["$scope","$filter","$location",function(e){return i.get({magazine_key:t.magazineKey},function(t){var n;return n=t.data.unpaid_payment,e.unpaid_payment=n},function(){return alert("\u30b7\u30b9\u30c6\u30e0\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}),e.dismiss=function(){return n.close()},e.goPurchaseLanding=function(t){return e.dismiss(),r.go("purchaseLanding",{urlname:t.user.urlname,key:t.key},{inherit:!1})}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/custom_social_plugin.html","<a ng-click='toggle()' analytics-category=\"timeline\" analytics-event=\"open-popover\" analytics-label=\"share\" analytics-on='click'> <i class='renewal-p-icon renewal-p-icon--share'></i> </a> <div class='renewal-c-popover renewal-c-popover--action renewal-c-popover--top' ng-show='isShow'> <div> <ul> <li class='renewal-c-popover__item'> <i class='icon-20 icon-20-share-facebook inline-child space-r-h'></i> <a class='inline-child' href='#' ng-click='windowShare(fbShareUrl, \"share_on_facebook\", 550, 450)' analytics-category='timeline' analytics-event='share' analytics-label='facebook' analytics-on='click'>Facebook</a> </li> <li class='renewal-c-popover__item'> <i class='icon-20 icon-20-share-twitter inline-child space-r-h'></i> <a class='inline-child' href='' ng-click='windowShare(twShareUrl, \"share_on_twitter\", 550, 450)' analytics-category='timeline' analytics-event='share' analytics-label='twitter' analytics-on='click'>Twitter</a> </li> <li class='renewal-c-popover__item' ng-if='note'> <i class='icon-20 icon-20-share-hatena inline-child space-r-h'></i> <a class='inline-child' href='' ng-click='windowShare(hatehaShareUrl, \"share_on_hatena_bookmark\", 800, 600)' analytics-category='timeline' analytics-event='share' analytics-label='hatebu' analytics-on='click'>\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af</a> </li> <li class='renewal-c-popover__item' ng-if='note'> <i class='icon-20 icon-20-share-embed inline-child space-r-h'></i> <a analytics-category='timeline' analytics-event='share' analytics-label='embed' analytics-on='click' class='inline-child' href='#' ng-click='showEmbed()'>\u30b5\u30a4\u30c8\u306b\u8cbc\u308b</a> </li> </ul> </div> </div>")}]),angular.module("noteApp").directive("customSocialPlugin",["$timeout","$filter","Title","CustomDomainContext","$window","SocialText",function(e,t,n,r,i,a){var o;return o={restrict:"E",templateUrl:"common/renewal/custom_social_plugin.html",link:function(e){return e.isShow=!1,a.generate(e)},scope:{note:"=",fbShare:"&",magazine:"="},controller:["$scope","$window","Popeye",function(t,n,r){return t.toggle=function(){var n;return n=angular.element(document),t.isShow?(n.off("mouseup"),t.isShow=!1,!1):(t.isShow=!0,n.on("mouseup",function(r){return r.preventDefault(),e(function(){return t.isShow=!1},0),n.off("mouseup")}),!1)},t.windowShare=function(e,t,r,i){var a,o,s;a=screen.availWidth/2-r/2,s=screen.availHeight/2-i/2,o="width="+r+", height="+i+", personalbar=0, toolbar=0, scrollbars=1, resizable=1, top="+s+", left="+a,n.open(e,t,o)},t.showEmbed=function(){var e,n;n=t,e=r.openModal({templateUrl:"/templates/modal/embed_tag",controller:["$scope","$rootScope",function(t){return t.embedNoteUrl=n.embedNoteUrl,t.embedNoteScript=n.embedNoteScript,t.close=function(){return e.close()}}]})}}]}}])}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/dateTimeSelectBox.html",'<div class="advanced-setting__form-elem" ng-init="$ctrl.initDateList()">\n  <select\n    class="advanced-setting__select-month"\n    ng-model="$ctrl.selectedDate.yearMonth"\n    ng-change="$ctrl.onChnageYearMonth()"\n  >\n    <option ng-repeat="yearMonth in $ctrl.selectableYserMonths" value="{{::yearMonth}}"\n            ng-selected="$ctrl.selectedDate.yearMonth == yearMonth" >\n      {{::yearMonth.split(\'-\')[0]}}\u5e74{{::yearMonth.split(\'-\')[1]}}\u6708\n    </option>\n  </select>\n  <select\n    class="advanced-setting__select-day"\n    ng-model="$ctrl.selectedDate.day"\n    ng-change="$ctrl.onDateChange(\'hour\')"\n    ng-options="option as option for option in $ctrl.selectableDays"\n  ></select>\n\n  <select\n    class="advanced-setting__select-time"\n    ng-model="$ctrl.selectedDate.hourMinute"\n    ng-change="$ctrl.onChnageHourMinute()"\n    ng-options="option as option for option in $ctrl.selectableHourMinutes"\n  ></select>\n</div>'),e.put("common/renewal/dateTimeSelectBoxOld.html",'\n<div class="advanced-setting__form-elem" ng-init="$ctrl.initDateList()">\n  \u5e74\n  <select\n    ng-model="$ctrl.selectedDate.year"\n    ng-change="$ctrl."\n    ng-options="option as option for option in $ctrl.selectableYears"\n  ></select>\n\n  \u6708\n  <select\n    ng-model="$ctrl.selectedDate.month"\n    ng-change="$ctrl.onDateChange(\'day\')"\n    ng-options="option.value as option.label for option in $ctrl.selectableMonths"\n  ></select>\n\n  \u65e5\n  <select\n    ng-model="$ctrl.selectedDate.day"\n    ng-change="$ctrl.onDateChange(\'hour\')"\n    ng-options="option as option for option in $ctrl.selectableDays"\n  ></select>\n\n  \u6642\n  <select\n    ng-model="$ctrl.selectedDate.hour"\n    ng-change="$ctrl.onDateChange(\'minute\')"\n    ng-options="option as option for option in $ctrl.selectableHours"\n  ></select>\n\n  \u5206\n  <select\n    ng-model="$ctrl.selectedDate.minute"\n    ng-change="$ctrl.onDateChange(\'minute\')"\n    ng-options="option as option for option in $ctrl.selectableMinutes"\n  ></select>\n\n</div>')
}]),e=function(){function e(e,n){this.$scope=e,this.$rootScope=n,this.checkValidDate=t(this.checkValidDate,this),this.updateMinuteList=t(this.updateMinuteList,this),this.updateHourList=t(this.updateHourList,this),this.updateHourMinuteList=t(this.updateHourMinuteList,this),this.updateDayList=t(this.updateDayList,this),this.updateMonthList=t(this.updateMonthList,this),this.updateYearMonthList=t(this.updateYearMonthList,this),this.updateYearList=t(this.updateYearList,this),this.updateDateList=t(this.updateDateList,this),this.onChnageHourMinute=t(this.onChnageHourMinute,this),this.onChnageYearMonth=t(this.onChnageYearMonth,this),this.setSectedDate=t(this.setSectedDate,this),this.initDateList=t(this.initDateList,this),this.formatDate=void 0}return e.inject=["$scope","$rootScope"],e.prototype.initDateList=function(){return this.setSectedDate(),this.onDateChange("year")},e.prototype.setSectedDate=function(){return this.selectedDate={year:this.targetDate.getFullYear(),month:this.targetDate.getMonth(),day:this.targetDate.getDate(),hour:this.targetDate.getHours(),minute:parseInt(this.targetDate.getMinutes()/this.period)*this.period},this.selectedDate.yearMonth=""+this.selectedDate.year+"-"+(this.selectedDate.month+1),this.selectedDate.hourMinute=""+this.selectedDate.hour+":"+("0"+this.selectedDate.minute).slice(-2)},e.prototype.onDateChange=function(e){var t;return this.targetDate=moment([this.selectedDate.year,this.selectedDate.month,this.selectedDate.day,this.selectedDate.hour,this.selectedDate.minute]).toDate(),this.targetDate<this.startAt&&(t=new Date(this.startAt.getTime()),t.setMinutes(this.startAt.getMinutes()+this.period),this.targetDate=t,this.setSectedDate()),this.endAt<this.targetDate&&(this.targetDate=this.endAt,this.setSectedDate()),this.formatDate=moment(this.targetDate).format(),this.updateDateList(e)},e.prototype.onChnageYearMonth=function(){return this.selectedDate.year=this.selectedDate.yearMonth.split("-")[0],this.selectedDate.month=this.selectedDate.yearMonth.split("-")[1]-1,this.onDateChange("month")},e.prototype.onChnageHourMinute=function(){return this.selectedDate.hour=parseInt(this.selectedDate.hourMinute.split(":")[0]),this.selectedDate.minute=parseInt(this.selectedDate.hourMinute.split(":")[1]),this.onDateChange("hour")},e.prototype.updateDateList=function(e){var t,n,r,i,a;switch(r=[this.updateYearList,this.updateYearMonthList,this.updateMonthList,this.updateDayList,this.updateHourList,this.updateHourMinuteList,this.updateMinuteList],t=0,e){case"year":t=0;break;case"month":t=2;break;case"day":t=3;break;case"hour":t=4;break;case"minute":t=5}for(a=[],n=i=t;6>=t?6>=i:i>=6;n=6>=t?++i:--i)a.push(r[n]());return a},e.prototype.updateYearList=function(){var e,t;return this.selectableYears=function(){t=[];for(var n=e=this.startAt.getFullYear(),r=this.endAt.getFullYear();r>=e?r>=n:n>=r;r>=e?n++:n--)t.push(n);return t}.apply(this)},e.prototype.updateYearMonthList=function(){return this.selectableYserMonths=[],this.selectableYears.forEach(function(e){return function(t){return[1,2,3,4,5,6,7,8,9,10,11,12].forEach(function(n){return e.checkValidDate(moment([t,n-1,1]).toDate(),moment([t,n,0]).toDate())?e.selectableYserMonths.push(""+t+"-"+n):void 0})}}(this))},e.prototype.updateMonthList=function(){var e;return e=[1,2,3,4,5,6,7,8,9,10,11,12].filter(function(e){return function(t){return e.checkValidDate(moment([e.selectedDate.year,t-1,1]).toDate(),moment([e.selectedDate.year,t,0]).toDate())}}(this)),this.selectableMonths=e.map(function(){return function(e){return{value:e-1,label:e}}}(this))},e.prototype.updateDayList=function(){var e,t;return e=function(){t=[];for(var e=1,n=moment([this.selectedDate.year,this.selectedDate.month+1,0]).toDate().getDate();n>=1?n>=e:e>=n;n>=1?e++:e--)t.push(e);return t}.apply(this),this.selectableDays=e.filter(function(e){return function(t){var n,r;return r=moment([e.selectedDate.year,e.selectedDate.month,t]).toDate(),n=moment([e.selectedDate.year,e.selectedDate.month,t,23,59,59]).toDate(),e.checkValidDate(r,n)}}(this))},e.prototype.updateHourMinuteList=function(){return this.selectableHourMinutes=[],this.selectableHours.forEach(function(e){return function(t){var n,r;return function(){for(r=[],n=0;59>=n;n++)r.push(n);return r}.apply(this).forEach(function(n){var r,i;if(n%e.period===0)return i=moment([e.selectedDate.year,e.selectedDate.month,e.selectedDate.day,t,n,0]).toDate(),r=moment([e.selectedDate.year,e.selectedDate.month,e.selectedDate.day,t,n,59]).toDate(),e.checkValidDate(i,r)?e.selectableHourMinutes.push(""+t+":"+("0"+n).slice(-2)):void 0})}}(this))},e.prototype.updateHourList=function(){var e,t;return this.selectableHours=function(){for(t=[],e=1;23>=e;e++)t.push(e);return t}.apply(this).filter(function(e){return function(t){var n,r;return r=moment([e.selectedDate.year,e.selectedDate.month,e.selectedDate.day,t,0,0]).toDate(),n=moment([e.selectedDate.year,e.selectedDate.month,e.selectedDate.day,t,59,59]).toDate(),e.checkValidDate(r,n)}}(this))},e.prototype.updateMinuteList=function(){var e,t;return this.selectableMinutes=function(){for(t=[],e=0;59>=e;e++)t.push(e);return t}.apply(this).filter(function(e){return function(t){var n,r;return t%e.period!==0?!1:(r=moment([e.selectedDate.year,e.selectedDate.month,e.selectedDate.day,e.selectedDate.hour,t,0]).toDate(),n=moment([e.selectedDate.year,e.selectedDate.month,e.selectedDate.day,e.selectedDate.hour,t,59]).toDate(),e.checkValidDate(r,n))}}(this))},e.prototype.checkValidDate=function(e,t){return this.startAt<=t&&e<=this.endAt},e}(),angular.module("noteApp").directive("dateTimeSelectBox",function(){return{restrict:"AE",controller:n.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"common/renewal/dateTimeSelectBox.html",bindToController:{targetDate:"=",startAt:"=",endAt:"=",period:"="}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("drawer",["$window","$rootScope",function(e,t){var n,r,i,a,o,s,l,c,u,d,p;return l=!1,r=void 0,c=void 0,p=void 0,o=angular.element(document.documentElement),i=angular.element(document.body),n={ALL:0,LEFT:1,RIGHT:2},u=function(){var t;t=angular.element(e)[0].innerHeight+"px",r.css("height",t),c&&c.css("height",t),p&&p.css("height",t)},s=function(){r=angular.element(document.createElement("div")),r.addClass("ng-drawer-bg"),r.bind("click",function(){a(n.ALL)}),angular.element(document.body).append(r),u(),angular.element(e).bind("resize",u),t.openRightDrawer=function(){d(n.RIGHT)},t.openLeftDrawer=function(){d(n.LEFT)},t.openDrawer=function(){d(n.ALL)},t.closeRightDrawer=function(){a(n.RIGHT)},t.closeLeftDrawer=function(){a(n.LEFT)},t.closeDrawer=function(){a(n.ALL)},t.toggleDrawer=function(){r.hasClass("active")?a(n.ALL):d(n.LEFT)}},d=function(e){r.addClass("active"),i.addClass("ng-drawer-no-scroll"),o.addClass("ng-drawer-no-scroll"),!c||e!==n.LEFT&&e!==n.ALL||c.addClass("active"),!p||e!==n.RIGHT&&e!==n.ALL||p.addClass("active")},a=function(e){r.removeClass("active"),i.removeClass("ng-drawer-no-scroll"),o.removeClass("ng-drawer-no-scroll"),!c||e!==n.LEFT&&e!==n.ALL||c.removeClass("active"),!p||e!==n.RIGHT&&e!==n.ALL||p.removeClass("active")},{restrict:"AE",link:function(t,n,r){l||s(),n.addClass("ng-drawer"),n.css("height",angular.element(e)[0].innerHeight+"px"),"right"===r.drawer?(n.addClass("ng-drawer-right"),p=n):(n.addClass("ng-drawer-left"),c=n)}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$scope=e,this.$state=t,this.Auth=n,this.EcItems=r,this.EcService=i,this.EcService.isEcEnabled()&&(this.setCallbacks(),this.init())}return e.inject=["$scope","$state","Auth","EcItems","EcService"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,window.location.href="/"):(e.currentUser=t.data,e.currentUser.has_store?e.switchItemFilter("all"):location.href="/")}}(this))},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.switchItemFilter(this.currentType,this.currentPage+1):void 0},e.prototype.switchItemFilter=function(e,t){return null==t&&(t=1),e!==this.currentType&&(this.items=[]),this.isLoading=!0,this.currentPage=t,this.currentType=e,this.EcItems.get({type:e,page:t},function(t){return function(n){var r,i,a,o;if(n.error)return void console.log(n.error);for(o=n.data.items,i=0,a=o.length;a>i;i++)r=o[i],t.items.push(r);return t.isLastPage=n.data.isLastPage,t.isLoading=!1,t.itemFilter=e,t.filterListShow=!1}}(this),function(e){return function(t){return e.EcService.handleError(t),e.isLoading=!1}}(this))},e.prototype.getTotalStock=function(e){var t,n,r,i,a;for(t=0,a=e.variants,r=0,i=a.length;i>r;r++)n=a[r],t+=n.stockCount;return t},e.prototype.goToItem=function(e){return"public"===e.status?this.$state.go("ecStore.item",{urlname:e.user.urlname,key:e.key}):this.$state.go("ecEditItem",{key:e.key})},e.prototype.updateItemPosition=function(){var e;return this.saving=!0,e={},e.key_lists=this.items.map(function(e){return{key:e.key}}),this.EcItems.update_position(e,function(e){return function(){return alert("\u4e26\u3073\u9806\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),e.saving=!1}}(this),function(e){return function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"),e.saving=!1}}(this))},e}(),angular.module("noteApp").directive("ecItem",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/items",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$scope=e,this.$state=t,this.Auth=n,this.EcAvailableStocks=r,this.EcService=i,this.EcService.isEcEnabled()&&(this.stocks=[],this.setCallbacks(),this.init())}return e.inject=["$scope","$state","Auth","EcAvailableStocks","EcService"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?window.location.href="/":(e.currentUser=t.data,e.currentUser.has_store?e.getStocks():location.href="/")}}(this))},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.getStocks(this.currentPage+1):void 0},e.prototype.getStocks=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.EcAvailableStocks.get({page:e},function(e){return function(t){var n,r,i,a;if(t.error)return void console.log(t.error);for(a=t.data.variants,r=0,i=a.length;i>r;r++)n=a[r],e.stocks.push(n);return e.isLastPage=t.data.isLastPage,e.isLoading=!1}}(this),function(e){return function(){return alert("\u5728\u5eab\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),e.isLoading=!1}}(this))},e}(),angular.module("noteApp").directive("ecStockHistory",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/history_stock",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$scope=e,this.$state=t,this.Auth=n,this.EcHistoryWarehouses=r,this.EcService=i,this.EcService.isEcEnabled()&&(this.histories=[],this.setCallbacks(),this.init())}return e.inject=["$scope","$state","Auth","EcHistoryWarehouses","EcService"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?window.location.href="/":(e.currentUser=t.data,e.currentUser.has_store?e.getHistories():location.href="/")}}(this))},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.getHistories(this.currentPage+1):void 0},e.prototype.getHistories=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.EcHistoryWarehouses.get({page:e},function(e){return function(t){var n,r,i,a;if(t.error)return void console.log(t.error);for(a=t.data.warehouses,r=0,i=a.length;i>r;r++)n=a[r],e.histories.push(n);return e.isLastPage=t.data.isLastPage,e.isLoading=!1}}(this),function(e){return function(){return alert("\u5c65\u6b74\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),e.isLoading=!1}}(this))},e}(),angular.module("noteApp").directive("ecWarehouseHistory",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/history_warehouse",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h){this.$rootScope=e,this.$window=t,this.$location=n,this.$state=r,this.$stateParams=i,this.$timeout=a,this.$upload=o,this.$q=s,this.Auth=l,this.EcItems=c,this.Title=u,this.MessageModal=d,this.CropperModalService=p,this.EcService=h,this.EcService.isEcEnabled()&&(this.itemModel={},this.minAllowedPrice=100,this.maxAllowedPrice=1e4,this.itemTypes=[{type:"single",label:"\u5358\u54c1"},{type:"set",label:"\u30bb\u30c3\u30c8"}],this.itemModel.changed=!0,this.$state.is("ecNewItem")?this.initNew():this.initEdit())}return e.inject=["$rootScope","$window","$location","$state","$stateParams","$timeout","$upload","$q","Auth","EcItems","Title","MessageModal","CropperModalService","EcService"],e.prototype.initNew=function(){return this.Auth.then(function(e){return function(t){return t.error?e.$state.go("login",{redirectPath:e.$location.path()},{reload:!0,location:!0,inherit:!0}):(e.currentUser=t.data,e.currentUser.has_store?void 0:location.href="/")}}(this)),this.itemModel.item={price:300,variants:[{stockCount:0,status:"private"}],images:[],type:"single",itemSets:[]},this.selectedItemType=this.itemModel.item.type,this.setImageList(),this.Title.set("\u5546\u54c1\u767b\u9332")},e.prototype.initEdit=function(){return this.loaded=!1,this.Auth.then(function(e){return function(t){return t.error?e.$state.go("login",{redirectPath:e.$location.path()},{reload:!0,location:!0,inherit:!0}):(e.currentUser=t.data,e.currentUser.has_store?e.EcItems.get({key:e.$stateParams.key},function(t){return t.data.isMyItem||(e.$window.location.href="/"),e.itemModel.item=t.data,e.selectedItemType=e.itemModel.item.type,e.setImageList(),e.Title.set("\u5546\u54c1\u7de8\u96c6"),e.loaded=!0},function(t){return e.EcService.handleError(t),e.loaded=!0}):e.$window.location.href="/")}}(this))},e.prototype.cancel=function(){return this.$state.go("ecItems")},e.prototype.setImageList=function(){var e,t,n,r;if(e=this.itemModel.item.images.length,!(e>3)){for(r=[],t=n=e;3>=e?3>=n:n>=3;t=3>=e?++n:--n)r.push(this.itemModel.item.images.push({}));return r}},e.prototype.addVariants=function(){return this.itemModel.item.variants.push({stockCount:0,status:"private"})},e.prototype.removeVariant=function(e){return this.getActiveVariants().length<2?void 0:(this.itemModel.item.variants[e].sku?this.itemModel.item.variants[e].isDeleted=!0:this.itemModel.item.variants.splice(e,1),this.onItemChanged())},e.prototype.getActiveVariants=function(){return this.itemModel.item.variants.filter(function(e){return e.isDeleted!==!0})},e.prototype.isShowVariant=function(){return!(this.getActiveVariants().length<2&&!this.getActiveVariants()[0].name)},e.prototype.isEnableRemoveVariant=function(e){return this.getActiveVariants().length>1&&!e.isWarehoused},e.prototype.existItemSets=function(){return"set"!==this.itemModel.item.type?!0:this.itemModel.item.itemSets.length>0},e.prototype.setItemType=function(){return this.itemModel.item.type=this.selectedItemType},e.prototype.save=function(){var e,t,n;if(this.itemModel.changed)return this.variantDupErrMsg="","single"===this.itemModel.item.type&&this.getActiveVariants().length>1&&(t=this.getActiveVariants().map(function(e){return e.name}),e=t.some(function(e,n){return t.indexOf(e)!==n}))?this.variantDupErrMsg="\u7a2e\u985e\u540d\u306f\u91cd\u8907\u3057\u306a\u3044\u3088\u3046\u306b\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002":(n={name:this.itemModel.item.name,description:this.itemModel.item.description,images:this.itemModel.item.images,price:this.itemModel.item.price,type:this.itemModel.item.type},"set"===this.itemModel.item.type?n.item_sets=this.itemModel.item.itemSets.map(function(e){return{id:e.variant.id,sku:e.variant.sku,status:e.variant.status,quantity:e.quantity}}):n.variants=this.itemModel.item.variants.map(function(e){return{id:e.id,sku:e.sku,item_id:e.itemId,name:e.name,is_deleted:e.isDeleted,status:e.status}}),this.saveItem(n))},e.prototype.saveItem=function(e){var t;return this.saving=!0,t=function(e){return function(){return function(){return e.itemModel.changed=!1,e.saving=!1,e.MessageModal.show({message:"\u5546\u54c1\u3092\u767b\u9332\u3057\u307e\u3057\u305f\u3002",callback:function(){return e.$state.go("ecItems")}})}}}(this),this.$state.is("ecNewItem")?this.EcItems.save(e,t(),function(e){return function(){return e.saving=!1,alert("\u6b63\u5e38\u306b\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")}}(this)):(e.key=this.itemModel.item.key,this.EcItems.update(e,t(),function(e){return function(t){return e.saving=!1,alert(""+(t.data.data||"\u6b63\u5e38\u306b\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044")+"\u3002")}}(this)))},e.prototype.onUploadImage=function(e){this.$rootScope.isPC&&!this.$rootScope.isIE?this.CropperModalService.getFile("item").then(function(t){return function(n){var r;return r=new Blob([t.CropperModalService.base64ToBinary(n.result.cropped)],{type:n.result.mime,encoding:"utf-8"}),t.uploadImage(e,r,n)}}(this)):(this.itemSelectFile=angular.element("#item-select-file"),this.itemSelectFile.attr("data-idx",e),this.itemSelectFile.click())},e.prototype.onFileSelect=function(e){var t,n;return t=this.itemSelectFile.attr("data-idx"),e&&0!==e.length?(n=e[e.length-1],n.size>5242880?this.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):this.uploadImage(t,n)):void 0},e.prototype.uploadImage=function(e,t,n){var r;return r={url:"/api/v2/images",data:{kind:"item",item_key:this.itemModel.item.key||null}},$.extend(!0,r,t instanceof File?{data:{file:t}}:{fileName:n.result.name,file:t,data:{width:n.cropData.width,height:n.cropData.height,x:n.cropData.x,y:n.cropData.y}}),this.$upload.upload(r).success(function(t){return function(n){return t.$timeout(function(){return t.itemModel.item.images[e]={url:n.data.url,key:n.data.key},t.onItemChanged()})}}(this)).error(function(e){return function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"})}}(this))},e.prototype.deleteImage=function(e){return this.itemModel.item.images.splice(e,1),this.setImageList(),this.onItemChanged()},e.prototype.deleteItem=function(){var e;return e=function(e){return function(){var t;return t=e.$q.defer(),e.EcItems["delete"]({key:e.itemModel.item.key},function(n){return n.error?console.log(n.error):(e.$state.go("ecItems"),t.resolve())},function(e){return t.reject({message:""+e.data.data+"\u3002"||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),t.promise}}(this),this.MessageModal.confirm({title:"\u5546\u54c1\u3092\u524a\u9664",message:"\u5546\u54c1\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",isTermination:!0,process:e})},e.prototype.isShowFirstOverlay=function(e){return this.itemModel.item.images[e].url||0!==e&&!this.itemModel.item.images[e-1].url?!1:!0},e.prototype.switchStatus=function(e){return e.status="public"===e.status?"private":"public",this.onItemChanged()},e.prototype.onItemChanged=function(){return this.itemModel.changed=!0},e}(),angular.module("noteApp").directive("ecItemEdit",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/item_edit",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){var a,o;this.$scope=e,this.$http=t,this.$timeout=n,this.EcVariants=r,this.EcService=i,a={},o=function(e){return function(){return e.searchText}}(this),this.$scope.$watch(o,function(e){return function(t){return e.isNotFound=!1,e.suggests=[],!t||t.length<2?void 0:(e.$timeout.cancel(a),a=e.$timeout(function(){return e.EcVariants.get({q:t}).$promise.then(function(t){var n,r,i,a,o,s,l,c;for(e.suggests=t.data.variants.slice(0,10),n=e.suggests.length,r=a=l=n-1;a>=0;r=a+=-1)for(c=e.itemSets,o=0,s=c.length;s>o;o++)if(i=c[o],i.variant.sku===e.suggests[r].sku){e.suggests.splice(r,1);break}return e.isNotFound=e.searchText&&e.searchText.length>=2&&0===e.suggests.length})},1e3))}}(this))}return e.inject=["$scope","$http","$timeout","EcVariants","EcService"],e.prototype.buildVariantName=function(e){var t;return t=e.itemName,e.name&&(t=""+t+"\uff08\u7a2e\u985e\uff1a"+e.name+"\uff09"),t},e.prototype.add=function(e){return this.searchText=null,this.suggests=[],this.itemSets.push({variant:e,quantity:1}),this.calculatePrice()},e.prototype.remove=function(e){return this.itemSets.splice(e,1),this.calculatePrice()},e.prototype.calculatePrice=function(){var e,t,n,r,i;for(t=0,i=this.itemSets,n=0,r=i.length;r>n;n++)e=i[n],t+=e.variant.itemPrice*(e.quantity||0);return this.price=t},e}(),angular.module("noteApp").directive("itemSetsInput",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/item_sets_setting",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{itemSets:"=",price:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$scope=e,this.$state=t,this.Auth=n,this.EcAvailableStocks=r,this.EcService=i,this.EcService.isEcEnabled()&&(this.stocks=[],this.setCallbacks(),this.init())}return e.inject=["$scope","$state","Auth","EcAvailableStocks","EcService"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?window.location.href="/":(e.currentUser=t.data,e.currentUser.has_store?e.getStocks():location.href="/")}}(this))},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.getStocks(this.currentPage+1):void 0},e.prototype.getStocks=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.EcAvailableStocks.get({page:e},function(e){return function(t){var n,r,i,a;if(t.error)return void console.log(t.error);for(a=t.data.variants,r=0,i=a.length;i>r;r++)n=a[r],e.stocks.push(n);return e.isLastPage=t.data.isLastPage,e.isLoading=!1}}(this),function(e){return function(){return alert("\u5728\u5eab\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),e.isLoading=!1}}(this))},e}(),angular.module("noteApp").directive("ecStockAvailable",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/stock_available",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n,r,i,a){var o,s,l,c,u;if(this.$scope=e,this.$state=n,this.Auth=r,this.EcVariants=i,this.EcService=a,this.initVariant=t(this.initVariant,this),this.EcService.isEcEnabled()){if(this.variantModel={variants:[]},this.selectedVariants=[],this.warehouse=this.EcService.getWarehouse(),this.warehouse.details)for(this.type="edit",u=this.warehouse.details,l=0,c=u.length;c>l;l++)o=u[l],s=o.variant,s.quantity=o.quantity,this.selectedVariants.push(s);else this.warehouse={},this.type="new";this.setCallbacks(),this.init()}}return e.inject=["$scope","$state","Auth","EcVariants","EcService"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?window.location.href="/":(e.currentUser=t.data,e.currentUser.has_store?e.getItems():location.href="/")}}(this))},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.getItems(this.currentPage+1):void 0},e.prototype.getItems=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.EcVariants.get({page:e},function(e){return function(t){var n,r,i,a;if(t.error)return void console.log(t.error);for(a=t.data.variants,r=0,i=a.length;i>r;r++)n=a[r],e.variantModel.variants.push(n);return e.isLastPage=t.data.isLastPage,e.isLoading=!1}}(this),function(e){return function(){return alert("\u5546\u54c1\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),e.isLoading=!1}}(this))},e.prototype.select=function(e){var t,n,r,i,a,o;for(e.selected=!e.selected,a=this.selectedVariants,o=[],t=r=0,i=a.length;i>r;t=++r){if(n=a[t],n.id===e.id){this.selectedVariants.splice(t,1);break}o.push(void 0)}return o},e.prototype.isSelected=function(e){var t,n,r,i,a;if(e.selected){for(t=!1,a=this.selectedVariants,r=0,i=a.length;i>r;r++)if(n=a[r],n.id===e.id){t=!0;break}t||this.selectedVariants.push(e)}return e.selected},e.prototype.existSelectedVariants=function(){return this.selectedVariants.length>0},e.prototype.initVariant=function(e,t,n){var r,i,a,o;if(!this.initialized&&this.selectedVariants.length>0)for(o=this.selectedVariants,i=0,a=o.length;a>i;i++)if(r=o[i],e.id===r.id){e.selected=!0,e.quantity=r.quantity;break}return t&&n?this.initialized=!0:void 0},e}(),angular.module("noteApp").directive("ecWarehouse",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/warehouse_index",controller:n.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l){this.$state=e,this.$stateParams=t,this.$q=n,this.Auth=r,this.EcWareHouses=i,this.EcWarehouseLabel=a,this.EcService=o,this.MessageModal=s,this.FlashModal=l,this.EcService.isEcEnabled()&&(this.loaded=!1,this.init())}return e.inject=["$state","$stateParams","$q","Auth","EcWareHouses","EcWarehouseLabel","EcService","MessageModal","FlashModal"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,window.location.href="/"):(e.currentUser=t.data,e.currentUser.has_store?e.getWareHouse():location.href="/")}}(this))},e.prototype.getWareHouse=function(){var e;return e=this.$stateParams.number,this.EcWareHouses.get({number:e},function(e){return function(t){return t.error?void console.log(t.error):(e.warehouse=t.data,e.loaded=!0)}}(this),function(e){return function(t){return 404===t.status?e.$state.go("_404",null,{location:!1}):alert("\u5165\u5eab\u4f9d\u983c\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")}}(this))},e.prototype.filterReceived=function(e){return e.filter(function(e){return e.received>0})},e.prototype.isWaiting=function(){return"waiting"===this.warehouse.status},e.prototype.editWarehouse=function(){return this.EcService.setWarehouse(this.warehouse),this.$state.go("ecWarehouses.home")},e.prototype.deleteWarehouse=function(){var e;return e=function(e){return function(){var t;return t=e.$q.defer(),e.EcWareHouses["delete"]({number:e.warehouse.number},function(n){return n.error?console.log(n.error):(e.$state.go("ecWarehouses.inprocess"),t.resolve())},function(n){var r;return r=n.data.data||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f",t.reject({message:""+r+"\u3002"}),e.$state.go(e.$state.current,{},{reload:!0})}),t.promise}}(this),this.MessageModal.confirm({title:"\u5165\u5eab\u4f9d\u983c\u3092\u524a\u9664",message:"\u5165\u5eab\u4f9d\u983c\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",isTermination:!0,process:e})},e.prototype.downloadLabel=function(){return this.downloading?void 0:(this.downloading=!0,this.EcWarehouseLabel.download({number:this.$stateParams.number},function(e){return function(t){return t.error?console.log(t.error):(e.downloadURI(t.url),e.downloading=!1)}}(this),function(e){return function(){return alert("\u5165\u5eab\u30e9\u30d9\u30eb\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),e.downloading=!1}}(this)))},e.prototype.downloadURI=function(e){var t;return t=document.createElement("a"),t.href=e,t.download="\u5165\u5eab\u30e9\u30d9\u30eb \u517c \u5165\u5eab\u660e\u7d30\u66f8_"+this.$stateParams.number+".pdf",document.body.appendChild(t),t.click(),document.body.removeChild(t)},e.prototype.isHistoryState=function(){return this.$state.is("ecHistory.warehouseDetail")},e}(),angular.module("noteApp").directive("ecWarehouseDetail",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/warehouse_detail",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$scope=e,this.$state=t,this.Auth=n,this.EcWareHouses=r,this.EcService=i,this.EcService.isEcEnabled()&&(this.warehouses=[],this.setCallbacks(),this.init())}return e.inject=["$scope","$state","Auth","EcWareHouses","EcService"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?window.location.href="/":(e.currentUser=t.data,e.currentUser.has_store?e.getWareHouses():location.href="/")}}(this))},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.getWareHouses(this.currentPage+1):void 0},e.prototype.getWareHouses=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.EcWareHouses.get({page:e},function(e){return function(t){var n,r,i,a;if(t.error)return void console.log(t.error);for(a=t.data.warehouses,r=0,i=a.length;i>r;r++)n=a[r],e.warehouses.push(n);return e.isLastPage=t.data.isLastPage,e.isLoading=!1}}(this),function(e){return function(t){return console.log(t),e.isLoading=!1}}(this))},e.prototype.getTotalQuantity=function(e){var t,n,r,i;for(n=0,r=0,i=e.length;i>r;r++)t=e[r],n+=t.quantity;return n},e}(),angular.module("noteApp").directive("ecWarehouseInprocess",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/backend/warehouse_inprocess",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.Popeye=e,this.$state=t,this.EcWareHouses=n,this.Cookie=r,this.EcService=i,!this.EcService.isEcEnabled()}return e.injects=["Popeye","$state","EcWareHouses","Cookie","EcService"],e.prototype.open=function(){var e;return e=this,this.Popeye.openModal({templateUrl:"/templates/modal/ec/warehouse",controller:["$scope",function(t){return function(n){return n.selectedVariants=e.selectedVariants,n.variantStatuses=e.variantStatuses,n.warehouse=e.warehouse,n.EcService=e.EcService,n.close=function(){return t.Popeye.closeCurrentModal()},n.save=function(){var r;return n.saving=!0,r={variants:e.selectedVariants.map(function(e){return{id:e.id,sku:e.sku,quantity:e.quantity}}),memo:e.warehouse.memo},"edit"===e.type?(r.number=e.warehouse.number,e.EcWareHouses.update(r,function(){return t.Cookie.put("rd_flash","warehouse"),t.$state.go("ecWarehouses.detail",{number:e.warehouse.number})
},function(e){return n.saving=!1,e.data.data?(alert(e.data.data),location.reload()):alert("\u6b63\u5e38\u306b\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")})):"new"===e.type?e.EcWareHouses.save(r,function(e){return t.Cookie.put("rd_flash","warehouse"),t.$state.go("ecWarehouses.detail",{number:e.data.number})},function(){return alert("\u6b63\u5e38\u306b\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),n.saving=!1}):void 0}}}(this)]})},e}(),angular.module("noteApp").directive("ecWarehouseModal",["Popeye","$state","$stateParams",function(){return{restrict:"E",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{warehouse:"=",type:"=",selectedVariants:"="},template:'<span ng-click="$ctrl.open()" class="c-button c-button--high" style="padding: 12px 18px">\u5165\u5eab\u6570\u3092\u5165\u529b\u3059\u308b</span>',scope:{}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("ecWarehouseTrackingCodeModal",["$stateParams","$state","Popeye","EcWareHouses",function(e,t,n,r){return{restrict:"A",link:function(i,a){return a.on("click",function(){var i,a;return a=n.openModal({templateUrl:"/templates/modal/ec/warehouse_tracking_code",controller:["$scope",function(a){return i(a),a.close=function(){return n.closeCurrentModal()},a.save=function(){var n;return a.saving=!0,n={number:e.number,tracking_codes:a.trackingCodes.length>0?a.trackingCodes.map(function(e){return{code:e.code}}):[{code:""}]},r.update(n,function(){return function(){return a.close(),t.go(t.current,{},{reload:!0})}}(this),function(){return function(e){return e.data.data?(alert(e.data.data),a.close(),t.go(t.current,{},{reload:!0})):(alert("\u6b63\u5e38\u306b\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),a.saving=!1)}}(this))},a.addTrackingCode=function(){return a.trackingCodes.push({})},a.removeTrackingCode=function(e){return a.trackingCodes.splice(e,1)}}]}),i=function(t){return r.get({number:e.number},function(){return function(e){return e.error?console.log(e.error):(t.trackingCodes=e.data.trackingCodes,t.trackingCodes.length<1?t.trackingCodes.push({}):void 0)}}(this),function(){return function(){return alert("\u4f1d\u7968\u756a\u53f7\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")}}(this))}})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.EcCarts=t,this.EcService=n,this.EcService.isEcEnabled()&&this.getCurrentOrder()}return e.inject=["$state","EcCarts","EcService"],e.prototype.getCurrentOrder=function(){return this.loaded=!1,this.EcCarts.current({},function(e){return function(t){return e.cart=t.data,e.getQuantityArray(e.cart.lineItems),e.EcService.setUrlname(e.cart.lineItems),e.loaded=!0}}(this),function(e){return function(t){return console.log(t),e.loaded=!0}}(this))},e.prototype.getQuantityArray=function(e){var t,n,r,i,a,o,s,l,c,u;for(this.quantityArray={},this.cartModel={lineItems:{}},u=[],s=0,c=e.length;c>s;s++){for(i=e[s],o=i.variant.stockCount,a=i.variant.sku,r=i.quantity>i.variant.stockCount,o>30&&(o=30),r&&(o=i.quantity),t=[],n=l=0;o>=0?o>=l:l>=o;n=o>=0?++l:--l)t.push(n);this.quantityArray[a]=t,u.push(this.cartModel.lineItems[i.id]={quantity:i.quantity,isStockShortage:r})}return u},e.prototype.existStockShortage=function(){var e,t,n;n=this.cartModel.lineItems;for(e in n)if(t=n[e],t.isStockShortage===!0)return!0;return!1},e.prototype.goCreatorStore=function(){var e;return e=this.EcService.getUrlname(),e?this.$state.go("creator.ecStore",{urlname:e},{reload:!0}):this.$state.go("home.home")},e.prototype.updateCart=function(e){var t,n;return null==e&&(e={}),this.saving?void 0:(this.saving=!0,e.number=this.cart.number,e.line_items_attributes=function(){var e,r;e=this.cartModel.lineItems,r=[];for(t in e)n=e[t],r.push({id:t,quantity:n.quantity});return r}.call(this),this.EcCarts.update(e,function(e){return function(t){return e.cart=t.data,e.getQuantityArray(e.cart.lineItems),e.saving=!1}}(this),function(e){return function(t){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"),console.log(t),e.saving=!1}}(this)))},e.prototype.deleteLineItem=function(e){return this.cartModel.lineItems[e].quantity=0,this.updateCart()},e.prototype.checkout=function(){return this.saving?void 0:(this.saving=!0,this.EcCarts.checkout({number:this.cart.number},function(e){return function(t){return localStorage.orderNumber=t.data.number,e.$state.go("ecStore.checkoutAddress")}}(this),function(e){return function(t){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"),console.log(t),e.saving=!1}}(this)))},e}(),angular.module("noteApp").directive("ecCart",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/cart",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$state=e,this.EcCheckouts=t,this.EcService=n,this.Auth=r,this.EcService.isEcEnabled()&&(this.billing={},this.shipping={},this.saveUserAddress=!0,this.init())}return e.inject=["$state","EcCheckouts","EcService","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login",{redirectPath:"/checkout/address"}):(e.currentUser=t.data,e.orderNumber=localStorage.orderNumber,e.orderNumber?e.getCheckout():e.EcService.backToCart())}}(this))},e.prototype.getCheckout=function(){return this.EcCheckouts.get({number:this.orderNumber},function(e){return function(t){return"cart"===t.data.state?void e.EcService.backToCart():(e.billing=t.data.billAddress,e.shipping=t.data.shipAddress,e.email=t.data.email||e.currentUser.email,e.useBilling=e.billing.id===e.shipping.id)}}(this),function(e){return function(t){return console.log(t),400===t.status&&alert(t.data.data),e.EcService.backToCart()}}(this))},e.prototype.submit=function(){var e;return this.submitting=!0,e={number:this.orderNumber,email:this.email,bill_address_attributes:{address1:this.billing.address1,address2:this.billing.address2,firstname:this.billing.firstname,lastname:this.billing.lastname,prefecture_code:this.billing.prefectureCode,country_id:this.billing.countryId||1,phone:this.billing.phone,zipcode:this.billing.zipcode},save_user_address:this.saveUserAddress,use_billing:this.useBilling,state:"address"},this.useBilling||(e.ship_address_attributes={address1:this.shipping.address1,address2:this.shipping.address2,firstname:this.shipping.firstname,lastname:this.shipping.lastname,prefecture_code:this.shipping.prefectureCode,country_id:this.shipping.countryId||1,phone:this.shipping.phone,zipcode:this.shipping.zipcode}),this.EcCheckouts.update(e,function(e){return function(t){return"payment"===t.state?e.$state.go("ecStore.checkoutPayment"):void 0}}(this),function(e){return function(t){var n;return console.log(t),n=400===t.status?t.data.data:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002",e.EcService.handleError(t,n),e.submitting=!1}}(this))},e}(),angular.module("noteApp").directive("ecCheckoutAddress",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/checkout_address",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$state=e,this.EcCheckouts=t,this.EcService=n,this.Cookie=r,this.Auth=i,this.EcService.isEcEnabled()&&this.init()}return e.inject=["$state","EcCheckouts","EcService","Cookie","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login",{redirectPath:"/cart"}):(e.orderNumber=localStorage.orderNumber,e.orderNumber?e.getCheckout():e.EcService.backToCart())}}(this))},e.prototype.getCheckout=function(){return this.EcCheckouts.get({number:this.orderNumber},function(e){return function(t){return"confirm"!==t.data.state?void e.EcService.backToCart():e.checkout=t.data}}(this),function(e){return function(t){return console.log(t),400===t.status&&alert(t.data.data),e.EcService.backToCart()}}(this))},e.prototype.submit=function(){var e;return this.submitting=!0,e={number:this.orderNumber,state:"confirm"},this.EcCheckouts.update(e,function(e){return function(t){return"complete"===t.state?(e.Cookie.put("rd_flash","checkout_complete"),location.href="/settings/purchase_history?type=item"):void 0}}(this),function(e){return function(t){var n;return console.log(t),n=400===t.status?t.data.data:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002",alert(n),e.$state.go("ecStore.checkoutPayment")}}(this))},e}(),angular.module("noteApp").directive("ecCheckoutConfirm",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/checkout_confirm",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$state=e,this.EcCheckouts=t,this.EcService=n,this.Auth=r,this.EcService.isEcEnabled()&&this.init()}return e.inject=["$state","EcCheckouts","EcService","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login",{redirectPath:"/cart"}):(e.orderNumber=localStorage.orderNumber,e.orderNumber?e.getCheckout():e.EcService.backToCart())}}(this))},e.prototype.getCheckout=function(){return this.EcCheckouts.get({number:this.orderNumber},function(e){return function(t){return["payment","confirm"].includes(t.data.state)?e.checkout=t.data:void e.EcService.backToCart()}}(this),function(e){return function(t){return console.log(t),400===t.status&&alert(t.data.data),e.EcService.backToCart()}}(this))},e.prototype.submit=function(){var e;return this.submitting=!0,e={number:this.orderNumber,payments_attributes:{payment_method_id:1},state:"payment"},this.EcCheckouts.update(e,function(e){return function(t){return"confirm"===t.state?e.$state.go("ecStore.checkoutConfirm"):void 0}}(this),function(e){return function(t){return console.log(t),e.EcService.handleError(t,"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"),e.submitting=!1}}(this))},e}(),angular.module("noteApp").directive("ecCheckoutPayment",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/checkout_payment",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("ecOrderCancelModal",["$stateParams","$state","Popeye","EcOrders",function(e,t,n,r){return{restrict:"A",link:function(i,a){return a.on("click",function(){var i;return i=n.openModal({templateUrl:"/templates/modal/ec/order_cancel",controller:["$scope",function(i){return i.close=function(){return n.closeCurrentModal()},i.submit=function(){var n;return i.submitting=!0,n=e.number,r.cancel({number:n},function(){return function(e){return"canceled"!==e.data.state&&alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"),i.close(),t.go(t.current,{},{reload:!0})}}(this),function(){return function(e){return console.log(e),alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"),i.close(),t.go(t.current,{},{reload:!0})}}(this))}}]})})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$state=e,this.$stateParams=t,this.EcHistoryOrders=n,this.EcService=r,this.Auth=i,this.EcService.isEcEnabled()&&(this.order={},this.init())}return e.inject=["$state","$stateParams","EcHistoryOrders","EcService","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login"):e.getOrder()}}(this))},e.prototype.getOrder=function(){var e;return e=this.$stateParams.number,this.loaded=!1,this.EcHistoryOrders.get({number:e},function(e){return function(t){return e.order=t.data,e.loaded=!0}}(this),function(e){return function(t){return console.log(t),e.$state.go("settings.purchase_history"),e.loaded=!0}}(this))},e.prototype.trackingUrl=function(){switch(this.order.shipments[0].deliveryCarrier){case"YAMATO":return"http://jizen.kuronekoyamato.co.jp/jizen/servlet/crjz.b.NQ0010?id="+this.order.shipments[0].tracking;case"SAGAWA":return"http://k2k.sagawa-exp.co.jp/cgi-bin/mall.mmcgi?oku01="+this.order.shipments[0].tracking;default:return""}},e}(),angular.module("noteApp").directive("ecPurchaseHistoryDetail",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/purchase_history_detail",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){this.$state=e,this.Popeye=t}return e.inject=["$state","Popeye"],e.prototype.callbackCreditCardSave=function(){return this.Popeye.closeCurrentModal(),this.$state.go(this.$state.current,{},{reload:!0})},e}(),angular.module("noteApp").directive("ecPurchaseSelectPayment",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"=",confirmCallback:"&"},templateUrl:"/templates/modal/ec/purchase_select_payment",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.EcSales=t,this.Auth=n,this.init()}return e.inject=["$state","EcSales","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login"):(e.currentUser=t.data,(e.currentUser.no_urlname_user||!e.currentUser.has_store)&&e.$state.go("home.home"),e.getSales())}}(this))},e.prototype.getSales=function(){return this.EcSales.get({},function(e){return function(t){var n,r,i,a,o;for(e.sales=t.data,e.unpaid_sales=[],e.processed_sales=[],e.sales.prev_month_str=moment(e.sales.prev_month,"YYYYMM").format("YYYY\u5e74MM\u6708"),a=t.data.total_sales,o=[],r=0,i=a.length;i>r;r++)n=a[r],n.month_str=moment(n.month,"YYYYMM").format("YYYY\u5e74MM\u6708"),"unpaid"===n.status&&e.unpaid_sales.push(n),o.push("done"===n.status||"apply"===n.status||"in_process"===n.status?e.processed_sales.push(n):void 0);return o}}(this),function(){return function(e){return console.log(e)}}(this))},e}(),angular.module("noteApp").directive("ecSalesmanage",function(){return{restrict:"E",scope:{},templateUrl:"/templates/sitesettings/ec_salesmanage",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$state=e,this.$stateParams=t,this.EcSales=n,this.Auth=r,this.init()}return e.inject=["$state","$stateParams","EcSales","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login"):(e.currentUser=t.data,(e.currentUser.no_urlname_user||!e.currentUser.has_store)&&e.$state.go("home.home"),e.getSalesDetail())}}(this))},e.prototype.getSalesDetail=function(){var e;return e=this.$stateParams.month,this.EcSales.get({month:e},function(e){return function(t){return e.item_stats=t.data.item_stats,e.start_date=t.data.start_date,e.end_date=moment(t.data.end_date,"YYYY/MM/DD").format("MM/DD")}}(this),function(e){return function(t){return console.log(t),e.$state.go("sitesettings.ec_salesmanage")}}(this))},e}(),angular.module("noteApp").directive("ecSalesmanageDetail",function(){return{restrict:"E",scope:{},templateUrl:"/templates/sitesettings/ec_salesmanage_detail",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/ec_social_plugin.html","<ul class='sns-button-list'> <li> <div class='fb-share-button' ng-href='{{url}}' type='button_count' data-href=\"{{url}}\"></div> </li> <li> <a class='twitter-share-button' data-counturl='{{counturl}}' data-lang='ja' data-text='{{text}}' data-url='{{url}}' ng-href='https://twitter.com/share'>\u30c4\u30a4\u30fc\u30c8</a> <span class='sns-button-twitter-balloon'><a ng-href='https://twitter.com/search?q={{url}}' target='_blank'>List</a></span> </li> <li ng-if='isPC'> <a class='hatena-bookmark-button' data-hatena-bookmark-lang='ja' data-hatena-bookmark-layout='standard-balloon' data-hatena-bookmark-title='note' href='http://b.hatena.ne.jp/entry/{{ url }}' title='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0'> <img alt='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0' height='20' src='https://b.st-hatena.com/images/entry-button/button-only@2x.png' style='border: none;' width='20'> </a> <script async='async' charset='utf-8' src='https://b.st-hatena.com/js/bookmark_button.js' type='text/javascript'></script> </li> <li ng-if='isSmartPhone'> <a class='hatena-bookmark-button' data-hatena-bookmark-layout='simple-balloon' data-hatena-bookmark-title='note' href='http://b.hatena.ne.jp/entry/{{ url }}' title='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0'> <img alt='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0' height='20' src='https://b.st-hatena.com/images/entry-button/button-only@2x.png' style='border: none;' width='20'> </a> <script async='async' charset='utf-8' src='https://b.st-hatena.com/js/bookmark_button.js' type='text/javascript'></script> </li> </ul>")}]),angular.module("noteApp").directive("ecSocialPlugin",["$filter","$interval","Title","UserAgent","$window",function(e,t,n,r,i){var a;return a={restrict:"E",templateUrl:"common/ec_social_plugin.html",scope:{item:"="},link:function(a,o){var s,l,c,u,d,p,h,m,f,g,v,y;return d=665869046808089,a.item?(m="development"===window.PREFETCH.NOTE.conf.env?i.PREFETCH.NOTE.production_host:location.host,a.url=""+location.protocol+"//"+m+"/"+a.item.user.urlname+"/i/"+a.item.key,a.counturl=""+location.protocol+"//"+m+"/"+a.item.user.urlname+"/i/"+a.item.key,u=140,c=23,s=7,l=u-(c+s),f=a.item.name,p=a.item.user.nickname||a.item.user.urlname,v="note\uff08\u30ce\u30fc\u30c8\uff09",a.isSmartPhone=r.isSmartPhone,a.isPC=r.isPC,y=[],(f+p+v).length<l?y.push(f,p,v):(f+v).length<l?y.push(f,v):y.push(f.length<l?f:e("truncate")(f,l)),a.text=n.create(y),g=t(function(){return window.FB?(FB.XFBML.parse(),t.cancel(g)):void 0},200),o.append('<script async type="text/javascript" src="//platform.twitter.com/widgets.js"></script>'),h='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId='+d+"\";fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script>",o.append(h)):void 0}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a){this.$state=e,this.$stateParams=t,this.$window=n,this.EcStoreItems=r,this.EcCarts=i,this.EcService=a,this.EcService.isEcEnabled()&&(this.orderModel={},this.itemsrc=null,this.getStoreItem())}return e.inject=["$state","$stateParams","$window","EcStoreItems","EcCarts","EcService"],e.prototype.getStoreItem=function(){var e,t;return t=this.$stateParams.urlname,e=this.$stateParams.key,this.EcStoreItems.get({urlname:t,key:e},function(e){return function(t){var n,r,i,a,o,s,l,c,u,d;if(e.itemType=t.data.type,"set"===e.itemType){for(e.item=t.data,l=e.item.itemSets,u=[],i=0,o=l.length;o>i;i++){if(n=l[i],n.quantity>n.variant.stockCount){e.disableQuantity=!0;break}u.push(void 0)}return u}for(e.item=t.data,e.orderModel.quantity=1,e.orderModel.sku=e.item.variants[0].sku,e.getQuantityArray(e.item.variants[0].stockCount),c=e.item.variants,d=[],a=0,s=c.length;s>a;a++){if(r=c[a],r.stockCount>0){e.orderModel.sku=r.sku,e.getQuantityArray(r.stockCount);break}d.push(void 0)}return d}}(this),function(e){return function(t){return e.EcService.handleError(t),console.log(t)}}(this))},e.prototype.getQuantityArray=function(e){var t,n;if(this.quantityArray=[],1>e)return void(this.disableQuantity=!0);for(e>30&&(e=30),t=n=1;e>=1?e>=n:n>=e;t=e>=1?++n:--n)this.quantityArray.push(t);return this.disableQuantity=!1},e.prototype.onVariantChange=function(){var e,t,n,r,i;for(r=this.item.variants,i=[],t=0,n=r.length;n>t;t++){if(e=r[t],e.sku===this.orderModel.sku){this.getQuantityArray(e.stockCount);break}i.push(void 0)}return i},e.prototype.addCart=function(){var e;return this.saving=!0,e="set"===this.itemType?this.item.itemSets.map(function(e){return{quantity:e.quantity,sku:e.variant.sku}}):[{quantity:this.orderModel.quantity,sku:this.orderModel.sku}],this.EcCarts.populate({variants:e},function(e){return function(t){return localStorage.orderToken=t.guest_token,e.$window.location.href="/cart"}}(this),function(e){return function(t){return console.log(t),e.saving=!1}}(this))},e}(),angular.module("noteApp").directive("ecStoreItemDetail",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/store_item_detail",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$scope=e,this.$state=t,this.EcStoreItems=n,this.CustomDomainContext=r,this.EcService=i,this.EcService.isEcEnabled()&&(this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.$state.params.urlname,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.items=[],this.setCallbacks(),this.getStoreItems())}return e.inject=["$scope","$state","EcStoreItems","CustomDomainContext","EcService"],e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.getStoreItems(this.currentPage+1):void 0},e.prototype.getStoreItems=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.EcStoreItems.get({urlname:this.urlname,page:e},function(e){return function(t){var n,r,i,a;for(a=t.data.items,r=0,i=a.length;i>r;r++)n=a[r],e.items.push(n);return e.isLastPage=t.data.isLastPage,e.isLoading=!1}}(this),function(e){return function(t){return console.log(t),e.EcService.handleError(t),e.isLoading=!1}}(this))},e}(),angular.module("noteApp").directive("storeTop",function(){return{restrict:"E",scope:{},templateUrl:"/templates/ec/frontend/store_top",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.EcTransferHistories=t,this.Auth=n,this.init()}return e.inject=["$state","EcTransferHistories","Auth"],e.prototype.init=function(){return this.Auth.then(function(e){return function(t){return t.error?void e.$state.go("login"):(e.currentUser=t.data,e.currentUser.no_urlname_user||!e.currentUser.has_store?e.$state.go("home.home"):e.getHistories())}}(this))},e.prototype.getHistories=function(){return this.EcTransferHistories.get({},function(e){return function(t){return e.transfer_histories=t.data.transfer_histories}}(this),function(){return function(e){return console.log(e)}}(this))},e}(),angular.module("noteApp").directive("ecTransferHistory",function(){return{restrict:"E",scope:{},templateUrl:"/templates/sitesettings/ec_transfer_history",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("entryAndFollowModal",["Popeye","$state",function(e,t){var n;return n={restrict:"A",scope:{initAction:"=",urlname:"=",redirectPath:"="},link:function(n,r){return r.on("click",function(){var r;return r=e.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","$location","CustomDomainContext",function(e,i,a){return e.checkout_type="follow",e.pageTo=function(e){var o,s,l;return s=null!=(l=n.redirectPath)?l:i.path(),a.isCdAccess()&&(o=a.getBaseUrl(),s="cdMyNote"===t.current.name?""+o+"/n/"+t.params.key:"cdCreator.home"===t.current.name||"cdMagazine.home"===t.current.name?s=o:void 0),"login"===e?(t.go("login",{redirectPath:s,follow:n.urlname}),r.close()):"signup"===e?(t.go("signup",{redirectPath:s,follow:n.urlname}),r.close()):void 0}}]})})}}}]),angular.module("noteApp").directive("entryAndMagazineFollowModal",["Popeye","$state",function(e,t){var n;return n={restrict:"A",scope:{initAction:"=",magazine:"="},link:function(n,r){return r.on("click",function(){var r;return r=e.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","CustomDomainContext",function(e,i){return e.checkout_type="magazineFollow",e.pageTo=function(e){var a;return a=i.isCdAccess()&&"cdMagazine.home"===t.current.name?i.getBaseUrl():"/"+n.magazine.user.urlname+"/m/"+n.magazine.key,"login"===e?(t.go("login",{redirectPath:a,magazineFollow:n.magazine.key}),r.close()):"signup"===e?(t.go("signup",{redirectPath:a,magazineFollow:n.magazine.key}),r.close()):void 0}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("entryAndLikeModal",["Popeye","$state",function(e,t){var n;return n={restrict:"A",scope:{initAction:"=",note:"=",redirectPath:"="},link:function(n,r){return r.on("click",function(){var r;return r=e.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","$location",function(e,i){return e.checkout_type="like",e.pageTo=function(e){var a,o;return a=null!=(o=n.redirectPath)?o:i.path(),"login"===e?(t.go("login",{redirectPath:a,likable_id:n.note.id,likables:n.note.type}),r.close()):"signup"===e?(t.go("signup",{redirectPath:a,likable_id:n.note.id,likables:n.note.type}),r.close()):void 0}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("entryAndSomethingModal",["Popeye","$state",function(e,t){var n;return n={restrict:"A",scope:{checkoutType:"="},link:function(n,r){return r.on("click",function(){var r;return r=e.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","$location",function(e,i){return e.checkout_type=n.checkoutType,e.pageTo=function(e){return"login"===e?(t.go("login",{redirectPath:""+i.path()}),r.close()):"signup"===e?(t.go("signup",{redirectPath:""+i.path()}),r.close()):void 0}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("fancyOpen",["Popeye",function(e){var t;return t={restrict:"EA",link:function(t,n){return n.on("click",function(){var t;return t=e.openModal({modalClass:"video-iframe",templateUrl:"/templates/modal/fancy_modal",controller:["$scope",function(e){return e.dismiss=function(){return t.close()}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("fancyOpenBank",["Popeye",function(e){var t;return t={restrict:"EA",link:function(t,n,r){return n.on("click",function(){var t;return t=e.openModal({modalClass:"commissions-banktransferfee",templateUrl:"/templates/modal/fancy_bank_modal",controller:["$scope","$sce",function(e){return e.kind=r.kind,e.dismiss=function(){return t.close()}}]})})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){this.SocialText=e,this.$scope=t,this.$scope=this.SocialText.generate(this.$scope),this.twShareUrl=decodeURIComponent(this.$scope.twShareUrl),this.fbShareUrl=this.$scope.fbShareUrl,this.windowShare=this.$scope.windowShare,this.noteUrl=this.$scope.noteUrl,this.rand=Math.floor(6*Math.random())+1}return e.inject=["SocialText","$scope"],e.prototype.closeModal=function(){return location.href=this.noteUrl},e}(),angular.module("noteApp").directive("finishPostNoteModal",function(){return{restrict:"E",bindToController:{note:"="},templateUrl:"/templates/modal/renewal/finish_post_note_modal",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("focusMe",["$timeout",function(e){return{restrict:"A",link:function(t,n,r){return t.$watch(r.focusMe,function(t){return t===!0?e(function(){return n.focus()},20):void 0})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("followButton",function(){var e;return e={restrict:"A",controller:["$scope","$rootScope","Following","Auth","OpenPickUrlnameModalService",function(e,t,n,r,i){return r.then(function(r){var a;return e.currentUser=r.data,a=function(){var t;return e.currentUser.no_urlname_user?(t=function(){return location.reload()},i.open(t,"follow"),!0):!1},e.toggleFollow=function(t,n){return null==n&&(n="$UserFollowed"),t.is_following?(e.unfollow(t,n),e.nowFollowing=!1):(e.follow(t,n),e.nowFollowing=!0)},e.follow=function(e,r){var i;return null==r&&(r="$UserFollowed"),i=new n,i.$save({userId:e.id},function(n){return null==n.error?n.data.follow.blocked?void alert("\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059\u3002"):(e.is_following=!0,t.$broadcast(r,e.id)):void 0},function(e){return console.error(e)})},e.unfollow=function(e,r){return null==r&&(r="$UserUnFollowed"),n["delete"]({userId:e.id},function(n){return null==n.error?(e.is_following=!1,t.$broadcast(r,e.id)):void 0},function(){return console.log("Error occurred")})}})}]}})}.call(this),function(){"use strict";angular.module("noteApp").directive("focusMe",function(){return{restrict:"A",scope:{trigger:"=focusMe"},link:function(e,t){return e.$watch("trigger",function(e){return e===!0?t[0].focus():void 0})}}}),angular.module("noteApp").directive("enterSubmit",["$timeout",function(e){return{restrict:"A",link:function(t,n,r){var i;return i=!1,n.on("keydown",function(e){return t.$apply(function(){var n;if(13===e.which&&!e.shiftKey&&!t.isSmartPhone&&!t.isTablet){if(e.preventDefault(),i)return;switch(r.enterSubmit){case"comments":i=!0,t.createComment(r.commentables,r.commentableId);break;case"updateComments":if(n=t.comments.filter(function(e){return e.id===Number(r.commentId)})[0],i=!0,!n)return;t.updateComment(n,r.commentableId);break;default:return}}if(27===e.which&&!t.isSmartPhone&&!t.isTablet){if(e.preventDefault(),i)return;switch(r.enterSubmit){case"updateComments":if(n=t.comments.filter(function(e){return e.id===Number(r.commentId)})[0],!n)return;return t.stopEditing(n)}}})}),t.$on("$commentSubmissionEnd",function(t,r){return e(function(){return(null==r||r.blur!==!1)&&n.blur(),i=!1},100)})},controller:["$scope","$rootScope",function(e,t){return e.isSmartPhone=t.isSmartPhone,e.isTablet=t.isTablet}]}}]),angular.module("noteApp").directive("noEnterSubmit",function(){return{restrict:"A",link:function(e,t){return t.on("keypress",function(e){return 13===e.which?!1:void 0})}}}),angular.module("noteApp").directive("enterGoNext",function(){return{restrict:"A",link:function(e,t){return t.on("keypress",function(e){var n,r,i,a;return 13===e.which?(e.preventDefault(),i=t.parents("form"),n=i.find("input[enter-go-next]"),a=n.index(t),r=a+1,r>=n.length&&(r-=n.length),n.eq(r).focus()):void 0})}}}),angular.module("noteApp").directive("magazineEditEnter",function(){return{restrict:"A",scope:{magazineName:"="},link:function(e,t){return t.on("keypress",function(t){var n;return 13===t.which&&null!=e.magazineName&&(e.magazineName=e.magazineName.trim().replace(/(\r?\n){3,}/g,"\n\n"),(n=e.magazineName.match(/\r?\n/g))&&n.length>=2)?!1:void 0})}}}),angular.module("noteApp").directive("delayedValidation",function(){var e;return e={restrict:"A",link:function(e,t){return t.on("blur",function(){return e.delayed=!0}),t.on("focus",function(){return e.delayed=!1})}}}),angular.module("noteApp").directive("focusExpand",function(){var e;return e={restrict:"A",link:function(e,t){var n,r,i,a;return r=!1,i=parseInt(t.css("height"),10)||20,a=$(t).parent().find(".upload-img-btn"),n=t.parent(),t.on("focus",function(){return e.$broadcast("$talkNoteFormExpanded"),t.css("min-height",3*i),a.show()}),n.on("mouseenter",function(){return r=!0}),n.on("mouseleave",function(){return r=!1}),$(document).on("click",function(n){return n.stopPropagation(),""!==t.val()||r||0!==$("div.up-images").length?void 0:(t.css("min-height",""),a.hide(),e.$broadcast("$talkNoteFormCollapsed"))})}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("formAutofillFix",function(){return function(e,t,n){t.prop("method","POST"),n.ngSubmit&&setTimeout(function(){t.unbind("submit").submit(function(r){r.preventDefault(),t.find("input, textarea, select").trigger("input").trigger("change").trigger("keydown"),e.$apply(n.ngSubmit)
})},0)}})}.call(this),function(){"use strict";angular.module("noteApp").directive("hashtagCloud",["$rootScope",function(e){var t;return t={scope:{hashtags:"="},restrict:"A",template:'<ul class="mod-note-hashtags" ng-if="hashtags.length > 0"> <li class="hashtags" ng-repeat="hashtag in hashtags"> <span ng-html="hashtag.hashtag.name | hashtag"></span> </li> </ul>',link:function(t){return t.isMobile=e.isMobile}}}])}.call(this),function(){}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("hashtag/hashtag_input.html","<tags-input add-on-space='true' class='tags-input space-t-1 space-b-1' max-results-to-show='99' min-length='1' ng-model='hashtags' on-tag-added='onTagAdded()' on-tag-adding='onTagAdding($tag)' placeholder='\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u3092\u8ffd\u52a0\u3059\u308b'> <auto-complete min-length='1' source='loadHashtags($query)'></auto-complete> </tags-input> <div class='hashtag-suggested hashtag-recommend-group'> <p ng-hide='filteredSuggestedHashtag.length == 0'> \u304a\u3059\u3059\u3081\u306e\u30bf\u30b0 </p> <ul> <li ng-repeat='hashtag in filteredSuggestedHashtag = (suggestedHashtags | filter:filterHashtag(data))'> <a class='hashtag' ng-bind='hashtag' ng-click='confirmEntry({ text: hashtag })'></a> </li> </ul> </div> <div class='hashtag-suggested hashtag-recommend-group' ng-if='openedContests.length > 0' ng-repeat=\"contest in filteredContests = (openedContests | filter:filterContest(data))\"> <p class='mb'> {{contest.message}} <content-link type='note' note=\"contest.note\" target='_blank' style='text-decoration:underline' analytics=\"{ on: 'click', category: 'post-settings', event: 'contest-banner', label: contest.hashtag.name }\"> \u8a73\u3057\u304f\u898b\u308b </content-link> </p> <!-- TODO: \u65c5\u3059\u308b\u65e5\u672c\u8a9e\u30b3\u30f3\u30c6\u30b9\u30c8\u7528\u81e8\u6642\u5bfe\u5fdc\u306e\u305f\u3081\u30b3\u30f3\u30c6\u30b9\u30c8\u7d42\u4e86\u5f8c\u306b\u524a\u9664\u3059\u308b @tic40 --> <ul ng-if=\"contest.hashtag.name == contest_tabisuru_nihongo.hashtag\"> <li ng-repeat=\"hashtag in filteredhashtags = ([contest_tabisuru_nihongo.hashtag] | filter:filterHashtag(data))\"> <a class='hashtag' ng-click='confirmEntry({ text: hashtag })'>{{hashtag}}</a> </li> <li ng-repeat=\"subHashtag in filteredSubHashtags = (contest_tabisuru_nihongo.sub_hashtags | filter:filterHashtag(data))\"> <a class='hashtag' ng-click='confirmEntry({ text: subHashtag })'>{{subHashtag}}</a> </li> </ul> <ul ng-if=\"contest.hashtag.name != contest_tabisuru_nihongo.hashtag\"> <li> <a class='hashtag' ng-click='confirmEntry({ text: contest.hashtag.name })'>{{contest.hashtag.name}}</a> </li> </ul> <!-- <ul> <li> <a class='hashtag' ng-click='confirmEntry({ text: contest.hashtag.name })'>{{contest.hashtag.name}}</a> </li> </ul> --> </div>")}]),angular.module("noteApp").directive("hashtagInput",function(){return{restrict:"E",templateUrl:"hashtag/hashtag_input.html",scope:{data:"=",suggestedHashtags:"=",note:"=",openedContests:"="},link:function(e){var t;return t=function(){return e.data},e.$watch(t,function(t){return e.hashtags=t},!0)},controller:["$scope","$window","HashtagSearch","Contest",function(e,t,n){var r;return r=/^(#|\uff03)(w*[\u4e00-\u9fa0\u3005\u3007_\u3041-\u3093_\u30a1-\u30f4\u30fc\uff41-\uff5a\uff21-\uff3a\uff10-\uff19a-zA-Z0-9]+|[a-zA-Z0-9_]+|[a-zA-Z0-9_]w*)/g,e.filterHashtag=function(e){return e?function(t){var n,r,i;for(r=0,i=e.length;i>r;r++)if(n=e[r],n.text===t)return!1;return!0}:!1},e.contest_tabisuru_nihongo={hashtag:"#\u65c5\u3059\u308b\u65e5\u672c\u8a9e",sub_hashtags:["#\u604b\u8349","#\u78a7\u7a7a","#\u5e78\u5148","#\u708e\u7bc0","#\u793c\u9047","#\u6627\u723d","#\u751f\u3072\u512a\u308b","#\u6dbc\u98c7","#\u5947\u5049","#\u5dee\u6dfb\u3044","#\u5bf8\u666f"]},e.filterContest=function(t){return t?function(n){var r,i,a;for(i=0,a=t.length;a>i;i++)if(r=t[i],r.text===n.hashtag.name)return r.text===e.contest_tabisuru_nihongo.hashtag?!e.contest_tabisuru_nihongo.sub_hashtags.some(function(e){return-1!==t.map(function(e){return e.text}).indexOf(e)}):!1;return!0}:!1},e.loadHashtags=function(t){var i;return e.apiFlg===!0?e.hashtags:(e.apiFlg=!0,i=t,"#"!==t.charAt(0)&&"\uff03"!==t.charAt(0)&&(i="#"+t),i.match(r)?i.match(r)[0]!==i?e.hashtags:n.get({keyword:t}).$promise.then(function(t){var n,r;return e.apiFlg=!1,n=t.data.hashtags,n.length>10&&(n=n.slice(0,10)),r=n.map(function(e){return e.name}),-1===r.indexOf(i)&&r.push(i),r}):e.hashtags)},e.onTagAdding=function(t){var n,i,a,o,s;if(i=t.text,"#"!==i.charAt(0)&&"\uff03"!==i.charAt(0)&&(i="#"+i),!i.match(r))return!1;if(i.match(r)[0]!==i)return!1;if(i.length>100)return!1;for(s=e.hashtags,a=0,o=s.length;o>a;a++)if(n=s[a],n.text===i)return!1;return t.text=i,!0},e.onTagAdded=function(){return e.data=e.hashtags},e.confirmEntry=function(t){var n,r,i,a,o,s,l,c;if("published"===e.note.status||0===e.openedContests.length)return e.data.push(t);for(c=e.openedContests,a=s=0,l=c.length;l>s;a=++s){if(n=c[a],o=!1,n.hashtag.name!==e.contest_tabisuru_nihongo.hashtag?n.hashtag.name===t.text&&(o=!0):(r=-1!==e.data.map(function(e){return e.text}).indexOf(e.contest_tabisuru_nihongo.hashtag),i=e.contest_tabisuru_nihongo.sub_hashtags.some(function(t){return-1!==e.data.map(function(e){return e.text}).indexOf(t)}),t.text===e.contest_tabisuru_nihongo.hashtag?i&&(o=!0):-1!==e.contest_tabisuru_nihongo.sub_hashtags.indexOf(t.text)&&r&&!i&&(o=!0)),o)return void(confirm("\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u4f01\u753b\u300c"+n.hashtag.name.substr(1)+"\u300d\u306b\u53c2\u52a0\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")&&e.data.push(t));a===e.openedContests.length-1&&e.data.push(t)}}}]}})}.call(this),function(){"use strict";angular.module("noteApp").directive("hashtagSearch",function(){return{restrict:"E",template:"<button class='icon-30 icon-30-search' ng-click='searchClickHandler()' type='submit'></button> <angucomplete-alt id='hashtag_search_autocomplete' image-field='image_path' maxlength='20' minlength='1' ng-keydown='searchKeydownHandler($event)' pause='100' placeholder='\u30e6\u30fc\u30b6\u30fc\u30fb\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u3092\u691c\u7d22' remote-url-response-formatter='searchResponse' remote-url='./api/v1/search/common?keyword=' selected-object='searchSelected' title-field='name'></angucomplete-alt>",link:function(){},controller:["$scope","$window","$http","HashtagSearch",function(e,t){return e.searchSelected=function(e){var n;return n=e.originalObject,"user"===n.type?t.location.href="/"+n.urlname:"hashtag"===n.type?t.location.href="/hashtag/"+n.name.slice(1)+"?f=trend&search=on":void 0},e.searchResponse=function(e){var t,n,r,i,a,o,s,l,c,u;for(i=[],n=e.data.hashtags||[],o=e.data.users||[],s=0,c=n.length;c>s;s++)t=n[s],i.push({type:"hashtag",name:t.name,image_path:null});for(l=0,u=o.length;u>l;l++)a=o[l],r=a.nickname||a.urlname,i.push({type:"user",urlname:a.urlname,name:r,image_path:a.user_profile_image_path});return i},e.searchClickHandler=function(){var t;return t=$("#hashtag_search_autocomplete_value").val(),e.openSearchResult(t)},e.searchKeydownHandler=function(t){var n;return 13===t.which&&"none"===$("#hashtag_search_autocomplete_dropdown").css("display")?(n=$("#hashtag_search_autocomplete_value").val(),e.openSearchResult(n)):void 0},e.openSearchResult=function(e){0!==e.length&&("#"===e.charAt(0)&&(e=e.slice(1)),t.location.href="/hashtag/"+e+"?f=trend&search=on")}}]}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.Hashtags=e,this.$stateParams=t,this.Title=n,this.hashtags=[],this.currentPage=this.$stateParams.page?+this.$stateParams.page:1,this.nextPage=null,this.size=100,this.isLastPage=!1,this.initHashtags(),this.Title.set("\u4eba\u6c17\u30bf\u30b0",null,"note\uff08\u30ce\u30fc\u30c8\uff09")}return e.inject=["Hashtags","$stateParams","Title"],e.prototype.initHashtags=function(){return this.Hashtags.get({size:this.size,page:this.currentPage},function(e){return function(t){return e.hashtags=t.data.contents,e.nextPage=Number(e.currentPage+1),t.data.isLastPage&&(e.isLastPage=!0),e.totalCount=t.data.totalCount}}(this),function(){return function(e){return console.log(e)}}(this))},e}(),angular.module("noteApp").directive("hashtags",function(){return{restrict:"E",templateUrl:"/templates/hashtag/list.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){this.$window=e,this.Title=t,this.currentUser=this.$window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.supportEmailAddress=this.$window.PREFETCH.NOTE.support_email_address,this.Title.set("\u30d8\u30eb\u30d7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")}return e.inject=["$window","Title"],e}(),angular.module("noteApp").directive("help",function(){return{restrict:"E",scope:{},templateUrl:"/templates/help/index.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n,r,i){this.$scope=e,this.$rootScope=n,this.$element=r,this.$timeout=i,this.rotateImage=t(this.rotateImage,this),this.renderClippingArc=t(this.renderClippingArc,this),this.cropImage=t(this.cropImage,this),this.renderImage=t(this.renderImage,this),this.endFixing=t(this.endFixing,this),this.startFixing=t(this.startFixing,this),this.updatePosition=t(this.updatePosition,this),this.positionMoveHandler=t(this.positionMoveHandler,this),this.endZooming=t(this.endZooming,this),this.startZooming=t(this.startZooming,this),this.adjustZoomingPosition=t(this.adjustZoomingPosition,this),this.zoomChangeHandler=t(this.zoomChangeHandler,this),this.cleanupEventHandlers=t(this.cleanupEventHandlers,this),this.setupEventHandlers=t(this.setupEventHandlers,this),this.setupZoomer=t(this.setupZoomer,this),this.tweakDefaultSizes=t(this.tweakDefaultSizes,this),this.setupGetter=t(this.setupGetter,this),this.calculateZoomCorrection=t(this.calculateZoomCorrection,this),this.setupCanvas=t(this.setupCanvas,this),this.isTouch="ontouchstart"in window,this.imageType=this.$scope.$ctrl.imageType,this.currentPosition={x:0,y:0},this.zoomCorrection={x:0,y:0},this.previousPosition={x:null,y:null},this.isNowFixing=!1,this.isRendered=!1,this.setupCanvas(function(e){return function(){return e.setupZoomer(),e.setupGetter(),e.setupEventHandlers(),e.tweakDefaultSizes(),e.renderImage()}}(this))}return e.$inject=["$scope","$rootScope","$element","$timeout"],e.prototype.setupCanvas=function(e){var t;return this.image=new Image,this.image.onload=function(t){return function(){return t.canvas=t.$element.find("#cropper-image").get(0),t.canvas.height=t.$scope.$ctrl.canvasHeight,t.canvas.width=t.$scope.$ctrl.canvasWidth,t.context=t.canvas.getContext("2d"),t.cvs=t.$element.find("#cropper-field").get(0),t.cvs.width=t.$scope.$ctrl.cropSizeWidth,t.cvs.height=t.$scope.$ctrl.cropSizeHeight,t.ctx=t.cvs.getContext("2d"),t.ratio=t.cvs.width/t.image.width,e()}}(this),t=this.getOrientation(this.$scope.$ctrl.sourceImage),6===t||8===t?this.rotateImage(t):this.image.src=this.$scope.$ctrl.sourceImage},e.prototype.calculateZoomCorrection=function(){return this.zoomCorrection={x:this.distSize.width/this.canvas.width,y:this.distSize.height/this.canvas.height}},e.prototype.setupGetter=function(){return this.$scope.$ctrl.croppedGetter=function(e){return function(){return e.context.clearRect(0,0,e.canvas.width,e.canvas.height),e.context.drawImage(e.image,e.currentPosition.x,e.currentPosition.y,e.distSize.width,e.distSize.height,0,0,e.canvas.width,e.canvas.height),"profile"===e.imageType||"item"===e.imageType?e.canvas.toDataURL():"cover"===e.imageType||"creator-header"===e.imageType?(e.cropImage(),e.izf.toDataURL()):void 0}}(this)},e.prototype.tweakDefaultSizes=function(){return this.defaultSize={},"profile"===this.imageType?this.defaultSize.height=this.defaultSize.width=this.image.height<this.image.width?this.image.height:this.image.width:"cover"===this.imageType||"creator-header"===this.imageType?this.defaultSize=this.image.height*(this.canvas.width/this.image.width)<this.canvas.height?{width:this.canvas.width*(this.image.height/this.canvas.height),height:this.image.height}:{width:this.image.width,height:this.canvas.height*(this.image.width/this.canvas.width)}:"item"===this.imageType&&(this.defaultSize.height=this.defaultSize.width=this.image.height<this.image.width?this.image.height:this.image.width),this.distSize={height:this.defaultSize.height,width:this.defaultSize.width},this.calculateZoomCorrection()},e.prototype.setupZoomer=function(){return this.imageZoomer=this.$element.find("#zoom-range").get(0),this.imageZoomer.value=0,this.isNowZooming=!1},e.prototype.setupEventHandlers=function(){$(this.imageZoomer).on("mousedown.cropper.zoom",this.startZooming),$(this.imageZoomer).on("touchstart.cropper.zoom",this.startZooming),$(this.imageZoomer).on("mouseup.cropper.zoom",this.endZooming),$(this.imageZoomer).on("touchend.cropper.zoom",this.endZooming),$(this.imageZoomer).on("input.cropper.zoom",this.zoomChangeHandler),$(this.canvas).on("mousedown.cropper.handler",this.startFixing),$(document).on("mouseup.cropper.handler",this.endFixing),$(document).on("mousemove.cropper.handler",this.positionMoveHandler),$(this.canvas).on("touchstart.cropper.handler",this.startFixing),$(this.canvas).on("touchend.cropper.handler",this.endFixing),$(this.canvas).on("touchmove.cropper.handler",this.positionMoveHandler)},e.prototype.cleanupEventHandlers=function(){$(this.canvas).off("touchmove.cropper.handler"),$(this.canvas).off("touchend.cropper.handler"),$(this.canvas).off("touchstart.cropper.handler"),$(document).off("mousemove.cropper.handler"),$(document).off("mouseup.cropper.handler"),$(this.canvas).off("mousedown.cropper.handler"),$(this.imageZoomer).off("input.cropper.zoom"),$(this.imageZoomer).off("touchend.cropper.zoom"),$(this.imageZoomer).off("mousedown.cropper.zoom"),$(this.imageZoomer).off("touchstart.cropper.zoom"),$(this.imageZoomer).off("mouseup.cropper.zoom")},e.prototype.zoomChangeHandler=function(){var e,t,n;if(this.isNowZooming)return n=this.imageZoomer.value/200,e={height:this.defaultSize.height*n,width:this.defaultSize.width*n},t={x:Math.round(e.width/2),y:Math.round(e.height/2)},this.distSize={width:Math.round(this.defaultSize.width-e.width),height:Math.round(this.defaultSize.height-e.height)},this.calculateZoomCorrection(),this.adjustZoomingPosition("x",t.x),this.adjustZoomingPosition("y",t.y),this.renderImage(),this.previousPosition={x:t.x,y:t.y}},e.prototype.adjustZoomingPosition=function(e,t){var n,r;if(this.previousPosition[e])return n="x"===e?"width":"height",r=this.currentPosition[e]+(t-this.previousPosition[e]),this.currentPosition[e]+this.distSize[n]>=this.image[n]?this.currentPosition[e]+=this.image[n]-(this.currentPosition[e]+this.distSize[n]):r>0?this.currentPosition[e]=r:void 0},e.prototype.startZooming=function(){return this.isNowZooming=!0},e.prototype.endZooming=function(){return this.isNowFixing=!1,this.previousPosition={x:null,y:null}},e.prototype.positionMoveHandler=function(e){var t,n;if(this.isNowFixing)return e.preventDefault(),t=this.isTouch?e.originalEvent.touches[0].pageX:e.clientX,n=this.isTouch?e.originalEvent.touches[0].pageY:e.clientY,this.updatePosition("x",t),this.updatePosition("y",n),this.renderImage(),this.previousPosition={x:t,y:n}},e.prototype.updatePosition=function(e,t){var n,r;if(this.previousPosition[e])return r=this.currentPosition[e]+(this.previousPosition[e]-t)*this.zoomCorrection[e],r=Math.round(r),n="x"===e?"width":"height",r>0&&r+this.distSize[n]<this.image[n]?this.currentPosition[e]=r:void 0},e.prototype.startFixing=function(){return this.isNowFixing=!0},e.prototype.endFixing=function(){return this.isNowFixing=!1,this.previousPosition={x:null,y:null}},e.prototype.renderImage=function(e){return null==e&&(e="profile"===this.imageType),this.$timeout(function(t){return function(){return t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.context.imageSmoothingEnabled=!1,t.context.webkitImageSmoothingEnabled=!1,t.context.mozImageSmoothingEnabled=!1,t.context.imageSmoothingQuality="high",e&&(t.renderClippingArc(),t.context.globalCompositeOperation="destination-over"),t.isRendered||(t.image.height*(t.canvas.width/t.image.width)<t.canvas.height?t.currentPosition.x=t.image.width/2-t.canvas.width*(t.image.height/t.canvas.height)/2:t.currentPosition.y=t.image.height/2-t.canvas.height*(t.image.width/t.canvas.width)/2),t.context.drawImage(t.image,t.currentPosition.x,t.currentPosition.y,t.distSize.width,t.distSize.height,0,0,t.canvas.width,t.canvas.height),t.isRendered=!0,t.$scope.$ctrl.cropX=Math.round(t.currentPosition.x*t.ratio),t.$scope.$ctrl.cropY=Math.round(t.currentPosition.y*t.ratio),t.$scope.$ctrl.cropWidth=t.distSize.width*t.ratio,t.$scope.$ctrl.cropHeight=t.distSize.height*t.ratio,t.$scope.$applyAsync()}}(this))},e.prototype.cropImage=function(){return this.ratio=this.cvs.width/this.image.width,this.izf=this.$element.find("#image-zoom-field").get(0),this.izf.width=this.cvs.width,this.izf.height=this.cvs.width*(this.image.height/this.image.width),this.izfCtx=this.izf.getContext("2d"),this.izfCtx.drawImage(this.image,0,0,this.image.width,this.image.height,0,0,this.image.width*this.ratio,this.image.height*this.ratio),this.ctx.drawImage(this.izf,Math.round(this.currentPosition.x*this.ratio),Math.round(this.currentPosition.y*this.ratio),this.distSize.width*this.ratio,this.distSize.height*this.ratio,0,0,this.cvs.width,this.cvs.height)},e.prototype.renderClippingArc=function(){return this.context.fillStyle="rgba(0, 0, 0, 0.5)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle="rgb(255, 255, 255)",this.context.globalCompositeOperation="destination-out",this.context.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,2*Math.PI,!1),this.context.fill()},e.prototype.rotateImage=function(e){return this.rotateImage=new Image,this.rotateImage.onload=function(t){return function(){var n;return t.rotateCanvas=document.createElement("canvas"),n=t.$scope.$ctrl.sourceImage.match(/image\/[a-zA-Z]+/)[0],t.rotateImage.width>t.$scope.$ctrl.cropSizeWidth?(t.rotateCanvas.height=t.rotateImage.width/(t.rotateImage.height/t.$scope.$ctrl.cropSizeWidth),t.rotateCanvas.width=t.$scope.$ctrl.cropSizeWidth):(t.rotateCanvas.height=t.rotateImage.width,t.rotateCanvas.width=t.rotateImage.height),t.rcCtx=t.rotateCanvas.getContext("2d"),6===e?(t.rcCtx.translate(t.rotateCanvas.width,0),t.rcCtx.rotate(90*Math.PI/180)):8===e&&(t.rcCtx.translate(0,t.rotateCanvas.height),t.rcCtx.rotate(270*Math.PI/180)),t.rcCtx.drawImage(t.rotateImage,0,0,t.rotateImage.width,t.rotateImage.height,0,0,t.rotateCanvas.height,t.rotateCanvas.width),t.image.src=t.rotateCanvas.toDataURL(n)}}(this),this.rotateImage.src=this.$scope.$ctrl.sourceImage},e.prototype.getOrientation=function(e){var t,n;return t=atob(e.split(",")[1]),n=this.byteStringToOrientation(t)},e.prototype.byteStringToOrientation=function(e){var t,n,r,i,a,o,s,l,c;for(a=0,l=void 0;;){if(255===e.charCodeAt(a)&218===e.charCodeAt(a+1))break;if(255===e.charCodeAt(a)&216===e.charCodeAt(a+1))a+=2;else{if(s=256*e.charCodeAt(a+2)+e.charCodeAt(a+3),r=a+s+2,255===e.charCodeAt(a)&225===e.charCodeAt(a+1)){for(c=e.slice(a,r),t=77===c.charCodeAt(10),n=void 0,n=t?256*c.charCodeAt(18)+c.charCodeAt(19):c.charCodeAt(18)+256*c.charCodeAt(19),o=0;n>o;)i=c.slice(20+12*o,32+12*o),(t&&18===i.charCodeAt(1)||!t&&18===i.charCodeAt(0))&&(l=i.charCodeAt(t?9:8)),o++;break}a=r}if(a>e.length)break}return l},e}(),angular.module("noteApp").directive("imageCropper",["Popeye",function(){return{template:'<div style="text-align: center"> <canvas id="cropper-image" style="height: {{ ::$ctrl.styleHeight }}px; width: {{ ::$ctrl.styleWidth }}px; user-select: none; cursor: move;"> </canvas> <input type="range" id="zoom-range" max="{{ ::$ctrl.zoomRange }}" /> </div> <canvas id="image-zoom-field" style="display:none !important;"></canvas> <canvas id="cropper-field" style="display:none !important; width:{{$ctrl.cvs.width}}px; height:{{$ctrl.cvs.height}}px;"></canvas>',strict:"E",scope:{imageType:"=",sourceImage:"=",croppedGetter:"=",styleHeight:"=",styleWidth:"=",canvasHeight:"=",canvasWidth:"=",cropSizeHeight:"=",cropSizeWidth:"=",cropHeight:"=",cropWidth:"=",cropY:"=",cropX:"=",zoomRange:"@"},controller:e,controllerAs:"$ctrl",bindToController:!0}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("imageNoteModal",["$q","Popeye","NoteForm",function(e,t,n){var r;return r={restrict:"A",scope:{note:"=",currentUser:"="},link:function(r,i,a){return i.on("click",function(){var i,o,s;return o=t.openModal({templateUrl:"/templates/modal/edit_image_note",backdrop:"static",click:!1,controller:["$scope","$rootScope","$window","$upload","ImageNote","NoteNotifyUpdate","MagazineNote","ImageNoteDraft","DraftSaveAlert","$state","ContentLink","Auth","Bridge","$analytics","SocialText",function(t,n,l,c,u,d,p,h,m,f,g,v,y,b){var _,w,k,$,x,C;return i(r,a,l,t,v,y),t.saveImageNoteDraft=function(){var e,i,l,c,u,d,p,g,v,y;if(!t.afterSubmit&&!t.uploading)if(i=m.getMessage(t.note,t.settings),i&&alert(i),t.afterSubmit=!0,"edit"===a.imageNoteModal){for(l={status:"draft",name:t.note.name,images:t.note.pictures,paid_flag:t.note.paid_flag,price:t.note.price,magazine_ids:t.settings.magazineIds,limited:t.settings.limited},l.publish_at=t.note.is_reserved?t.settings.publishAt:null,l.hashtags=t.settings.hashtag.list?t.settings.hashtag.list.map(function(e){return e.text}):[],v=t.note.pictures,u=0,p=v.length;p>u;u++)if(c=v[u],null!=c.caption&&c.caption.length>255)return alert("\u753b\u50cf\u306e\u8aac\u660e\u306f255\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");h.save({id:t.note.id},l,function(e){return e.error?(alert(e.error.message),void(t.afterSubmit=!1)):("draft"===r.note.status&&(r.note.pictures=e.data.pictures,r.note.name=e.data.name,r.note.price=e.data.price,r.note.hashtag_notes=e.data.hashtag_notes),o.close(),void(t.afterSubmit=!1))})}else{for(s(f,b,"imageNoteDraft"),e=new h,t.afterSubmit=!0,e.status="draft",e.name=t.note.name,e.images=t.note.pictures,e.paid_flag=t.note.paid_flag,e.price=t.note.price,e.magazine_ids=t.settings.magazineIds,e.limited=t.settings.limited,e.publish_at=t.note.is_reserved?t.settings.publishAt:null,e.hashtags=t.settings.hashtag.list?t.settings.hashtag.list.map(function(e){return e.text}):[],y=t.note.pictures,d=0,g=y.length;g>d;d++)if(c=y[d],null!=c.caption&&c.caption.length>255)return alert("\u753b\u50cf\u306e\u8aac\u660e\u306f255\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");e.$save(null,function(e){return e.error?(alert(e.error.message),void(t.afterSubmit=!1)):("draft"===t.note.status&&(t.note.pictures=e.data.pictures,t.note.name=e.data.name,t.note.price=e.data.price,t.note.hashtag_notes=e.data.hashtag_notes),n.$emit("createNoteDraftFromNavBar",e.data),o.close(),void(t.afterSubmit=!1))})}},t.save=function(){var e,i,l,c,d,p,h,m,v;if(!t.afterSubmit&&!t.uploading)if(t.afterSubmit=!0,t.settings.normalize(),"edit"===a.imageNoteModal){for(i={status:"published",name:t.note.name,images:t.note.pictures,paid_flag:t.note.paid_flag,price:t.note.price,hashtags:t.settings.hashtag.list?t.settings.hashtag.list.map(function(e){return e.text}):[],magazine_ids:t.settings.magazineIds,limited:t.settings.limited,publish_at:t.settings.reserved||t.note.is_draft?t.settings.publishAt:null,prior_sale_activated:t.note.prior_sale_activated,first_served_sales_count:t.note.first_served_sales_count,change_prior_sale_count:t.note.change_prior_sale_count},t.currentUser.turnoff_comment_available&&(i.disable_comment=t.settings.enable_comment===!1),m=t.note.pictures,c=0,p=m.length;p>c;c++)if(l=m[c],null!=l.caption&&l.caption.length>255)return alert("\u753b\u50cf\u306e\u8aac\u660e\u306f255\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");u.put({noteId:t.note.id},i,function(e){var n,a;return e.error?(alert(e.error.message),void(t.afterSubmit=!1)):(r.note.pictures=e.data.pictures,r.note.name=e.data.name,r.note.price=e.data.price,r.note.hashtag_notes=e.data.hashtag_notes,r.note.prior_sale=e.data.prior_sale,"published"===r.note.status?i.limited===!0?(a=t.settings.magazineIds,r.note.is_limited=!0,r.note.limited_note_include_magazines=function(){var e,r,i;for(i=[],e=0,r=a.length;r>e;e++)n=a[e],i.push(t.settings.magChecks[n].magazine);return i}()):(r.note.is_limited=!1,r.note.limited_note_include_magazines=[]):r.note.is_reserved&&(r.note.reserved_publish_at=t.settings.publishAt),r.note.disable_comment=e.data.disable_comment,t.afterSubmit=!1,e.data.exist_purchased_user&&e.data.content_changed?t.ask_notify_update=!0:o.close(),void("draft"===r.note.status&&g.go("note",t.note,{reload:!0})))})}else{for(s(f,b,"imageNote"),e=new u,e.status="published",e.name=t.note.name,e.images=t.note.pictures,e.paid_flag=t.note.paid_flag,e.price=t.note.price,e.hashtags=t.settings.hashtag.list?t.settings.hashtag.list.map(function(e){return e.text}):[],e.magazine_ids=t.settings.magazineIds,e.limited=t.settings.limited,e.publish_at=t.settings.publishAt,e.prior_sale_activated=t.note.prior_sale_activated,e.first_served_sales_count=t.note.first_served_sales_count,e.change_prior_sale_count=t.note.change_prior_sale_count,t.currentUser.turnoff_comment_available&&(e.disable_comment=t.settings.enable_comment===!1),v=t.note.pictures,d=0,h=v.length;h>d;d++)if(l=v[d],null!=l.caption&&l.caption.length>255)return alert("\u753b\u50cf\u306e\u8aac\u660e\u306f255\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");e.$save(null,function(r){var i,a;return r.error?(alert(r.error.message),void(t.afterSubmit=!1)):(t.note.pictures=r.data.pictures,t.note.name=r.data.name,t.note.price=r.data.price,t.note.hashtag_notes=r.data.hashtag_notes,t.note.prior_sale=r.data.prior_sale,t.note.status="puiblished",t.note.user=r.data.user,t.note.custom_domain=r.data.user.custom_domain,t.note.key=r.data.key,t.note.note_days_count=r.data.note_days_count,t.note.note_days_text=r.data.note_days_text,t.settings.reserved===!0?(f.go("showTextNoteFriendly",{urlname:r.data.user.urlname,key:r.data.key}),o.close()):("published"===t.note.status?e.limited===!0?(a=t.settings.magazineIds,t.note.is_limited=!0,t.note.limited_note_include_magazines=function(){var e,n,r;for(r=[],e=0,n=a.length;n>e;e++)i=a[e],r.push(t.settings.magChecks[i].magazine);return r}()):(t.note.is_limited=!1,t.note.limited_note_include_magazines=[]):t.settings.reserved&&(t.note.reserved_publish_at=t.settings.publishAt),t.note.disable_comment=r.data.disable_comment,t.afterSubmit=!1,r.data.exist_purchased_user&&r.data.content_changed?t.ask_notify_update=!0:t.isPublishedNote=!0,n.$emit("createNoteFromNavBar",r.data),"draft"===t.note.status&&g.go("note",t.note,{reload:!0}),void 0))})}},t.notify_update=function(){return t.loading?void 0:(t.loading=!0,d.save({key:t.note.key},function(){return o.close()}))},t.cancel_without_restore=function(){return o.close()},t.onNoteModalImagesSelect=function(n){var r,i,a,o,s,l,c,u;if(i=n.length,!(1>i||t.uploading)){for(a=!1,n=n.filter(function(e){return e.type.indexOf("gif")>=0&&(a=!0),!(e.type.indexOf("gif")>=0)}),a&&(i=n.length,alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002")),t.uploading=!0,l=t.note.pictures.length,c=0,u=n.length;u>c;c++)r=n[c],t.note.pictures.push({});return s=x(n),o=n.map(function(e){return C(e,l,s)}),e.all(o).then(function(){var e,n,r;for(e=n=r=i+l-1;n>=l;e=n+=-1)void 0===t.note.pictures[e].key&&$(e);return t.uploading=!1}),n=[]}},t.imageMoveUpmost=function(e){var n;if(!t.uploading)return n=w(e),$(n),_(0,e)},t.imageMoveUp=function(e){var n;if(!(t.uploading||(n=w(e),0>=n)))return $(n),_(n-1,e)},t.imageMoveDown=function(e){var n;if(!(t.uploading||(n=w(e),n>=t.note.pictures.length-1)))return $(n),_(n+1,e)},t.imageRemove=function(e){var n;if(!t.uploading)return n=w(e),$(n),t.note.pictures.length<=1?t.note.paid_flag=!1:void 0},t.raisePayFlag=function(e){return e.paid_flag!==!0?e.pictures.length>=1?e.paid_flag=!0:t.showPayImageMsg=!0:void 0},w=function(e){return t.note.pictures.indexOf(e)},$=function(e){return t.note.pictures.splice(e,1)},_=function(e,n){return t.note.pictures.splice(e,0,n)},x=function(e){var t,n,r,i,a;for(r=k(e),n=[],i=0,a=r.length;a>i;i++)t=r[i],void 0!==t&&n.push(t);return n},k=function(e){var t,n,r,i,a,o;for(i=[],a=0,o=e.length;o>a;a++)t=e[a],r=t.name.match(/([0-9\uff10-\uff19]+)/i),r?(n=r[1].slice(-2).replace(/[\uff10-\uff19]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)}),n=parseInt(n,10)||0,void 0!==i[n]?i.splice(n,0,t):i[n]=t):i.push(t);return i},C=function(n,r,i){var a;return a=e.defer(),t.upload=c.upload({url:"/api/v1/image_upload/note_picture",file:n}).progress(function(){}).success(function(e){var n,o,s,l;if(e.error)alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else for(n=s=0,l=i.length;l>s;n=++s)if(o=i[n],o.name===e.data.filename){t.note.pictures[r+n]=e.data;break}return a.resolve()}),a.promise}}]}),i=function(e,t,r,i,a,o){var s,l;return i.$window=r,"edit"===t.imageNoteModal?(i.note=angular.copy(e.note),i.currentUser=e.currentUser,i.settings={hashtag:{notekey:i.note.key}},s=!1,l=function(){return{pictures:i.note.pictures,hashtags:i.settings.hashtag.list}},i.$watch(l,function(e,t){return s=!angular.equals(e,t)},!0),n.initEdit(i)):(i.hideNoteModalHeaderFlag=!0,i.note={paid_flag:!1,pictures:[],enableDownload:!1,status:"draft",type:"ImageNote"},i.settings={hashtag:{list:[]},enable_comment:!0},n.init(i,a,o))},s=function(e,t,n){var r,i;return i="create-"+n,"home.home"===e.current.name&&(r=i+"-from-home"),"creator.home"===e.current.name&&(r=i+"-from-creator"),"magazine.home"===e.current.name&&(r=i+"-from-magazine"),"showTextNoteFriendly"===e.current.name&&(r=i+"-from-note"),t.eventTrack(r,{category:"button",label:"link"})}})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("wallpaperUpload",function(){return{templateUrl:"/templates/creators/partials/wallpaper_upload_button",restrict:"E",link:function(e,t){return t.on("click",function(){return document.getElementById("user-wallpaper-upload").click()})}}}),angular.module("noteApp").directive("profileUpload",function(){return{templateUrl:"/templates/creators/partials/profile_upload_button",restrict:"E",link:function(e,t){return t.on("click",function(){return document.getElementById("user-profile-upload").click()})}}}),angular.module("noteApp").directive("magazineCoverUpload",function(){return{templateUrl:"/templates/users/partials/magazine_cover_upload_button",restrict:"E",link:function(e,t){return t.on("click",function(){return document.getElementById("magazine-cover-upload").click()})}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("lazyLoadImage",["PlaceholderImage",function(e){var t;return t={restrict:"E",template:"<img />",scope:{imageUrl:"=",imageClass:"=",imageStyle:"=",imageAlt:"=",imageTitle:"=",imageHeight:"=",imageWidth:"="},link:function(t,n){return null==t.imageUrl&&n.html(""),t.imageWidth&&t.imageHeight?e.cache(t.imageWidth,t.imageHeight).then(function(){return n.find("img").each(function(n,r){return $(r).attr({"data-src":t.imageUrl,src:e.get(t.imageWidth,t.imageHeight),style:t.imageStyle||"","class":t.imageClass||"",alt:t.imageAlt||"",title:t.imageTitle||""}),lzld(r)})}):n.find("img").each(function(n,r){return $(r).attr({"data-src":t.imageUrl,src:e.get(t.imageWidth,t.imageHeight),style:t.imageStyle||"","class":t.imageClass||"",alt:t.imageAlt||"",title:t.imageTitle||""}),lzld(r)})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("lightbox",["Lightbox",function(e){var t;return t={restrict:"A",scope:{lightboxType:"@"},link:function(t,n,r){return n.on("click",function(n){var i;return n.preventDefault(),i=[{url:r.src}],e.show(t.lightboxType,i)})}}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/like.html",'<div class=\'renewal-p-action__like\' ng-class="{\'is-active\': likable.is_liked}" ng-if="likeStyle == \'light\'"> <like-thanks user="likable.user" is-shown="likeMessage.isShown" ng-if="(likable.user.like_appeal_text || likable.user.likeAppealText )"></like-thanks> <div class=\'renewal-p-action__icon\' ng-click=\'toggleLike()\'> <i class=\'renewal-p-icon--like\'></i> </div> <div class="renewal-p-action__count" likable-type="note" likable="likable" anonymous-likes="likable.anonymous_like_count" like-list-modal ng-class="{\'is-active\':likable.is_liked}" ng-if="likable.like_count &gt; 0">{{ likable.like_count }}</div> </div> <div class="p-action__like" ng-if="likeStyle == \'light-animation\'"> <like-thanks user="likable.user" type="timeline" is-shown="likeMessage.isShown" ng-if="(likable.user.like_appeal_text || likable.user.likeAppealText )"></like-thanks> <div class="p-action__icon p-action__icon--like" ng-click="toggleLike()" ng-class="{\'is-active\':likable.is_liked, \'is-animate\':isAnimate}" ng-if="likeStyle == \'light-animation\'"> <i class="c-icon c-icon--color_like" ng-class="{\'c-icon--heart\':!likable.is_liked, \'c-icon--heartFill\':likable.is_liked,\'is-animate\':isAnimate}"></i> </div> </div> <like-thanks user="likable.user" type="spBooster" is-shown="likeMessage.isShown" ng-if="likeStyle == \'booster-animation\' && (likable.user.like_appeal_text || likable.user.likeAppealText )"></like-thanks> <div class="c-icon--like" ng-click="toggleLike()" ng-class="{\'is-animate\':isAnimate}" ng-if="likeStyle == \'booster-animation\'"> <div class="c-icon--like__icon"> <i class="renewal-p-icon--likeOutlineColor" ng-class="{\'is-active\':likable.is_liked}"></i> </div> </div> <div class="p-articleActions__item p-articleActions__item--suki" ng-if="likeStyle == \'booster-animation-pc\'"> <like-thanks user="likable.user" is-shown="likeMessage.isShown" type="pcBooster" ng-if="(likable.user.like_appeal_text || likable.user.likeAppealText )"></like-thanks> <div class="p-articleActions__like" ng-click="toggleLike()"> <i class="c-icon c-icon--color_like" ng-class="{\'c-icon--heart\':!likable.is_liked, \'c-icon--heartFill\':likable.is_liked,\'is-animate\':isAnimate}"></i> </div> <span class="p-articleActions__count" likable-type="note" likable="likable" like-list-modal  anonymous-likes="likable.anonymous_like_count" ng-class="{\'is-active\':likable.is_liked}" ng-if="likable.like_count &gt; 0">{{ likable.like_count }}</span> </div> <div class="mode-btn" ng-if="likeStyle == \'normal\'"> <a class="btn" ng-class="{\'is-active\':likable.is_liked }" ng-click="toggleLike()" ng-if="isLoggedIn"> <i class="icon-like"></i> \u30b9\u30ad </a> <a class="btn" entry-and-like-modal ng-if="!isLoggedIn" note="likable"> <i class="icon-like"></i> \u30b9\u30ad </a> </div> <span class="mode-txt" ng-if="likeStyle == \'normal\'"> <span ng-if="isLoggedIn"> <a class="pointer space-right-h" ng-click="toggleLike()"> <span ng-if="!likable.is_liked">\u30b9\u30ad</span> <span ng-if="likable.is_liked">\u30b9\u30ad</span> </a> <a class="pointer count" likable-type="comment" likable="likable" like-list-modal ng-if="likable.like_count > 0"><i style="display:inline-block; margin-right:4px;" class="renewal-p-icon--likeOutlineSmall icon-inline icon-like" ng-class="{\'is-active\':likable.is_liked}"></i>{{likable.like_count | number}}</a> </span> <span ng-if="!isLoggedIn"> <a class="pointer">\u30b9\u30ad</a> <a class="pointer count" likable-type="comment" likable="likable" like-list-modal ng-if="likable.like_count > 0"><i style="display:inline-block; margin-right:4px;" class="renewal-p-icon--likeOutlineSmall icon-inline icon-like" ng-class="{\'is-active\':likable.is_liked}"></i>{{likable.like_count | number}}</a> </span> </span> <div class=\'p-comments__actionIcon p-comments__actionIcon--like\' ng-class="{\'is-active\': likable.is_liked}" ng-if="likeStyle == \'comment-animation\'"> <i class="c-icon c-icon--heart" ng-click="toggleLike()" ng-class="{\'c-icon--heartFill \':likable.is_liked,\'is-animate\':isAnimate}"></i> </div>')
}]),angular.module("noteApp").directive("likeLink",["$rootScope",function(e){var t;return t={templateUrl:"common/renewal/like.html",restrict:"E",link:function(e){return e.likableName=e.likableType.slice(0,-1)},scope:{likable:"=",likableType:"@",likeStyle:"@"},controller:["$scope","Popeye","$timeout","Like","Auth","OpenPickUrlnameModalService","AnonymousVotes","$analytics",function(t,n,r,i,a,o,s,l){return t.processing=!1,t.likeStyle=t.likeStyle||"normal",t.isAnimate=!1,t.likeMessage={isShown:!1,count:0},t.noLoginLikes=[],a.then(function(a){var c,u;return a.error?(t.isLoggedIn=!1,t.noLoginLikes=localStorage.getItem("noLoginLikes")?localStorage.getItem("noLoginLikes").split(","):[],t.likable.is_liked=t.noLoginLikes.indexOf(t.likable.key)>=0?!0:!1):(t.currentUser=a.data,t.isLoggedIn=!0),c=function(){var e;return t.currentUser.no_urlname_user?(l.eventTrack("onclick-with-no-login",{category:"like",label:"open-no-urlname-modal"}),e=function(){return location.reload()},o.open(e,"like"),!0):!1},t.toggleLike=function(){var e;if(!t.currentUser&&"comments"===t.likableType)return l.eventTrack("onclick-with-no-login",{category:"like",label:"open-login-modal"}),void(e=n.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","$location","$state",function(t,n,r){return t.checkout_type="like",t.pageTo=function(t){var i;return i=0===r.current.name.lastIndexOf("cd",0)?n.absUrl():n.path(),r.go(t,{redirectPath:i}),e.close()}}]}));if(!(t.currentUser&&"comments"===t.likableType&&c()||t.processing===!0))return t.likable.is_liked===!0?t.deleteLike():(t.likeStyle.indexOf("-animation")>=0&&(t.isAnimate=!0),0===t.likeMessage.count&&(t.likeMessage.isShown=!0,t.likeMessage.count++),t.createLike())},t.createLike=function(){var n,a;if(angular.isNumber(t.likable.id))return t.processing=!0,t.likable.is_liked=!0,t.likable.like_count++,t.currentUser?("note"===t.likableName&&t.likable.likes.unshift({user:t.currentUser}),a=new i,a.$save({likables:t.likableName,likableId:t.likable.id},function(n){return n.error?(alert(n.error.message),t.likable.like_count--,t.likable.is_liked=!1,t.processing=!1,void("note"===t.likableName&&u())):(e.$broadcast("$CreateLikeSuccessfully",t.likableName,t.likable),r(function(){return t.processing=!1,t.likeStyle.indexOf("-animation")>=0?t.isAnimate=!1:void 0},500))},function(){return console.log("Error occurred")})):(l.eventTrack("onclick-with-no-login",{category:"like",label:"anonymous-like-create"}),n=new s,n.$save({votables:t.likableName,votableId:t.likable.id},function(e){var n;return n=e.data.note,t.noLoginLikes.push(n.key),t.likable.anonymous_like_count++,localStorage.setItem("noLoginLikes",t.noLoginLikes.join(",")),r(function(){return t.processing=!1},500)},function(){return console.log("Error occurred"),t.likable.like_count--,t.likable.is_liked=!1,r(function(){return t.processing=!1},500)}))},t.deleteLike=function(){var n;return t.processing=!0,t.currentUser?i["delete"]({likables:t.likableName,likableId:t.likable.id},function(){return t.likable.is_liked=!1,t.likable.like_count--,"note"===t.likableName&&u(),e.$broadcast("$DeleteLikeSuccessfully",t.likableName,t.likable),r(function(){return t.processing=!1},500)},function(){return console.log("Error occurred")}):(l.eventTrack("onclick-with-no-login",{category:"like",label:"anonymous-like-delete"}),n=new s,n.$save({votables:t.likableName,votableId:t.likable.id,"delete":!0},function(e){var n;return n=e.data.note,t.noLoginLikes=t.noLoginLikes.filter(function(e){return e!==n.key}),localStorage.setItem("noLoginLikes",t.noLoginLikes.join(",")),t.likable.is_liked=!1,t.likable.like_count--,t.likable.anonymous_like_count--,r(function(){return t.processing=!1},500)},function(){return console.log("Error occurred"),t.likable.is_liked=!0,t.likable.like_count++,r(function(){return t.processing=!1},500)}))},t.getLikeList=function(){return i.get({likables:t.likableName,likableId:t.likable.id},function(e){var t;return t=n.openModal({templateUrl:"/templates/modal/like_list",controller:["$scope",function(n){return n.likes=e.data.likes,n.close=function(){return t.close()}}]})},function(){return console.log("Error occurred")})},u=function(){var e,n,r,i,a,o;for(a=t.likable.likes,o=[],e=r=0,i=a.length;i>r;e=++r)n=a[e],o.push(angular.isDefined(n)&&angular.isDefined(n.user)?n&&n.user.id===t.currentUser.id?t.likable.likes.splice(e,1):void 0:n&&n===t.currentUser.id?t.likable.likes.splice(e,1):void 0);return o}})}]}}]),angular.module("noteApp").directive("likeListModal",["Popeye","Like","Auth",function(e,t,n){var r;return r={restrict:"A",scope:{likable:"=",likableType:"@",anonymousLikes:"="},link:function(t,r){return r.on("click",function(){var r;return r=e.openModal({templateUrl:"/templates/modal/like_list",controller:["$scope",function(e){return n.then(function(t){return e.isLoggedIn=t.error?!1:!0}),e.anonymousLikes=t.anonymousLikes,e.like_count=t.likable.like_count,e.initLikeListModal=function(){var n;return e.likerModel={},e.likerModel.initializing=!0,t.page=1,n=t.getLikerList(),n.$promise.then(function(t){return e.likerModel.likes=t.data.likes,e.likerModel.last_page=t.data.last_page,e.likerModel.initializing=!1,e.likerModel.loading=!1})},e.nextPage=function(){var n;return e.likerModel.loading=!0,t.page++,n=t.getLikerList(),n.$promise.then(function(t){var n,r,i,a;for(a=t.data.likes,r=0,i=a.length;i>r;r++)n=a[r],e.likerModel.likes.push(n);return e.likerModel.last_page=t.data.last_page,e.likerModel.loading=!1})},e.close=function(){return r.close()}}]})})},controller:["$scope",function(e){return e.getLikerList=function(){return t.get({likables:e.likableType,likableId:e.likable.id,page:e.page},function(t){return t.error?void(e.error=t.error):e.likes=t.data.likes},function(){return console.log("Error occurred")})}}]}}])}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/like_thanks.html",'<div class="p-replyToLike" ng-class="$ctrl.addClassToParent()"> <div class="p-messageBalloon" ng-class="$ctrl.addClassToBalloon()"> <div class="p-messageBalloon__content"> <div class="p-replyToLike__body"> <div class="p-replyToLike__avatar"> <div class="c-avatar--fit"> <img class="c-avatar__img" ng-src="{{$ctrl.user.user_profile_image_path || $ctrl.user.userProfileImagePath}}"> </div> </div> <p class="p-replyToLike__message">{{$ctrl.user.like_appeal_text || $ctrl.user.likeAppealText}}</p> </div> </div> </div> </div>')}]),e=function(){function e(){}return e.inject=[],e.prototype.addClassToParent=function(){return{"p-replyToLike--with_articleActionSp":"spBooster"===this.type,"p-replyToLike--with_articleActionPc":"pcBooster"===this.type,"p-replyToLike--with_timelineSp":"timeline"===this.type,"is-shown":this.isShown}},e.prototype.addClassToBalloon=function(){return{"p-messageBalloon--tailPosition_bottomRight":"spBooster"===this.type||"timeline"===this.type,"p-messageBalloon--tailPosition_bottomLeft":"spBooster"!==this.type&&"timeline"!==this.type}},e}(),angular.module("noteApp").directive("likeThanks",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"common/renewal/like_thanks.html",bindToController:{user:"=",type:"@",isShown:"="},link:function(e,t){return t.find(".p-replyToLike").on("animationend webkitAnimationEnd",function(){return t.hide()})}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("loggableClick",function(){return{restrict:"A",scope:{},link:function(e,t,n){return t.on("click",function(){var t,r,i,a,o;if(!e.sent){e.sent=!0;try{a=null;for(i in n)i.match(/^logData\w+/)&&(a||(a={}),r=i[7].toLowerCase()+i.slice(8,+(i.length-1)+1||9e9),a[r]=n[i]);if(a&&a.name)return o={name:a.name},a.noteKey&&(o.note_key=a.noteKey),a.userId&&(o.user_id=Number(a.userId)),$.post("/api/v1/click_log",o)}catch(s){t=s}}})}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineDeleteModal",["Popeye","$state",function(e){var t;return t={restrict:"A",scope:{key:"=",callback:"&"},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/magazine_delete_confirm",controller:["$scope","MyMagazine",function(e,r){return e.cancel=function(){return n.close()},e.ok=function(){var e;return e={magazine_key:t.key},r["delete"](e,function(){return t.callback()?(n.close(),t.callback()()):window.location="/magazines"},function(){return n.close()})}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineEditModal",["Popeye","$window",function(e){var t;return t={restrict:"A",scope:{edit:"=",magazine:"=",pickup:"=",magazines:"=",createMagazineCallback:"&"},link:function(t,n){return n.on("click",function(){var r;return r=e.openModal({templateUrl:"/templates/modal/magazine_flow",backdrop:"static",click:!1,controller:["$scope","$rootScope","$upload","$window","MyMagazine","Auth","ImageUploadMagazineCoverDelete","$q","$state",function(e,i,a,o,s,l,c,u,d){return e.magazine=t.magazine,e.oldMagazine=angular.copy(e.magazine),e.edit=t.edit,e.mag_edit_disabled=!1,e.check_open=!0,e.is_premium_user=!1,e.container_tmp=null,e.subscribe=!1,e.createMagazineCallback=t.createMagazineCallback,e.initModal=function(){return e.page="magazine_edit",e.$window=o,l.then(function(t){return t.error?e.isLoggedIn=!1:(e.isLoggedIn=!0,e.currentUser=t.data,e.buttonDisabled=!0,e.subscribeButtonDisabled=!1,e.currentUser.is_premium_user?(e.is_premium_user=!0,e.container_tmp=angular.copy(e.container)):e.is_premium_user=!1)})},e.pageTo=function(t){switch(t){case"apply_subscribe":return e.container_tmp=angular.copy(e.container),e.check_open=!1,e.page=t;default:return e.page=t}},e.showSubscribeForm=function(){return e.subscribe=!0,e.container.is_free_mode=!1,e.container.price=100},e.createSubscribleApply=function(){return e.subscribeButtonDisabled=!0,e.subscribe=!0,e.container=angular.copy(e.container_tmp),e.createNewMagazine()},e.close=function(){return r.close()},e.back=function(){return e.subscribe=!0,e.pageTo("magazine_edit")},e.closeSubscribeForm=function(){return e.subscribe=!1,e.buttonDisabled=!1,e.check_open=!0},e.initMagazineEditModal=function(){return e.mag_edit_disabled=!1,e.container={},e.container.is_free_mode=!0,e.edit?(e.container=e.magazine,e.container.cover=e.magazine.cover||$filter("defaultMagazineCover")(),e.container.status="private"===e.magazine.status,e.container.cover_key=e.magazine.cover_key,e.container.price=e.magazine.price,e.container.edit_pay_magazine=e.container.price>0,e.container.current_price=e.magazine.price):(e.container.name="",e.container.description="",e.container.status=!1,e.container.price=0,e.container.is_free_subscribe=!1,e.container.frequency=1,e.subscribe===!0&&(e.container=angular.copy(e.container_tmp)),e.container.layoutType="list",e.container.subscribeContentPlaceholder="\u4f8b: \u30e9\u30a4\u30d5\u30b9\u30bf\u30a4\u30eb\u3084\u30d3\u30b8\u30cd\u30b9\u7cfb\u306e\u30a6\u30a7\u30d6\u30e1\u30c7\u30a3\u30a2\u3092\u4e2d\u5fc3\u306b\u3001\u30d5\u30ea\u30fc\u30e9\u30f3\u30b9\u3067\u30e9\u30a4\u30bf\u30fc\u3092\u3057\u3066\u3044\u307e\u3059\u3002\u5b9a\u671f\u8cfc\u8aad\u30de\u30ac\u30b8\u30f3\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u66f4\u65b0\u3057\u3066\u3044\u304f\u4e88\u5b9a\u3067\u3059\u3002\n\u30fb\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u306e\u30c6\u30af\u30cb\u30c3\u30af\n\u30fb\u30d3\u30b8\u30cd\u30b9\u306b\u95a2\u3059\u308b\u30b3\u30e9\u30e0\n\u30fb\u53d6\u6750\u306e\u88cf\u8a71\n\u30fb\u8cfc\u8aad\u8005\u304b\u3089\u306e\u8cea\u554f\u30b3\u30fc\u30ca\u30fc"),e.onClickLayout=function(t){return t!==e.container.layoutType?e.container.layoutType=t:void 0},e.toggleStatus=function(){return e.container.status=!e.container.status}},e.cancel=function(){return angular.copy(e.oldMagazine,e.container),r.close()},e.updateMagazine=function(){var t;if(!e.container.magazineEditForm.$invalid){if(e.container.magazineEditForm.$invalid=!0,e.container.price=+e.container.price,0!==e.container.edit_pay_magazine&&e.container.price!==e.container.current_price){if(e.currentUser.can_remove_price_restriction&&(e.container.price<100||e.container.price>5e4))return void(e.error_message="\u30de\u30ac\u30b8\u30f3\u306e\u5024\u6bb5\u306f100\u5186\u304b\u308950,000\u5186\u306e\u9593\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002");if(!e.currentUser.can_remove_price_restriction&&(e.container.price<100||e.container.price>1e4))return void(e.error_message="\u30de\u30ac\u30b8\u30f3\u306e\u5024\u6bb5\u306f100\u5186\u304b\u308910,000\u5186\u306e\u9593\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002")}return e.magazine.is_subscribable&&e.oldMagazine.price!==e.container.price?void(e.error_message="\u5b9a\u671f\u8cfc\u8aad\u30de\u30ac\u30b8\u30f3\u306e\u6708\u984d\u4fa1\u683c\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002"):e.temp_image?(e.mag_edit_disabled=!0,t=u.defer(),e.removeMagazineCover().then(function(){return e.deferredUploadImage(e.temp_image)}).then(function(){return e.updateMagazineContents()})):(e.container.cover_key=e.magazine.cover_key,e.updateMagazineContents())}},e.updateMagazineContents=function(){var a,o;return e.container.status===!0&&(o="private"),"private"!==o&&(o="public"),a={name:e.container.name,description:e.container.description,price:e.container.price,status:o,magazine_key:e.container.key,magazine_cover_key:e.container.cover_key,layout_type:e.container.layoutType},s.put(a,function(a){return a.error?("magazine_count_exceeded"===a.error.code&&alert("\u4f5c\u6210\u53ef\u80fd\u306a\u30de\u30ac\u30b8\u30f3\u306f"+e.currentUser.max_magazine_add_count+"\u500b\u307e\u3067\u3067\u3059\u3002"),void("invalid"===a.error.code&&(e.error_message=a.error.message))):(null!=e.container.cover_key&&(e.container.cover=e.container.cover.replace(/_middle/,"_large")),e.container.status=e.container.status===!0?"private":"public",e.check_open&&r.close(),null!=a.data.cover&&(a.data.cover=a.data.cover.replace(/_large/,"_middle"),n.parents("li").find("div.mag-list__cover-img").find("img")[0].src=a.data.cover),t.pickup===!0?i.$broadcast("$UserPickupMagazinesReloadStart"):void 0)},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})},e.createNewMagazine=function(){if(!e.container.magazineEditForm.$invalid){if(e.loading=!0,e.container.price=+e.container.price,0!==e.container.price){if(e.currentUser.can_remove_price_restriction&&(e.container.price<100||e.container.price>5e4))return void(e.error_message="\u30de\u30ac\u30b8\u30f3\u306e\u5024\u6bb5\u306f100\u5186\u304b\u308950,000\u5186\u306e\u9593\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002");if(!e.currentUser.can_remove_price_restriction&&(e.container.price<100||e.container.price>1e4))return void(e.error_message="\u30de\u30ac\u30b8\u30f3\u306e\u5024\u6bb5\u306f100\u5186\u304b\u308910,000\u5186\u306e\u9593\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002")}return l.then(function(t){return t.error?e.isLoggedIn=!1:(e.isLoggedIn=!0,e.currentUser=t.data,e.buttonDisabled=!0),e.temp_image?(e.mag_edit_disabled=!0,e.deferredUploadImage(e.temp_image).then(function(){return e.createMagazineContents()})):e.createMagazineContents()})}},e.createMagazineContents=function(){var n;return n={name:e.container.name,description:e.container.description,status:e.container.status?"private":"public",magazine_cover_key:e.container.cover_key,price:e.container.price,subscribe:e.subscribe,content:e.container.content,frequency:e.container.frequency,is_free_subscribe:e.container.is_free_subscribe,target_number:e.container.target_number,management_name:e.container.management_name,email:e.container.email,homepage_url:e.container.homepage_url,blog_url:e.container.blog_url,facebook_url:e.container.facebook_url,twitter_url:e.container.twitter_url,instagram_url:e.container.instagram_url,others:e.container.others,layout_type:e.container.layoutType,message:e.container.price>0?e.container.message:null},s.save(n,function(n){var i;if(n.error){if(e.buttonDisabled=!1,"magazine_count_exceeded"===n.error.code)return void alert("\u4f5c\u6210\u53ef\u80fd\u306a\u30de\u30ac\u30b8\u30f3\u306f"+e.currentUser.max_magazine_add_count+"\u500b\u307e\u3067\u3067\u3059\u3002");alert(n.error)}null!=n.data.cover_key&&(n.data.cover=n.data.cover.replace(/_large/,"_middle")),i=t.magazines?t.magazines:t.$parent.$parent.magazines,("home.magazines"===d.current.name||"manage.magazines.home"===d.current.name)&&i.unshift(n.data),e.currentUser.magazine_count++,e.check_open&&r.close(),e.subscribe&&e.pageTo("confirm_apply"),e.createMagazineCallback&&(e.createMagazineCallback(),r.close())},function(e){return alert(e.data.error)})},e.onFileSelect=function(t,n){var r,i;switch(n){case"magazine_cover":return r=["image/jpeg","image/png","image/gif"],-1===r.indexOf(t[0].type)?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):t[0].size>5e6?void alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):(e.temp_image=t[0],i=new FileReader,i.readAsDataURL(t[0]),i.onload=function(t){return e.container.cover=t.target.result,e.$apply()})}},e.deferredUploadImage=function(t){var n;return n=a.upload({url:"/api/v1/image_upload/magazine_cover",file:t}).success(function(t){return null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):(e.container.cover=t.data.url,e.container.cover_key=t.data.key)}).error(function(e,t){return 422===t?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):void 0})},e.removeTempMagazineCover=function(){return e.temp_image=null,e.container.cover=null},e.removeMagazineCover=function(){var n;return n=u.defer(),l.then(function(r){return e.currentUser=r.data,e.container.user.urlname===e.currentUser.urlname?c.put({magazine_key:e.container.key},function(){return t.magazine.cover_key=null,n.resolve()},function(){return console.log("Error occurred")}):void 0}),n.promise},e.setPrice=function(t,n){return e.container.price=0,!n&&e.container.price>=100&&e.container.price<=5e4?void 0:(e.container.is_free_mode=n,e.container.price=t,e.subscribe=!1)},e.$watch("container.name",function(t){var n;return null!=t&&(e.container.name=t.trim().replace(/(\r?\n){3,}/g,"\n\n"),(n=e.container.name.match(/\r?\n/g))&&n.length>2)?e.container.name=e.container.name.replace(/\r?\n/g,""):void 0}),e.modal=r}]})}),t.onClickLayout=function(e){return e!==$scope.magazineEdit.layoutType?($scope.magazineEdit.layoutType=e,$scope.onMagazineChanged()):void 0}}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineEditorMenu",function(){return{templateUrl:"/templates/common/magazine_editor_menu",restrict:"A",scope:{editor:"=",currentEditor:"=",rolify:"&",deactivate:"&",leave:"&"},controller:["$scope",function(e){return e.hasRootAuthority=function(){return"root"===e.currentEditor.editor_role}}],link:function(e,t){var n,r,i,a,o,s;return n=t.find("div.unit"),r=t.find("a"),t.on("click",function(e){return e.preventDefault(),s(n,r)}),t.find("li").on("click","a",function(e){return e.stopPropagation(),i(n,r)}),s=function(e,t){return a(e)?i(e,t):o(e,t)},o=function(e,t){var n;return e.css("display","block"),t.addClass("active"),n=angular.element(document),n.on("mouseup",function(n){var r;return n.preventDefault(),r=angular.element(n.target),!r.hasClass("active")&&a(e)?i(e,t):void 0})},i=function(e,t){var n;return e.css("display","none"),t.removeClass("active"),n=angular.element(document),n.off("mouseup")},a=function(e){return"none"!==e.css("display")}}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineFollow",["Auth","MagazineFollowers","OpenPickUrlnameModalService","$rootScope","Popeye",function(e,t,n,r,i){var a;return a={restrict:"A",scope:{magazine:"=",noUrlnameUser:"=",broadCastName:"@"},link:function(a,o){return o.on("click",function(){var o;return o=function(){var e;return a.currentUser&&a.currentUser.no_urlname_user||a.noUrlnameUser?(e=function(){return location.reload()},n.open(e,"magazine_follow"),!0):!1},e.then(function(e){return a.currentUser=e.data,t.save({magazine_key:a.magazine.key},function(e){return e.error?void alert(e.error.message):(a.magazine.is_following=!0,a.broadCastName?r.$broadcast(a.broadCastName,a.magazine):void 0)},function(e){var t;return 401===e.status?t=i.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","CustomDomainContext","$state",function(e,n,r){return e.checkout_type="magazineFollow",e.pageTo=function(e){var i;return i=n.isCdAccess()&&"cdMagazine.home"===r.current.name?n.getBaseUrl():"/"+a.magazine.user.urlname+"/m/"+a.magazine.key,"login"===e?(r.go("login",{redirectPath:i,magazineFollow:a.magazine.key}),t.close()):"signup"===e?(r.go("signup",{redirectPath:i,magazineFollow:a.magazine.key}),t.close()):void 0}}]}):alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})})})}}}]),angular.module("noteApp").directive("magazineUnfollow",["Auth","MagazineFollowers","$rootScope",function(e,t,n){var r;return r={restrict:"A",scope:{magazine:"=",broadCastName:"@"},link:function(r,i){return i.on("click",function(){return e.then(function(e){return r.currentUser=e.data,t["delete"]({magazine_key:r.magazine.key},function(e){return e.error?void alert(e.error.message):(r.magazine.is_following=!1,r.broadCastName?n.$broadcast(r.broadCastName,r.magazine):void 0)},function(e){var t;return 401===e.status?t=Popeye.openModal({templateUrl:"/templates/modal/_login_or_signup",controller:["$scope","CustomDomainContext","$state",function(e,n,i){return e.checkout_type="magazineFollow",e.pageTo=function(e){var a;return a=n.isCdAccess()&&"cdMagazine.home"===i.current.name?n.getBaseUrl():"/"+r.magazine.user.urlname+"/m/"+r.magazine.key,"login"===e?(i.go("login",{redirectPath:a,magazineFollow:r.magazine.key}),t.close()):"signup"===e?(i.go("signup",{redirectPath:a,magazineFollow:r.magazine.key}),t.close()):void 0}}]}):alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})})})}}}]),angular.module("noteApp").directive("magazineFollowersModal",["Popeye",function(e){var t;return t={restrict:"A",scope:{magazine:"="},link:function(t,n){return n.on("click",function(){var t;return t=e.openModal({templateUrl:"/templates/modal/magazine_followers_list",controller:["$scope",function(e){return e.close=function(){return t.close()}}]},function(){return console.log("Error occurred")})})}}}]),angular.module("noteApp").directive("magazineSubscribersModal",["Popeye",function(e){var t;return t={restrict:"A",scope:{magazine:"="},link:function(t,n){return n.on("click",function(){var t;return t=e.openModal({templateUrl:"/templates/modal/magazine_subscribers_list",controller:["$scope",function(e){return e.close=function(){return t.close()}}]},function(){return console.log("Error occurred")})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineFollowModal",["Popeye",function(e){var t;return t={restrict:"A",scope:{magazine:"="},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/magazine_follow",backdrop:"static",controller:["$scope",function(e){return e.is_following=t.magazine.is_following,e.magazine=t.magazine,e.cancel=function(){return n.close()},e.ok=function(){return n.close()}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineHavingModal",["Popeye","$state","$stateParams","MagazineHavingTheNote","ContentLink",function(e,t,n,r,i){var a;return a={restrict:"A",scope:{noteKey:"="},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/magazine_having",controller:["$scope",function(e){return e.initMagazineHavingModal=function(){var n;return e.initializing=!0,t.page=1,n=t.getMagazines(),n.$promise.then(function(t){return e.magazines=t.data.magazines,e.last_page=t.data.last_page,e.initializing=!1,e.loading=!1})},e.nextPage=function(){var n;return e.loading=!0,t.page++,n=t.getMagazines(),n.$promise.then(function(t){var n,r,i,a;for(a=t.data.magazines,r=0,i=a.length;i>r;r++)n=a[r],e.magazines.push(n);return e.last_page=t.data.last_page,e.loading=!1})},e.close=function(){return n.close()},e.goAndClose=function(e,t){return i.go("magazine",t),n.close(),e.preventDefault()}}]})})},controller:["$scope",function(e){return e.getMagazines=function(){return r.get({note_key:e.noteKey,page:e.page,magazine_key:n.magazine_key},function(t){return e.magazines=t.data.magazines},function(){return console.log("Error occured")})}}]}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineRearrangeModal",["Popeye","$resource",function(e){var t;return t={restrict:"A",scope:{user:"="},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/magazine_rearrange",backdrop:"static",controller:["$scope","$rootScope","$upload","Bridge","OurMagazineNote",function(e,r,i,a,o){var s;return s=t.getAllMagazineNotes().$promise,e.loading=!0,s.then(function(t){return e.notes=t.data,e.magazine=a.magazine,e.oldNotes=angular.copy(e.notes),e.loading=!1}),e.cancel=function(){return angular.copy(e.oldNotes,e.notes),n.close()},e.markAsDeleted=function(t){return t.deleted?t.deleted=!1:(t.deleted=!0,e.moveToLast(t))},e.moveToLast=function(t){var n,r;return n=e.notes.indexOf(t),r=e.notes.splice(n,1)[0],e.notes.push(r)},e.forward=function(t,n){var r;if(r=e.notes.indexOf(t),n===!1){if(0===r)return;return e.notes.splice(r-1,2,e.notes[r],e.notes[r-1])}return r!==e.notes.length-1?e.notes.splice(r,2,e.notes[r+1],e.notes[r]):void 0},e.back=function(t){return e.forward(t,!1)},e.sortByPublishDate=function(){return e.asc?(e.notes.sort(function(e,t){return moment(e.publish_at).unix()-moment(t.publish_at).unix()}),e.asc=!1):(e.notes.sort(function(e,t){return moment(t.publish_at).unix()-moment(e.publish_at).unix()}),e.asc=!0)},e.rearrange=function(){var t,i,a,s,l,c;for(a=[],s=angular.copy(e.notes),l=0,c=s.length;c>l;l++)i=s[l],a.push({id:i.id,deleted:!!i.deleted}),i.deleted&&(t=e.notes.indexOf(i),e.notes.splice(t,1));return o.rearrange_notes({magazine_key:e.magazine.key,note_ids:a},function(){return r.$broadcast("$MagazineNoteTimelineReload"),r.$broadcast("$MagazineTopReload"),n.close()},function(){return alert("Failed to rearrange notes")})}}]})})},controller:["$scope","OurMagazineNote","Bridge",function(e,t,n){return e.getAllMagazineNotes=function(){return t.get({magazine_key:n.magazine.key})}}]}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineSocialPlugin",["$window","$filter","Title","CustomDomainContext",function(e,t,n,r){var i;return i={restrict:"E",templateUrl:"/templates/common/custom_social_plugin",link:function(i,a){return a.on("click",function(a){var o,s,l,c,u,d,p,h,m,f,g,v;return i.type=angular.isDefined(i.type)?i.type:"a",null!=i.magazine&&(p=""+e.PREFETCH.NOTE.protocol+"://"+e.PREFETCH.NOTE.host+"/"+i.magazine.user.urlname+"/m/"+i.magazine.key,r.isCdAccess()&&"magazine"===r.type&&r.key===i.magazine.key&&(p=""+r.getProtocol()+"://"+r.host),c=140,l=23,o=7,s=c-(l+o),h=i.magazine.name,u=i.magazine.user.nickname||i.magazine.user.urlname,h===u&&(u=""),f="note\uff08\u30ce\u30fc\u30c8\uff09",g=[],(h+u+f).length<s?g.push(h,u,f):(h+u).length<s?g.push(h,u):g.push(h.length<s?h:t("truncate")(h,s)),d=encodeURIComponent(n.create(g)),m="fb"===a.target.parentNode.getAttribute("data-type")?"https://www.facebook.com/share.php?u="+p+"&t="+d:"https://twitter.com/intent/tweet?url="+p+"&text="+d,v="fb"===a.target.parentNode.getAttribute("data-type")?"share on facebook":"share on twitter",e.open(m,v,"width=550, height=450,personalbar=0,toolbar=0,scrollbars=1,resizable=1")),a.preventDefault()})},scope:{fbShare:"&",magazine:"=",type:"@?"},controller:["$scope","$window","$location","CustomDomainContext",function(e,t,n,r){return e.rssPath=r.isCdAccess()&&"magazine"===r.type?"/rss":""+n.path()+"/rss",e.fbShare=function(){t.open(e.fbShareUrl,"share on facebook","width=550, height=450,personalbar=0,toolbar=0,scrollbars=1,resizable=1")}}]}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("magazineSuspendModal",["Popeye","$timeout",function(e,t){return{restrict:"A",scope:{magazine:"=",parent:"="},link:function(n,r){var i;return i=function(){var t;return t=e.openModal({templateUrl:"/templates/modal/magazine_suspend_confirm",controller:["$scope","$window","MyMagazine",function(e,r,i){return e.magazine=n.magazine,e.state="agreement",e.agreement=!1,e.changeState=function(t){return e.state=t},e.dismiss=function(){return t.close()},e.execute=function(){var r;return r={magazine_key:n.magazine.key},i.suspend(r,function(){return e.state="completed"},function(){return alert("\u505c\u6b62\u7533\u8acb\u51e6\u7406\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),t.close()})},e.complete=function(){return r.location.reload()}}]})},r.on("click",function(){return n.parent?(n.parent.result.then(function(){return t(function(){return i()},250)}),n.parent.close()):i()})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.Magazines=e,this.$stateParams=t,this.Title=n,this.$scope=r,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.magazines=[],this.currentPage=this.$stateParams.page?+this.$stateParams.page:1,this.nextPage=null,this.per=18,this.isLastPage=!1,this.initMagazines(),this.Title.set("\u30de\u30ac\u30b8\u30f3\u4e00\u89a7",null,"note\uff08\u30ce\u30fc\u30c8\uff09"),this.$scope.$on("$MagazineFollowToggle",function(e,t){return t.isFollowing=!t.isFollowing})}return e.inject=["Magazines","$stateParams","Title","$scope"],e.prototype.initMagazines=function(){return this.Magazines.get({page:this.currentPage,per:this.per,is_note_app:!0},function(e){return function(t){return e.magazines=t.data.contents,e.nextPage=Number(e.currentPage+1),t.data.isLastPage&&(e.isLastPage=!0),e.totalCount=t.data.totalCount}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.magazineDescTruncateLen=function(){return 60},e.prototype.snakizeMagazineProperties=function(e){return e?(e.cover_rectangle=e.coverRectangle,e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),e.subscriptionInfo&&(e.subscription_info={},e.subscription_info.can_advance_purchase=e.subscriptionInfo.canAdvancePurchase,e.subscription_info.payment_date=e.subscriptionInfo.paymentDate,e.subscription_info.payment_date_carrier=e.subscriptionInfo.paymentDateCarrier,e.subscription_info.renewal_date=e.subscriptionInfo.renewalDate,e.subscription_info.reserved_end_date=e.subscriptionInfo.reservedEndDate,e.subscription_info.reserved_price=e.subscriptionInfo.reservedPrice,e.subscription_info.reserved_start_date=e.subscriptionInfo.reservedStartDate,e.subscription_info.conveniences=e.subscriptionInfo.conveniences),e.hasCoupon&&(e.has_coupon=e.hasCoupon),e.isOneshotSubscribeMagazine?e.is_oneshot_subscribe_magazine=e.isOneshotSubscribeMagazine:void 0):void 0},e}(),angular.module("noteApp").directive("magazines",function(){return{restrict:"E",templateUrl:"/templates/magazines/renew/list.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("minimumController",function(){return{link:function(){},controller:["$scope","Auth",function(e,t){return t.then(function(t){return t.error?e.isLoggedIn=!1:(e.isLoggedIn=!0,e.currentUser=t.data)})}]}})}.call(this),function(){"use strict";angular.module("noteApp").directive("movieNoteModal",["Popeye","NoteForm",function(e,t){var n;return n={restrict:"A",scope:{note:"=",currentUser:"="},link:function(n,r,i){return r.on("click",function(){var r,a,o;
return a=e.openModal({templateUrl:"/templates/modal/edit_movie_note",backdrop:"static",click:!1,controller:["$scope","$rootScope","$upload","MovieNote","NoteNotifyUpdate","MovieNoteDraft","DraftSaveAlert","$state","ContentLink","Auth","Bridge","$analytics",function(e,t,s,l,c,u,d,p,h,m,f,g){return r(n,i,e,m,f),e.initMovieNote=function(){return e.note.external_url=null},e.noMovieUrlChange=function(){var t,n;return n=e.note.movieUrl,e.note.external_url=(t=n.match("youtube.com/watch\\?v=([a-zA-Z-0-9_-]+)")||n.match("youtube.com/embed/([a-zA-Z-0-9_-]+)")||n.match("youtu.be/([a-zA-Z-0-9_-]+)"))?"https://www.youtube.com/embed/"+t[1]:(t=n.match("vimeo.com/([0-9]+)")||n.match("player.vimeo.com/video/([0-9]+)"))?"https://player.vimeo.com/video/"+t[1]:(t=n.match("instagram.com/p/([a-zA-Z-0-9_-]+)"))?"https://instagram.com/p/"+t[1]+"/embed/":(t=n.match("vine.co/v/([a-zA-Z-0-9_-]+)"))?"https://vine.co/v/"+t[1]+"/embed/simple":null},e.saveMovieNoteDraft=function(){var r,s,l;if(!e.afterSubmit&&(r=d.getMessage(e.note,e.settings),r&&alert(r),e.afterSubmit=!0,e.note.name&&e.note.external_url))return e.settings.normalize(),"edit"===i.movieNoteModal?(l={status:"draft",name:e.note.name,movieUrl:e.note.movieUrl,external_url:e.note.external_url,description:e.note.description||null,magazine_ids:e.settings.magazineIds,limited:e.settings.limited},l.publish_at=e.note.is_reserved?e.settings.publishAt:null,l.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],u.save({id:e.note.id},l,function(t){return e.afterSubmit=!1,t.error?void alert(t.error.message):("draft"===n.note.status&&(n.note.name=e.note.name,n.note.external_url=e.note.external_url,n.note.description=e.note.description||null,n.note.hashtag_notes=t.data.hashtag_notes),a.close())},function(){return alert(res.error.message),e.afterSubmit=!1})):(o(p,g,"movieNoteDraft"),s=new u,s.status="draft",s.name=e.note.name,s.movieUrl=e.note.movieUrl,s.external_url=e.note.external_url,s.description=e.note.description||null,s.magazine_ids=e.settings.magazineIds,s.limited=e.settings.limited,s.publish_at=e.note.is_reserved?e.settings.publishAt:null,s.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],s.$save(null,function(n){return e.afterSubmit=!1,n.error?void alert(n.error.message):(a.close(),t.$emit("createNoteDraftFromNavBar",n.data))},function(){return alert(res.error.message),e.afterSubmit=!1}))},e.save=function(){var r,s;if(!e.afterSubmit&&(e.afterSubmit=!0,e.note.name&&e.note.external_url))return e.settings.normalize(),"edit"===i.movieNoteModal?(s={status:"published",name:e.note.name,movieUrl:e.note.movieUrl,external_url:e.note.external_url,description:e.note.description||null,hashtags:e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.reserved||e.note.is_draft?e.settings.publishAt:null},e.currentUser.turnoff_comment_available&&(s.disable_comment=e.settings.enable_comment===!1),l.put({noteId:e.note.id},s,function(t){var r,i;return t.error?(alert(t.error.message),void(e.afterSubmit=!1)):(n.note.name=e.note.name,n.note.external_url=e.note.external_url,n.note.description=e.note.description||null,n.note.hashtag_notes=t.data.hashtag_notes,t.data.prior_sale&&(n.note.prior_sale.activated=t.data.prior_sale.activated,n.note.prior_sale.first_served_sales_count=t.data.prior_sale.first_served_sales_count),"published"===n.note.status?s.limited===!0?(i=e.settings.magazineIds,n.note.is_limited=!0,n.note.limited_note_include_magazines=function(){var t,n,a;for(a=[],t=0,n=i.length;n>t;t++)r=i[t],a.push(e.settings.magChecks[r].magazine);return a}()):(n.note.is_limited=!1,n.note.limited_note_include_magazines=[]):e.settings.reserved&&(n.note.reserved_publish_at=e.settings.publishAt),n.note.disable_comment=t.data.disable_comment,e.afterSubmit=!1,t.data.exist_purchased_user&&t.data.content_changed?e.ask_notify_update=!0:a.close(),"draft"===n.note.status?h.go("note",e.note,{reload:!0}):void 0)},function(){return alert(res.error.message),e.afterSubmit=!1})):(o(p,g,"movieNote"),r=new l,r.status="published",r.name=e.note.name,r.movieUrl=e.note.movieUrl,r.external_url=e.note.external_url,r.description=e.note.description||null,r.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],r.magazine_ids=e.settings.magazineIds,r.limited=e.settings.limited,r.publish_at=e.settings.publishAt,e.currentUser.turnoff_comment_available&&(r.disable_comment=e.settings.enable_comment===!1),r.$save(null,function(n){var r,i;return n.error?(alert(n.error.message),void(e.afterSubmit=!1)):e.settings.reserved===!0?(p.go("showTextNoteFriendly",{urlname:n.data.user.urlname,key:n.data.key}),a.close()):(n.data.prior_sale&&(e.note.prior_sale.activated=n.data.prior_sale.activated,e.note.prior_sale.first_served_sales_count=n.data.prior_sale.first_served_sales_count),e.note.status="published",e.note.user=n.data.user,e.note.custom_domain=n.data.user.custom_domain,e.note.key=n.data.key,e.note.note_days_count=n.data.note_days_count,e.note.note_days_text=n.data.note_days_text,"published"===e.note.status?e.note.limited===!0?(i=e.settings.magazineIds,e.note.is_limited=!0,e.note.limited_note_include_magazines=function(){var t,n,a;for(a=[],t=0,n=i.length;n>t;t++)r=i[t],a.push(e.settings.magChecks[r].magazine);return a}()):(e.note.is_limited=!1,e.note.limited_note_include_magazines=[]):e.note.is_reserved&&(e.note.reserved_publish_at=e.settings.publishAt),e.note.disable_comment=n.data.disable_comment,e.afterSubmit=!1,n.data.exist_purchased_user&&n.data.content_changed?e.ask_notify_update=!0:e.isPublishedNote=!0,t.$emit("createNoteFromNavBar",n.data),"draft"===e.note.status?h.go("note",e.note,{reload:!0}):void 0)},function(){return alert(res.error.message),e.afterSubmit=!1}))},e.notify_update=function(){return c.save({key:e.note.key},function(){return a.close()})},e.cancel_without_restore=function(){return a.close()}}]}),r=function(e,n,r,i,a){return"edit"===n.movieNoteModal?(r.note=angular.copy(e.note),r.currentUser=e.currentUser,r.settings={hashtag:{notekey:r.note.key}},t.initEdit(r)):(r.hideNoteModalHeaderFlag=!0,r.note={paid_flag:!1,audio:null,enableDownload:!1,status:"draft",type:"MovieNote"},r.settings={hashtag:{list:[]},enable_comment:!0},t.init(r,i,a))},o=function(e,t,n){var r,i;return i="create-"+n,"home.home"===e.current.name&&(r=i+"-from-home"),"creator.home"===e.current.name&&(r=i+"-from-creator"),"magazine.home"===e.current.name&&(r=i+"-from-magazine"),"showTextNoteFriendly"===e.current.name&&(r=i+"-from-note"),t.eventTrack(r,{category:"button",label:"link"})}})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("multipleUserPick",["UserSearches","$timeout",function(e,t){return{restrict:"A",templateUrl:"/templates/common/multiple_user_pick",scope:{data:"=",options:"=",email:"@"},link:function(n){var r,i,a,o,s,l,c,u,d;if(r=/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,n.suggests=[],void 0===n.data.picked&&(n.data.picked=[]),n.search_api_calling=!1,n.inputing_username=null,n.hide_already_picked=n.options&&n.options.hideAlreadyPicked===!0,n.cursor="initial",n.loading=!1,n.isAllLoaded=!1,l=20,s="off"===n.email,o=[],a=[],n.data.already_picked_user_tags)for(d=n.data.already_picked_user_tags,c=0,u=d.length;u>c;c++)i=d[c],i.user_id&&o.push(i.user_id),i.email&&a.push(i.email);return n.$watch("search_text",function(i){var c;if(!i)return n.cursor="initial",n.just_picked_user_tags=[],n.suggests=[],n.loading=!1,void(n.isAllLoaded=!1);if(!n.search_api_calling)return n.loading=!1,n.isAllLoaded=!1,n.inputing_username=null===i.match(r),n.cursor="initial",n.just_picked_user_tags=[],n.just_picked_user_tags=n.data.picked.map(function(e){return e.user_tag}),s||n.inputing_username?e.get({q:i,size:l,cursor:{user:n.cursor}}).$promise.then(function(e){var r,i,a,s,l,c,u,d;for(n.search_api_calling=!1,n.cursor=e.data.cursor.user,n.suggests=[],r=0,u=e.data.users.contents,d=[],i=l=0,c=u.length;c>l;i=++l)s=u[i],n.just_picked_user_tags.indexOf(s.urlname)>=0||(a=o.indexOf(s.id)>=0,n.suggests.push({is_picked:a,user_id:s.id,urlname:s.urlname,nickname:s.nickname,user_tag:s.urlname,image:s.profileImageUrl})),d.push(i===e.data.users.contents.length-1?t(function(){var e;return e=angular.element(".user-select__dropdown"),e.on("scroll",function(){var t;t=30,e.scrollTop()>e[0].scrollHeight-e.height()-t&&n.nextPage()})},500):void 0);return d}):(n.suggests=[],c=a.indexOf(n.search_text)>=0,n.suggests.push({is_picked:c,email:!0,user_tag:n.search_text}))}),n.addItem=function(e){var t,r,i,a,o;if(r=n.suggests[e],!r.is_picked&&(n.inputing_username||null!==n.search_text.match(/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/))){for(o=n.data.picked,i=0,a=o.length;a>i;i++)if(t=o[i],t.user_tag&&r.user_tag&&t.user_tag===r.user_tag)return n.suggests=[],void(n.search_text=null);return r&&n.data.picked.push(r),n.suggests=[],n.search_text=null}},n.removePickedItem=function(e){var t,r;return r=n.data.picked[e],t=n.data.picked.indexOf(r),n.data.picked.splice(t,1)},n.nextPage=function(){return n.loading||n.isAllLoaded?void 0:(n.loading=!0,e.get({q:n.search_text,size:l,cursor:{user:n.cursor}}).$promise.then(function(e){var t,r,i,a,s,l,c,u;for(n.cursor=e.data.cursor.user,t=0,0===e.data.users.contents.length&&(n.isAllLoaded=!0),c=e.data.users.contents,u=[],r=s=0,l=c.length;l>s;r=++s)a=c[r],n.just_picked_user_tags.indexOf(a.urlname)>=0||(i=o.indexOf(a.id)>=0,n.suggests.push({is_picked:i,user_id:a.id,urlname:a.urlname,nickname:a.nickname,user_tag:a.urlname,image:a.profileImageUrl})),u.push(n.loading=!1);return u}))}}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("multipleUserPickModal",["Popeye","$state","$stateParams",function(e){return{restrict:"A",scope:{invitable:"=",data:"=",role:"=",isPremium:"=",max:"@",process:"&",callback:"&"},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/multiple_user_pick",controller:["$scope","$rootScope","$upload","Bridge","MagazineNoteRearrange",function(e){return e.initModal=function(){return e.data=t.data,e.invitablePrice=t.invitable.price||0,e.pickWithRatios=e.invitablePrice>0&&"root"===t.role,e.role=t.role,e.isPremium=t.isPremium,e.max=t.max,e.options={hideAlreadyPicked:!0},e.page="pick",e.state="ready"},e.complete=function(){var n,r,i,a,o,s;if(e.processing=!0,r={user_ids:e.data.picked.map(function(e){return e.user_id})},e.pickWithRatios){for(i={},s=e.editors,a=0,o=s.length;o>a;a++)n=s[a],i[n.user_id]=n.distribution_ratio;r.ratios=i}return t.process()(r).then(function(){return e.page="done"},function(t){return e.page="error",t?e.message=t.message:void 0})},e.proceed=function(){var n;return n=e.data.picked.map(function(e){return e.user_profile_image_path=e.image,{role:"member",user_id:e.user_id,distribution_ratio:0,user:e}}),e.editors=t.data.already_picked_editors.concat(n),e.checkAmount(),e.pageTo("ratio"),e.state="ready"},e.checkAmount=function(){var t,n,r,i,a;for(n=0,a=e.editors,r=0,i=a.length;i>r;r++)t=a[r],n+=t.distribution_ratio;return e.validAmount=100===n},e.linkTo=function(e){return location.href=e},e.pageTo=function(t){return e.page=t},e.changeState=function(t){return e.state=t},e.close=function(){var r;return r=t.callback(),r&&"done"===e.page&&r(),n.close()}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("nameUnique",["$http",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,i){return t.$watch(function(){return i.$modelValue},function(t){return t?e({method:"POST",url:"/api/v1/sessions/check_urlname",data:{urlname:t},timeout:200}).success(function(e){return i.$setValidity("unique",e.data.valid)}).error(function(){return console.log("Error occurred")}):i.$setValidity("unique",!0)})}}}])}.call(this),function(){"use strict";var e,t,n,r;angular.module("noteApp").directive("settingMenu",function(){var t;return t={templateUrl:"/templates/common/navbar_setting_menu",restrict:"E",scope:{user:"="},link:function(t,n){var i,a;return i=angular.element(document.querySelector("div.dropdown.setting")),a=n.find("#dropdown-toggle"),n.on("click",function(e){return e.preventDefault(),r(i,a)}),n.find("li").on("click","a",function(t){return t.stopPropagation(),e(i,a)})}}}),r=function(r,i){return t(r)?e(r,i):n(r,i)},n=function(n,r){var i;return n.css("display","block"),r.addClass("active"),i=angular.element(document),i.on("mouseup",function(i){var a;return i.preventDefault(),a=angular.element(i.target),a.hasClass("on-navbar-button")||a.hasClass("nav-bar-notification-read-more")||a.hasClass("active")||!t(n)?void 0:e(n,r)})},e=function(e,t){var n;return e.css("display","none"),t.removeClass("active"),n=angular.element(document),n.off("mouseup")},t=function(e){return"none"!==e.css("display")}}.call(this),function(){angular.module("noteApp").directive("newUserBadge",["$rootScope",function(){var e;return e={template:"<span class='icon-new-user' ng-if='note.is_new'>NEW</span>",restrict:"AE"}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("ngHtml",function(){return function(e,t,n){return e.$watch(n.ngHtml,function(e){return t[0].innerHTML=e})}})}.call(this),function(){"use strict";angular.module("noteApp").directive("noteAuthLink",function(){return{restrict:"A",scope:{provider:"=",follow:"=",redirect:"=",from:"=",nkey:"=",nourlname:"=",like:"=",likables:"=",magazine:"="},link:function(e,t){return t.on("click",function(){var t,n,r,i,a,o,s,l;switch(t="",e.provider){case"twitter":t="/auth/twitter?x_auth_access_type=read&";break;case"facebook":t="/auth/facebook?";break;default:return}return t+=e.nourlname?"no_urlname=1":e.follow?"follow="+(null!=(n=e.follow)?n:"")+"&redirectPath="+(null!=(r=e.redirect)?r:""):e.magazine?"magazineFollow="+(null!=(i=e.magazine)?i:"")+"&redirectPath="+(null!=(a=e.redirect)?a:""):"likable_id="+(null!=(o=e.like)?o:"")+"&likables="+(null!=(s=e.likables)?s:"")+"&redirectPath="+(null!=(l=e.redirect)?l:""),e.from&&(t+="&from="+e.from),e.nkey&&(t+="&nkey="+e.nkey),location.href=t})}}})}.call(this),function(){"use strict";var e=[].slice;NOTE.CTRL.NoteListCtrl=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g){this.$state=e,this.$scope=t,this.$rootScope=n,this.$stateParams=r,this.$location=i,this.NoteListContents=a,this.Popeye=o,this.NoteListArchives=s,this.NoteListSticker=l,this.NoteListStickerNote=c,this.CustomDomainContext=u,this.PostingSettingStash=d,this.NotePreviewAccessTokenPublisher=p,this.AutoHideNotification=h,this.clipboard=m,this.$timeout=f,this.UserAgent=g,this.displayMode="view",this.initProps(),this.setTabTitle(),this.loadArchives(),this.loadContents(),this.setCallbacks(),this.$rootScope.$on("createNoteFromNavBar",function(){return location.reload()}),this.$rootScope.$on("createNoteDraftFromNavBar",function(){return location.reload()})}return e.injects=["$state","$scope","$rootScope","$stateParams","$location","NoteListContents","Popeye","NoteListArchives","NoteListSticker","NoteListStickerNote","CustomDomainContext","PostingSettingStash","NotePreviewAccessTokenPublisher","AutoHideNotification","clipboard","$timeout","UserAgent"],e.prototype.initProps=function(){return this.notes=[],this.status=this.$stateParams.status,this.startDate=this.$stateParams.from,this.endDate=this.$stateParams.to,this.magazineId=this.$stateParams.magazine_id,this.categoryId=this.$stateParams.category_id,this.stickerId=this.$stateParams.label_id,this.userId=this.$stateParams.user_id,this.noteArchivesSelects=[],this.isLoggedIn=!1,this.$scope.noteModel={notes:[]},this.magazines=[],this.categories=[],this.stickers=[],this.currentPage=0,this.isLoading=!1,this.isLastPage=!1,this.notesTotalCount=0,this.noteStatuses={published:"\u516c\u958b\u4e2d",draft:"\u4e0b\u66f8\u304d",reserved:"\u4e88\u7d04"},this.noteStatusTabTitles={published:"\u516c\u958b\u4e2d",draft:"\u4e0b\u66f8\u304d",reserved:"\u4e88\u7d04\u6295\u7a3f"},this.isEmptyContent=!1,this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.currentUser=window.PREFETCH.NOTE.user,this.enableCategoryFilter=window.PREFETCH.NOTE.enable_category_filter,this.enableStickerFilter=window.PREFETCH.NOTE.enable_sticker_filter,this.flipStatus=!1,this.flipDate=!1,this.flipCategory=!1,this.flipMagazine=!1,this.flipUser=!1,this.stashedTabTitles={},this.toggledNotes=[],this.toggledNotesIds=[],this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.currentUser.urlname,this.dateFromParam=this.$stateParams.from,this.dateToParam=this.$stateParams.to,this.enableLimitedEditPrivMode=window.PREFETCH.NOTE.enable_limited_edit_priv_mode,this.searchQuery=this.$stateParams.q,this._searchQuery=this.$stateParams.q},e.prototype.setTabTitle=function(){var e,t,n,r,i,a,o,s,l,c,u,d;return s=this.PostingSettingStash.stashPop(),a=this.$stateParams.magazine_id&&s?s.magazine:null,r=this.$stateParams.magazine_id?function(){var e,t,r,i;for(r=this.magazines,i=[],e=0,t=r.length;t>e;e++)n=r[e],parseInt(n.id,10)===parseInt(this.$stateParams.magazine_id,10)&&i.push(n.name);return i}.call(this)[0]:null,i=this.$stateParams.category_id&&s?s.category:null,t=this.$stateParams.category_id?function(){var t,n,r,i;for(r=this.categories,i=[],t=0,n=r.length;n>t;t++)e=r[t],parseInt(e.id,10)===parseInt(this.$stateParams.category_id,10)&&i.push(e.name);return i}.call(this)[0]:null,o=this.$stateParams.label_id&&s?s.sticker:null,u=this.$stateParams.label_id?function(){var e,t,n,r;for(n=this.stickers,r=[],e=0,t=n.length;t>e;e++)c=n[e],parseInt(c.id,10)===parseInt(this.$stateParams.label_id,10)&&r.push(c.name);return r}.call(this)[0]:null,l=this.$stateParams.user_id&&s?s.user:null,d=this.$stateParams.user_id&&this.searchedUser?this.searchedUser.name:null,this.statusTitle=this.$stateParams.status?this.$stateParams.magazine_id||this.$stateParams.category_id?a||i?this.noteStatusTabTitles[this.$stateParams.status]:r||t?this.noteStatusTabTitles[this.$stateParams.status]:"\u516c\u958b\u30b9\u30c6\u30fc\u30bf\u30b9":this.noteStatusTabTitles[this.$stateParams.status]:"\u516c\u958b\u30b9\u30c6\u30fc\u30bf\u30b9",this.dateTitle=this.$stateParams.magazine_id||this.$stateParams.category_id?a||i?this.setDateTitle():r||t?this.setDateTitle():"\u65e5\u6642":this.setDateTitle(),this.stickerTitle=this.$stateParams.label_id?o?o:u?u:"\u30e9\u30d9\u30eb":"\u30e9\u30d9\u30eb",this.categoryTitle=this.$stateParams.category_id?i?i:t?t:"\u30ab\u30c6\u30b4\u30ea":"\u30ab\u30c6\u30b4\u30ea",this.magazineTitle=this.$stateParams.magazine_id?a?a:r?r:"\u30de\u30ac\u30b8\u30f3":"\u30de\u30ac\u30b8\u30f3",this.userTitle=this.$stateParams.user_id?l?l:d?d:null:null},e.prototype.setDateTitle=function(){var e,t,n,r,i,a,o,s,l;return e="",this.$stateParams.from&&this.$stateParams.to?(i=this.$stateParams.from.split("-"),a=new Date(i[0],i[1]-1,1),n=moment(a).format("YYYY-MM-DD"),s=this.$stateParams.to.split("-"),l=new Date(s[0],s[1],0),r=moment(l).format("YYYY-MM-DD"),this.$stateParams.from===n&&this.$stateParams.to===r?e=moment(a).format("YYYY\u5e74M\u6708"):(o=moment(this.$stateParams.from).format("YYYY\u5e74M\u6708D\u65e5"),t=moment(this.$stateParams.to).format("YYYY\u5e74M\u6708D\u65e5"),e=o===t?o:""+o+"\u301c"+t)):this.$stateParams.from?e=""+moment(this.$stateParams.from).format("YYYY\u5e74M\u6708D\u65e5")+"\u4ee5\u964d":this.$stateParams.to?e=""+moment(this.$stateParams.to).format("YYYY\u5e74M\u6708D\u65e5")+"\u4ee5\u524d":this.$stateParams.from||this.$stateParams.to||(e="\u65e5\u6642"),e},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this)),this.$scope.$on("$NoteListContensDelete",function(t,n){var r;return r=e.toggledNotes.indexOf(n.id),e.toggledNotes.splice(r,1),r=e.toggledNotesIds.indexOf(n.id),e.toggledNotesIds.splice(r,1),r=e.notes.indexOf(n),e.notes.splice(r,1),e.notesTotalCount=e.notesTotalCount-1})},e.prototype.changeCondition=function(e,t,n,r,i,a,o){return"all"===e?(this.status=null,this.statusTitle="\u30b9\u30c6\u30fc\u30bf\u30b9",this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)):null!==e&&(this.status=e,this.statusTitle=this.noteStatusTabTitles[e],this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)),"all"===t&&"all"===n?(this.startDate=null,this.endDate=null,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)):t&&n?(this.startDate=t,this.endDate=n,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)):t?(this.startDate=t,this.endDate=null,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)):n&&(this.endDate=n,this.startDate=null,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)),"all"===r?(this.sticker=null,this.stickerId=null,this.stickerTitle="\u30e9\u30d9\u30eb",this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)):null!==r&&(this.sticker=r,this.stickerId=this.sticker.id,this.stickerTitle=r.name,this.stashedTabTitles.sticker=r.name,this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)),"all"===i?(this.category=null,this.categoryId=null,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle="\u30ab\u30c6\u30b4\u30ea",this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)):null!==i&&(this.category=i,this.categoryId=this.category.id,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle=i.name,this.stashedTabTitles.category=i.name,this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle)),"all"===a?(this.magazine=null,this.magazineId=null,this.magazineTitle="\u30de\u30ac\u30b8\u30f3",this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle)):null!==a&&(this.magazine=a,this.magazineId=this.magazine.id,this.magazineTitle=a.name,this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.stashedTabTitles.magazine=a.name,this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle)),null!==o&&(this.userId=o,this.userTitle&&(this.stashedTabTitles.user=this.userTitle),this.stickerTitle&&(this.stashedTabTitles.sticker=this.stickerTitle),this.magazineTitle&&(this.stashedTabTitles.magazine=this.magazineTitle),this.categoryTitle&&(this.stashedTabTitles.category=this.categoryTitle)),this.PostingSettingStash.stash(this.stashedTabTitles),this.$state.go("note_list",{status:this.status,from:this.startDate,to:this.endDate,label_id:this.stickerId,category_id:this.categoryId,magazine_id:this.magazineId,user_id:this.userId},{reload:!0})},e.prototype.loadArchives=function(){return this.NoteListArchives.get({},function(e){return function(t){var n,r,i,a,o,s;for(o=t.data,s=[],i=0,a=o.length;a>i;i++)r=o[i],s.push(function(){var e,t,i,a;for(i=r.details,a=[],e=0,t=i.length;t>e;e++)n=i[e],a.push(this.noteArchivesSelects.push({key:n.summaryDate,value:""+r.year+"\u5e74"+n.month+"\u6708"}));return a}.call(e));return s}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.loadContents=function(e){return null==e&&(e=1),this.isLoading=!0,this.currentPage=e,this.NoteListContents.get({status:this.status,page:e,from:this.startDate,to:this.endDate,label_id:this.stickerId,category_id:this.categoryId,magazine_id:this.magazineId,user_id:this.userId},function(e){return function(t){var n,r,i,a;for(e.isEmptyContent=0===t.data.notes.length,a=t.data.notes,r=0,i=a.length;i>r;r++)n=a[r],e.notes.push(n);return e.magazines=t.data.magazines,e.categories=t.data.categories,e.stickers=t.data.stickers,e.attachingNoteStickers=t.data.attachingNoteStickers,e.notesTotalCount=t.data.totalCount,e.searchedUser=t.data.searchedUser,e.setTabTitle(),e.isLoading=!1,e.isLastPage=t.data.isLastPage}}(this),function(e){return function(t){return console.log(t),e.isLoading=!1}}(this))},e.prototype.getPreviewLink=function(e){var t,n,r;return t=e.key,r=void 0,n=this.UserAgent.original.toLowerCase(),this.NotePreviewAccessTokenPublisher.post({note_key:e.key}).$promise.then(function(t){return function(i){var a,o,s;return s="development"===window.PREFETCH.NOTE.conf.env?"http":"https",a=window.PREFETCH.NOTE.host,o="preview/"+e.key,r=""+s+"://"+a+"/"+o+"?prev_access_key="+i.data.preview_access_token,n.indexOf("firefox")>=0?window.open(r,"_blank"):t.AutoHideNotification.success("\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002")}}(this)),n.indexOf("firefox")>=0?void 0:this.$timeout(function(e){return function(){return e.clipboard.copyText(r)}}(this),1e3)},e.prototype.goPreview=function(e){return null==e&&(e=null),this.NotePreviewAccessTokenPublisher.post({note_key:e.key}).$promise.then(function(){return function(t){var n,r,i,a;return i="development"===window.PREFETCH.NOTE.conf.env?"http":"https",n=window.PREFETCH.NOTE.host,r="preview/"+e.key,a=""+i+"://"+n+"/"+r+"?prev_access_key="+t.data.preview_access_token,window.open(a,"_blank")}}(this))},e.prototype.snakizeNoteProperties=function(e){return e.external_url=e.externalUrl,e.audio?e.audio.artist_name=e.audio.artistName:void 0},e.prototype.goTextNoteEdit=function(e){var t,n;return null==e&&(e=null),n=e.key,"draft"===e.status?this.$location.url("/notes/"+n+"/edit").replace():e.noteDraft?t=this.Popeye.openModal({templateUrl:"/templates/modal/confirm_textnote_edit",controller:["$resource","$scope",function(e,r){return r.startReEditNote=function(){return t.close(),this.$state.go("editTextNote",{key:n,reedit:!0})},r.editExistsNote=function(){return t.close(),this.$state.go("editTextNote",{key:n})}}]}):this.$state.go("editTextNote",{key:n})},e.prototype.toggleNote=function(e,t){var n;return e.target.checked?this.toggledNotes.length<20?(e.target.checked=!0,this.toggledNotes.push(t),this.toggledNotesIds.push(t.id)):(alert("\u4e00\u5ea6\u306b\u524a\u9664\u3067\u304d\u308b\u306e\u306f20\u4ef6\u307e\u3067\u3067\u3059\u3002"),e.target.checked=!1):(n=this.toggledNotes.indexOf(t),this.toggledNotes.splice(n,1),n=this.toggledNotesIds.indexOf(t.id),this.toggledNotesIds.splice(n,1),e.target.checked=!1)},e.prototype.setPikaday=function(){var e,t;return t=this,e=this.Popeye.openModal({templateUrl:"/templates/modal/renewal/select_date",controller:["$scope","$resource","$q","$window",function(n){return n.ok=function(){var r,i,a,o;return i=null,r=null,a=document.getElementById("start_date").value,o=document.getElementById("end_date").value,a&&(n.startPicker&&n.startPicker.getDate()?(t.startPicker=n.startPicker,i=moment(t.startPicker.getDate()).format("YYYY-MM-DD")):t.startPicker&&t.startPicker.getDate()&&(i=moment(t.startPicker.getDate()).format("YYYY-MM-DD"))),o&&(n.endPicker&&n.endPicker.getDate()?(t.endPicker=n.endPicker,r=moment(t.endPicker.getDate()).format("YYYY-MM-DD")):t.endPicker&&t.endPicker.getDate()&&(r=moment(t.endPicker.getDate()).format("YYYY-MM-DD"))),t.changeCondition(null,i,r,null,null,null,null),e.close()},n.cancel=function(){return t.startPicker=n.startPicker,e.close()},n.changeDate=function(e){return"from"===e?(t.startPicker=n.startPicker,n.endPicker.setMinDate(n.startPicker.getDate())):"to"===e?(t.endPicker=n.endPicker,n.startPicker.setMaxDate(n.endPicker.getDate())):void 0}}]}),e.opened.then(function(){var e,n,r,i,a;return t.dateFromParam&&(r=document.getElementById("start_date"),r.value=moment(t.dateFromParam).format("YYYY\u5e74M\u6708D\u65e5"),e=new Date(t.dateFromParam),i=new Pikaday,i.setDate(t.dateFromParam),t.startPicker=i),t.dateToParam?(a=document.getElementById("end_date"),a.value=moment(t.dateToParam).format("YYYY\u5e74M\u6708D\u65e5"),e=new Date(t.dateToParam),n=new Pikaday,n.setDate(t.dateToParam),t.endPicker=n):void 0})},e.prototype.setStickerInfo=function(e,t){var n,r;return r=this,n=this.Popeye.openModal({templateUrl:"/templates/modal/renewal/sticker",controller:["$scope","$resource","$q","$window",function(i){return i.sticker="edit"===e?t:{},i.type=e,i.ok=function(){return"new"===e&&r.createSticker(i.sticker),"edit"===e&&r.editSticker(i.sticker),n.close()},i.cancel=function(){return n.close()},i["delete"]=function(){return r.deleteSticker(i.sticker,function(){return n.close()})},i.selectStickerColor=function(e){return i.sticker.color=e}}]})},e.prototype.createSticker=function(e){return this.NoteListSticker.create({name:e.name,color:e.color},function(e){return function(t){return e.stickers.push(t.data)}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.editSticker=function(e){return this.NoteListSticker.update({id:e.id,name:e.name,color:e.color},function(t){return function(){var n;return n=t.stickers.indexOf(e),t.stickers[n].name=e.name,t.stickers[n].color=e.color,t.stickerTitle=e.name}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.deleteSticker=function(e,t){return null==t&&(t=null),this.NoteListSticker["delete"]({id:e.id},function(n){return function(){var r;return r=n.stickers.indexOf(e),n.stickers.splice(r,1),"function"==typeof t?t():void 0}}(this),function(n){return function(r){return 424!==r.status?console.log(r):confirm("\u3053\u306e\u30e9\u30d9\u30eb\u306b\u8a18\u4e8b\u304c\u7d10\u4ed8\u3044\u3066\u3044\u307e\u3059\u304c\u3001\u524a\u9664\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")?n.NoteListSticker["delete"]({id:e.id,force:1},function(){var r;return r=n.stickers.indexOf(e),n.stickers.splice(r,1),n.stickerId===e.id.toString()?n.changeCondition(null,null,null,"all",null,null,null):n.changeCondition(null,null,null,null,null,null,null),"function"==typeof t?t():void 0},function(e){return console.log(e)}):void 0}}(this))},e.prototype.deleteNotes=function(e){var t,n;return n=this,t=this.Popeye.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$scope","$resource","$q","$window",function(r,i,a){return r.ok=function(){var n,i,o,s;for(i=[],o=0,s=e.length;s>o;o++)n=e[o],i.push(r.deleteNote(n));return a.all(i).then(function(){return t.close()})["catch"](function(){return alert("\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")})},r.cancel=function(){return t.close()},r.deleteNote=function(e){var t;return t=a.defer(),"draft"===e.status?i("/api/v1/text_notes/draft_delete")["delete"]({id:e.id},function(){var r;return n.$rootScope.$broadcast("$NoteListContensDelete",e),r=n.toggledNotes.indexOf(e),n.toggledNotes.splice(r,1),t.resolve()},function(){return t.reject()}):i("/api/v1/notes/"+e.id)["delete"]({},function(){var r;return n.$rootScope.$broadcast("$NoteListContensDelete",e),r=n.toggledNotes.indexOf(e),n.toggledNotes.splice(r,1),t.resolve()},function(){return t.reject()}),t.promise}}]})},e.prototype.getDividedStickers=function(){return this.flipStickerAttach?void 0:this.NoteListSticker.get({"note_ids[]":this.toggledNotesIds},function(e){return function(t){return e.dividedStickers=t.data}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.attachSticker=function(e){return this.NoteListStickerNote.create({sticker_id:e.id,note_ids:this.toggledNotesIds},function(t){return function(){var n,r,i,a,o,s;for(o=t.toggledNotes,s=[],i=0,a=o.length;a>i;i++)r=o[i],n=t.notes.indexOf(r),s.push(t.notes[n].stickers.push(e));return s}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.removeSticker=function(e){return this.NoteListStickerNote["delete"]({sticker_id:e.id,"note_ids[]":this.toggledNotesIds},function(t){return function(){var n,r,i,a,o,s,l,c;for(l=t.toggledNotes,c=[],o=0,s=l.length;s>o;o++)i=l[o],n=t.notes.indexOf(i),a=t.notes[n].stickers.map(function(e){return e.id}),r=a.indexOf(e.id),c.push(-1!==r?t.notes[n].stickers.splice(r,1):void 0);
return c}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.clearAllChecks=function(){var e,t,n,r,i;for(this.toggledNotes=[],this.toggledNotesIds=[],t=document.getElementsByClassName("list-checkbox"),i=[],n=0,r=t.length;r>n;n++)e=t[n],i.push(e.checked=!1);return i},e.prototype.paging=function(){return this.currentPage>0&&!this.isLoading&&!this.isLastPage?this.loadContents(this.currentPage+1,this.status,this.month,this.magazine):void 0},e.prototype.startDateFormatter=function(e,t){var n,r,i;return n=e.split("-"),n[2]?(r=new Date(n[0],n[1]-1,n[2]),i=moment(r).format(t)):(r=new Date(n[0],n[1]-1,1),i=moment(r).format(t)),i},e.prototype.endDateFormatter=function(e,t){var n,r,i;return n=e.split("-"),n[2]?(r=new Date(n[0],n[1]-1,n[2]),i=moment(r).format(t)):(r=new Date(n[0],n[1],0),i=moment(r).format("YYYY-MM-DD")),i},e.prototype.MonthlyDateFormatter=function(e,t){var n,r,i;return i=e.split("-"),n=new Date(i[0],i[1]-1,1),r=moment(n).format(t)},e.prototype.listStatusClass=function(e){return{"p-noteListStatus--published":"published"===e.status,"p-noteListStatus--reserved":"reserved"===e.status,"p-noteListStatus--draft":"draft"===e.status}},e}(),angular.module("noteApp").directive("noteList",["$timeout","$document",function(t,n){return{restrict:"E",scope:{},templateUrl:"/templates/note_list/index",controller:e.call(NOTE.CTRL.NoteListCtrl.injects).concat([NOTE.CTRL.NoteListCtrl]),controllerAs:"$ctrl",link:function(e){return n.on("click",function(n){return t($(n.target).hasClass("status-tab")?function(){return function(){return e.$ctrl.flipStatus=e.$ctrl.flipStatus?!1:!0,e.$ctrl.flipDate=!1,e.$ctrl.flipSticker=!1,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=!1}}(this):$(n.target).hasClass("date-tab")?function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=e.$ctrl.flipDate?!1:!0,e.$ctrl.flipSticker=!1,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=!1}}(this):$(n.target).hasClass("sticker-tab")?function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=!1,e.$ctrl.flipSticker=e.$ctrl.flipSticker?!1:!0,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=!1}}(this):$(n.target).hasClass("category-tab")?function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=!1,e.$ctrl.flipCategory=e.$ctrl.flipCategory?!1:!0,e.$ctrl.flipSticker=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=!1}}(this):$(n.target).hasClass("magazine-tab")?function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=!1,e.$ctrl.flipSticker=!1,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=e.$ctrl.flipMagazine?!1:!0,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=!1}}(this):$(n.target).hasClass("sticker-attach-button")?function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=!1,e.$ctrl.flipSticker=!1,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=e.$ctrl.flipStickerAttach?!1:!0,e.$ctrl.flipUser=!1}}(this):$(n.target).hasClass("user-tab")?function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=!1,e.$ctrl.flipSticker=!1,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=e.$ctrl.flipUser?!1:!0}}(this):function(){return function(){return e.$ctrl.flipStatus=!1,e.$ctrl.flipDate=!1,e.$ctrl.flipSticker=!1,e.$ctrl.flipCategory=!1,e.$ctrl.flipMagazine=!1,e.$ctrl.flipStickerAttach=!1,e.$ctrl.flipUser=!1}}(this))})}}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/note_price_setting.html","<p class='post-ui__name'>\u8ca9\u58f2\u8a2d\u5b9a</p> <div class='post-ui__price'> <label> <input name='paidFlag' ng-checked=\"data.radioSalesKind == 'free'\" ng-click='resetPaidFlag()' type='radio'><span class='post-ui__radio-name'>\u7121\u6599</span></label> <label class='post-ui__pay'> <input id='note_price_paid_flag_checkbox_on' name='paidFlag' ng-checked=\"data.radioSalesKind == 'pay' || data.radioSalesKind == 'prior_sales'\" ng-click='setPaidFlag()' type='radio'><span class='post-ui__radio-name'>\u6709\u6599</span></label> <input class='post-ui__pay-input' name='price' ng-change='onPriceChange()' ng-model='note.price' ng-pattern='/(^0$|^[1-9][0-9]*$)/' ng-required=\"data.radioSalesKind == 'pay'\" ng-show=\"data.radioSalesKind == 'pay' || data.radioSalesKind == 'prior_sales'\"> <span class='space-r-1h' ng-show=\"data.radioSalesKind == 'pay' || data.radioSalesKind == 'prior_sales'\"> \u5186 </span> <label ng-if=\"user.can_sell_on_first_come_note &amp;&amp; (data.radioSalesKind == 'pay' || data.radioSalesKind == 'prior_sales')\"> <input name='paidFlag' ng-checked=\"data.radioSalesKind == 'prior_sales'\" ng-click='setPriorSale()' ng-model='note.prior_sale_activated' type='checkbox'><span class='post-ui__radio-name'>\u6570\u91cf\u9650\u5b9a\u3067\u8ca9\u58f2\u3059\u308b</span></label> </div>")}]),angular.module("noteApp").directive("notePriceSetting",function(){return{templateUrl:"common/note_price_setting.html",restrict:"A",scope:{note:"=",user:"=",data:"=",form:"="},controller:["$scope",function(e){var t;return(null===e.note.price||"undefined"==typeof e.note.price)&&(e.note.price=0),e.note.paid_flag=e.note.price>0,e.note.prior_sale_activated=e.note.prior_sale&&e.note.prior_sale.activated,e.note.current_price=e.note.price,e.data.radioSalesKind=e.note.prior_sale_activated?"prior_sales":e.note.price>0?"pay":"free",t=function(){var t;for(t in e.data.magChecks)e.data.magChecks[t].checked=!1,e.data.magChecks[t].disabled=e.data.magChecks[t].magazine.is_suspended;return e.form.price.$setValidity("min",!0),e.form.price.$setValidity("max",!0)},e.resetPaidFlag=function(){return e.note.paid_flag=!1,e.note.price=0,e.data.radioSalesKind="free",e.data.magazineIds=[],e.data.limited=!1,e.data.limitedConfigurable=!1,e.note.prior_sale_activated=!1,t()},e.setPaidFlag=function(){return e.note.paid_flag=!0,e.note.price=100,e.data.radioSalesKind="pay","enableDownload"in e.note&&(e.note.enableDownload=!0),e.data.magazineIds=[],e.data.limited=!1,e.note.prior_sale_activated=!1,t()},e.setPriorSale=function(){return e.note.paid_flag=!0,e.data.radioSalesKind=e.note.prior_sale_activated===!0?"prior_sales":"pay",e.note.price=e.note.price||100,e.note.first_served_sales_count=e.note.first_served_sales_count||10,t()},e.onPriceChange=function(){return e.note.paid_flag&&e.note.price&&e.note.price.match(/(^0$|^[1-9][0-9]*$)/)?(e.form.price.$setValidity("min",e.note.price>=100),e.note.max_price=5e4,e.user.can_remove_price_restriction||e.note.current_price===parseInt(e.note.price)||(e.note.max_price=1e4),e.form.price.$setValidity("max",e.note.price<=e.note.max_price)):void 0}}]}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/note_prior_sale_setting.html","<div class='limited-settings' ng-if=\"user.can_sell_on_first_come_note && data.radioSalesKind == 'prior_sales'\"> <div class='limited-settings__value'> \u8ca9\u58f2\u30ce\u30fc\u30c8\u6570<span class='limited-settings__count' ng-if='note.change_prior_sale_count == false'>{{ ::note.first_served_sales_count }}\u30ce\u30fc\u30c8 <span ng-if='note.stock_count != undefined'><span class='txt-grey'>(</span><a class='txt-green txt-small' ng-click='enable_edit_sale_count()'><span ng-show='note.stock_count == 0'>\u518d\u8ca9</span><span ng-show='note.stock_count > 0'>\u5909\u66f4</span></a><span class='txt-grey'>)</span></span></span><span ng-if='note.change_prior_sale_count'> <input class='limited-settings__input' name='first_served_sales_count' ng-change='onPriorSaleCountSettingChange()' ng-model='note.first_served_sales_count' ng-pattern='/(^0$|^[1-9][0-9]*$)/'> \u30ce\u30fc\u30c8 </span> <!-- kawakami san design fix needed --> </div> <div class='limited-settings__value' ng-if='note.stock_count != undefined'> \u8ca9\u58f2\u53ef\u80fd\u6570\u3042\u3068 <span class='limited-settings__count'><span ng-if='note.stock_count == 0'>\u58f2\u308a\u5207\u308c</span><span ng-if='note.stock_count > 0'><span>{{ note.prior_sale.stock_count }}</span><span class='slash txt-grey'>/</span><span class='txt-grey'>{{ ::note.first_served_sales_count }}\u30ce\u30fc\u30c8</span></span> </span> </div> </div>")}]),angular.module("noteApp").directive("notePriorSaleSetting",function(){return{templateUrl:"common/note_prior_sale_setting.html",restrict:"A",scope:{note:"=",data:"=",form:"=",user:"=",action:"@"},controller:["$scope",function(e){return e.note.change_prior_sale_count=void 0===e.note.prior_sale||null===e.note.prior_sale,null!=e.note.prior_sale&&(e.note.prior_sale_activated=e.note.prior_sale.activated,e.note.first_served_sales_count=e.note.prior_sale.first_served_sales_count.toString(),e.note.stock_count=e.note.prior_sale.stock_count),e.onPriorSaleCountSettingChange=function(){return"prior_sales"===e.data.radioSalesKind&&e.note.first_served_sales_count&&e.note.first_served_sales_count.match(/(^0$|^[1-9][0-9]*$)/)?e.form.first_served_sales_count.$setValidity("min",e.note.first_served_sales_count>=1):void 0},e.onPriorSalePriceSettingChange=function(){return"prior_sales"===e.data.radioSalesKind&&e.note.price&&e.note.price.match(/(^0$|^[1-9][0-9]*$)/)?(e.form.price.$setValidity("min",e.note.price>=100),e.form.price.$setValidity("max",e.note.price<=1e4)):void 0},e.enable_edit_sale_count=function(){return e.note.change_prior_sale_count=!0}}]}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.$rootScope=e,this.editorTips=localStorage.getItem("tips_open_status")?null!=(t="true"===localStorage.getItem("tips_open_status"))?t:{"true":!1}:!0}return e.injects=["$rootScope"],e.prototype.toggleTips=function(){return this.editorTips=!this.editorTips,localStorage.setItem("tips_open_status",this.editorTips)},e}(),angular.module("noteApp").directive("noteTips",function(){return{restrict:"E",scope:{},templateUrl:"/templates/note_tips/index",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("magazinePaywall",function(){return{restrict:"E",scope:{},bindToController:{note:"=",isLoggedIn:"="},templateUrl:"/templates/notes/magazine_paywall",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n,r,i,a,o,s){var l;this.$rootScope=e,this.$scope=n,this.$window=r,this.$timeout=i,this.$sce=a,this.$element=o,this.$filter=s,this.sanitizeNode=t(this.sanitizeNode,this),this.doc=this.$window.document,this.bodyElem=this.$element[0],this.attachEvents(),l=this.sanitizeBody(this.note.body),this.sanitizedBody=this.$sce.trustAsHtml(l.body),this.$rootScope.contentLoading=!1,this.$timeout(function(e){return function(){var t,n,r,i,a;for(e.setPaywallLine(),i=l.embedKeys,a=[],n=0,r=i.length;r>n;n++)t=i[n],a.push(e.setEmbeddedContent(t));return a}}(this),0)}return e.$inject=["$rootScope","$scope","$window","$timeout","$sce","$element","$filter"],e.prototype.attachEvents=function(){var e;return e=this.onIframeMessage.bind(this),this.$window.removeEventListener("message",e),this.$window.addEventListener("message",e),this.$scope.$on("$destroy",function(t){return function(){return t.$window.removeEventListener("message",e)}}(this))},e.prototype.sanitizeBody=function(e){var t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_;if(!e)return{body:null,embedKeys:[]};for(h=this.doc.createElement("div"),h.innerHTML=e.replace(/<\/?script[^>]*>/gi,""),r=[],b=h.childNodes,f=0,v=b.length;v>f;f++){for(l=b[f],l.nodeType===Node.TEXT_NODE&&(a=this.doc.createElement("p"),a.textContent=l.textContent,l.parentNode.replaceChild(a,l),l=a),s=l.nodeName.toLowerCase(),c=this.doc.createElement(s),m=l.getAttribute("name"),d=l.getAttribute("style"),p=l.getAttribute("class"),m&&c.setAttribute("name",this.$filter("sanitize")(m)),d&&c.setAttribute("style",this.$filter("sanitize")(d)),p&&c.setAttribute("class",this.$filter("sanitize")(p)),"figure"===s&&(l.classList&&l.classList.contains("image-wrapper")?(i="image-wrapper",l.classList.contains("image-with-caption")&&(i+=" image-with-caption"),c.setAttribute("class",i)):(n=l.getAttribute("embedded-content-key"),u=l.getAttribute("embedded-service"),n&&c.setAttribute("embedded-content-key",this.$filter("sanitize")(n)),u&&c.setAttribute("embedded-service",this.$filter("sanitize")(u)),r.push(n),"external-article"===u&&(l.innerHTML=""))),"pre"!==s||c.classList.contains("p-textNoteCode")||c.classList.add("p-textNoteCode"),l.innerHTML&&(o=this.replaceFullSpace(l.innerHTML),"pre"!==s&&(o=this.$filter("hashtag")(o)),o=this.$filter("nofollow")(o),l.innerHTML=o),_=l.childNodes,g=0,y=_.length;y>g;g++)t=_[g],this.sanitizeNode(t);c.innerHTML=l.innerHTML,l.parentNode.replaceChild(c,l)}return{body:h.innerHTML,embedKeys:r}},e.prototype.sanitizeNode=function(e){var t,n,r,i,a,o,s,l,c,u,d;if(e.nodeType===Node.ELEMENT_NODE){if(i=e.nodeName.toLowerCase(),"a"!==i&&"img"!==i&&"br"!==i&&"iframe"!==i&&"figcaption"!==i){if(o=this.doc.createElement(i),s=e.getAttribute("style"),l=e.getAttribute("class"),s&&o.setAttribute("style",this.$filter("sanitize")(s)),l&&o.setAttribute("class",this.$filter("sanitize")(l)),e.childNodes&&e.childNodes.length>0)for(d=e.childNodes,c=0,u=d.length;u>c;c++)t=d[c],this.sanitizeNode(t);o.innerHTML=e.innerHTML,"code"===i&&(hljs.highlightBlock(o),o.classList.contains("p-textNoteCode__main")||o.classList.add("p-textNoteCode__main")),e.parentNode.replaceChild(o,e)}if("a"===i&&(n=e.querySelector("img"),n&&this.sanitizeNode(n)),"figcaption"===i&&(a=e.previousElementSibling,a&&"img"===a.nodeName.toLowerCase()&&a.classList.contains("getty-image")&&(r=this.doc.createElement("a"),r.href="http://welcome-to-gettyimages.jp/licensed-by-gettyimages/",r.target="_blank",r.textContent=this.$window.PREFETCH.NOTE.getty_caption||"Licensed by Getty Images",e.innerHTML=r.outerHTML)),"img"===i&&(e.removeAttribute("width"),e.removeAttribute("height"),e.getAttribute("style")&&this.$rootScope.isSmartPhone===!0))return e.removeAttribute("style")}},e.prototype.replaceFullSpace=function(e){return e?e.split("&#160;").join(" "):void 0},e.prototype.setEmbeddedContent=function(e){var t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g;for(r=null,f=this.note.embedded_contents,d=0,h=f.length;h>d;d++)if(n=f[d],n.key===e){r=n;break}if(r){if("external-article"===r.service){for(c=this.doc.createElement("div"),c.innerHTML=r.html_for_embed,g=c.querySelectorAll("script"),p=0,m=g.length;m>p;p++)l=g[p],u=this.doc.createTextNode(l.textContent),l.parentNode.replaceChild(u,l);r.html_for_embed=c.innerHTML}return t=this.bodyElem.offsetWidth,i=this.bodyElem.querySelector("[embedded-content-key='"+r.key+"']"),s=this.$window.document.createElement("div"),s.classList.add("fude-iframe-container"),a=this.$window.document.createElement("div"),a.classList.add("fude-iframe-container-"+r.service),this.$rootScope.isIPhone===!0&&(a.style.width=""+t+"px",a.style.overflow="auto"),s.appendChild(a),a.innerHTML=r.html_for_embed,this.$rootScope.isIPhone===!0&&(o=a.querySelector("iframe"),o&&(o.style.display="block",o.style.margin="0",o.style.width=""+t+"px",o.src=""+o.src+"?w="+t)),$(i).html(s.outerHTML)}},e.prototype.setPaywallLine=function(){var e,t;if(this.note.is_my_note||this.$rootScope.isPreview)return e=this.doc.querySelector("[name='"+this.note.separator+"']"),t=this.doc.querySelector("div.body-paywall-line-separator"),e&&t?e.parentNode.insertBefore(t,e.nextElementSibling):void 0},e.prototype.onIframeMessage=function(e){var t,n,r,i,a,o;if(e.data&&"string"==typeof e.data)return i=e.data.split("::"),3===i.length&&(r=i[0],a=i[1],o=i[2],n=this.articleBodyElem.querySelector("iframe[src='"+a+"']"),n&&"height"===r)?this.$rootScope.isIPhone===!0?(t=n.parentNode,t.style.height=""+o+"px",n.removeAttribute(r),n.style.height=""+o+"px"):(n.removeAttribute(r),n.setAttribute(r,o)):void 0},e}(),angular.module("noteApp").directive("noteBody",function(){return{restrict:"E",template:'<div class="body-wrapper" ng-bind-html="$ctrl.sanitizedBody"></div>',scope:{note:"=",isLoading:"="},controller:e,controllerAs:"$ctrl",replace:!1,bindToController:!0}})}.call(this),function(){"use strict";var e=[].slice;NOTE.CTRL.NoteDetailCtrl=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g){this.$rootScope=e,this.$window=t,this.$document=n,this.$state=r,this.$stateParams=i,this.$filter=a,this.$sce=o,this.$timeout=s,this.Auth=l,this.Note=c,this.CustomDomainContext=u,this.Bridge=d,this.Title=p,this.ReadHistory=h,this.Admin=m,this.NotePreviewAccessToken=f,this.Lightbox=g,this.currentUser={},this.noteModel={},this.commentModel={comments:[]},this.paywallContext={},this.collapsed=!0,this.initNote(),this.isSmartPhone=this.$rootScope.isSmartPhone,this.noteLineHeightTest="C",this.audioPreload=!0,this.otherList=!1}return e.inject=["$rootScope","$window","$document","$state","$stateParams","$filter","$sce","$timeout","Auth","Note","CustomDomainContext","Bridge","Title","ReadHistory","Admin","NotePreviewAccessToken","Lightbox"],e.prototype.initNote=function(){return this.Auth.then(function(e){return function(t){var n,r,i;return t.error&&(e.error=t.error,e.isLoggedIn=!1),t.data&&(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),r=e.$stateParams.key.match(/^(n[0-9a-z]{12})/)[0],n=e.$stateParams.magazine_key,i=e.$stateParams.prev_access_key,e.Note.get({noteKey:r,magazine_key:n,prev_access_key:i},function(t){var n,r,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w,k;if(t.error)return"not_found"===t.error.code&&e.$state.go("_404",null,{location:!1}),void(e.error=t.error);if(t.data.user.no_urlname_user)return n=e.CustomDomainContext.isCdAccess()?"magazine"===e.CustomDomainContext.type?"cdMagazine.home":"cdCreator.home":"home.home",e.$state.go(n);if(e.CustomDomainContext.isCdAccess()&&null===t.data.custom_domain&&"cdMyNote"===e.$state.current.name)return c=e.$state.href("showTextNoteFriendly",{urlname:t.data.user.urlname,key:t.data.key}),g=""+e.CustomDomainContext.getProtocol()+"://"+e.CustomDomainContext.getNoteHost()+c,e.$window.location.href=g;if(e.CustomDomainContext.isCdAccess()&&t.data.custom_domain&&t.data.custom_domain.host!==e.CustomDomainContext.host&&"cdMyNote"===e.$state.current.name||!e.CustomDomainContext.isCdAccess()&&t.data.custom_domain&&"showTextNoteFriendly"===e.$state.current.name)return d=t.data.custom_domain.tls?"https":"http",e.$window.location.href=""+d+"://"+t.data.custom_domain.host+"/n/"+t.data.key;if(!e.CustomDomainContext.isCdAccess()&&e.$state.params.urlname!==t.data.user.urlname&&!i)return e.$state.go("showTextNoteFriendly",{urlname:t.data.user.urlname,key:t.data.key},{inherit:!0,location:"replace"});if(u=angular.copy(t.data.body),s=t.data,f=navigator.userAgent,f.toLowerCase().indexOf("phantomjs")>=0||(m=[],null!=t.data.name?e.$filter("truncate")(t.data.name,100)&&m.push(e.$filter("truncate")(t.data.name,100)):m.push(e.$filter("truncate")(t.data.body,100)),m.push(null!=t.data.user.nickname?t.data.user.nickname:t.data.user.urlname),e.Title.set(m)),window.PREFETCH.NOTE.enable_ogp_setting&&"TextNote"===t.data.type&&null!=t.data.meta_datum.title&&(document.title=t.data.meta_datum.title),e.noteModel.note=t.data,t.data.custom_domain?(l=t.data.custom_domain,e.noteUrl=""+window.PREFETCH.NOTE.protocol+"://"+l.host+"/n/"+e.noteModel.note.key):e.noteUrl=""+window.PREFETCH.NOTE.protocol+"://"+window.PREFETCH.NOTE.host+"/"+e.noteModel.note.user.urlname+"/n/"+e.noteModel.note.key,p=window.PREFETCH.NOTE.relatedNote.max_count||3,e.noteModel.note.recommendations=t.data.note_related_notes.concat(t.data.popular_sibling_notes),e.noteModel.note.recommendations.splice(p),"TalkNote"===e.noteModel.note.type&&(e.noteModel.note.body=e.$filter("trim")(e.noteModel.note.body),e.noteModel.note.body=e.$filter("linky")(e.noteModel.note.body,"_blank"),e.noteModel.note.body=e.$filter("hashtag")(e.noteModel.note.body),e.noteModel.note.body=e.$filter("nofollow")(e.noteModel.note.body),e.noteModel.note.body=e.noteModel.note.body?e.noteModel.note.body.replace(/&#10;/gm,"\n"):"",e.noteModel.note.body=e.$filter("nl2br")(e.noteModel.note.body)),"TextNote"===e.noteModel.note.type&&e.$state.params.prev_access_key&&e.NotePreviewAccessToken.get({note_key:e.noteModel.note.key,token:e.$state.params.prev_access_key}).$promise.then(function(){})["catch"](function(t){e.$state.go("_404",null,{location:!1}),e.error=t.error}),e.noteModel.note.plane_body=u,e.commentModel.comments=s.comments,e.is_my_note=s.is_my_note,e.prev_note=s.prev_note,e.next_note=s.next_note,e.paywallContext.isShowLimitedPayNotePaywall=!1,e.noteModel.note.limited_note_include_magazines)for(w=e.noteModel.note.limited_note_include_magazines,v=0,b=w.length;b>v;v++)a=w[v],(a.is_purchased||a.is_subscribed)&&(e.paywallContext.isShowLimitedPayNotePaywall=!0);for(h=0,k=e.noteModel.note.magazines_for_subscribe,y=0,_=k.length;_>y;y++)r=k[y],r.is_same_month_now_and_magazine_add&&(h+=1);if(e.noteModel.note.same_month_cnt=h,e.initFinished=!0,e.Admin.isAdminCheck!==!0&&e.ReadHistory.save({id:s.id,referrer:e.$rootScope.prevPage}),e.$rootScope.urlname_for_message=s.user.urlname,e.$rootScope.urlname_for_tokusyo=s.user.urlname,o=e.$stateParams.modal)switch(o){case"add_to_magazine":e.init_action="add_to_magazine";break;case"support":e.init_action="support_modalopen";break;default:e.init_action="modalopen"}return e.$timeout(function(){return e.$rootScope.phantom_status="ready","comment"===e.$stateParams.scrollpos?e.scrollToComment():e.$stateParams.scrollpos?e.scrollToName():void 0},300,!1),e.$rootScope.isPC?e.$timeout(function(){return e.lightboxNoteImages()},500):void 0})}}(this))},e.prototype.scrollToComment=function(){var e;return e=angular.element(document.getElementById("commentAreaElement")),e?this.$document.scrollTo(e,0,0):void 0},e.prototype.scrollToName=function(){var e;return e=angular.element("[name='"+this.$stateParams.scrollpos+"']"),e?this.$document.scrollTo(e[0],-e.height(),0):void 0},e.prototype.toggleOtherList=function(){return this.otherList?(this.$document.off("mouseup"),this.otherList=!1,!1):(this.otherList=!0,this.$document.on("mouseup",function(e){return function(t){return t.preventDefault(),e.$timeout(function(){return e.otherList=!1},0),e.$document.off("mouseup")}}(this)),!1)},e.prototype.lightboxNoteImages=function(){var e,t;return t=this,"TextNote"===t.noteModel.note.type&&(e=[],angular.element(".body-wrapper p img").each(function(t,n){return angular.isDefined(n.parentNode.href)?n.parentNode.href===n.src&&angular.element(this).addClass("is-slide"):angular.element(this).addClass("is-slide"),e.push({url:n.src})})),"ImageNote"===t.noteModel.note.type&&angular.element(".image-note-pictures .img-url").on("click",function(e){var n;return e.preventDefault(),e.stopPropagation(),n=angular.element(".image-note-pictures .img-url").index(this),t.Lightbox.show("multiple",t.noteModel.note.pictures,n)}),angular.element(".image-note-pictures img, .body-wrapper p img").on("click",function(n){var r;if("TextNote"!==t.noteModel.note.type||!angular.isDefined(this.parentNode.href)||this.parentNode.href===this.src)return n.preventDefault(),n.stopPropagation(),r=angular.element(".image-note-pictures img, .body-wrapper p img").index(this),"TextNote"===t.noteModel.note.type?t.Lightbox.show("multiple",e,r):"ImageNote"===t.noteModel.note.type?t.Lightbox.show("multiple",t.noteModel.note.pictures,r):void 0})},e}(),angular.module("noteApp").directive("noteDetail",function(){return{restrict:"E",scope:{},templateUrl:"/templates/notes/note_detail",controller:e.call(NOTE.CTRL.NoteDetailCtrl.inject).concat([NOTE.CTRL.NoteDetailCtrl]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].slice;NOTE.CTRL.NoteEditCtrl=function(){function t(t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w,k,x,C,S,T,A,M,E,P,N,D){var z;this.$scope=t,this.$rootScope=n,this.$window=r,this.$location=i,this.$state=a,this.$stateParams=o,this.$sce=s,this.$timeout=l,this.$interval=c,this.$upload=u,this.$compile=d,this.Auth=p,this.Note=h,this.TextNote=m,this.NoteDraft=f,this.EditorManager=g,this.Title=v,this.MessageModal=y,this.ContentLink=b,this.PostingSettingStash=_,this.ImageUploadNoteEyecatchDelete=w,this.CropperModalService=k,this.StockPhotoImages=x,this.$document=C,this.GettyImagesSearch=S,this.NotePreviewAccessTokenPublisher=T,this.clipboard=A,this.Popeye=M,this.ImageUploadValidationService=E,this.ImageCropperService=P,this.CreateStockPhotoImageLogs=N,this.$analytics=D,this.openCropper=e(this.openCropper,this),this.openGetty=e(this.openGetty,this),this.updatePrevDataFromHtml=e(this.updatePrevDataFromHtml,this),this.isEqPrevData=e(this.isEqPrevData,this),this.removeEventListeners=e(this.removeEventListeners,this),this.addEventListeners=e(this.addEventListeners,this),this.newStateName="newTextNote",this.editStateName="editTextNote",this.paypartStateName="paypartDetermineTextNote",this.newPageTitle="\u65b0\u898f\u30ce\u30fc\u30c8\u4f5c\u6210",this.editPageTitle="\u30ce\u30fc\u30c8\u7de8\u96c6",this.$window=r,this.editorOptions={enableTextLead:r.PREFETCH.NOTE.enable_textnote_lead===!0,enableGettyImage:r.PREFETCH.NOTE.enable_getty_image===!0,enableTextNoteImageCaption:r.PREFETCH.NOTE.enable_textnote_image_caption===!0,enableTextNoteH2:r.PREFETCH.NOTE.enable_textnote_h2===!0,enableTextNoteExtraJustification:r.PREFETCH.NOTE.enable_textnote_extra_justification===!0,enableTextNoteList:r.PREFETCH.NOTE.enable_textnote_list===!0,enableExternalArticleEmbed:r.PREFETCH.NOTE.enable_external_article_embed===!0,enableNotePictureCropper:r.PREFETCH.NOTE.enable_note_picture_cropper===!0},z=[],z.push(n.$on("selectGalleryImage",function(e){return function(t,n){var r;return e.cropperLoading=!0,e.stockPhotoImageId=n.stockPhotoImageId,r=new Image,r.onload=function(){var t,i;return t=document.createElement("canvas"),t.width=r.width,t.height=r.height,i=t.getContext("2d"),i.drawImage(r,0,0,r.width,r.height),e.eyeCatchUploadFromImageNote(t.toDataURL("image/jpeg",1),n)},r.crossOrigin="anonymous",r.src=n.url.original}}(this))),z.push(n.$on("uploadGettyImage",function(e){return function(t,n,r,i,a,o){var s,l;return s=a.getData(),"note_picture"===o?l="/api/v2/image_upload/text_note_picture":"eyecatch"===o&&(l="/api/v1/image_upload/note_eyecatch"),n.toBlob(function(t){return e.$upload.upload({url:l,fileName:"getty_"+r+".jpg",file:t,data:{note_id:e.noteModel.note.id,x:Math.round(s.x*a.reducedScale),y:Math.round(s.y*a.reducedScale),height:Math.round(s.height*a.reducedScale),width:Math.round(s.width*a.reducedScale),vendor_id:r,vendor_name:"getty"}}).success(function(t){return"note_picture"===o?e.ImageUploadValidationService.errors(t.error,{},function(){return e.onUploadGettyImageSuccess({key:r,url:t.data.url,alt:i})}):"eyecatch"===o?e.ImageUploadValidationService.errors(t.error,{},function(){var n;return $("#textnote-eyecatch-upload").val(""),n=e.$window.document.querySelector("img.p-setCoverImage__image"),n.onload=function(){var t;return t=e.$window.document.createEvent("Event"),t.initEvent("resize",!0,!0),e.$window.dispatchEvent(t),n.onload=null},e.noteModel.note.eyecatch=t.data.url,e.noteModel.note.eyecatch_vendor="getty"}):void 0}).error(function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"})})},"image/jpeg")}}(this))),t.$on("$destroy",function(){return function(){return z.forEach(function(e){return e()})}}(this)),this.$timeout(function(e){return function(){var t,n;return e.$rootScope.isIE===!1?e.$state.current.name===e.paypartStateName&&e.PostingSettingStash.isEmpty()?(e.invalidTransition=!0,e.$window.location.href="/"):e.$window.NOTE.editorLoaded===!0?e.setUpEditor():(n=e.$window.document.createElement("script"),n.src=e.$window.PREFETCH.NOTE.editorPath,n.async=!0,n.onload=function(){return e.$window.NOTE.editorLoaded=!0,e.setUpEditor()},t=e.$window.document.getElementsByTagName("script")[0],t.parentNode.insertBefore(n,t)):e.Auth.then(function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1,void e.$state.go("login",{redirectPath:e.$location.path()},{reload:!0,location:!0,inherit:!0})):(e.currentUser=t.data,e.isLoggedIn=!0,e.noteModel={note:{is_my_note:!0}})})}}(this),0),this.gettyImageGalleryModel={search:{},menus:[],getImages:function(){return this.getImagesObj.images&&this.getImagesObj.images.isLastPage||this.getImagesObj.loadingFlag?void 0:this.getImagesObj.query?(this.getImagesObj.loadingFlag=!0,this.getImagesObj.getImagesFn.get({page:this.getImagesObj.page,query:this.getImagesObj.query,sort_order:this.getImagesObj.order,"orientations[]":this.getImagesObj.orientations,"asset_families[]":this.getImagesObj.assetFamilies,page_size:30},function(e){return function(t){return 1===e.getImagesObj.page?e.getImagesObj.images=t.data:(angular.forEach(t.data.contents,function(t){return e.getImagesObj.images.contents.push(t)}),e.getImagesObj.images.isLastPage=t.data.isLastPage),e.getImagesObj.loadingFlag=!1,e.getImagesObj.page+=1}}(this),function(e){return function(t){return e.getImagesObj.loadingFlag=!1,e.getImagesObj.images.isLastPage=!0,console.log(t)}}(this))):(this.getImagesObj.images=[],void(this.getImagesObj.images.isLastPage=!0))},masonryOptions:{gutterSize:10,gridWidth:204},getImagesObj:{images:{},loadingFlag:!1,page:1,query:"",order:"",orientations:[],assetFamilies:[],getImagesFn:this.GettyImagesSearch},initObj:function(e,t){return null==e&&(e={}),null==t&&(t=""),this.getImagesObj.images={},this.getImagesObj.loadingFlag=!1,this.getImagesObj.images.isLastPage=!0,this.getImagesObj.page=1,this.getImagesObj.query="",this.getImagesObj.order="best_match",this.getImagesObj.ratio=e,this.getImagesObj.kind=t}},this.imageGalleryModel={search:{endpoint:"./api/v2/suggest_stock_photo_tags?query="},menus:[{name:"all",showName:"\u3059\u3079\u3066",query:""},{name:"scene",showName:"\u98a8\u666f",query:"\u98a8\u666f"},{name:"human",showName:"\u4eba\u7269",query:"\u4eba\u7269"},{name:"town",showName:"\u8857",query:"\u8857"},{name:"thing",showName:"\u30e2\u30ce",query:"\u30e2\u30ce"},{name:"food",showName:"\u98df\u3079\u7269",query:"\u98df\u3079\u7269"},{name:"illustration",showName:"\u30a4\u30e9\u30b9\u30c8",query:"\u30a4\u30e9\u30b9\u30c8"}],getImages:function(){return this.getImagesObj.images&&this.getImagesObj.images.isLastPage||this.getImagesObj.loadingFlag?void 0:(this.getImagesObj.loadingFlag=!0,this.getImagesObj.getImagesFn.get({page:this.getImagesObj.page,size:this.getImagesObj.size,query:this.getImagesObj.query,order:this.getImagesObj.order},function(e){return function(t){return 1===e.getImagesObj.page?e.getImagesObj.images=t.data:(angular.forEach(t.data.contents,function(t){return e.getImagesObj.images.contents.push(t)}),e.getImagesObj.images.isLastPage=t.data.isLastPage),e.getImagesObj.totalCount=t.data.totalCount,setTimeout(function(){return e.getImagesObj.loadingFlag=!1},300),e.getImagesObj.page+=1}}(this),function(){return function(e){return console.log(e)}}(this)))},backImages:function(){return this.getImagesObj.images.contents=[],angular.element(".ag-clone").remove(),this.getImagesObj.page=(this.getImagesObj.currentPage-1)*this.getImagesObj.limitPage-(this.getImagesObj.limitPage-1),this.getImagesObj.loadingFlag=!1,this.getImagesObj.images.isLastPage=!1,this.getImagesObj.currentPage-=1,this.getImages()},nextImages:function(){return this.getImagesObj.currentPage+=1,this.getImagesObj.images.contents=[],angular.element(".ag-clone").remove(),this.getImages()},masonryOptions:{gutterSize:10,gridWidth:204},getImagesObj:{images:{},loadingFlag:!1,page:1,size:40,query:"",order:"",totalCount:null,limitPage:6,currentPage:1,getImagesFn:this.StockPhotoImages,type:"stock_photo"},initObj:function(){return this.getImagesObj.images={},this.getImagesObj.loadingFlag=!1,this.getImagesObj.page=1,this.getImagesObj.query="",this.getImagesObj.order=""}}}return t.inject=["$scope","$rootScope","$window","$location","$state","$stateParams","$sce","$timeout","$interval","$upload","$compile","Auth","Note","TextNote","NoteDraft","EditorManager","Title","MessageModal","ContentLink","PostingSettingStash","ImageUploadNoteEyecatchDelete","CropperModalService","StockPhotoImages","$document","GettyImagesSearch","NotePreviewAccessTokenPublisher","clipboard","Popeye","ImageUploadValidationService","ImageCropperService","CreateStockPhotoImageLogs","$analytics"],t.prototype.setUpEditor=function(){return this.currentUser={},this.noteModel={changed:!1,newNote:this.$state.current.name===this.newStateName},this.nameElem=this.$window.document.querySelector(".note-name > h1 > .editable"),this.leadElem=this.$window.document.querySelector(".note-lead > .editable"),this.bodyElem=this.$window.document.querySelector(".note-body > .editable"),this.noteLeadEnabled=(this.leadElem||this.$state.current.name===this.paypartStateName)&&this.editorOptions.enableTextLead,this.imageGalleryScreen=!1,this.onContentModified=function(e){return function(t){var n;
return t.preventDefault(),e.isEqPrevData()?e.noteModel.newNote&&!e.noteModel.firstSaved?e.noteModel.changed=!1:void 0:(e.noteModel.changed=!0,e.toggleSubmitButton(),n=e.$interval(function(){return e.$window.NOTE.editor.readyToSave===!0?(e.$interval.cancel(n),e.autoSave()):void 0},100))}}(this),this.onEditorMessage=function(e){return function(t){return e.MessageModal.show({message:t.message})}}(this),this.$scope.$on("$TextNoteInitialized",function(e){return function(){return e.cancelCaptionElem=e.$window.document.querySelector("#fude_cancel_button > span"),e.updatePrevDataFromHtml(),e.toggleSubmitButton(),e.addEventListeners(),e.$state.current.name!==e.newStateName?e.autoSave(!0):void 0}}(this)),this.$scope.$on("$stateChangeStart",function(){return!0}),$(window).on("beforeunload",function(e){return function(t){return $('div[contenteditable="true"]').text().length>0&&e.isNoteEditing===!0?"\u30ce\u30fc\u30c8\u3092\u7de8\u96c6\u4e2d\u3067\u3059":(t||window.event).returnValue=void 0}}(this)),$("div.note").one("keydown",function(e){return function(){return e.isNoteEditing=!0}}(this)),this.$state.current.name===this.newStateName?this.initNewTextNote():this.initTextNoteEdit()},t.prototype.initNewTextNote=function(){return this.mode="new",this.enableToPublish=!1,this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1,void e.$state.go("login",{redirectPath:e.$location.path()},{reload:!0,location:!0,inherit:!0})):(e.currentUser=t.data,e.currentUser.no_urlname_user?void(e.$window.location.href="/"):(e.isLoggedIn=!0,e.TextNote.save(null,function(t){return t.error?void(e.error=t.error):(e.noteModel.note=t.data,e.noteModel.note.is_my_note=!0,e.noteModel.note.user=e.currentUser,e.noteModel.note.authors=[],e.$timeout(function(){return e.EditorManager.createEditor(e.createEditorInitOptions())},0))}),e.Title.set(e.newPageTitle)))}}(this))},t.prototype.initTextNoteEdit=function(e){return this.mode="edit",this.separatorElem={},this.Auth.then(function(t){return function(n){var r;return n.error?(t.error=n.error,t.isLoggedIn=!1,void t.$state.go("login",{redirectPath:t.$location.path()},{reload:!0,location:!0,inherit:!0})):(t.currentUser=n.data,t.isLoggedIn=!0,r={noteKey:t.$stateParams.key,draft:e&&"published"===e?!1:!0,draft_reedit:"true"===t.$state.params.reedit},t.Note.get(r,function(n){var r;return n.error?(console.log("error"),t.load_error=!0,void(t.error=n.error)):(n.data.can_update||(t.$window.location.href="/"),t.Title.set(t.editPageTitle),t.noteModel.note=n.data,t.noteModel.note.body=t.$sce.trustAsHtml(n.data.body),t.load_ok=!0,t.edit_status=e,t.prevName=t.noteModel.note.name,t.prevBody=n.data.body,t.openSelect=!1,t.noteLeadEnabled&&(t.noteModel.note.lead=t.$sce.trustAsHtml(n.data.description),t.prevLead=n.data.description),t.noteModel.note.stock_photo&&(t.stockPhotoImageId=t.noteModel.note.stock_photo.stock_photo_image.id),r=t.PostingSettingStash.stashPop(),r&&r.reserved&&(t.reservedFlag=r.reserved),t.PostingSettingStash.stash(r),t.$timeout(function(){var e,n,r,i,a,o;if(t.$state.current.name===t.paypartStateName){for(t.EditorManager.destroyEditor(),a=t.noteModel.note.embedded_contents,o=[],r=0,i=a.length;i>r;r++)e=a[r],o.push($("div.note-body").find("[embedded-content-key='"+e.key+"']").html("<div class='fude-iframe-container'><div class='fude-iframe-container-"+e.service+"'>"+e.html_for_embed+"</div></div>"));return o}return t.$state.current.name===t.editStateName?(n=t.createEditorInitOptions(),n.embeds=t.noteModel.note.embedded_contents,t.EditorManager.createEditor(n)):void 0},100))}))}}(this))},t.prototype.addEventListeners=function(){return this.nameElem.addEventListener("contentChanged",this.onContentModified),this.bodyElem.addEventListener("contentChanged",this.onContentModified),this.bodyElem.addEventListener("editorMessage",this.onEditorMessage),this.noteLeadEnabled?this.leadElem.addEventListener("contentChanged",this.onContentModified):void 0},t.prototype.removeEventListeners=function(){return this.nameElem.removeEventListener("contentChanged",this.onContentModified),this.bodyElem.removeEventListener("contentChanged",this.onContentModified),this.bodyElem.removeEventListener("editorMessage",this.onEditorMessage),this.noteLeadEnabled?this.leadElem.removeEventListener("contentChanged",this.onContentModified):void 0},t.prototype.autoSave=function(e){return null==e&&(e=!1),this.$timeout.cancel(this.savingPromise),this.savingPromise=this.$timeout(function(t){return function(){var n,r,i,a;if(a=t.getDataFromHtml(),i=a.save_name,r=a.save_lead,n=a.save_body,t.enableToPublish=t.judgeEnableToPublish(i,n),!e){if(!t.hasText(i,r,n))return;if(t.$window.document.querySelector(".modal-window"))return;if(t.isEqPrevData())return void t.saveStockPhotoImageLog()}return t.$window.NOTE.editor&&t.$window.NOTE.editor.setParagraphNames(),t.saving=!0,t.NoteDraft.save({id:t.noteModel.note.id},{name:i,description:r,body:n,status:t.noteModel.note.status?t.noteModel.note.status:"draft",stock_photo_image_id:t.stockPhotoImageId?t.stockPhotoImageId:null},function(){return t.saving=!1,t.updatePrevDataFromHtml(),t.noteModel.newNote&&!t.noteModel.firstSaved&&(t.noteModel.firstSaved=!0,t.cancelCaptionElem.textContent="\u4e0b\u66f8\u304d\u4fdd\u5b58"),t.$timeout(function(){return t.saving=null},2e3)})}}(this),2e3)},t.prototype.onSaveNewNote=function(){return!this.noteModel.newNote||this.noteModel.firstSaved||this.noteModel.changed?this.immediateAutoSave({noAlertFlag:!0}):void 0},t.prototype.onCancelNewNote=function(){return!this.noteModel.newNote||this.noteModel.firstSaved||this.noteModel.changed?this.immediateAutoSave():(this.$rootScope.prevState||this.$window.history.back(),void this.$state.go(this.$rootScope.prevState,this.$rootScope.prevStateParams))},t.prototype.immediateAutoSave=function(e){var t,n,r,i,a;return this.$window.NOTE.editor.readyToSave!==!0?this.MessageModal.show({message:"\u672c\u6587\u30c7\u30fc\u30bf\u306e\u51e6\u7406\u304c\u7d42\u308f\u308b\u307e\u3067\u5c11\u3005\u304a\u5f85\u3061\u4e0b\u3055\u3044\u3002"}):(e=e||{},a=this.getDataFromHtml(),i=a.save_name,r=a.save_lead,n=a.save_body,this.enableToPublish=this.judgeEnableToPublish(i,n),t=function(t){return function(){return t.removeEventListeners(),t.EditorManager.destroyEditor(),null!=e.toState?t.$state.go(e.toState):t.$rootScope.prevState&&"drafts.home"===t.$rootScope.prevState?t.$state.go(t.$rootScope.prevState):t.ContentLink.go("note",t.noteModel.note)}}(this),this.isEqPrevData()&&(this.saveStockPhotoImageLog(),!e.noAlertFlag)?void t():(this.$window.NOTE.editor.setParagraphNames(),this.saving=!0,this.NoteDraft.save({id:this.noteModel.note.id},{name:i,description:r,body:n,status:this.noteModel.note.status?this.noteModel.note.status:"draft",stock_photo_image_id:this.stockPhotoImageId?this.stockPhotoImageId:null},function(n){return function(){return n.noteModel.note.status||n.noteModel.firstSaved||(n.noteModel.firstSaved=!0),e.noAlertFlag?void 0:(n.saving=!1,n.updatePrevDataFromHtml(),n.$timeout(function(){return n.saving=null},2e3),n.MessageModal.show({message:"\u672a\u4fdd\u5b58\u306e\u5909\u66f4\u5185\u5bb9\u3092\u4e0b\u66f8\u304d\u306b\u4fdd\u5b58\u3057\u307e\u3057\u305f",callback:function(){return n.isNoteEditing=!1,t()}}))}}(this))))},t.prototype.judgeEnableToPublish=function(e,t){var n,r,i,a,o,s,l;if(!(e&&e.toString().length>0&&t&&t.toString().length>0))return!1;for(a=""===$(t).text()&&"<br>"===$(t).html(),i=!0,l=$(t),o=0,s=l.length;s>o;o++)n=l[o],r=$(n).find("img"),r&&r.length>0&&(i=!1);return a&&i?!1:!0},t.prototype.toggleSubmitButton=function(){var e,t,n,r;return e=this.$window.document.querySelector("#fude_save_button"),r=this.getDataFromHtml(),n=r.save_name,t=r.save_body,this.judgeEnableToPublish(n,t)?(e.classList.remove("btn-low"),e.classList.add("btn-high")):(e.classList.remove("btn-high"),e.classList.add("btn-low"))},t.prototype.clickSelectEyecatch=function(){return this.openSelect=!this.openSelect,this.openSelect?this.$analytics.eventTrack("open-menu-selection",{category:"textnote-eyecatch",label:"open-menu-selection"}):void 0},t.prototype.clickEyecatchUpload=function(){return this.$analytics.eventTrack("upload-local-file",{category:"textnote-eyecatch",label:"upload-local-file"}),this.CropperModalService.getFile("cover").then(function(e){return function(t){var n;return n=new Blob([e.CropperModalService.base64ToBinary(t.result.cropped)],{type:t.result.cropped.match(/image\/[a-zA-Z]+/)[0],encoding:"utf-8"}),e.uploadEyecatch(t,n)}}(this))},t.prototype.onFileSelect=function(e){return this.noteModel.note.can_update===!0?this.$upload.upload({url:"/api/v1/image_upload/note_eyecatch",file:e[0],data:{note_id:this.noteModel.note.id}}).success(function(e){return function(t){var n;return null!=t.error&&"file_size_limit_exceeded"===t.error.code?e.MessageModal.show({message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):null!=t.error&&"file_type_not_allowed"===t.error.code?e.MessageModal.show({message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"}):($("#textnote-eyecatch-upload").val(""),n=e.$window.document.querySelector("img.p-setCoverImage__image"),n.onload=function(){var t;return t=e.$window.document.createEvent("Event"),t.initEvent("resize",!0,!0),e.$window.dispatchEvent(t),n.onload=null},e.noteModel.note.eyecatch=t.data.url)}}(this)):void 0},t.prototype.eyeCatchUploadFromImageNote=function(e,t){var n,r;return r=e.match(/image\/[a-zA-Z]+/)[0],n={source:e,type:"cover",mime:r,name:t.key+"."+r.split("/")[1]},this.noteModel.note.stockPhoto=t,this.cropperLoading=!1,this.CropperModalService.openCropperModal(n).then(function(e){return function(t){var n;return n=new Blob([e.CropperModalService.base64ToBinary(t.result.cropped)],{type:t.result.mime,encoding:"utf-8"}),e.uploadEyecatch(t,n)}}(this))},t.prototype.uploadEyecatch=function(e,t){var n,r;return r=e.result.name.split(".")[0],n=e.result.cropped.match(/image\/[a-zA-Z]+/)[0].split("/")[1],this.$upload.upload({url:"/api/v1/image_upload/note_eyecatch",fileName:r+"."+n,file:t,data:{note_id:this.noteModel.note.id,width:+e.cropData.width,height:+e.cropData.height,x:+e.cropData.x,y:+e.cropData.y}}).success(function(e){return function(t){var n;return null!=t.error&&"file_size_limit_exceeded"===t.error.code?e.MessageModal.show({message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):null!=t.error&&"file_type_not_allowed"===t.error.code?e.MessageModal.show({message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"}):($("#textnote-eyecatch-upload").val(""),n=e.$window.document.querySelector("img.p-setCoverImage__image"),n.onload=function(){var t;return t=e.$window.document.createEvent("Event"),t.initEvent("resize",!0,!0),e.$window.dispatchEvent(t),n.onload=null},e.noteModel.note.eyecatch=t.data.url)}}(this)).error(function(e){return function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"})}}(this))},t.prototype.removeEyecatch=function(){return this.noteModel.note.can_update===!0?(this.noteModel.note.stockPhoto&&(this.noteModel.note.stockPhoto=null),this.noteModel.note.stock_photo&&(this.noteModel.note.stock_photo=null),this.stockPhotoImageId&&(this.stockPhotoImageId=null),this.ImageUploadNoteEyecatchDelete.put({imageable_id:this.noteModel.note.id},function(e){return function(){return null!=e.noteModel.note.eyecatch&&delete e.noteModel.note.eyecatch,!0}}(this),function(){return console.log("Error occurred")}),!0):void 0},t.prototype.openStockPhoto=function(){return this.imageGalleryScreen=!0},t.prototype.generateNoteLink=function(e){return e.user.customDomain?location.protocol+"//"+e.user.customDomain.host+"/n/"+e.noteKey:"/"+e.user.urlname+"/n/"+e.noteKey},t.prototype.getDataFromHtml=function(){var e,t;return t=this.noteLeadEnabled?this.leadElem.innerHTML:null,e=this.bodyElem.innerHTML,{save_name:this.nameElem.textContent.trim(),save_lead:null!=t&&t.trim(),save_body:null!=e&&e.trim()}},t.prototype.hasText=function(e,t,n){return e&&e.toString().length>0||t&&t.toString().length>0||n&&n.toString().length>0},t.prototype.isEqPrevData=function(){var e,t,n;return n=this.nameElem.textContent.trim().toString(),t=this.noteLeadEnabled?this.leadElem.innerHTML.trim().toString():null,e=this.bodyElem.innerHTML.trim().toString(),this.noteLeadEnabled?n===this.prevName.toString()&&t===this.prevLead.toString()&&e===this.prevBody.toString():n===this.prevName.toString()&&e===this.prevBody.toString()},t.prototype.updatePrevDataFromHtml=function(){return this.prevName=this.nameElem.textContent.trim(),this.prevLead=this.noteLeadEnabled?this.leadElem.innerHTML.trim():null,this.prevBody=this.bodyElem.innerHTML.trim()},t.prototype.openGetty=function(e,t,n,r,i){var a;return null==r&&(r={}),null==i&&(i="note_picture"),this.onUploadGettyImageSuccess||(this.onUploadGettyImageSuccess=e),this.gettyImageGalleryModel.initObj(r,i),a=this.Popeye.openModal({templateUrl:"/templates/modal/renewal/_open_image_gallery",containerClassList:["full-screen"],locals:{menus:this.gettyImageGalleryModel.menus,search:this.gettyImageGalleryModel.search,getImages:this.gettyImageGalleryModel.getImages,getImagesObj:this.gettyImageGalleryModel.getImagesObj,masonryOptions:this.gettyImageGalleryModel.masonryOptions,imageGalleryTitle:"Getty Images\u304b\u3089\u753b\u50cf\u3092\u633f\u5165",getty:!0},keyboard:!1,controller:["$scope",function(e){var n,r,i;i=a.options.locals;for(n in i)r=i[n],e[n]=r;return e.close=function(){return a.close(),t?t():void 0}}]}),a.opened.then(function(e){return function(){return e.$document.on("keydown.galleryPopeyeModal",function(e){return 27===e.which&&0===angular.element(".renewal-p-galleryLayout__modalMask").length?a.close():void 0})}}(this)),a.closed.then(function(e){return function(){return e.$document.off("keydown.galleryPopeyeModal")}}(this))},t.prototype.openCropper=function(e,t){var n;return n={noteId:this.noteModel.note.id,kind:"note_picture"},this.ImageCropperService.process(n).then(function(){return function(t){return e(t)}}(this),function(e){return function(n){return n?e.MessageModal.show({message:n,callback:t}):t()}}(this))},t.prototype.createEditorInitOptions=function(){return{noteHost:this.$window.PREFETCH.NOTE.host,buttonLabels:"fontawesome",anchor:{targetCheckbox:!0,linkValidation:!0,placeholderText:"http://"},toolbar:{headingTag:this.editorOptions.enableTextNoteH2?"h2":"h3",enableImageCaption:this.editorOptions.enableTextNoteImageCaption===!0,enableList:this.editorOptions.enableTextNoteList===!0,enablePre:"origin"===this.$window.PREFETCH.NOTE.mode,justification:{left:this.editorOptions.enableTextNoteExtraJustification===!0,right:this.editorOptions.enableTextNoteExtraJustification===!0}},embedToolbar:{getty:this.editorOptions.enableGettyImage?this.openGetty:null,gettyCaption:this.$window.PREFETCH.NOTE.getty_caption,cropper:this.editorOptions.enableNotePictureCropper===!0?this.openCropper:null,enableExternalArticle:this.editorOptions.enableExternalArticleEmbed===!0,enableCodeEmbed:"origin"===this.$window.PREFETCH.NOTE.mode,altNoteDomain:this.$window.PREFETCH.NOTE.aspDefaultHost},targetBlank:!0,autoLink:!0,screenId:"note-editor-screen",noteBodyWidth:this.$window.PREFETCH.NOTE.noteBodyWidth||620,callback:function(e){return function(){return e.$scope.$emit("$TextNoteInitialized")}}(this)}},t.prototype.saveStockPhotoImageLog=function(){var e;return e=new this.CreateStockPhotoImageLogs,e.stock_photo_image_id=this.stockPhotoImageId,e.note_id=this.noteModel.note.id,e.$save(null,function(){return console.log("ok")},function(e){return console.log(e)})},t}(),angular.module("noteApp").directive("noteEdit",function(){return{restrict:"E",scope:{},templateUrl:"/templates/notes/note_edit",controller:t.call(NOTE.CTRL.NoteEditCtrl.inject).concat([NOTE.CTRL.NoteEditCtrl]),controllerAs:"$ctrl"}}),angular.module("noteApp").directive("notePaypart",function(){return{restrict:"E",scope:{},templateUrl:"/templates/notes/note_paypart",controller:t.call(NOTE.CTRL.NoteEditCtrl.inject).concat([NOTE.CTRL.NoteEditCtrl]),controllerAs:"$ctrl"}}),angular.module("noteApp").directive("eyecatchDragDropUpload",function(){return{restrict:"A",link:function(e,t){return t.on({"dragenter dragover":function(e){return t.addClass("is-dragging"),e.preventDefault()},dragleave:function(){return t.removeClass("is-dragging")},drop:function(n){return t.removeClass("is-dragging"),n.originalEvent.dataTransfer.files[0].type.match(/png|jpg|jpeg/)?(e.$ctrl.$analytics.eventTrack("d&d-upload-local-file",{category:"textnote-eyecatch",label:"d&d-upload-local-file"}),e.$ctrl.CropperModalService.fileLoadHandler(n,"cover").then(function(){return function(t){return e.$ctrl.CropperModalService.openCropperModal(t).then(function(t){var n;return n=new Blob([e.$ctrl.CropperModalService.base64ToBinary(t.result.cropped)],{type:t.result.cropped.match(/image\/[a-zA-Z]+/)[0],encoding:"utf-8"}),e.$ctrl.uploadEyecatch(t,n)})}}(this)),n.preventDefault()):void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002")}})}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e,this.initAb()}return e.inject=["$location"],e.prototype.initAb=function(){var e;return e=0===this.note.magazines_for_buy.length&&0===this.note.magazines_for_subscribe.length&&!this.note.prior_sale,this.isSimplePaidNote=e,this.isSimplePaidNoteTestA=!1},e}(),angular.module("noteApp").directive("notePaywall",function(){return{restrict:"E",scope:{},bindToController:{note:"=",context:"=",isLoggedIn:"="},templateUrl:"/templates/notes/note_paywall",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.Notes=e,this.$stateParams=t,this.Title=n,this.notes=[],this.currentPage=this.$stateParams.page?+this.$stateParams.page:1,this.nextPage=null,this.size=20,this.isLastPage=!1,this.initNotes(),this.Title.set("\u30ce\u30fc\u30c8\u4e00\u89a7",null,"note\uff08\u30ce\u30fc\u30c8\uff09")}return e.inject=["Notes","$stateParams","Title"],e.prototype.initNotes=function(){return this.Notes.get({size:this.size,page:this.currentPage},function(e){return function(t){return e.notes=t.data.contents,e.nextPage=Number(e.currentPage+1),t.data.isLastPage&&(e.isLastPage=!0),e.totalCount=t.data.totalCount}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.snakizeNoteProperties=function(e){return e.external_url=e.externalUrl,e.like_count=e.likeCount,e.audio&&(e.audio.artist_name=e.audio.artistName),e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain?(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key):void 0},e}(),angular.module("noteApp").directive("notes",function(){return{restrict:"E",templateUrl:"/templates/notes/index",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("templates/notes/_paywall_message.html",'<div class="p-messageBalloon p-messageBalloon--tailPosition_magTmbTop u-widthFull u-mbS" ng-if="$ctrl.magazine.message"> <div class="p-messageBalloon__content"> <div class="p-paywallMessage"> <div class="p-paywallMessage__body"> <div class="p-paywallMessage__author"> <div class="c-avatar c-avatar--fit"> <lazy-load-image image-class="\'c-avatar__img\'" image-url="$ctrl.magazine.user.user_profile_image_path || $ctrl.note.user.user_profile_image_path"></lazy-load-image> </div> </div> <div class="p-paywallMessage__content"> {{::$ctrl.magazine.message}} </div> </div> </div> </div> </div>')}]),e=function(){function e(){}return e.injects=[],e}(),angular.module("noteApp").directive("paywallMessage",function(){return{restrict:"E",templateUrl:"templates/notes/_paywall_message.html",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",scope:{},bindToController:{magazine:"=",note:"="}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$stateParams","$rootScope","$scope","$state","Title","User","$window"],t=function(){function e(e,t,n,r,i,a,o){var s;this.$stateParams=e,this.$rootScope=t,this.$scope=n,this.$state=r,this.Title=i,this.User=a,this.$window=o,this.Title.set("\u30b2\u30b9\u30c8"),s=this.$stateParams.user_id,s?this.User.get({id:s},function(e){return function(t){return t.error&&e.$state.go("home.home"),t.data.no_urlname_user||e.$state.go("creator.home",{urlname:t.data.urlname}),e.user=t.data}}(this),function(e){return function(){return e.$state.go("home.home")}}(this)):(this.user={},this.user.user_profile_image_path=this.$window.PREFETCH.NOTE.defaultImage.profile)}return e}(),angular.module("noteApp").directive("nourlname",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{},templateUrl:"/templates/nourlname/index",scope:{}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("openDialog",function(){var e;return e={restrict:"A",link:function(e,t,n){return t.on("click",function(){return alert(n.openDialog)})}}})}.call(this),function(){"use strict";var e;e=function(e,t,n){var r,i;return r=document.createElement("iframe"),r.src=""+e+"://"+n.type+"/"+n.key+n.magazineKeyQuery,r.width=0,r.height=0,r.style.display="none",document.body.appendChild(r),i=(new Date).getTime(),setTimeout(function(){var e;return e=(new Date).getTime(),document.body.removeChild(r),e-i>400?void 0:document.location=t},300)},angular.module("noteApp").directive("openWithMobileApp",function(){var t;return t={scope:{type:"@",key:"=",nickname:"=",urlScheme:"=",magazineKey:"="},restrict:"EA",templateUrl:"/templates/common/open_with_mobile_app",link:function(t){return null!=t.key&&-1===t.key.search(/^[0-9A-Za-z\-_]+$/)&&(t.key=""),t.magazineKeyQuery=null!=t.magazineKey?"?magazine_key="+t.magazineKey:"",t.launchApp=function(n,r){return e(n,r,{type:t.type,key:t.key,magazineKeyQuery:t.magazineKeyQuery})}},controller:["$scope","$rootScope","$state","UserAgent","Bridge",function(e,t,n,r){return e.$state=n,e.isIPhone=r.isIPhone,e.isAndroid=r.isAndroid}]}}),angular.module("noteApp").directive("promotingModal",["Popeye","$timeout","$stateParams","ipCookie","UserAgent",function(t,n,r,i,a){var o,s;return o=["$scope",function(t){return t.isIPhone=a.isIPhone,t.isAndroid=a.isAndroid,t.magazineKeyQuery=null!=r.magazine_key?"?magazine_key="+r.magazine_key:"",t.launchApp=function(n,r){return e(n,r,{type:t.type,key:t.key,magazineKeyQuery:t.magazineKeyQuery})},t.dismiss=function(){return t.modal.close()},t.setModalOpenedCookie=function(){return i("promoting",!0,{expires:30,expirationUnit:"days",path:"/"})},t.hrefAndDismiss=function(e){return location.href=e,t.dismiss}}],s={scope:{type:"@",key:"=",magazineKey:"="},restrict:"AE",link:function(e){return document.referrer&&-1!==document.referrer.indexOf("smartnews")?void 0:null==i("promoting")&&a.isAndroid?(e.modal=t.openModal({scope:e,templateUrl:"/templates/modal/promoting",controller:o}),e.modal.closed.then(e.setModalOpenedCookie)):void 0},controller:o}}]),angular.module("noteApp").directive("appInstallPostNote",["Popeye","$timeout","$stateParams","UserAgent",function(t,n,r,i){var a;return a={scope:{type:"@",key:"=",magazineKey:"="},restrict:"EA",link:function(n,a){return a.on("click",function(){var a;return a=t.openModal({scope:n,templateUrl:"/templates/modal/app_install_post_note",controller:["$scope",function(t){return t.isIPhone=i.isIPhone,t.isAndroid=i.isAndroid,t.magazineKeyQuery=null!=r.magazine_key?"?magazine_key="+r.magazine_key:"",t.launchApp=function(n,r){return e(n,r,{type:t.type,key:t.key,magazineKeyQuery:t.magazineKeyQuery})},t.dismiss=function(){return a.close()}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("payPartDeterminer",["$sce",function(e){var t,n;return n="",t={restrict:"E",templateUrl:"/templates/notes/_paypart",link:function(t,r){return t.$watch("note",function(){var i,a,o,s,l,c,u,d,p,h,m,f,g,v;if(s=null,t.note&&t.note.body){if(n=e.getTrustedHtml(t.note.body),i=$(".separator_pay_free"),a=$(".separator_ui"),i.insertAfter($(r)),l="p, h3, pre, blockquote, figure, ul",u=function(e){return $(e).css("opacity",1),$(e).prevAll(l).css("opacity",1),$(e).nextAll(l).css("opacity",.2)},i.click(function(){return a.insertAfter($(s)),u(s),t.$apply(function(){return t.separatorElem=$(s).attr("name")}),i.css("display","none")}),t.separatorElem=t.note.separator,t.separatorElem&&t.separatorElem.length>0){for(a.insertAfter($(r)),f=$(r).find("div").children(l),d=0,h=f.length;h>d;d++)if(c=f[d],$(c).attr("name")===t.separatorElem){a.insertAfter($(c)),u(c);break}}else a.insertAfter($(r)),o=$(r).find("div").children(l)[0],a.insertAfter($(o)),t.separatorElem=$(o).attr("name"),u(o);for(g=$(r).find("div").children(l),v=[],p=0,m=g.length;m>p;p++)c=g[p],v.push(function(e){return $(e).on("click",function(){return a.insertAfter($(e)),i.css("display","none"),a.css("display","block"),t.$apply(function(){return t.separatorElem=$(e).attr("name")}),u(this)}),$(e).on("mouseover",function(){return s=this,$(e).attr("name")===t.separatorElem?i.css("display","none"):i.css("display","inline"),t.$apply(function(){return t.mouseonElem=$(e).attr("name")}),i.insertAfter($(e))})}(c));return v}})},scope:{note:"=",currentUser:"=",separatorElem:"="},controller:["$scope","$resource",function(){}]}}]),angular.module("noteApp").directive("paywallSeparator",["$timeout","$rootScope",function(e,t){var n;return n={restrict:"A",scope:{note:"=paywallSeparator"},link:function(n){return e(function(){return n.note.is_my_note||t.isPreview?angular.element("div.body-paywall-line-separator").insertAfter("[name='"+n.note.separator+"']"):void 0},0)}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("pickUrlnameModal",["$state","$stateParams","OpenPickUrlnameModalService",function(e,t,n){return{restrict:"A",replace:!0,scope:{state:"@",via:"@"},link:function(e,t){return t.on("click",function(){var t;return t=function(){return location.reload()},n.open(t,e.via)})}}}])}.call(this),function(){"use strict";var e,t,n=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("templates/popover.html",'<div class="renewal-c-popover renewal-c-popover--action renewal-c-popover--top" ng-show="$ctrl.otherList">\n\n  <div ng-if="$ctrl.type===\'timeline\'">\n    <ul>\n      <li class="renewal-c-popover__item" ng-if="!$ctrl.note.isPinned && $ctrl.note.isAuthor">\n        <a ng-click="$ctrl.pinnedNote()">\n          \u30de\u30a4\u30da\u30fc\u30b8\u306b\u56fa\u5b9a\u8868\u793a\n        </a>\n      </li>\n      <li class="renewal-c-popover__item" ng-if="$ctrl.note.isPinned && $ctrl.note.isAuthor">\n        <a ng-click="$ctrl.unPinnedNote()">\n          \u56fa\u5b9a\u8868\u793a\u3092\u89e3\u9664\n        </a>\n      </li>\n      <li class="renewal-c-popover__separator" ng-if="$ctrl.note.isAuthor"></li>\n\n      <li class="renewal-c-popover__item" ng-if="$ctrl.note.isAuthor">\n        <a ng-click="$ctrl.deleteNote($ctrl.note)">\u524a\u9664</a>\n      </li>\n    </ul>\n  </div>\n\n  <div ng-if="($ctrl.type===\'noteDetail\' || $ctrl.type===\'pcTimeline\') && $ctrl.currentUser.is_admin">\n    <ul>\n      <li class="renewal-c-popover__item" ng-if="$ctrl.currentUser.is_admin">\n        <a ng-href="/admin/ml/note_category_trains/new?note_key={{$ctrl.note.key}}" target="_blank">\n          \u30ab\u30c6\u30b4\u30ea\u8ffd\u52a0\n        </a>\n      </li>\n    </ul>\n  </div>\n\n</div>')}]),e=["$window","UserAgent","$scope","$rootScope","Popeye","$resource","CreatorPinnedContents","MessageModal","$q"],t=function(){function e(e,t,n,r,i,a,o,s,l){this.$window=e,this.UserAgent=t,this.$scope=n,this.$rootScope=r,this.Popeye=i,this.$resource=a,this.CreatorPinnedContents=o,this.MessageModal=s,this.$q=l,this.currentUser=this.$window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isSmartPhone=t.isSmartPhone,this.isTablet=t.isTablet}return e.prototype.deleteNote=function(e){var t,n;return n=this,t=this.Popeye.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$scope",function(r){return r.ok=function(){return n.$resource("/api/v1/notes/"+e.id)["delete"]({},function(){return location.reload(),t.close()},function(){return console.log("Error occurred")})},r.cancel=function(){return t.close()}}]})},e.prototype.pinnedNote=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorPinnedContents.save({urlname:t.currentUser.urlname,content_type:"Note",content_id:t.note.id},function(){return e.resolve()},function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},this.MessageModal.confirm({title:"\u30ce\u30fc\u30c8\u3092\u5148\u982d\u306b\u56fa\u5b9a\u3059\u308b",message:"\u3053\u306e\u30ce\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u30ce\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u307e\u3057\u305f",process:e,callback:function(){return location.reload()}})},e.prototype.unPinnedNote=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorPinnedContents["delete"]({urlname:t.currentUser.urlname,id:t.note.pinnedUserNoteId},function(){return e.resolve()},function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},this.MessageModal.confirm({title:"\u56fa\u5b9a\u3057\u305f\u30ce\u30fc\u30c8\u3092\u89e3\u9664\u3059\u308b",message:"\u3053\u306e\u30ce\u30fc\u30c8\u306e\u56fa\u5b9a\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u30ce\u30fc\u30c8\u306e\u56fa\u5b9a\u3092\u89e3\u9664\u3057\u307e\u3057\u305f",process:e,callback:function(){return location.reload()}})},e}(),angular.module("noteApp").directive("popover",function(){return{restrict:"E",scope:{},bindToController:{note:"=",otherList:"=",type:"@"},templateUrl:"templates/popover.html",controller:n.call(e).concat([t]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("/templates/asp/common/recommend_bundle_view.html",'<bundle-view tmpl={{$ctrl.tmpl}} kind={{$ctrl.recommendKind}} size={{$ctrl.size}} slick-config="$ctrl.slickConfig" methods="$ctrl.methods" after-fetch="$ctrl.afterFetch" params="$ctrl.bundleParams" image-size={{$ctrl.imageSize}} ng-if="$ctrl.finishedFetch" ></bundle-view>')}]),e=function(){function e(e,t,n){this.$q=t,this.Bundle=n,this.finishedFetch=!1,this.bundleParams=this.gaParams?{ga:this.gaParams}:{},this.params&&(this.bundleParams=$.extend(this.bundleParams,this.params)),this.fetchBundle()}return e.inject=["$rootScope","$q","Bundle"],e.prototype.fetchBundle=function(e){var t;return null==e&&(e=null),this.kind&&this.size?(t={},t.id=this.kind,t.page=1,t.filter=this.filter,this.params&&this.params.excepts&&(t["excepts[]"]=this.params.excepts),this.Bundle.get(t,function(t){return function(n){var r;return r=null,n.data.contents.forEach(function(e){return null==r&&"Note"===e.contentableType?r=e.content.id:void 0}),t.recommendKind=null!=r?"recommend_"+r:"auto_recommend",t.finishedFetch=!0,e?e.resolve():void 0}}(this),function(t){return console.log(t),e?e.reject(t):void 0})):void 0},e}(),angular.module("noteApp").directive("recommendBundleView",["$compile","$templateRequest",function(){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/common/recommend_bundle_view.html",bindToController:{tmpl:"@",kind:"@",size:"@",slickConfig:"=",methods:"=",afterFetch:"&",filter:"@",params:"=",imageSize:"@",gaParams:"="}}}])}.call(this),function(){"use strict";
var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("/templates/asp/common/recommend_magazine_view.html",'<bundle-view tmpl={{$ctrl.tmpl}} kind={{$ctrl.recommendKind}} size={{$ctrl.size}} slick-config="$ctrl.slickConfig" methods="$ctrl.methods" after-fetch="$ctrl.afterFetch" filter={{$ctrl.filter}} params="$ctrl.bundleParams" image-size={{$ctrl.imageSize}} ng-if="$ctrl.finishedFetch" ></bundle-view>')}]),e=function(){function e(e,t,n){this.$q=t,this.ChildNotes=n,this.finishedFetch=!1,this.bundleParams=this.gaParams?{ga:this.gaParams}:{},this.params&&(this.bundleParams=$.extend(this.bundleParams,this.params)),this.fetchNotes()}return e.inject=["$rootScope","$q","ChildNotes"],e.prototype.fetchNotes=function(e){return null==e&&(e=null),this.ChildNotes.get({parent_type:"Magazine",parent_id:this.magazineId,per:1,page:1},function(t){return function(n){return t.recommendKind=0===n.data.notes.length?"auto_recommend":"recommend_"+n.data.notes[0].id,t.finishedFetch=!0,e?e.resolve():void 0}}(this),function(){return function(t){return console.error(t),e?e.reject(t):void 0}}(this))},e}(),angular.module("noteApp").directive("recommendMagazineView",["$compile","$templateRequest",function(){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/common/recommend_magazine_view.html",bindToController:{tmpl:"@",kind:"@",size:"@",slickConfig:"=",methods:"=",afterFetch:"&",filter:"@",params:"=",imageSize:"@",gaParams:"=",magazineId:"="}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("relatedNoteEditorMenu",function(){return{templateUrl:"/templates/common/related_note_editor_menu",restrict:"A",scope:{note:"="},controller:["$scope",function(e){return e.removeNote=function(){var t,n,r,i,a,o;for(a=e.$parent.$ctrl.relatedNotes,o=[],t=r=0,i=a.length;i>r;t=++r){if(n=a[t],this.note.key===n.key){e.$parent.$ctrl.relatedNotes.splice(t,1);break}o.push(void 0)}return o}}],link:function(e,t){var n,r,i,a,o,s;return n=t.find("div.unit"),r=t.find("a"),t.on("click",function(e){return e.preventDefault(),s(n,r)}),t.find("li").on("click","a",function(e){return e.stopPropagation(),i(n,r)}),s=function(e,t){return a(e)?i(e,t):o(e,t)},o=function(e,t){var n;return e.css("display","block"),t.addClass("active"),n=angular.element(document),n.on("mouseup",function(n){var r;return n.preventDefault(),r=angular.element(n.target),!r.hasClass("active")&&a(e)?i(e,t):void 0})},i=function(e,t){var n;return e.css("display","none"),t.removeClass("active"),n=angular.element(document),n.off("mouseup")},a=function(e){return"none"!==e.css("display")}}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){var a,o;this.$scope=e,this.$http=t,this.$timeout=n,this.$window=r,this.Searches=i,a={},o=function(e){return function(){return e.searchText}}(this),this.$scope.$watch(o,function(e){return function(t){return e.isNotFound=!1,e.suggests=[],!t||t.length<2?void 0:(e.$timeout.cancel(a),a=e.$timeout(function(){return e.Searches.get({context:"note",q:t,sort:"new"}).$promise.then(function(t){var n,r,i,a,o,s,l,c;for(e.suggests=t.data.notes.contents.slice(0,10),n=e.suggests.length,r=a=l=n-1;a>=0;r=a+=-1)if(e.notekey!==e.suggests[r].key){for(c=e.relatedNotes,o=0,s=c.length;s>o;o++)if(i=c[o],i.key===e.suggests[r].key){e.suggests.splice(r,1);break}}else e.suggests.splice(r,1);return e.isNotFound=e.searchText&&e.searchText.length>=2&&0===e.suggests.length})},1e3))}}(this))}return e.inject=["$scope","$http","$timeout","$window","Searches"],e.prototype.addItem=function(e){return this.searchText=null,this.suggests=[],this.relatedNotes.push(e),"fixed"===window.PREFETCH.NOTE.relatedNote.display_mode&&this.relatedNotes.length>window.PREFETCH.NOTE.relatedNote.max_count?alert(""+window.PREFETCH.NOTE.relatedNote.max_count+"\u4ef6\u3092\u8d85\u3048\u3066\u3044\u308b\u305f\u3081\u3001\u8ffd\u52a0\u3057\u305fnote\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002"):void 0},e}(),angular.module("noteApp").directive("relatedNoteInput",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/related_note_setting",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{relatedNotes:"=",notekey:"="}}})}.call(this),function(){"use strict";var e,t,n,r,i,a=[].slice;i=function(){function e(){}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("creatorContentTextNote",function(){return{templateUrl:"/templates/creators/renewal/creator_content_text_note",restrict:"E",scope:{},controller:a.call(i.INJECTS).concat([i]),controllerAs:"$ctrl",bindToController:{note:"=",hasNoAdditionalMenu:"="}}}),r=function(){function e(){}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("creatorContentTalkNote",function(){return{templateUrl:"/templates/creators/renewal/creator_content_talk_note",restrict:"E",scope:{},controller:a.call(r.INJECTS).concat([r]),controllerAs:"$ctrl",bindToController:{note:"=",hasNoAdditionalMenu:"="}}}),t=function(){function e(){}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("creatorContentMovieNote",function(){return{templateUrl:"/templates/creators/renewal/creator_content_movie_note",restrict:"E",scope:{},controller:a.call(t.INJECTS).concat([t]),controllerAs:"$ctrl",bindToController:{note:"=",hasNoAdditionalMenu:"="}}}),n=function(){function e(e,t){this.$window=t,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null)}return e.INJECTS=["$scope","$window"],e}(),angular.module("noteApp").directive("creatorContentSoundNote",function(){return{templateUrl:"/templates/creators/renewal/creator_content_sound_note",restrict:"E",scope:{},controller:a.call(n.INJECTS).concat([n]),controllerAs:"$ctrl",bindToController:{note:"=",hasNoAdditionalMenu:"="}}}),e=function(){function e(e,t){this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isPC=t.isPC,this.isTablet=t.isTablet,this.isSmartPhone=t.isSmartPhone}return e.INJECTS=["$scope","$rootScope"],e}(),angular.module("noteApp").directive("creatorContentImageNote",function(){return{templateUrl:"/templates/creators/renewal/creator_content_image_note",restrict:"E",scope:{},controller:a.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",hasNoAdditionalMenu:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d){this.$state=e,this.$scope=t,this.CreatorContents=n,this.CreatorPickupContents=r,this.MessageModal=i,this.CustomDomainContext=a,this.$rootScope=o,this.CreatorCustomMenus=s,this.Title=l,this.ContentLink=c,this.$timeout=u,this.$stateParams=d,this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.$state.params.urlname,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isPC=this.$rootScope.isPC,this.isTablet=this.$rootScope.isTablet,this.isSmartPhone=this.$rootScope.isSmartPhone,this.isSmartPhone&&(this.kind="creatorTop",this.gaPrefix="creator-timeline"),this.setCallbacks(),this.$rootScope.$on("createNoteFromNavBar",function(){return location.reload()})}return e.INJECTS=["$state","$scope","CreatorContents","CreatorPickupContents","MessageModal","CustomDomainContext","$rootScope","CreatorCustomMenus","Title","ContentLink","$timeout","$stateParams"],e.prototype.initProps=function(){return this.notes=[],this.magazines=[],this.currentPage=0,this.isLoading=!1,this.isLastPage=!1,this.noteArchivesSelects=[],this.noteArchiveSelectedKey=null,this.notesTotalCount=0,this.magazinesTotalCount=0,this.pickupMagazinesCount=0,this.creatorWidgets=[],this.hasNoAdditionalMenu=!1},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$CreatorTopContensDelete",function(t,n){var r;return r=e.notes.indexOf(n),e.notes.splice(r,1)}),this.$scope.$on("$MagazineFollowToggle",function(t,n){var r,i;return i=e.magazines.indexOf(n),r=e.magazines[i],r.isFollowing=!r.isFollowing}),this.sb=this.isSmartPhone?this.$scope.$on("$inViewportElementForPaging",function(){return function(){return e.paging("")}}(this)):this.$scope.$on("$scrollBottom",function(){return function(){return e.paging("")}}(this)),this.$scope.$on("$destroy",function(e){return function(){return e.sb()}}(this))},e.prototype.snakizeNoteProperties=function(e){var t,n,r,i;if(e.is_liked=e.isLiked,e.like_count=e.likeCount,e.anonymous_like_count=e.anonymousLikeCount,e.is_limited=e.isLimited,e.is_treasured_note=e.isTreasuredNote,e.is_author=e.isAuthor,e.external_url=e.externalUrl,e.disable_comment=e.disableComment,e.limited_message=e.limitedMessage,e.audio&&(e.audio.artist_name=e.audio.artistName),e.limitedMessage)for(e.limited_message.user_name=e.limitedMessage.userName,i=e.limitedMessage.magazines,n=0,r=i.length;r>n;n++)t=i[n],t.customDomain&&(t.custom_domain=t.customDomain),t.user.customDomain&&(t.user.custom_domain=t.user.customDomain);return e.priorSale&&(e.prior_sale={},e.prior_sale.activated=e.priorSale.activated,e.prior_sale.first_served_sales_count=e.priorSale.firstServedSalesCount,e.prior_sale.is_sellout=e.priorSale.isSellout,e.prior_sale.now_on_sale=e.priorSale.nowOnSale,e.prior_sale.on_sale_price=e.priorSale.onSalePrice,e.prior_sale.stock_count=e.priorSale.stockCount),e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),this.isSmartPhone?(e.user.user_profile_image_path=e.user.userProfileImagePath,e.sp_eyecatch=e.spEyecatch,e.publish_at=e.publishAt,e.comment_count=e.commentCount,e.can_read=e.canRead):void 0},e.prototype.snakizeMagazineProperties=function(e){return e?(e.cover_rectangle=e.coverRectangle,e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),e.subscriptionInfo&&(e.subscription_info={},e.subscription_info.can_advance_purchase=e.subscriptionInfo.canAdvancePurchase,e.subscription_info.payment_date=e.subscriptionInfo.paymentDate,e.subscription_info.payment_date_carrier=e.subscriptionInfo.paymentDateCarrier,e.subscription_info.renewal_date=e.subscriptionInfo.renewalDate,e.subscription_info.reserved_end_date=e.subscriptionInfo.reservedEndDate,e.subscription_info.reserved_price=e.subscriptionInfo.reservedPrice,e.subscription_info.reserved_start_date=e.subscriptionInfo.reservedStartDate,e.subscription_info.conveniences=e.subscriptionInfo.conveniences),e.hasCoupon&&(e.has_coupon=e.hasCoupon),e.isOneshotSubscribeMagazine?e.is_oneshot_subscribe_magazine=e.isOneshotSubscribeMagazine:void 0):void 0},e.prototype.clickTab=function(e){switch(this.initProps(),this.currentTab=e.kind,this.currentTab){case"home":this.loadNotes(),this.loadPickupContents();break;case"magazine":this.loadMagazines();break;case"search":this.loadArchives(),this.$stateParams.year&&this.$stateParams.month?(this.notes=[],this.loadContents("note",1,""+this.$stateParams.year+"-"+this.$stateParams.month,!0)):this.$stateParams.year&&!this.$stateParams.month&&(this.notes=[],this.loadContents("note",1,""+this.$stateParams.year,!0));break;default:this.loadMenu(e)}return this.Title.set("creator.magazines"===this.$state.current.name||"cdCreator.magazines"===this.$state.current.name?""+this.creator.nickname+"\u306e\u30de\u30ac\u30b8\u30f3\u4e00\u89a7":"creator.ecStore"===this.$state.current.name||"cdCreator.ecStore"===this.$state.current.name?""+this.creator.nickname+"\u306e\u5546\u54c1\u4e00\u89a7":"creator.archives"===this.$state.current.name||"cdCreator.archives"===this.$state.current.name?""+this.creator.nickname+"\u306e\u30a2\u30fc\u30ab\u30a4\u30d6":"creator.archives.year"===this.$state.current.name||"cdCreator.archives.year"===this.$state.current.name?""+this.creator.nickname+"\u306e"+this.$stateParams.year+"\u5e74\u306e\u30ce\u30fc\u30c8":"creator.archives.month"===this.$state.current.name||"cdCreator.archives.month"===this.$state.current.name?""+this.creator.nickname+"\u306e"+this.$stateParams.year+"\u5e74"+ +this.$stateParams.month+"\u6708\u306e\u30ce\u30fc\u30c8":this.creator.nickname)},e.prototype.loadNotes=function(e){return null==e&&(e=1),this.loadContents("note",e)},e.prototype.loadMagazines=function(e){return null==e&&(e=1),this.loadContents("magazine",e)},e.prototype.loadContents=function(e,t,n,r,i){return null==t&&(t=1),null==n&&(n=null),null==r&&(r=!1),null==i&&(i=null),this.isLoading=!0,this.currentKind=e,this.currentPage=t,this.currentMenuId=i,this.CreatorContents.get({urlname:this.urlname,kind:e,page:t,publish_on:n,disabled_pinned:r,menu_id:i},function(e){return function(t){var n,r,i,a,o,s,l,c;if("note"===e.currentKind){for(l=t.data.contents,i=0,o=l.length;o>i;i++)r=l[i],e.notes.push(r);e.notesTotalCount=t.data.totalCount,!e.isCurrentTabFor("home")&&!e.isCurrentTabFor("custom_menu")||e.isPC||1!==e.currentPage?e.isSmartPhone&&e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.notes.length):(e.notes.length<=2?(e.firstViewNotes=e.notes,e.secondViewNotes=[]):(e.firstViewNotes=e.notes.slice(0,2),e.secondViewNotes=e.notes.slice(2)),e.notes=[],e.isSmartPhone&&e.eventInViewport(document.getElementsByClassName("p-timeline__item"),t.data.contents.length))}else{for(c=t.data.contents,a=0,s=c.length;s>a;a++)n=c[a],e.magazines.push(n);e.magazinesTotalCount=t.data.totalCount}return e.isLoading=!1,e.isLastPage=t.data.isLastPage}}(this),function(e){return function(){return e.isLoading=!1}}(this))},e.prototype.loadPickupContents=function(){return this.CreatorPickupContents.get({urlname:this.urlname,kind:"magazine"},function(e){return function(t){return e.magazines=t.data.magazines,e.creatorWidgets=t.data.creatorWidgets,e.pickupMagazinesCount=e.magazines.length}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.loadArchives=function(){var e,t,n,r,i,a;for(i=this.archives,a=[],n=0,r=i.length;r>n;n++)t=i[n],this.noteArchivesSelects.push({key:t.year,value:""+t.year+"\u5e74"}),a.push(function(){var n,r,i,a;for(i=t.details,a=[],n=0,r=i.length;r>n;n++)e=i[n],this.noteArchivesSelects.push({key:e.summaryDate,value:"\u3000"+ +e.month+"\u6708 ("+e.num+")"}),a.push(this.$stateParams.year&&this.$stateParams.month?this.noteArchiveSelectedKey=""+this.$stateParams.year+"-"+this.$stateParams.month:this.$stateParams.year&&!this.$stateParams.month?this.noteArchiveSelectedKey=""+this.$stateParams.year:void 0);return a}.call(this));return a},e.prototype.loadMenu=function(e){var t;return"link"===e.kind?(t={urlname:e.urlname,key:e.noteKey,creator_urlname:this.urlname,current_menu_id:e.id},this.$state.go("showTextNoteFriendly",t)):"tag"===e.kind?this.loadContents("note",1,null,!1,e.id):void 0},e.prototype.paging=function(e){return this.currentPage>0&&!("byhand"!==e&&(this.notes||this.magazines)&&this.currentPage+1===2||this.isLoading||this.isLastPage)?this.isCurrentTabFor("home")||this.isCurrentTabFor("magazine")||this.isCurrentTabFor("custom_menu")?this.loadContents(this.currentKind,this.currentPage+1,null,!1,this.currentMenuId):this.loadContents(this.currentKind,this.currentPage+1,this.noteArchiveSelectedKey,!0):void 0},e.prototype.isCurrentTabFor=function(e){return this.currentTab===e?!0:"custom_menu"!==e||"tag"!==this.currentTab&&"link"!==this.currentTab?!1:!0},e.prototype.onPinnedNote=function(){return this.clickTab("home")},e.prototype.onCreateMagazine=function(){return this.MessageModal.show({message:"\u30de\u30ac\u30b8\u30f3\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f"}),this.clickTab("magazine")},e.prototype.isMySelf=function(){return this.currentUser?this.urlname===this.currentUser.urlname:!1},e.prototype.onChangeNoteArchives=function(){var e;if(this.noteArchiveSelectedKey)return this.notes=[],e=this.noteArchiveSelectedKey.split("-"),2===e.length?this.$state.go("creator.archives.month",{urlname:this.creator.urlname,year:e[0],month:e[1]}):this.$state.go("creator.archives.year",{urlname:this.creator.urlname,year:e[0]})},e.prototype.magazineDescTruncateLen=function(){return this.isCurrentTabFor("magazine")?100:60},e.prototype.callbackMenu=function(e){return this.clickTab(e)},e.prototype.eventInViewport=function(e,t){var n,r;if(e&&(r=t-4,n=t-1,!(0>r)))return this.$timeout(function(t){return function(){return inViewport(e[r],function(e){return t.$scope.$emit("$inViewportElementForPaging",e)}),inViewport(e[n],function(e){return t.isLoading?void 0:t.$scope.$emit("$inViewportElementForPaging",e)})}}(this),500)},e}(),angular.module("noteApp").directive("creatorContents",function(){return{restrict:"E",scope:{},templateUrl:"/templates/creators/renewal/creator_contents",controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",archives:"="}}})}.call(this),function(){"use strict";var e,t,n=[].slice;t=["Popeye","$state","$stateParams"],e=function(){function e(){var e,n,r,i;for(e=r=0,i=t.length;i>r;e=++r)n=t[e],this[n]=arguments[e]}return e.prototype.open=function(){return this.Popeye.openModal({templateUrl:"/templates/modal/renewal/creator_description",controller:["$scope",function(e){return function(t){return t.creator=e.creator,t.close=function(){return e.Popeye.closeCurrentModal()}}}(this)]})},e}(),angular.module("noteApp").directive("creatorDescriptionModal",["Popeye","$state","$stateParams",function(){return{restrict:"E",controller:n.call(t).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"="},template:'<a ng-click="$ctrl.open()"><i class="renewal-p-icon renewal-p-icon--info"></i></a>',scope:{}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$state=e,this.$scope=t,this.CreatorCustomMenus=n,this.CustomDomainContext=r,this.EcService=i,this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.isEcEnabled=this.EcService.isEcEnabled(!1),this.activeMenu=this.HOME_MENU,this.setupMenus(),"creator_top"===this.via&&this.$scope.$on("$stateChangeSuccess",function(e){return function(){return e.activeMenu=e.selectActiveMenu(),e.clickCb({menu:e.activeMenu})}}(this))}return e.INJECTS=["$state","$scope","CreatorCustomMenus","CustomDomainContext","EcService"],e.prototype.HOME_MENU={id:-1,kind:"home"},e.prototype.MAGAZINE_MENU={id:-2,kind:"magazine"},e.prototype.SEARCH_MENU={id:-3,kind:"search"},e.prototype.STORE_MENU={id:-4,kind:"store"},e.prototype.setupMenus=function(){return this.CreatorCustomMenus.get({urlname:this.urlname},function(e){return function(t){var n,r,i,a;for(e.menus=[].concat(e.defaultMenus()),t.data.length<=0&&setTimeout(function(){return e.hasNoAdditionalMenu=!0}),a=t.data,r=0,i=a.length;i>r;r++)n=a[r],e.menus.push(n);return e.activeMenu=e.selectActiveMenu(),"creator_top"===e.via?e.clickCb({menu:e.selectActiveMenu()}):void 0}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.defaultMenus=function(){return[this.HOME_MENU,this.MAGAZINE_MENU,this.STORE_MENU]},e.prototype.getActiveMenuKind=function(e){return"creator.home"===e||"cdCreator.home"===e?"home":"creator.magazines"===e||"cdCreator.magazines"===e?"magazine":"creator.menu"===e||"cdCreator.menu"===e?"menu":"creator.ecStore"===e||"cdCreator.ecStore"===e?"store":"search"},e.prototype.selectActiveMenu=function(){var e,t,n;return(t=this.$state.params.current_menu_id)?this.findMenu(t):(e=this.getActiveMenuKind(this.$state.current.name),"home"===e?this.HOME_MENU:"magazine"===e?this.MAGAZINE_MENU:"menu"===e?(n=this.$state.params.menu_id,this.findMenu(n)):"search"===e?this.SEARCH_MENU:"store"===e?this.STORE_MENU:void 0)},e.prototype.isActiveMenu=function(e){return this.activeMenu.id===e.id},e.prototype.clickSearch=function(){return this.clickCb({menu:this.SEARCH_MENU})},e.prototype.findMenu=function(e){var t,n,r,i;for(i=this.menus,n=0,r=i.length;r>n;n++)if(t=i[n],t.id===Number(e))return t;return null},e}(),angular.module("noteApp").directive("creatorMenus",function(){return{restrict:"E",scope:{},templateUrl:"/templates/creators/renewal/creator_menus",controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{urlname:"=",hasNoAdditionalMenu:"=",via:"@",clickCb:"&",creator:"=",archives:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m){this.$state=e,this.$scope=t,this.$upload=n,this.$filter=r,this.$timeout=i,this.$q=a,this.$window=o,this.$location=s,this.Creators=l,this.MessageModal=c,this.Images=u,this.$rootScope=d,this.CustomDomainContext=p,this.CropperModalService=h,this.Title=m,this.initProps(),this.setCallbacks(),this.initCreator()}return e.INJECTS=["$state","$scope","$upload","$filter","$timeout","$q","$window","$location","Creators","MessageModal","Images","$rootScope","CustomDomainContext","CropperModalService","Title"],e.prototype.initProps=function(){return this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.isCdAccess?(this.urlname=this.CustomDomainContext.key,this.rssPath="/rss"):(this.urlname=this.$state.params.urlname,this.rssPath="/"+this.urlname+"/rss"),this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.tempUpdateParams=this.defaultTempUpdateParams(),this.isSaving=!1,this.isPc=this.$rootScope.isPC,this.isSmartPhone=this.$rootScope.isSmartPhone,this.$rootScope.urlname_for_message=this.urlname,this.$rootScope.urlname_for_tokusyo=this.urlname},e.prototype.defaultTempUpdateParams=function(){return{images:{header:{url:null,key:null,isDelete:!1},profile:{url:null,key:null}},nickname:null,profile:null}},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$UserFollowToggle",function(){return e.creator.isFollowing=!e.creator.isFollowing,e.creator.isFollowing?e.creator.followerCount++:e.creator.followerCount--})},e.prototype.initCreator=function(){return this.Title.set("creator.magazines"===this.$state.current.name||"cdCreator.magazines"===this.$state.current.name?""+this.creator.nickname+"\u306e\u30de\u30ac\u30b8\u30f3\u4e00\u89a7":"creator.ecStore"===this.$state.current.name||"cdCreator.ecStore"===this.$state.current.name?""+this.creator.nickname+"\u306e\u5546\u54c1\u4e00\u89a7":this.creator.nickname),this.snakizeCreatorProperties(this.creator),this.tempUpdateParams.nickname=this.creator.nickname,this.tempUpdateParams.profile=this.creator.profile},e.prototype.snakizeCreatorProperties=function(e){return e.is_following=e.isFollowing,e.user_profile_image_path=e.profileImageUrl},e.prototype.onChangeDisplayMode=function(e){return this.$rootScope.$broadcast("$SwitchDisplayMode",e)},e.prototype.headerImage=function(){return this.tempUpdateParams.images.header.isDelete?null:this.tempUpdateParams.images.header.url?this.tempUpdateParams.images.header.url:this.creator.headerImageUrl},e.prototype.profileImage=function(){return this.tempUpdateParams.images.profile.url?this.tempUpdateParams.images.profile.url:this.creator.profileImageUrl},e.prototype.onCancelProfile=function(){var e;return e=this,this.$timeout(function(){return e.tempUpdateParams=e.defaultTempUpdateParams(),e.tempUpdateParams.nickname=e.creator.nickname,e.tempUpdateParams.profile=e.creator.profile,e.onChangeDisplayMode("view")})},e.prototype.onUploadImage=function(e){"header"===e?this.$rootScope.isPC&&!this.$rootScope.isIE?this.CropperModalService.getFile("creator-header").then(function(t){return function(n){var r;return t.cropData=n.cropData,r=new Blob([t.CropperModalService.base64ToBinary(n.result.cropped)],{type:n.result.mime,encoding:"utf-8"}),t.uploadImage(e,r,n)}}(this)):(angular.element("#header-select-file").click(),this.tempUpdateParams.images.header.isDelete=!1):"profile"===e&&(this.$rootScope.isPC&&!this.$rootScope.isIE?this.CropperModalService.getFile("profile").then(function(t){return function(n){var r;return r=new Blob([t.CropperModalService.base64ToBinary(n.result.cropped)],{type:n.result.mime,encoding:"utf-8"}),t.uploadImage(e,r,n)}}(this)):angular.element("#profile-select-file").click())},e.prototype.onFileSelect=function(e,t){var n;if(e&&0!==e.length)return n=e[e.length-1],n.size>5242880?this.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):this.uploadImage(t,n)},e.prototype.onDeleteImage=function(e){return"header"===e?(this.tempUpdateParams.images.header.resource=null,this.tempUpdateParams.images.header.file=null,this.tempUpdateParams.images.header.isDelete=!0):void 0},e.prototype.uploadImage=function(e,t,n){var r,i,a;return a={url:"/api/v2/images",data:{kind:"tmp_"+e}},angular.isDefined(n)&&(i=n.result.name.split(".")[0],r=n.result.cropped.match(/image\/[a-zA-Z]+/)[0].split("/")[1]),$.extend(!0,a,t instanceof File?{data:{file:t}}:{fileName:i+"."+r,file:t,data:{width:n.cropData.width,height:n.cropData.height,x:n.cropData.x,y:n.cropData.y}}),this.$upload.upload(a).success(function(t){return function(n){return t.$timeout(function(){return"header"===e?(t.tempUpdateParams.images.header.url=n.data.url,t.tempUpdateParams.images.header.key=n.data.key,t.tempUpdateParams.images.header.isDelete=!1):(t.tempUpdateParams.images.profile.url=n.data.url,t.tempUpdateParams.images.profile.key=n.data.key)})}}(this)).error(function(e){return function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"})}}(this))},e.prototype.imageDeletePromiss=function(e){var t,n;return t=this.$q.defer(),n="header"===e?this.creator.headerImageKey||this.tempUpdateParams.images.header.key:this.creator.profileImageKey||this.tempUpdateParams.images.profile.key,this.Images["delete"]({key:n},function(n){return function(){return"header"===e?(n.creator.headerImageUrl=null,n.creator.headerImageKey=null):(n.creator.profileImageUrl=null,n.creator.profileImageKey=null),t.resolve()}}(this),function(e){return function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30e6\u30fc\u30b6\u60c5\u5831\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"}),e.isSaving=!1,t.reject()}}(this)),t.promise},e.prototype.creatorUpdatePromiss=function(){var e,t,n,r,i,a;return n=this.creator.nickname!==this.tempUpdateParams.nickname?this.tempUpdateParams.nickname:void 0,i=this.creator.profile!==this.tempUpdateParams.profile?this.tempUpdateParams.profile:void 0,t=this.tempUpdateParams.images.header.isDelete?void 0:this.tempUpdateParams.images.header.key,a=this.tempUpdateParams.images.profile.key?this.tempUpdateParams.images.profile.key:void 0,e=this.$q.defer(),r={urlname:this.urlname,nickname:n,profile:i,tmp_header_image_key:t,tmp_profile_image_key:a},this.$rootScope.isPC&&!this.$rootScope.isIE&&this.cropData&&(r.crop_data={width:this.cropData.width,height:this.cropData.height,x:this.cropData.x,y:this.cropData.y}),this.Creators.update(r,function(){return function(){return e.resolve()}}(this),function(t){return function(){return t.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30e6\u30fc\u30b6\u60c5\u5831\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"}),t.isSaving=!1,e.reject()}}(this)),e.promise},e.prototype.onSaveProfile=function(){var e;return this.isSaving=!0,e=[],this.tempUpdateParams.images.header.isDelete&&e.push(this.imageDeletePromiss("header")),e.push(this.creatorUpdatePromiss()),e.length>0?this.$q.all(e).then(function(e){return function(){return e.$window.location.reload()}}(this)):(this.onChangeDisplayMode("view"),void(this.isSaving=!1))},e}(),angular.module("noteApp").directive("creatorProfile",function(){return{restrict:"E",scope:{},templateUrl:"/templates/creators/renewal/creator_profile",controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{displayMode:"=",creator:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$state=e,this.$scope=t,this.CustomDomainContext=n,this.CreatorRecommendContents=r,this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.$state.params.urlname}return e.injects=["$state","$scope","CustomDomainContext","CreatorRecommendContents"],e.prototype.createTest=function(){return this.CreatorRecommendContents.save({urlname:this.urlname,content_type:"note",content_ids:[1,2,3]},function(e){return console.log(e)},function(e){return console.log(e)})},e}(),angular.module("noteApp").directive("creatorRecommendNotes",function(){return{restrict:"E",scope:{},templateUrl:"/templates/creators/renewal/creator_recommend_notes",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l){this.$scope=e,this.$rootScope=t,this.Popeye=n,this.$resource=r,this.CreatorPinnedContents=i,this.MessageModal=a,this.$q=o,this.$document=s,this.$timeout=l,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isSmartPhone=this.$rootScope.isSmartPhone,this.isTablet=this.$rootScope.isTablet,this.otherListAdmin=!1}return e.INJECTS=["$scope","$rootScope","Popeye","$resource","CreatorPinnedContents","MessageModal","$q","$document","$timeout"],e.prototype.deleteNote=function(e){var t,n;return n=this,t=this.Popeye.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$scope",function(r){return r.ok=function(){return n.$resource("/api/v1/notes/"+e.id)["delete"]({},function(){return n.$rootScope.$broadcast("$CreatorTopContensDelete",e),t.close()},function(){return console.log("Error occurred")})},r.cancel=function(){return t.close()}}]})},e.prototype.pinnedNote=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorPinnedContents.save({urlname:t.user.urlname,content_type:"Note",content_id:t.note.id},function(){return t.pinnedNoteCallback({target:t.note}),e.resolve()},function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},this.MessageModal.confirm({title:"\u30ce\u30fc\u30c8\u3092\u5148\u982d\u306b\u56fa\u5b9a\u3059\u308b",message:"\u3053\u306e\u30ce\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u30ce\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u307e\u3057\u305f",process:e})},e.prototype.unPinnedNote=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorPinnedContents["delete"]({urlname:t.user.urlname,id:t.note.pinnedUserNoteId},function(){return t.pinnedNoteCallback({target:t.note}),e.resolve()},function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},this.MessageModal.confirm({title:"\u56fa\u5b9a\u3057\u305f\u30ce\u30fc\u30c8\u3092\u89e3\u9664\u3059\u308b",message:"\u3053\u306e\u30ce\u30fc\u30c8\u306e\u56fa\u5b9a\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u30ce\u30fc\u30c8\u306e\u56fa\u5b9a\u3092\u89e3\u9664\u3057\u307e\u3057\u305f",process:e})},e.prototype.toggleOtherListAdmin=function(){return this.otherListAdmin?(this.$document.off("mouseup"),this.otherListAdmin=!1,!1):(this.otherListAdmin=!0,this.$document.on("mouseup",function(e){return function(t){return t.preventDefault(),e.$timeout(function(){return e.otherListAdmin=!1},0),e.$document.off("mouseup")}}(this)),!1)},e}(),angular.module("noteApp").directive("creatorTimelineActions",function(){return{templateUrl:"/templates/creators/renewal/creator_timeline_actions",restrict:"E",scope:{},controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",user:"=",pinnedNoteCallback:"&"}}
})}.call(this),function(){"use strict";var e,t,n=[].slice;t=["$state","$scope","Creators","CustomDomainContext","CreatorArchives"],e=function(){function e(e,t,n,r,i){this.$state=e,this.$scope=t,this.Creators=n,this.CustomDomainContext=r,this.CreatorArchives=i,this.displayMode="view",this.initProps(),this.setCallbacks(),this.loadCreator(),this.loadArchives()}return e.prototype.initProps=function(){return this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.$state.params.urlname},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$SwitchDisplayMode",function(t,n){var r,i;return e.displayMode=n,i=angular.element(".renewal-l-header"),r=angular.element(".footer"),"edit"===n?(i.hide(),r.hide()):(i.show(),r.show())})},e.prototype.loadCreator=function(){return this.Creators.get({urlname:this.urlname},function(e){return function(t){return e.creator=t.data}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.loadArchives=function(){return this.CreatorArchives.get({urlname:this.urlname},function(e){return function(t){return e.archives=t.data}}(this),function(){return function(e){return console.log(e)}}(this))},e}(),angular.module("noteApp").directive("creatorTop",function(){return{restrict:"E",scope:{},templateUrl:"/templates/creators/renewal/creator_top",controller:n.call(t).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("gallery_search/renewal/cropper_canvas.html",'<div> <div class="cropper_canvas" ng-if="$ctrl.imageUrl" style="max-height: calc(100vh - 360px);"> <canvas id="cropImage" class="cropper-hidden" width="100%" ng-init="$ctrl.getCropper()"></canvas> </div> </div>')}]),e=function(){function e(e,t){this.$scope=e,this.$rootScope=t}return e.injects=["$scope","$rootScope"],e.prototype.getCropper=function(){var e;return this.cropImage=angular.element("#cropImage"),e=new Image,e.onload=function(t){return function(){return t.cropperMask(),t.generateCropper(e)}}(this),e.crossOrigin="anonymous",e.src=this.imageUrl},e.prototype.cropperMask=function(){var e;return e=angular.element(".renewal-p-galleryLayout__modalMask"),this.cropImage.on("cropstart",function(){return e.addClass("close-disabled")}),this.cropImage.on("cropend",function(){return e.removeClass("close-disabled")})},e.prototype.generateCropper=function(e){var t,n,r;return t=this.cropImage[0],t.width=this.width||this.height*e.width*1/e.height,t.height=this.height||this.width*e.height*1/e.width,n=t.getContext("2d"),n.drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),r={},this.cropRatio&&Object.keys(this.cropRatio).length>0&&(r.aspectRatio=this.cropRatio.width/this.cropRatio.height),this.cropper=new Cropper(t,r)},e}(),angular.module("noteApp").directive("cropperCanvas",function(){return{restrict:"E",templateUrl:"gallery_search/renewal/cropper_canvas.html",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",scope:{},bindToController:{imageUrl:"=",width:"=",height:"=",cropRatio:"=",cropper:"="}}})}.call(this),function(){"use strict";var e,t,n=[].slice;t=["FollowingBoosterCategory","FollowingBoosterCategoryUsers","FollowingBoosterCategoryMagazines","Followings","$scope","Cookie","$q","$analytics","$stateParams","$timeout"],e=function(){function e(e,t,n,r,i,a,o,s,l,c){this.FollowingBoosterCategory=e,this.FollowingBoosterCategoryUsers=t,this.FollowingBoosterCategoryMagazines=n,this.Followings=r,this.$scope=i,this.Cookie=a,this.$q=o,this.$analytics=s,this.$stateParams=l,this.$timeout=c,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.loading=!1,this.initFBCategory(),this.categories=[],this.selectCategories=[],this.selectCategoriesSize=0,this.followingBoosterStep=1,this.willFollowUserIds=[],this.followStart=!1,this.stepBack=!1,this.$scope.$on("repeatFinishedEventFired",function(e){return function(){return e.loading=!1}}(this)),this.$scope.$on("$MagazineFollowToggle",function(){return function(e,t){return t.isFollowing=!t.isFollowing}}(this))}return e.prototype.initFBCategory=function(){return this.FollowingBoosterCategory.get().$promise.then(function(e){return function(t){return angular.forEach(t.data.categories,function(t){return t.isChecked=!1,e.categories.push(t)})}}(this),function(){return function(e){return console.error(e)}}(this))},e.prototype.selectCategory=function(e){return e.isChecked=!e.isChecked,e.isChecked?this.selectCategoriesSize++:this.selectCategoriesSize--},e.prototype.step=function(e){if("next"===e){if(1===this.followingBoosterStep){if(!this.selectCategoriesSize)return;this.loadCategoryUsers()}if(2===this.followingBoosterStep){if(!this.selectCategoriesSize)return;this.followUsers().then(function(e){return function(){return e.stepBack?void 0:e.loadCategoryMagazines()}}(this))}return this.followingBoosterStep++}return this.followingBoosterStep--,this.stepBack=1===this.followingBoosterStep?!1:!0},e.prototype.skip=function(){return location.href=this.$stateParams.redirectPath?this.$stateParams.redirectPath:"/"},e.prototype.loadCategoryUsers=function(){return this.loading=!0,this.categoryUsers=[],angular.forEach(this.categories,function(e){return function(t){return t.isChecked?(e.$analytics.eventTrack("category",{category:"following-booster",label:t.engName}),e.FollowingBoosterCategoryUsers.get({id:t.id}).$promise.then(function(t){return e.categoryUsers.push(t.data),e.$timeout(function(){return e.loading=!1},500)},function(e){return console.error(e)})):void 0}}(this))},e.prototype.loadCategoryMagazines=function(){return this.loading=!0,this.categoryMagazines=[],angular.forEach(this.categories,function(e){return function(t){return t.isChecked?e.FollowingBoosterCategoryMagazines.get({id:t.id}).$promise.then(function(t){return e.categoryMagazines.push(t.data),e.$timeout(function(){return e.loading=!1},500)},function(e){return console.error(e)}):void 0}}(this))},e.prototype.snakizeCreatorProperties=function(e){return e.is_following=e.isFollowing,e.user_profile_image_path=e.profileImageUrl,e.is_official=e.isOfficial,e.is_myself=e.isMyself,e.custom_domain=e.customDomain},e.prototype.initCategory=function(e){return e.isAllChecked=!0},e.prototype.initCategoryUser=function(e){return this.stepBack?void 0:e.checked=!0},e.prototype.allCheck=function(e){var t,n,r,i;for(i=e.users,n=0,r=i.length;r>n;n++)if(t=i[n],!t.checked)return void(e.isAllChecked=!1);return e.isAllChecked=!0},e.prototype.toggleCategoryCheck=function(e){var t,n,r,i,a,o,s,l,c;if(e.isAllChecked){for(o=e.users,l=[],n=0,i=o.length;i>n;n++)t=o[n],l.push(t.checked=!1);return l}for(s=e.users,c=[],r=0,a=s.length;a>r;r++)t=s[r],c.push(t.checked=!0);return c},e.prototype.willFollowUsersCount=function(){var e,t,n,r,i;for(t=0,i=angular.element(".category-user-check"),n=0,r=i.length;r>n;n++)e=i[n],e.checked&&t++;return t},e.prototype.followUsers=function(){var e,t,n,r,i,a,o,s;if(!this.followStart){if(this.followStart=!0,a=[],i=null,r=0,t=angular.element(".category-user-check"),0===t.length)return n=this.$q.defer(),n.resolve(),n.promise;for(o=0,s=t.length;s>o;o++)e=t[o],e.checked&&(a.push(+e.value),this.$analytics.eventTrack("user",{category:"following-booster",label:""+ +e.value})),r++,r===t.length&&(i=this.follow(a),this.followStart=!1);return i}},e.prototype.magazineDescTruncateLen=function(){return 100},e.prototype.finishBooster=function(){return location.href=this.$stateParams.redirectPath?this.$stateParams.redirectPath:"/"},e.prototype.follow=function(e){var t,n;return t=this.$q.defer(),0===e.length?(t.resolve(),t.promise):(n=new this.Followings,n.$save({user_ids:e.join(",")},function(){return function(e){return null!=e.error?t.reject():t.resolve()}}(this),function(){return function(e){return t.reject(),console.error(e)}}(this)),t.promise)},e.prototype.snakizeMagazineProperties=function(e){return e?(e.cover_rectangle=e.coverRectangle,e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),e.subscriptionInfo&&(e.subscription_info={},e.subscription_info.can_advance_purchase=e.subscriptionInfo.canAdvancePurchase,e.subscription_info.payment_date=e.subscriptionInfo.paymentDate,e.subscription_info.payment_date_carrier=e.subscriptionInfo.paymentDateCarrier,e.subscription_info.renewal_date=e.subscriptionInfo.renewalDate,e.subscription_info.reserved_end_date=e.subscriptionInfo.reservedEndDate,e.subscription_info.reserved_price=e.subscriptionInfo.reservedPrice,e.subscription_info.reserved_start_date=e.subscriptionInfo.reservedStartDate,e.subscription_info.conveniences=e.subscriptionInfo.conveniences),e.hasCoupon&&(e.has_coupon=e.hasCoupon),e.isOneshotSubscribeMagazine?e.is_oneshot_subscribe_magazine=e.isOneshotSubscribeMagazine:void 0):void 0},e}(),angular.module("noteApp").directive("followRecommend",function(){return{restrict:"E",controller:n.call(t).concat([e]),controllerAs:"$ctrl",bindToController:{},templateUrl:"/templates/follow_recommend/index",scope:{}}})}.call(this),function(){"use strict";var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r=[].slice;t=["$upload","StockPhotoImages","UserImages","UploadStockPhotoImages","$rootScope","$stateParams","$state","$scope","AutoHideNotification"],e=function(){function e(e,t,r,i,a,o,s,l,c){this.$upload=e,this.StockPhotoImages=t,this.UserImages=r,this.UploadStockPhotoImages=i,this.$rootScope=a,this.$stateParams=o,this.$state=s,this.$scope=l,this.AutoHideNotification=c,this.onSelectSelfImage=n(this.onSelectSelfImage,this),this.onFileSelect=n(this.onFileSelect,this),this.image_urls=[],this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.init(),this.onSelectSelfImage(),this.imageGalleryTitle="\u904e\u53bb\u306bnote\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u753b\u50cf",this.imageGalleryLead='\u3053\u306e\u753b\u9762\u304b\u3089\u300c<a href="https://note.mu/info/n/nd06624fc3e58" target="_blank" class="u-linkPrimary">\u307f\u3093\u306a\u306e\u30d5\u30a9\u30c8\u30ae\u30e3\u30e9\u30ea\u30fc(\u03b2)</a>\u300d\u306b\u51fa\u54c1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002',this.eventSelectImage=this.$rootScope.$on("editStockPhoto",function(e){return function(t,n){var r;return r={keywords:n.keywords,description:n.description},e.UploadStockPhotoImages.update({id:n.stockPhotoImageId},r,function(e){return console.log(e)})}}(this)),this.eventMenu=this.$rootScope.$on("selectImageGalleryMenu",function(e){return function(t,n){return n.query?void 0:e.$state.go("creatorGallery",{},{reload:!0})}}(this)),this.$scope.$on("$destroy",function(e){return function(){return e.eventMenu(),e.eventSelectImage(),e.eventAddStockPhoto?e.eventAddStockPhoto():void 0}}(this))}return e.prototype.init=function(){return this.imageGalleryModel={search:{endpoint:""},menus:[],getImages:function(){return this.getImagesObj.images&&this.getImagesObj.images.isLastPage||this.getImagesObj.loadingFlag?void 0:(this.getImagesObj.loadingFlag=!0,this.getImagesObj.getImagesFn.get({page:this.getImagesObj.page,query:this.getImagesObj.query,order:this.getImagesObj.order,size:this.getImagesObj.size,from:this.getImagesObj.date.from||null,to:this.getImagesObj.date.to||null,shared:this.getImagesObj.sharedFlag},function(e){return function(t){return 1===e.getImagesObj.page?e.getImagesObj.images=t.data:(angular.forEach(t.data.contents,function(t){return e.getImagesObj.images.contents.push(t)}),e.getImagesObj.images.isLastPage=t.data.isLastPage),e.getImagesObj.totalCount=t.data.totalCount,setTimeout(function(){return e.getImagesObj.loadingFlag=!1},300),e.getImagesObj.page+=1}}(this),function(){return function(e){return console.log(e)}}(this)))},masonryOptions:{gutterSize:10,gridWidth:204},backImages:function(){return this.getImagesObj.images.contents=[],this.getImagesObj.page=(this.getImagesObj.currentPage-1)*this.getImagesObj.limitPage-(this.getImagesObj.limitPage-1),this.getImagesObj.loadingFlag=!1,this.getImagesObj.images.isLastPage=!1,this.getImagesObj.currentPage-=1,this.getImages()},nextImages:function(){return this.getImagesObj.currentPage+=1,this.getImagesObj.images.contents=[],this.getImages()},getImagesObj:{images:{},loadingFlag:!1,page:1,size:25,query:"",order:"",date:{},user_id:this.currentUser.id,getImagesFn:this.UserImages,type:"self",totalCount:null,limitPage:5,currentPage:1,sharedFlag:!1},initObj:function(){return this.getImagesObj.images={},this.getImagesObj.loadingFlag=!1,this.getImagesObj.page=1,this.getImagesObj.query="",this.getImagesObj.order=""}},this.imageGalleryModel.getImages()},e.prototype.onFileSelect=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(this.$upload.upload({url:"/api/v2/image_upload/stock_photo_images",file:t}).success(function(e){return function(t){return e.image_urls.push(t.data.url)}}(this)));return i},e.prototype.onSelectSelfImage=function(){return this.eventAddStockPhoto=this.$rootScope.$on("addImageToStockPhoto",function(e){return function(t,n){var r;if(!n.stockPhotoImageId||"deleted"===n.status)return n.isStockPhoto?void alert("\u307f\u3093\u306a\u306e\u30d5\u30a9\u30c8\u30ae\u30e3\u30e9\u30ea\u30fc(\u03b2)\u306b\u8ffd\u52a0\u6e08\u307f\u3067\u3059"):(r=new e.UploadStockPhotoImages,r.image_id=n.id,r.self_flag=!0,r.keywords=n.keywords,r.description=n.description,r.$save(null,function(t){return e.imageGalleryModel.getImagesObj.images.contents.splice(n.index,1,t.data),e.AutoHideNotification.success("\u307f\u3093\u306a\u306e\u30d5\u30a9\u30c8\u30ae\u30e3\u30e9\u30ea\u30fc(\u03b2)\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002")},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}))}}(this))},e}(),angular.module("noteApp").directive("creatorGallery",function(){return{restrict:"E",controller:r.call(t).concat([e]),controllerAs:"$ctrl",bindToController:{},templateUrl:"/templates/creator_gallery/index",scope:{}}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("layout/renewal/gallery_evaluation.html",'<ul class="gallery-evaluation button-group" style="justify-content: flex-end;"> <li><a class="button" ng-click="evaluation(image.stockPhotoImageId, \'negative\', $event)">negative</a></li> <li><a class="button" ng-click="evaluation(image.stockPhotoImageId, \'poor\', $event)">poor</a></li> </ul>')}]),angular.module("noteApp").directive("galleryEvaluation",function(){return{restrict:"E",templateUrl:"layout/renewal/gallery_evaluation.html",scope:{image:"="},link:function(){},controller:["$scope","EvaluateStockPhotoImages",function(e,t){return e.evaluation=function(e,n,r){return r.stopPropagation(),!angular.element(r.target).hasClass("is--active")&&confirm(""+n+"\u306b\u3057\u307e\u3059\u3001\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")?t.update({id:e},{evaluation:n},function(e){return console.log("stock_photo_image_id:"+e.data.id+" is "+e.data.evaluation+" evaluation."),angular.element(r.target).addClass("is--active")},function(e){return console.log(e)}):void 0}}]}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("layout/renewal/gallery_paging.html",'<ul ng-if="totalPage >= 2 && getImagesObj.images.contents.length > 0" class="p-galleryPaging"> <li ng-if="((getImagesObj.images.contents.length * getImagesObj.currentPage >= (getImagesObj.size * getImagesObj.limitPage) * getImagesObj.currentPage) || getImagesObj.images.isLastPage) && getImagesObj.currentPage >= 2"><a ng-click="backImages()" class="renewal-c-button--medium">\u524d\u3078</a></li> <li ng-if="(getImagesObj.images.contents.length * getImagesObj.currentPage >= (getImagesObj.size * getImagesObj.limitPage) * getImagesObj.currentPage && totalPage >= 2 && !getImagesObj.loadingFlag)"><a ng-click="nextImages()" class="renewal-c-button--medium">\u6b21\u3078</a></li> </ul>')}]),angular.module("noteApp").directive("galleryPaging",function(){return{restrict:"E",templateUrl:"layout/renewal/gallery_paging.html",scope:{nextImages:"&",backImages:"&",getImagesObj:"="},link:function(){},controller:["$scope","$rootScope","$interval",function(e,t,n){return e.intervalPromise=n(function(){return e.getImagesObj.totalCount>0?(e.totalPage=Math.ceil(e.getImagesObj.totalCount/(e.getImagesObj.size*e.getImagesObj.limitPage)),n.cancel(e.intervalPromise)):void 0})}]}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("gallery_search/renewal/gallery_search.html","<button ng-click='searchClickHandler()' type='submit'></button> <angucomplete-alt id='gallery_search_autocomplete' minlength='1' pause='100' placeholder='\u30ad\u30fc\u30ef\u30fc\u30c9\u691c\u7d22' local-data='localData' local-search='localSearch' search-fields='title' selected-object='searchSelected' title-field='name' ng-keydown='searchKeydownHandler($event, $item)' match-class='highlight'></angucomplete-alt>")}]),angular.module("noteApp").directive("gallerySearch",function(){return{restrict:"E",templateUrl:"gallery_search/renewal/gallery_search.html",link:function(){},scope:{search:"="},controller:["$scope","$rootScope",function(e,t){return e.searchSelected=function(e){var n;return e?(n=e.originalObject,t.$emit("selectImageGalleryKeyword",n.name)):void 0},e.searchResponse=function(e){var t,n,r,i,a;for(t=[],r=e.data.suggest.suggestions||[],i=0,a=r.length;a>i;i++)n=r[i],t.push({name:n.suggestion});return t},e.localData=[],e.localSearch=function(e,t){return t},e.searchClickHandler=function(){var e;return e=angular.element("#gallery_search_autocomplete_value").val(),t.$emit("selectImageGalleryKeyword",e)},e.searchKeydownHandler=function(e){var n;return 13===e.which||"Enter"===e.key&&229===e.which?(n=angular.element("#gallery_search_autocomplete_value").val(),t.$emit("selectImageGalleryKeyword",n)):void 0}}]}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("getty_search/renewal/getty_search.html","\n<button ng-click='$ctrl.searchClickHandler()' type='submit'></button>\n<input type='text' minlength='1' placeholder='\u30ad\u30fc\u30ef\u30fc\u30c9\u691c\u7d22' ng-model='phrase' ng-keypress='$ctrl.searchKeypressHandler($event, $item)'></input>\n")}]),e=function(){function e(e,n){this.$scope=e,this.$rootScope=n,this.searchKeypressHandler=t(this.searchKeypressHandler,this),this.searchClickHandler=t(this.searchClickHandler,this)}return e.injects=["$scope","$rootScope"],e.prototype.searchClickHandler=function(){return this.$rootScope.$emit("selectImageGalleryKeyword",this.$scope.phrase)},e.prototype.searchKeypressHandler=function(e){return 13===e.which||"Enter"===e.key&&229===e.which?this.$rootScope.$emit("selectImageGalleryKeyword",this.$scope.phrase):void 0},e}(),angular.module("noteApp").directive("gettySearch",function(){return{restrict:"E",templateUrl:"getty_search/renewal/getty_search.html",scope:{},controller:n.call(e.injects).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n,r,i,a,o){this.$scope=e,this.$rootScope=n,this.GettyImagesDetail=r,this.MessageModal=i,this.$document=a,this.$timeout=o,this.selectImage=t(this.selectImage,this),this.notSubmitable=!0,this.keydownEsc()}return e.injects=["$scope","$rootScope","GettyImagesDetail","MessageModal","$document","$timeout"],e.prototype.selectImage=function(e){return this.cropper.reducedScale=1*this.canvas.width/this.cropperWidth(),this.$rootScope.$emit("uploadGettyImage",this.canvas,e.id,this.altText,this.cropper,this.kind),this.closeModal(),this.closeFn()},e.prototype.selectTag=function(e){return this.$rootScope.$emit("selectImageGalleryKeyword",e),angular.element("#gallery_search_autocomplete_value").val(e),this.closeModal()},e.prototype.closeModal=function(){return this.$timeout(function(e){return function(){return e.$document.off("keydown.galleryModal"),e.openSelectModal=!1}}(this))},e.prototype.keydownEsc=function(){return this.$document.on("keydown.galleryModal",function(e){return function(t){return 27===t.which?e.closeModal():void 0}}(this))},e.prototype.cropperWidth=function(){return angular.element(".modal-image").width()},e.prototype.getDiscription=function(){return this.notSubmitable=!0,this.imageDescription={},this.GettyImagesDetail.get({id:this.gettyId},function(e){return function(t){var n;return e.imageDescription=t.data,n=new Image,n.onload=function(){return e.generateCanvas(n),e.notSubmitable=!1,e.$scope.$apply()},n.crossOrigin="anonymous",n.src=e.imageDescription.src}}(this),function(e){return function(){return alert("\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u3002\n\u73fe\u5728\u3053\u306e\u753b\u50cf\u306f\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002"),e.closeModal()}}(this))},e.prototype.generateCanvas=function(e){var t;return this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,t=this.canvas.getContext("2d"),t.drawImage(e,0,0,e.width,e.height)},e}(),angular.module("noteApp").directive("gettySelectModal",function(){return{restrict:"E",controller:n.call(e.injects).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/modal/renewal/_getty_gallery_select",scope:{},bindToController:{image:"=",openSelectModal:"=",closeFn:"&",gettyId:"=",ratio:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n){this.$rootScope=e,this.$scope=n,this.close=t(this.close,this),this.changeAssetFamilies=t(this.changeAssetFamilies,this),this.changeOrientations=t(this.changeOrientations,this),this.setImageGalleryOrder=t(this.setImageGalleryOrder,this),this.currentUser=window.PREFETCH.NOTE.user,this.query=this.getImagesObj.query,this.order=this.getImagesObj.order,this.page=this.getImagesObj.page,this.scrollFlag=!1,this.loadingFlag=this.getImagesObj.loadingFlag,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.getImages(),this.eventKeyword=this.$rootScope.$on("selectImageGalleryKeyword",function(e){return function(t,n){return e.getImagesObj.query=n,e.getImagesObj.sharedFlag=!1,e.getImagesObj.page=1,e.getImagesObj.images=null,e.getImages()}}(this)),this.eventMenu=this.$rootScope.$on("selectImageGalleryMenu",function(e){return function(t,n){return e.getImagesObj.query=n.query,e.getImagesObj.sharedFlag=!1,e.getImagesObj.page=1,e.getImagesObj.images=null,e.getImages()}}(this)),this.eventDateSort=this.$rootScope.$on("selectImageGalleryDateSort",function(e){return function(t,n){return e.getImagesObj.date=n,e.getImagesObj.page=1,e.getImagesObj.images=null,e.getImages()}}(this)),this.eventStatusSort=this.$rootScope.$on("selectImageGalleryStatusSort",function(e){return function(t,n){return e.getImagesObj.sharedFlag="all"===n.status?!1:!0,e.getImagesObj.page=1,e.getImagesObj.images=null,e.getImages()}}(this)),this.$scope.$on("$destroy",function(e){return function(){return e.eventKeyword(),e.eventMenu(),e.eventDateSort&&e.eventDateSort(),e.eventStatusSort&&e.eventStatusSort(),e.eventScroll?e.eventScroll():void 0}}(this)),this.observeScrollPosition()}return e.injects=["$rootScope","$scope"],e.prototype.setImageGalleryOrder=function(e){return this.getImagesObj.order=e},e.prototype.changeOrientations=function(e,t){return t?this.getImagesObj.orientations.push(e):this.getImagesObj.orientations=this.getImagesObj.orientations.filter(function(){return function(t){return e!==t}}(this))},e.prototype.changeAssetFamilies=function(e,t){return t?this.getImagesObj.assetFamilies.push(e):this.getImagesObj.assetFamilies=this.getImagesObj.assetFamilies.filter(function(){return function(t){return e!==t}}(this))},e.prototype.close=function(){return this.closeFn()},e.prototype.observeScrollPosition=function(){return"self"===this.getImagesObj.type?this.eventScroll=this.$rootScope.$on("$scrollBottom",function(e){return function(){return e.getImagesObj.images.contents.length*e.getImagesObj.currentPage>=e.getImagesObj.size*e.getImagesObj.limitPage*e.getImagesObj.currentPage?void 0:e.getImages()}}(this)):angular.element("#image-gallery-container").off("scroll").on("scroll",function(e){return function(){var t,n,r,i,a;if(!(e.getImagesObj.images.contents.length*e.getImagesObj.currentPage>=e.getImagesObj.size*e.getImagesObj.limitPage*e.getImagesObj.currentPage)||e.getty)return r=angular.element("#image-gallery-container"),t=angular.element(".angular-grid"),n=angular.element(".renewal-p-galleryLayout__header"),i=t.height()+n.height(),a=r.height()+r.scrollTop(),.5*i>i-a?e.getImages():void 0}}(this))},e}(),angular.module("noteApp").directive("imageGallery",function(){return{restrict:"E",controller:n.call(e.injects).concat([e]),controllerAs:"$igCtrl",templateUrl:"/templates/modal/renewal/image_gallery",replace:!1,bindToController:!0,scope:{menus:"=",getImages:"&",search:"=",masonryOptions:"=",getImagesObj:"=",images:"=",closeFn:"&",imageGalleryTitle:"=",imageGalleryLead:"=",getty:"=",ratio:"=",kind:"=",type:"=",nextImages:"&",backImages:"&"},link:function(){}}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("image_gallery/renewal/image_gallery_check_option.html",'<ul>\n  <li style="display: inline;" ng-repeat="option in options track by $index">\n    <label style="display: inline; margin-left: 1em;">\n      <input type="checkbox" ng-value="true" ng-model="$parent.selected[$index]" ng-change="onChangeItemState(option.value, $parent.selected[$index])"/>{{option.label}}\n    </label>\n  </li>\n</ul>')}]),angular.module("noteApp").directive("imageGalleryCheckOption",function(){return{restrist:"E",templateUrl:"image_gallery/renewal/image_gallery_check_option.html",replace:!0,scope:{options:"=",onChangeItemState:"="},controller:["$scope",function(e){var t;return t=[],e.options.forEach(function(){return function(n){return e.onChangeItemState(n.value,n.checked),t.push(n.checked)}}(this)),e.selected=t}]}})}.call(this),function(){"use strict";var e;angular.module("noteApp").run(["$templateCache",function(e){return e.put("image_gallery/renewal/image_gallery_date_sort.html","<ul class=\"p-sortNav\">\n  <li>\n    <span class='u-flexboxBasic date-tab'>\n      {{dateTitle}}\n      <i class='renewal-p-icon renewal-p-icon--caretDown u-mlXXXS date-tab'></i>\n    </span>\n    <div class='renewal-c-popover--sortNavAddFooter renewal-c-popover--bottomRight' ng-show='flipDate'>\n      <ul>\n        <li class='renewal-c-popover__item' ng-click=\"changeCondition(null, null, null); toggleDate()\">\u3059\u3079\u3066</li>\n        <li class='renewal-c-popover__item' ng-click=\"changeCondition(null, startDateFormatter(month.key, 'YYYY-MM-DD'), endDateFormatter(month.key, 'YYYY-MM-DD')); toggleDate()\" ng-repeat='month in monthes'>{{monthlyDateFormatter(month.key, 'YYYY\u5e74M\u6708')}}</li>\n      </ul>\n      <div class='renewal-c-popover__footer'><a ng-click='setPikaday()'>\u671f\u9593\u3092\u6307\u5b9a</a></div>\n    </div>\n  </li>\n</ul>")}]),angular.module("noteApp").directive("imageGalleryDateSort",["$timeout","$document",function(t,n){return{restrict:"E",templateUrl:"image_gallery/renewal/image_gallery_date_sort.html",link:function(e){return n.on("click",function(n){return t(angular.element(n.target).hasClass("date-tab")?function(){return function(){return e.flipDate=e.flipDate?!1:!0}}(this):function(){return function(){return e.flipDate=!1}}(this))})},controller:["$scope","$rootScope","Popeye","$state",function(t,n,r){var i,a,o,s;for(t.dateTitle="\u65e5\u6642\u3067\u7d5e\u308a\u8fbc\u3080",t.flipDate=!1,t.toggleDate=function(){return t.flipDate=!t.flipDate},t.monthes=[],a=s=0;12>s;a=++s)i=moment(),o=i.add(-a,"months"),t.monthes.push({key:o.format("YYYY-MM"),value:o.format("YYYY\u5e74M\u6708")});return t.changeCondition=function(r,i,a){var o;return o={from:i,to:a},t.dateTitle=e(i,a),n.$emit("selectImageGalleryDateSort",o)},t.startDateFormatter=function(e,t){var n,r,i;return n=e.split("-"),n[2]?(r=new Date(n[0],n[1]-1,n[2]),i=moment(r).format(t)):(r=new Date(n[0],n[1]-1,1),i=moment(r).format(t)),i},t.endDateFormatter=function(e,t){var n,r,i;return n=e.split("-"),n[2]?(r=new Date(n[0],n[1]-1,n[2]),i=moment(r).format(t)):(r=new Date(n[0],n[1],0),i=moment(r).format("YYYY-MM-DD")),i},t.monthlyDateFormatter=function(e,t){var n,r,i;return i=e.split("-"),n=new Date(i[0],i[1]-1,1),r=moment(n).format(t)},t.setPikaday=function(){return function(){var e,n;return n=t,e=r.openModal({templateUrl:"/templates/modal/renewal/select_date",controller:["$scope","$resource","$q","$window","$rootScope",function(t){return t.ok=function(){var r,i,a,o;return i=null,r=null,a=document.getElementById("start_date").value,o=document.getElementById("end_date").value,a&&(t.startPicker&&t.startPicker.getDate()?(self.startPicker=t.startPicker,i=moment(self.startPicker.getDate()).format("YYYY-MM-DD")):self.startPicker&&self.startPicker.getDate()&&(i=moment(self.startPicker.getDate()).format("YYYY-MM-DD"))),o&&(t.endPicker&&t.endPicker.getDate()?(self.endPicker=t.endPicker,r=moment(self.endPicker.getDate()).format("YYYY-MM-DD")):self.endPicker&&self.endPicker.getDate()&&(r=moment(self.endPicker.getDate()).format("YYYY-MM-DD"))),n.changeCondition(null,i,r),n.toggleDate(),e.close()},t.cancel=function(){return self.startPicker=t.startPicker,e.close()},t.changeDate=function(e){return"from"===e?(self.startPicker=t.startPicker,t.endPicker.setMinDate(t.startPicker.getDate())):"to"===e?(self.endPicker=t.endPicker,t.startPicker.setMaxDate(t.endPicker.getDate())):void 0}}]}),e.opened.then(function(){var e,t,n,r,i;return self.dateFromParam&&(n=document.getElementById("start_date"),n.value=moment(self.dateFromParam).format("YYYY\u5e74M\u6708D\u65e5"),e=new Date(self.dateFromParam),r=new Pikaday,r.setDate(self.dateFromParam),self.startPicker=r),self.dateToParam?(i=document.getElementById("end_date"),i.value=moment(self.dateToParam).format("YYYY\u5e74M\u6708D\u65e5"),e=new Date(self.dateToParam),t=new Pikaday,t.setDate(self.dateToParam),self.endPicker=t):void 0})}}(this)}]}}]),e=function(e,t){var n,r,i,a,o,s,l,c,u;return n="",e&&t?(o=e.split("-"),s=new Date(o[0],o[1]-1,1),i=moment(s).format("YYYY-MM-DD"),c=t.split("-"),u=new Date(c[0],c[1],0),a=moment(u).format("YYYY-MM-DD"),e===i&&t===a?n=moment(s).format("YYYY\u5e74M\u6708"):(l=moment(e).format("YYYY\u5e74M\u6708D\u65e5"),r=moment(t).format("YYYY\u5e74M\u6708D\u65e5"),n=l===r?l:""+l+"\u301c"+r)):e?n=""+moment(e).format("YYYY\u5e74M\u6708D\u65e5")+"\u4ee5\u964d":t?n=""+moment(t).format("YYYY\u5e74M\u6708D\u65e5")+"\u4ee5\u524d":e||t||(n="\u65e5\u6642\u3067\u7d5e\u308a\u8fbc\u3080"),n}}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("image_gallery/renewal/image_gallery_menu.html",'<div class="renewal-p-galleryLayout__menu">\n  <div ng-if="getty"><div class="renewal-p-galleryLayout__search p-searchForm--gallery"><getty-search></getty-search></div><image-gallery-sort-order sort-orders="sortOrders" on-change-order="changeOrder" style="display: inline-block"></image-gallery-sort-order><image-gallery-check-option options="orientationsItems" on-change-item-state="onChangeOrientations" style="display: inline-block"></image-gallery-check-option><image-gallery-check-option options="assetFamilyItems" on-change-item-state="onChangeAssetFamilies" style="display: inline-block"></image-gallery-check-option><ul class="renewal-p-galleryLayout__category" ng-if="menu.length>0"><li ng-class="{\'active\' : query == keyword.query}" ng-repeat="keyword in menu"><a href="" ng-click="keywordSearch(keyword.query)">{{keyword.showName}}</a></li></ul></div>\n\n  <div ng-if="!getty"><div class="renewal-p-galleryLayout__search p-searchForm--gallery"><gallery-search ng-if="!!search.endpoint" search="search"></gallery-search></div><ul class="renewal-p-galleryLayout__category" ng-if="menu.length>0"><li ng-class="{\'active\' : query == keyword.query}" ng-repeat="keyword in menu"><a href="" ng-click="keywordSearch(keyword.query)">{{keyword.showName}}</a></li></ul></div>\n</div>')}]),angular.module("noteApp").directive("imageGalleryMenu",function(){return{restrict:"E",templateUrl:"image_gallery/renewal/image_gallery_menu.html",replace:!0,scope:{query:"=",menu:"=",search:"=",getty:"=",onChangeOrder:"=",onChangeOrientations:"=",onChangeAssetFamilies:"="},link:function(){},controller:["$scope","$rootScope",function(e,t){return e.keywordSearch=function(e){var n;
return n={query:e},t.$emit("selectImageGalleryMenu",n)},e.sortOrders=[["best_match","best match"],["most_popular","most popular"],["newest","newest"]],e.assetFamilyItems=[{value:"editorial",label:"Editorial",checked:!0},{value:"creative",label:"Creative",checked:!0}],e.orientationsItems=[{value:"horizontal",label:"\u6a2a\u9577",checked:!0},{value:"vertical",label:"\u7e26\u9577",checked:!0},{value:"square",label:"\u6b63\u65b9\u5f62",checked:!0}],e.changeOrder=function(t){return e.onChangeOrder(t)}}]}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("image_gallery/renewal/image_gallery_sort_order.html",'<ul><li style="display: inline;" ng-repeat="sortOrder in sortOrders track by $index"><label style="display: inline; margin-left: 1em;"><input name="image-gallery-sort-order" type="radio" ng-value="$index" ng-model="$parent.selected" ng-change="$parent.onChangeOrder(sortOrder[0])"/>{{sortOrder[1]}}</label></li></ul>')}]),angular.module("noteApp").directive("imageGallerySortOrder",function(){return{restrist:"E",templateUrl:"image_gallery/renewal/image_gallery_sort_order.html",replace:!0,scope:{sortOrders:"=",onChangeOrder:"="},controller:["$scope",function(e){return e.selected=0}]}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("image_gallery/renewal/image_gallery_status_sort.html","<ul class=\"p-sortNav\">\n  <li>\n    <span class='u-flexboxBasic status-tab'>\n      {{sortTitle}}\n      <i class='renewal-p-icon renewal-p-icon--caretDown u-mlXXXS status-tab'></i>\n    </span>\n    <div class='renewal-c-popover--sortNavAddFooter renewal-c-popover--bottomRight' ng-show='flipStatus'>\n      <ul>\n        <li class='renewal-c-popover__item' ng-click=\"changeCondition(s)\" ng-repeat=\"s in statuses\">{{s.label}}</li>\n      </ul>\n    </div>\n  </li>\n</ul>")}]),angular.module("noteApp").directive("imageGalleryStatusSort",["$timeout","$document",function(e,t){return{restrict:"E",templateUrl:"image_gallery/renewal/image_gallery_status_sort.html",link:function(n){return t.on("click",function(t){return e(angular.element(t.target).hasClass("status-tab")?function(){return function(){return n.flipStatus=n.flipStatus?!1:!0}}(this):function(){return function(){return n.flipStatus=!1}}(this))})},controller:["$scope","$rootScope",function(e,t){return e.sortTitle="\u3059\u3079\u3066",e.flipStatus=!1,e.statuses=[{status:"all",label:"\u3059\u3079\u3066"},{status:"shared",label:"\u5171\u6709\u6e08\u307f"}],e.changeCondition=function(n){return e.sortTitle=n.label,e.flipStatus=!1,t.$emit("selectImageGalleryStatusSort",n)}}]}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("image_gallery/renewal/image_gallery_title.html",'<div class="renewal-p-galleryLayout__title"><div><h2>{{galleryTitle}}</h2><p ng-if="galleryLead" ng-bind-html="galleryLead"></p></div><i class="renewal-p-galleryLayout__close renewal-p-icon--closeBold" ng-click="closeFn()" ng-if="closeFn"></i></div>')}]),angular.module("noteApp").directive("imageGalleryTitle",function(){return{restrict:"E",templateUrl:"image_gallery/renewal/image_gallery_title.html",replace:!0,scope:{galleryTitle:"=",galleryLead:"=",closeFn:"="},link:function(){},controller:["$scope","$rootScope",function(){}]}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a){this.$scope=e,this.$rootScope=t,this.DeleteStockPhotoImage=n,this.$analytics=r,this.$document=i,this.$timeout=a,this.keydownEsc()}return e.injects=["$scope","$rootScope","DeleteStockPhotoImage","$analytics","$document","$timeout"],e.prototype.selectImage=function(e,t){return null==t&&(t="selectGalleryImage"),this.type&&"stock_photo"===this.type&&this.$analytics.eventTrack("finish-select-gallery-image",{category:"textnote-eyecatch",label:"finish-select-gallery-image"}),this.$rootScope.$emit(t,this.image),this.closeModal(),this.closeFn()},e.prototype.selectTag=function(e){return this.$rootScope.$emit("selectImageGalleryKeyword",e),angular.element("#gallery_search_autocomplete_value").val(e),this.closeModal()},e.prototype.closeModal=function(){return this.type&&angular.element("body").removeClass("popeye-modal-open"),this.$timeout(function(e){return function(){return e.$document.off("keydown.galleryModal"),e.openSelectModal=!1}}(this))},e.prototype.keydownEsc=function(){return this.$document.on("keydown.galleryModal",function(e){return function(t){return 27===t.which?e.closeModal():void 0}}(this))},e.prototype.initImage=function(e){return e.isUpload=this.image.isStockPhoto,e.keywords=[],e.terms=!1,e.description=""},e.prototype.changeStatus=function(e){return this.image.status=e},e.prototype.deleteStockPhoto=function(e){var t;return t=e.histories.length>0?"\u3053\u306e\u753b\u50cf\u306f"+e.histories.length+"\u30ce\u30fc\u30c8\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u300c\u307f\u3093\u306a\u306e\u30d5\u30a9\u30c8\u30ae\u30e3\u30e9\u30ea\u30fc(\u03b2)\u300d\u304b\u3089\u524a\u9664\u3059\u308b\u3068\u3001\n\u305d\u308c\u3089\u306e\u30ce\u30fc\u30c8\u306e\u753b\u50cf\u3082\u6d88\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u672c\u5f53\u306b\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":"\u3053\u306e\u753b\u50cf\u3092\u300c\u307f\u3093\u306a\u306e\u30d5\u30a9\u30c8\u30ae\u30e3\u30e9\u30ea\u30fc(\u03b2)\u300d\u304b\u3089\u524a\u9664\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",confirm(t)?this.DeleteStockPhotoImage.destroy({id:e.stockPhotoImageId},function(){return location.reload()},function(e){return console.log(e)}):!0},e.prototype.snakizeNoteProperties=function(e){var t,n,r,i;if(e.is_liked=e.isLiked,e.like_count=e.likeCount,e.is_limited=e.isLimited,e.is_treasured_note=e.isTreasuredNote,e.can_read=e.canRead,e.is_author=e.isAuthor,e.external_url=e.externalUrl,e.disable_comment=e.disableComment,e.limited_message=e.limitedMessage,e.audio&&(e.audio.artist_name=e.audio.artistName),e.limitedMessage)for(e.limited_message.user_name=e.limitedMessage.userName,i=e.limitedMessage.magazines,n=0,r=i.length;r>n;n++)t=i[n],t.customDomain&&(t.custom_domain=t.customDomain),t.user.customDomain&&(t.user.custom_domain=t.user.customDomain);return e.priorSale&&(e.prior_sale={},e.prior_sale.activated=e.priorSale.activated,e.prior_sale.first_served_sales_count=e.priorSale.firstServedSalesCount,e.prior_sale.is_sellout=e.priorSale.isSellout,e.prior_sale.now_on_sale=e.priorSale.nowOnSale,e.prior_sale.on_sale_price=e.priorSale.onSalePrice,e.prior_sale.stock_count=e.priorSale.stockCount),e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain?(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key):void 0},e}(),angular.module("noteApp").directive("imageSelectModal",function(){return{restrict:"E",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/modal/renewal/_image_gallery_select",scope:{},bindToController:{image:"=",openSelectModal:"=",closeFn:"&",type:"="},link:function(){}}})}.call(this),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n){this.$rootScope=e,this.InstagramImage=n,this.selectImage=t(this.selectImage,this),this.$rootScope.$on("selectImageGalleryKeyword",function(e){return function(t,n){return e.searchImages(n)}}(this)),this.observeScrollPosition(),this.masonryOptions={gutterSize:10,gridWidth:204},this.modalOptions={search:{endpoint:"./api/v2/instagram_images/suggest?query="},imageGalleryTitle:"\u30a4\u30f3\u30b9\u30bf\u30b0\u30e9\u30e0\u304b\u3089\u9078\u629e"}}return e.injects=["$rootScope","InstagramImage"],e.prototype.searchImages=function(e){return this.query=e,this.page=1,this.images=null,this.selectedImages=[],this.scrollFlag=!1,this.getImages()},e.prototype.getImages=function(){return this.images&&this.isLastPage||this.loadingFlag?void 0:(this.loadingFlag=!0,this.InstagramImage.get({query:this.query,page:this.page,added_ids:this.addedImageIds.join(","),page_size:30},function(e){return function(t){return e.images=1===e.page?t.data.instagramImages:e.images.concat(t.data.instagramImages),e.isLastPage=t.data.isLastPage,e.loadingFlag=!1,e.page+=1}}(this),function(e){return function(t){return e.loadingFlag=!1,e.images.isLastPage=!0,console.log(t)}}(this)))},e.prototype.selectImage=function(e){var t;return t=this.selectedImages.indexOf(e),-1===t?(this.selectedImages.push(e),e.style={border:"solid 4px red"}):(this.selectedImages.splice(t,1),e.style={})},e.prototype.observeScrollPosition=function(){return angular.element("#instagram-image-gallery-container").on("scroll",function(e){return function(){var t,n,r,i,a;return r=angular.element("#instagram-image-gallery-container"),t=angular.element(".angular-grid"),n=angular.element(".renewal-p-galleryLayout__header"),i=t.height()+n.height(),a=r.height()+r.scrollTop(),.03*i>i-a?e.getImages():void 0}}(this))},e.prototype.keywordNavClass=function(e){return $scope.query===e?"active":void 0},e.prototype.applyImage=function(){return this.addItems(this.selectedImages),this.closeFn()},e}(),angular.module("noteApp").directive("instagramImageGallery",function(){return{restrict:"E",controller:n.call(e.injects).concat([e]),controllerAs:"$igCtrl",templateUrl:"/templates/modal/renewal/instagram_image_gallery",replace:!1,bindToController:!0,scope:{addedImageIds:"=",closeFn:"&",addItems:"="}}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("layout/renewal/masonry_layout.html",'<!-- masonry layout start --> <div class="renewal-p-galleryLayout__masonry" angular-grid="getImagesObj.images.contents" ag-grid-width="gridWidth" ag-gutter-size="gutterSize" performant-scroll="true" ag-css-grid="false"> <div class="renewal-p-galleryLayout__masonryItem" ng-repeat="i in getImagesObj.images.contents track by $index" ng-click="selectGalleryImage(i)" ng-init="indexImage(i, $index)"> <gallery-evaluation image="i" ng-if="::(getImagesObj.type==\'stock_photo\' && isAdmin && evaluationMode)"></gallery-evaluation> <span class="renewal-c-label--smallPrimary" ng-if="i.isStockPhoto" style="position:absolute;top:10px;left:10px;">\u5171\u6709\u6e08\u307f</span> <img ng-src="{{::(i.url.imageUrl || i.url.pictureMobile)}}" alt="" actual-width="{{::i.size.width}}" actual-height="{{::i.size.height}}"/> <div class="renewal-p-galleryLayout__masonryItemMask"> <div class="renewal-p-galleryLayout__masonryItemCreator" ng-if="::(i.user&&!getty)"> <img ng-src="{{::i.user.userProfileImagePath}}" alt="" class="c-avatar--small" /> <p><span>{{::i.user.name}}</span><i class="renewal-p-icon--officialAccount" ng-if="::i.user.isOfficial"></i></p> </div> </div> </div> </div> <gallery-paging back-images="backImages()" next-images="nextImages()" get-images-obj="getImagesObj"></gallery-paging> <div class="loading-animation" ng-show="getImagesObj.loadingFlag && !getImagesObj.lastpageFlag"></div> <!-- masonry layout end --> <!-- select modal start --> <image-select-modal image="image" open-select-modal="openSelectModal" close-fn="closeFn()" type="getImagesObj.type"></image-select-modal> <!-- select modal end --> <getty-select-modal image="image" open-select-modal="openSelectGettyModal" close-fn="closeFn()" getty-id="gettyId" ratio="ratio" kind="kind"></getty-select-modal>')}]),angular.module("noteApp").directive("masonryLayout",["$analytics",function(e){return{restrict:"E",templateUrl:function(e,t){return t.templateUrl},scope:{images:"=",loadingFlag:"=",lastpageFlag:"=",gridWidth:"=",gutterSize:"=",templateUrl:"@",closeFn:"&",getty:"=",ratio:"=",kind:"=",selectGalleryImageFn:"&",type:"=",nextImages:"&",backImages:"&",getImagesObj:"="},link:function(){},controller:["$scope","$rootScope","$interval","$location",function(t,n,r,i){return t.openSelectModal=!1,t.openGelectGettyModal=!1,t.isAdmin=window.PREFETCH.NOTE.user.is_admin,t.evaluationMode=!1,i.search().evaluate&&1===Number(i.search().evaluate)&&(t.evaluationMode=!0),t.getImagesObj&&t.getImagesObj.totalCount&&(t.intervalPromise=r(function(){return t.getImagesObj.totalCount>0?(t.totalPage=Math.ceil(t.getImagesObj.totalCount/(t.getImagesObj.size*t.getImagesObj.limitPage)),r.cancel(t.intervalPromise)):void 0})),t.selectGalleryImage=function(){return function(n,r){return t.selectGalleryImageFn()?(r.preventDefault(),t.selectGalleryImageFn()(n)):t.getty?(t.openSelectGettyModal=!0,t.gettyId=n.id):(t.getImagesObj.type&&(angular.element("body").addClass("popeye-modal-open"),"stock_photo"===t.getImagesObj.type&&e.eventTrack("select-gallery-image",{category:"textnote-eyecatch",label:"select-gallery-image"})),t.openSelectModal=!0),t.image=n}}(this),t.indexImage=function(){return function(e,t){return e.index=t}}(this)}]}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.injects=[],e}(),angular.module("noteApp").directive("openImageGallery",["Popeye","$analytics","$document",function(n,r,i){return{restrict:"A",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",scope:{},bindToController:{menus:"=",search:"=",getImages:"&",getImagesObj:"=",masonryOptions:"=",initFn:"&",imageGalleryTitle:"@",imageGalleryLead:"@",getty:"=",nextImages:"&",backImages:"&"},link:function(e,t){return t.on("click",function(){return function(){var t;return r.eventTrack("open-gallery",{category:"textnote-eyecatch",label:"open-gallery"}),e.$ctrl.initFn(),t=n.openModal({templateUrl:"/templates/modal/renewal/_open_image_gallery",containerClass:"galleyModal",keyboard:!1,locals:{menus:e.$ctrl.menus,search:e.$ctrl.search,getImages:e.$ctrl.getImages,nextImages:e.$ctrl.nextImages,backImages:e.$ctrl.backImages,getImagesObj:e.$ctrl.getImagesObj,masonryOptions:e.$ctrl.masonryOptions,imageGalleryTitle:e.$ctrl.imageGalleryTitle,imageGalleryLead:e.$ctrl.imageGalleryLead,getty:e.$ctrl.getty},controller:["$scope",function(e){var n,r,i;i=t.options.locals;for(n in i)r=i[n],e[n]=r;return e.close=function(){return t.close()}}]}),t.opened.then(function(){return i.on("keydown.galleryPopeyeModal",function(){return function(e){return 27===e.which&&0===angular.element(".renewal-p-galleryLayout__modalMask").length?t.close():void 0}}(this))}),t.closed.then(function(){return i.off("keydown.galleryPopeyeModal")})}}(this))}}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("stock_photo/stock_photo_keywords_input.html","<tags-input add-on-space='true' class='tags-input space-t-1 space-b-1' max-results-to-show='99' min-length='1' ng-model='keywords' on-tag-added='onTagAdded()' on-tag-adding='onTagAdding($tag)' placeholder='\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u8ffd\u52a0'> <!-- <auto-complete min-length='1' source='loadKeywords($query)'></auto-complete> --> </tags-input>")}]),angular.module("noteApp").directive("stockPhotoKeywordsInput",function(){return{restrict:"E",templateUrl:"stock_photo/stock_photo_keywords_input.html",scope:{data:"="},link:function(e){var t;return t=function(){return e.data},e.$watch(t,function(t){return e.keywords=t},!0)},controller:["$scope",function(e){var t;return t=/^(w*[\u4e00-\u9fa0\u3005\u3007_\u3041-\u3093_\u30a1-\u30f4\u30fc\uff41-\uff5a\uff21-\uff3a\uff10-\uff19a-zA-Z0-9]+|[a-zA-Z0-9_]+|[a-zA-Z0-9_]w*)/g,e.filterKeyword=function(){return e.data?function(t){var n,r,i,a;for(a=e.data,r=0,i=a.length;i>r;r++)if(n=a[r],n.text===t)return!1;return!0}:!1},e.onTagAdding=function(n){var r,i,a,o,s;if(i=n.text,!i.match(t))return!1;if(i.match(t)[0]!==i)return!1;for(s=e.keywords,a=0,o=s.length;o>a;a++)if(r=s[a],r.text===i)return!1;return n.text=i,!0},e.onTagAdded=function(){return e.data=e.keywords}}]}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/stock_photo_price_setting.html","<p class='post-ui__name'>\u8ca9\u58f2\u8a2d\u5b9a</p> <div class='post-ui__price post-ui__price-height'> <label> <input name='paidFlag' ng-checked=\"!pay.flag\" ng-click='resetPaidFlag()' type='radio'><span class='post-ui__radio-name'>\u7121\u6599</span></label> <label class='post-ui__pay'> <input id='note_price_paid_flag_checkbox_on' name='paidFlag' ng-checked=\"pay.flag\" ng-click='setPaidFlag()' type='radio'><span class='post-ui__radio-name'>\u6709\u6599</span></label> <input class='post-ui__pay-input' name='price' ng-change='onPriceChange()' ng-model='pay.price' ng-pattern='/(^0$|^[1-9][0-9]*$)/' ng-show=\"pay.flag\"> <span class='space-r-1h' ng-show=\"pay.flag\"> \u5186 </span> <!-- <label ng-if=\"user.can_sell_on_first_come_note &amp;&amp; (data.radioSalesKind == 'pay' || data.radioSalesKind == 'prior_sales')\"> <input name='paidFlag' ng-checked=\"data.radioSalesKind == 'prior_sales'\" ng-click='setPriorSale()' ng-model='note.prior_sale_activated' type='checkbox'><span class='post-ui__radio-name'>\u6570\u91cf\u9650\u5b9a\u3067\u8ca9\u58f2\u3059\u308b</span></label>--> </div>")}]),angular.module("noteApp").directive("stockPhotoPriceSetting",function(){return{templateUrl:"common/stock_photo_price_setting.html",restrict:"A",scope:{pay:"="},controller:["$scope",function(e){return e.resetPaidFlag=function(){return e.pay.flag=!1,e.pay.price=0},e.setPaidFlag=function(){return e.pay.flag=!0,e.pay.price=100}}]}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=[],t=function(){function e(){}return e}(),angular.module("noteApp").directive("stockPhotoUploadModal",["Popeye",function(r){var i;return i={restrict:"A",controller:n.call(e).concat([t]),controllerAs:"$ctrl",link:function(e,t){return t.on("click",function(){var e;return e=r.openModal({templateUrl:"/templates/modal/stock_photo_upload_modal",backdrop:"static",controller:["$scope","$rootScope","$upload","$timeout",function(t,n,r,i){return t.imageUrls=[],t.keywords=null,t.description=null,t.files=null,t.uploading=!1,t.isUpload=!1,t.payObject={flag:!1,price:null},t.cancel_without_restore=function(){return e.close()},t.onDragAreaClicked=function(e){return angular.element(e).click(),null},t.onFileSelect=function(){return function(e){var n;return t.files=e,n=new FileReader,n.onload=function(e){return i(function(){return function(){return t.imageUrls.push({url:e.target.result})}}(this))},n.readAsDataURL(e[0])}}(this),t.imageRemove=function(){return t.imageUrls=[]},t.upload=function(){var e,n,i,a,o;for(t.uploading=!0,a=t.files,o=[],n=0,i=a.length;i>n;n++)e=a[n],o.push(r.upload({url:"/api/v2/image_upload/stock_photo_images",file:e,data:{keywords:t.keywords||[],description:t.description||"",price:t.payObject.price||0}}).success(function(){return function(){return location.reload()}}(this)).error(function(){return function(){return t.uploading=!1}}(this)));return o}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache","$sce",function(e){return e.put("modal/renewal/hashtag_cloud.html",'<ul class=\'renewal-p-cardItem__hashtag\' ng-if=\'!isMobile && hashtags.length > 0\'>\n  <li ng-repeat=\'hashtag in hashtags\'>\n    <a ui-sref="hashtag.home({ hashtag: hashtag.hashtag.name.slice(1) })" ui-sref-opts="{ reload: true, notify: true }" analytics-category="timeline" analytics-event="hashtag" analytics-label="hashtag" analytics-on="click">\n      {{ hashtag.hashtag.name }}\n    </a>\n  </li>\n</ul>')}]),angular.module("noteApp").directive("renewalHashtagCloud",["$rootScope",function(e){var t;return t={scope:{hashtags:"="},restrict:"A",templateUrl:"modal/renewal/hashtag_cloud.html",link:function(t){return t.isMobile=e.isMobile}}}])}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){var t;return e.put("hashtag/renewal/hashtag_search.html","<button class='icon-30 icon-30-search' ng-click='searchClickHandler()' type='submit'></button> <angucomplete-alt id='hashtag_search_autocomplete' image-field='image_path' maxlength='20' minlength='1' pause='100' placeholder='\u30ad\u30fc\u30ef\u30fc\u30c9\u3084\u4f5c\u8005\u540d\u3067\u691c\u7d22' remote-url-response-formatter='searchResponse' remote-url='./api/v2/searches?context=user&mode=typeahead&q=' selected-object='searchSelected' title-field='name' template-url='hashtag/renewal/hashtag_search_autocomplete.html' override-suggestions='true' clear-selected='true' focus-in='focusIn()' input-changed='inputChangeHandler'></angucomplete-alt>"),t='<div class="angucomplete-holder" ng-class="{\'angucomplete-dropdown-visible\': showDropdown}">  <input id="{{id}}_value" name={{inputName}} ng-class="{\'angucomplete-input-not-empty\': notEmpty}" ng-model="searchStr" ng-disabled="disableInput" type="{{type}}" placeholder="{{placeholder}}" maxlength="{{maxlength}}" ng-focus="onFocusHandler()" class="{{inputClass}}" ng-focus="resetHideResults()" ng-blur="hideResults($event)" autocapitalize="off" autocorrect="off" autocomplete="off" ng-change="inputChangeHandler(searchStr)"/>  <div id="{{id}}_dropdown" class="angucomplete-dropdown" ng-show="showDropdown">    <div class="angucomplete-row" ng-repeat="result in results" ng-click="selectResult(result)" ng-mouseover="getHistories()" ng-mouseenter="hoverRow($index)" ng-class="{\'angucomplete-selected-row\': $index == currentIndex}">      <div ng-if="imageField" class="angucomplete-image-holder">        <img ng-if="result.image && result.image != \'\'" ng-src="{{result.image}}" class="angucomplete-image"/>        <div ng-if="!result.image && result.image != \'\'" class="angucomplete-image-default"></div>      </div>      <div class="angucomplete-title" ng-if="matchClass" ng-bind-html="result.title"></div>      <div class="angucomplete-title" ng-if="!matchClass&&$index===0">\u300c<b>{{ result.title }}</b>\u300d\u3067\u5168\u4f53\u3092\u691c\u7d22</div>      <div class="angucomplete-title" ng-if="!matchClass&&$index!==0">{{ result.title }}<i class="renewal-p-icon--officialAccount" ng-if="result.originalObject.is_official"></i></div>      <div ng-if="matchClass && result.description && result.description != \'\'" class="angucomplete-description" ng-bind-html="result.description"></div>      <div ng-if="!matchClass && result.description && result.description != \'\'" class="angucomplete-description">{{result.description}}</div>    </div>  </div></div>',e.put("hashtag/renewal/hashtag_search_autocomplete.html",t)}]),angular.module("noteApp").directive("renewalHashtagSearch",function(){return{restrict:"E",templateUrl:"hashtag/renewal/hashtag_search.html",link:function(){},controller:["$scope","$rootScope","$window","$http","$document","$timeout","HashtagSearch","CustomDomainContext","$state",function(e,t,n,r,i,a,o,s,l){return e.currentUser=window.PREFETCH.NOTE.user,i.on("click",function(e){return angular.element(e.target).hasClass("renewal-p-icon--search")||"hashtag_search_autocomplete_value"===e.target.id?void 0:a(function(){return function(){return t.showHistories=!1}}(this))}),0===Object.keys(e.currentUser).length&&(e.currentUser=null),e.inputChangeHandler=function(n){return""!==n?t.showHistories=!1:e.currentUser&&t.historyWords&&t.historyWords.length>0?t.showHistories=!0:void 0},e.searchSelected=function(t){var r,i;if(t.originalObject){if(!angular.isDefined(t.originalObject.type))return i=t.originalObject,"#"===i.charAt(0)&&(i=i.slice(1)),e.addToHistories(i),l.go("search",{context:"note",q:i,mode:"search"},{reload:!0}),e.renewalSearchObj.renewalSearch=!1;if(r=t.originalObject,"User"===r.type)return n.location.href=""+s.getNoteBaseUrl()+"/"+r.urlname;if("Hashtag"===r.type)return n.location.href=""+s.getNoteBaseUrl()+"/hashtag/"+r.name.slice(1)+"?f=trend&search=on";if("Search"===r.type)return l.go("search",{context:"note",q:r.name,mode:"search"},{reload:!0}),e.renewalSearchObj.renewalSearch=!1,e.addToHistories(r.name)}},e.searchResponse=function(e){var t,n,r,i,a,o;for(n=[{type:"Search",name:angular.element("#hashtag_search_autocomplete_value").val()}],i=e.data.users.contents||[],a=0,o=i.length;o>a;a++)r=i[a],t=r.nickname||r.urlname,n.push({type:"User",urlname:r.urlname,name:t,image_path:r.profileImageUrl,is_official:r.isOfficial});return n},e.searchClickHandler=function(){var t;return t=angular.element("#hashtag_search_autocomplete_value").val(),e.openSearchResult(t)},e.openSearchResult=function(t){0!==t.length&&("#"===t.charAt(0)&&(t=t.slice(1)),l.go("search",{context:"note",q:t},{reload:!0}),e.renewalSearchObj.renewalSearchSearch=!1,e.addToHistories(t))},e.addToHistories=function(e){var n;return n=t.historyWords.indexOf(e),n>=0&&t.historyWords.splice(n,1),t.historyWords.unshift(e),t.historyWords.length>10&&t.historyWords.pop(),t.showHistories=!1}}]}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["Popeye","$state","$stateParams"],t=function(){function t(){var t,n,r,i;for(t=r=0,i=e.length;i>r;t=++r)n=e[t],this[n]=arguments[t]}return t.prototype.open=function(){return this.Popeye.openModal({templateUrl:"/templates/modal/renewal/magazine_description",controller:["$scope",function(e){return function(t){return t.magazine=e.magazine,t.contentTotalCount=e.magazine.page_layout.section.total_count,t.close=function(){return e.Popeye.closeCurrentModal()}}}(this)]})},t}(),angular.module("noteApp").directive("magazineDescriptionModal",["Popeye","$state","$stateParams",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{magazine:"="},template:'<div class="renewal-c-button--tertiaryXsmall" ng-click="$ctrl.open()">\u8a73\u7d30\u60c5\u5831</div>',scope:{}}}])}.call(this),function(){"use strict";var e,t,n=[].slice;e=["MagazineSectionLayout","MagazineSectionContextService","$state"],t=function(){function t(){var t,n,r,i,a,o,s,l,c,u,d,p,h;for(r=o=0,c=e.length;c>o;r=++o)i=e[r],this[i]=arguments[r];for(this.selectedArchiveItem={summary_date:null},this.selectedCategoryItem={hashtag_id:null},a=[],p=this.magazine.archive_note_counters,s=0,u=p.length;u>s;s++)for(t=p[s],h=t.counters,l=0,d=h.length;d>l;l++)n=h[l],a.push({summary_date:n.summary_date,name:""+t.year+"\u5e74"+n.month+"\u6708"});this.selectCounterOptions=a}return t.prototype.toggleArchive=function(e){var t,n,r,i,a;for(i=this.magazine.archive_note_counters,a=[],n=0,r=i.length;r>n;n++){if(t=i[n],t.year===e){t.show=!t.show;break}a.push(void 0)}return a},t.prototype.searchArchive=function(e){return this.selectedCategoryItem={hashtag_id:null},this.searchTargetYm=e?""+e+"-01":null,this.contents=[],"sp"===this.pf&&(this.$state.includes("magazine.*")?this.$state.go("magazine.archive",{urlname:this.magazine.user.urlname,key:this.magazine.key,date:e}):this.$state.includes("cdMyMagazine.*")?this.$state.go("cdMyMagazine.archive",{key:this.magazine.key,date:e}):this.$state.includes("cdMagazine.*")&&this.$state.go("cdMagazine.archive",{date:e})),this.MagazineSectionContextService.fetchSectionContentByArchive(this.searchTargetYm),document.getElementById("headline").scrollIntoView(!0)},t.prototype.changeArchiveItem=function(){return this.searchArchive(this.selectedArchiveItem.summary_date)},t.prototype.searchCategory=function(e,t){return this.selectedArchiveItem={summary_date:null},t?(this.searcnCategoryName=e,this.searcnHashtagId=t):(this.searcnHashtagId=null,this.searcnCategoryName=null),this.contents=[],"sp"===this.pf&&(this.$state.includes("magazine.*")?this.$state.go("magazine.hashtag",{urlname:this.magazine.user.urlname,key:this.magazine.key,hashtag_id:t}):this.$state.includes("cdMyMagazine.*")?this.$state.go("cdMyMagazine.hashtag",{key:this.magazine.key,hashtag_id:t}):this.$state.includes("cdMagazine.*")&&this.$state.go("cdMagazine.hashtag",{hashtag_id:t})),this.MagazineSectionContextService.fetchSectionContentByHashtag(this.searcnHashtagId),document.getElementById("headline").scrollIntoView(!0)},t.prototype.changeCategoryItem=function(){return this.searchCategory(null,this.selectedCategoryItem.hashtag_id)},t}(),angular.module("noteApp").directive("magazineInformation",function(){return{restrict:"E",templateUrl:"/templates/magazines/renew/magazine_information",scope:{},bindToController:{magazine:"=",isLoggedIn:"=",pf:"=",currentMenuId:"="},controller:n.call(e).concat([t]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t,n=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/creator_magazine_list_item.html","<div class='renewal-p-magList__item'> <div class='renewal-p-magList__cover'> <content-link magazine='$ctrl.magazine' target='_blank' type='magazine'> <div class='renewal-p-magList__overlay'></div> <div class='renewal-p-magList__title'><p>{{ $ctrl.magazine.name }} <span ng-if='($ctrl.magazine.isAuthor || ($ctrl.magazine.isJointlyManaged && $ctrl.magazine.isEditable)) && $ctrl.magazine.price > 0'> <i class='renewal-p-icon--magPay'></i> </span> <span ng-if=\"($ctrl.magazine.isAuthor || ($ctrl.magazine.isJointlyManaged && $ctrl.magazine.isEditable)) && $ctrl.magazine.status === 'private'\"> <i class='renewal-p-icon--lock'></i> </span> <span ng-if=\"$ctrl.magazine.isOfficial\"> <i class='renewal-p-icon--officialAccount'></i> </span> </p></div> <img ng-src='{{ $ctrl.magazine.cover }}'> </content-link> </div> <div class='renewal-p-magList__description' ng-if='$ctrl.magazine.description'><p><content-link magazine='$ctrl.magazine' target='_blank' type='magazine'>{{ $ctrl.magazine.description | trim | truncateWithLink:$ctrl.magazineDescTruncateLen() }}</content-link></p></div> <div class='renewal-p-magList__body renewal-p-magList__body'> <content-link class='renewal-p-magList__avatar' ng-if='!$ctrl.magazine.isJointlyManaged || ($ctrl.magazine.isJointlyManaged && $ctrl.magazine.editors.length === 1)' target='_blank' type='user' user='$ctrl.magazine.user'> <img class='c-avatar--small' ng-src='{{::$ctrl.magazine.user.userProfileImagePath}}'> <p>{{ $ctrl.magazine.user.nickname || $ctrl.magazine.user.urlname}}</p> </content-link> <div class='renewal-p-magList__avatarList' ng-if='$ctrl.magazine.isJointlyManaged && $ctrl.magazine.editors.length > 1'> <ul title='\u904b\u55b6\u30e1\u30f3\u30d0\u30fc' user-list-modal users='$ctrl.magazine.editors'> <li ng-repeat='editor in $ctrl.magazine.editors | limitTo:5'> <img class='c-avatar--small' ng-src='{{::editor.userProfileImagePath}}'> </li> <li class='renewal-p-magList__more' ng-if='$ctrl.magazine.editors.length > 5'> +{{$ctrl.magazine.editors.length - 5}}{{$ctrl.magazine.editors.length >= 50 ? '\u301c' : ''}} </li> </ul> </div> <div class='renewal-p-magList__button'> <div ng-if='$ctrl.magazine.canFollow'> <a broad-cast-name='$MagazineFollowToggle' class='renewal-c-button--secondaryXsmall is-follow' magazine-unfollow magazine='$ctrl.magazine' ng-if='$ctrl.currentUser && $ctrl.magazine.isFollowing'>\u30d5\u30a9\u30ed\u30fc\u4e2d</a> <a broad-cast-name='$MagazineFollowToggle' class='renewal-c-button--secondaryXsmall' magazine-follow magazine='$ctrl.magazine' ng-if='$ctrl.currentUser && !$ctrl.magazine.isFollowing' no-urlname-user='$ctrl.currentUser.no_urlname_user'> \u30d5\u30a9\u30ed\u30fc </a> <a class='renewal-c-button--secondaryXsmall' entry-and-magazine-follow-modal magazine='$ctrl.magazine' ng-if='!$ctrl.currentUser'> \u30d5\u30a9\u30ed\u30fc </a> </div> <div ng-if='$ctrl.magazine.price > 0 && !($ctrl.magazine.isAuthor || $ctrl.magazine.isEditable)'> <a class='renewal-c-button--secondaryXsmall is-disabled' ng-if='!$ctrl.magazine.isSubscribable && $ctrl.magazine.isPurchased'> \u8cfc\u5165\u6e08 </a> <content-link magazine='$ctrl.magazine' ng-if='!$ctrl.magazine.isSubscribable && !$ctrl.magazine.isPurchased' style-class='renewal-c-button--secondaryXsmall' target='_blank' type='magazine'> \xa5{{ $ctrl.magazine.price }} </content-link> <a class='renewal-c-button--secondaryXsmall is-disabled' ng-if='$ctrl.magazine.isSubscribable && $ctrl.magazine.isSubscribed'> \u8cfc\u8aad\u4e2d </a> <content-link magazine='$ctrl.magazine' ng-if='$ctrl.magazine.isSubscribable && !$ctrl.magazine.isSubscribed' style-class='renewal-c-button--secondaryXsmall' target='_blank' type='magazine'> <span ng-if='$ctrl.magazine.yearlyPrice == 0'> \xa5{{ $ctrl.magazine.price }} / \u6708 </span> <span ng-if='$ctrl.magazine.yearlyPrice > 0'> \xa5{{ $ctrl.magazine.yearlyPrice }} / \u5e74 </span> </content-link> </div> <div ng-if='!$ctrl.magazine.isAuthor && !$ctrl.magazine.isSuspended && $ctrl.magazine.isEditable'><a class='renewal-c-button--secondaryXsmall' ui-sref='magazine_edit.home({ urlname: $ctrl.magazine.user.urlname, key: $ctrl.magazine.key })'>\u8a2d\u5b9a</a></div> <div ng-if='$ctrl.magazine.isAuthor && !$ctrl.magazine.isSuspended'><a class='renewal-c-button--secondaryXsmall' ui-sref='magazine_edit.home({ urlname: $ctrl.magazine.user.urlname, key: $ctrl.magazine.key })'>\u8a2d\u5b9a</a></div> </div> </div> </div>")
}]),e=[],t=function(){function e(){}return e}(),angular.module("noteApp").directive("magazineListItem",function(){return{restrict:"E",replace:!0,templateUrl:"common/creator_magazine_list_item.html",scope:{},controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{magazine:"=",currentUser:"=",magazineDescTruncateLen:"&"}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$state","MagazineSectionContextService"],t=function(){function t(){var t,n,r,i;for(t=r=0,i=e.length;i>r;t=++r)n=e[t],this[n]=arguments[t]}return t.prototype.searchByMenu=function(e){return this.MagazineSectionContextService.fetchSectionContentByMenu(e),this.setActivateMenuId(e)},t.prototype.setActivateMenuId=function(e){return this.activateMenuId=e},t}(),angular.module("noteApp").directive("magazineMenu",function(){return{restrict:"E",templateUrl:"/templates/magazines/renew/magazine_menu",scope:{},bindToController:{magazine:"=",pf:"@",currentMenuId:"="},controller:n.call(e).concat([t]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$scope","MagazineSectionLayout","MagazineSectionContextService","UserAgent","$timeout","$rootScope","ContentLink","Title","CustomDomainContext"],t=function(){function t(t,n,r,i){var a,o,s,l;for(a=s=0,l=e.length;l>s;a=++s)o=e[a],this[o]=arguments[a];this.MagazineSectionContextService.fetchCallback=this.fetchMagazineSectionLayout.bind(this),this.page=1,this.currentPage=1,this.isLoading=!1,this.menuKind=null,this.isSmartPhone=i.isSmartPhone,this.isSmartPhone&&(this.kind="magazine",this.gaPrefix="magazine-timeline"),this.contentTotalCount=this.magazine.page_layout.section.total_count,this.sb=this.isSmartPhone?this.$rootScope.$on("$inViewportElementForPaging",function(e){return function(){return e.loadNextPage("")}}(this)):this.$scope.$on("$scrollBottom",function(e){return function(){e.loadNextPage("")}}(this)),this.$scope.$on("$destroy",function(e){return function(){return e.sb()}}(this))}return t.prototype.loadNextPage=function(e){return"byhand"!==e&&this.contents&&this.currentPage+1===2||this.isLoading||this.isLastPage?void 0:(this.page+=1,this.currentPage=this.page,this.fetchMagazineSectionLayout(this.page))},t.prototype.fetchMagazineSectionLayout=function(e){return null==e&&(e=1),1===e&&(this.page=1,this.currentPage=1,this.contents=[]),this.isLoading=!0,this.MagazineSectionLayout.get({magazine_key:this.magazine.key,page:e,ym:this.MagazineSectionContextService.searchTargetYm,hashtag_id:this.MagazineSectionContextService.searcnHashtagId,menu_id:this.MagazineSectionContextService.searchMenuId},function(e){return function(t){var n,r,i,a,o,s;if(e.isLoading=!1,t.error)return void console.log(t.error);for(s=t.data.section.contents,a=0,o=s.length;o>a;a++)n=s[a],e.contents.push(n);return e.isLastPage=t.data.section.is_last_page,e.contentTotalCount=t.data.section.total_count,e.currentMenuId=t.data.section.menu?t.data.section.menu.id:null,e.menuKind=t.data.section.menu?t.data.section.menu.kind:null,e.menuDispType=t.data.section.menu?t.data.section.menu.disp_type:null,i=e.getTitle({magazine:e.magazine}),r=e.CustomDomainContext.isCdAccess()&&1===i.length?"":"\uff5c",e.Title.set(i,r),e.isSmartPhone?e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.contents.length):void 0}}(this))},t.prototype.snakizeNoteProperties=function(e){return this.isSmartPhone?e.user.user_profile_image_path=e.user.profile_image_path:void 0},t.prototype.eventInViewport=function(e,t){var n,r;if(e&&(r=t-6,n=t-1,!(0>r)))return this.$timeout(function(t){return function(){return inViewport(e[r],function(e){return t.$rootScope.$emit("$inViewportElementForPaging",e)}),inViewport(e[n],function(e){return t.isLoading?void 0:t.$rootScope.$emit("$inViewportElementForPaging",e)})}}(this),500)},t}(),angular.module("noteApp").directive("magazineSectionContents",function(){return{templateUrl:"/templates/magazines/renew/magazine_section_contents",restrict:"E",scope:{},controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{magazine:"=",contents:"=",isLastPage:"=",currentUser:"=",currentMenuId:"=",getTitle:"&"}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$scope"],t=function(){function e(){}return e}(),angular.module("noteApp").directive("magazineSectionInner",function(){return{templateUrl:"/templates/magazines/renew/magazine_section_inner",restrict:"E",scope:{},controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{content:"="}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$scope","$window"],t=function(){function e(e,t){this.$window=t}return e}(),angular.module("noteApp").directive("magazineSectionNormal",function(){return{templateUrl:"/templates/magazines/renew/magazine_section_normal",restrict:"E",scope:{},controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{magazine:"=",contents:"=",currentUser:"=",currentMenuId:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f){this.$timeout=e,this.$state=t,this.$filter=n,this.$window=r,this.Auth=i,this.Bridge=a,this.MagazineReadHistory=o,this.MagazineLayout=s,this.CustomDomainContext=l,this.ContentLink=c,this.$rootScope=u,this.Admin=d,this.Title=p,this.MessageModal=h,this.Cookie=m,this.$location=f,this.contents=[],this.isLastPage=!1,this.pf=u.isPC?"pc":"sp",this.enableCoverVideo=!1,this.initRenewMagazineTop(),this.currentMenuId=this.$state.params.menu_id}return e.inject=["$timeout","$state","$filter","$window","Auth","Bridge","MagazineReadHistory","MagazineLayout","CustomDomainContext","ContentLink","$rootScope","Admin","Title","MessageModal","Cookie","$location"],e.prototype.initRenewMagazineTop=function(){return this.urlname=this.$state.params.urlname,this.key=this.$state.params.key,this.CustomDomainContext.isCdAccess()&&("magazine"===this.CustomDomainContext.type&&(this.key=this.CustomDomainContext.key),"creator"===this.CustomDomainContext.type&&(this.urlname=this.CustomDomainContext.key)),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0,e.Admin.isAdminCheck!==!0&&e.$timeout(function(){return e.magazine?e.MagazineReadHistory.save({key:e.magazine.key}):void 0},5e3,!1)),e.fetchMagazineLayout()}}(this))},e.prototype.fetchMagazineLayout=function(){var e,t,n,r;return n=this.$location.path().split("/"),e=null,t=null,"creator"===this.CustomDomainContext.type?(r=n[2],"archive"===n[3]?e=""+n[4]+"-01":"hashtag"===n[3]&&(t=n[4])):"magazine"===this.CustomDomainContext.type?(r=this.key,"archive"===n[1]?e=""+n[2]+"-01":"hashtag"===n[1]&&(t=n[2])):(r=n[3],"archive"===n[4]?e=""+n[5]+"-01":"hashtag"===n[4]&&(t=n[5])),this.MagazineLayout.get({ym:e,magazine_key:r,hashtag_id:t,menu_id:this.$state.params.menu_id},function(e){return function(t){var n,r,i,a,o,s,l,c;if(t.error)return void("not_found"===t.error.code&&e.$state.go("_404",null,{location:!1}));if(i=t.data.magazine_layout,o=e.getTitle(i),r=e.CustomDomainContext.isCdAccess()&&1===o.length?"":"\uff5c",e.Title.set(o,r),e.showInvitedMessageModal(i.name),"magazine.home"===e.$state.current.name&&e.urlname&&e.urlname!==i.user.urlname)return e.ContentLink.go("magazine",i,{inherit:!0});if(!e.CustomDomainContext.isCdAccess()&&i.custom_domain&&(e.$state.current.name="magazine.home"))return a=i.custom_domain.tls?"https":"http",e.$window.location.href=""+a+"://"+i.custom_domain.host;for(e.magazine=i,e.Bridge.magazine=e.magazine,e.$rootScope.urlname_for_message=i.user.urlname,e.$rootScope.urlname_for_tokusyo=i.user.urlname,c=t.data.magazine_layout.page_layout.section.contents,s=0,l=c.length;l>s;s++)n=c[s],e.contents.push(n);return e.isLastPage=t.data.magazine_layout.page_layout.section.is_last_page,e.contentTotalCount=t.data.magazine_layout.page_layout.section.total_count,e.magazine.cover=t.data.magazine_layout.cover_landscape||e.$filter("defaultMagazineCover")(),e.magazine.own=e.currentUser?e.magazine.user.id===e.currentUser.id:!1,e.setPageOptional(),e.magazine.existsMenu=e.magazine.menus&&e.magazine.menus.length>0,e.$rootScope.isSmartPhone?e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.contents.length):void 0}}(this),function(e){return function(){return e.$state.go("_404",null,{location:!1})}}(this))},e.prototype.getTitle=function(e){var t,n,r,i,a,o,s,l,c;if(a=[],o=this.$filter("truncate")(e.name,100),a.push(function(){return null==e.name?this.$filter("truncate")(e.body,100):o?o:void 0}()),r=this.$location.path().match(/hashtag\/(\d+)/),t=this.$location.path().match(/archive\/(\d{4}-\d{2})/),r){for(i=null,c=e.category_note_counters,s=0,l=c.length;l>s;s++)if(n=c[s],n.hashtag_id===+r[1]){i=n.name;break}a[0]=""+a[0]+" - "+i}else t&&(a[0]=""+a[0]+" - "+t[1]);return null!=e.user.nickname&&e.name!==e.user.nickname?a.push(e.user.nickname):e.user.nickname||null==e.user.urlname||e.name===e.user.urlname||a.push(e.user.urlname),a},e.prototype.showInvitedMessageModal=function(e){return"true"===this.Cookie.get("jm_magazine_joined")?(this.Cookie.remove("jm_magazine_joined"),this.MessageModal.show({title:"\u30de\u30ac\u30b8\u30f3\u3078\u306e\u53c2\u52a0",message:""+e+"\u306b\u53c2\u52a0\u3057\u307e\u3057\u305f\u3002"})):void 0},e.prototype.clickCover=function(){return $window.location.reload()},e.prototype.setPageOptional=function(){var e;return e=this.magazine.page_layout.page_layout_optional,e.cover_video_url?(this.enableCoverVideo=!0,angular.element("#cover-video").attr("src",e.cover_video_url)):void 0},e.prototype.eventInViewport=function(e,t){var n,r;if(e&&(r=t-6,n=t-1,!(0>r)))return this.$timeout(function(t){return function(){return inViewport(e[r],function(e){return t.$rootScope.$emit("$inViewportElementForPaging",e)}),inViewport(e[n],function(e){return t.isLoading?void 0:t.$rootScope.$emit("$inViewportElementForPaging",e)})}}(this),500)},e}(),angular.module("noteApp").directive("magazineTop",function(){return{restrict:"E",scope:{},templateUrl:"/templates/magazines/renew/magazine_top",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a){this.Popeye=e,this.$state=t,this.AmazonWidget=n,this.CreatorAmazonWidgets=r,this.$window=i,this.CreatorAmazonWidgetsCount=a,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null)}return e.createdLimitCount=5,e.incects=["Popeye","$state","AmazonWidget","CreatorAmazonWidgets","$window","CreatorAmazonWidgetsCount"],e.prototype.open=function(){var t;return t=this,this.Popeye.openModal({templateUrl:"/templates/modal/renewal/amazon_widget_edit",controller:["$scope",function(n){return function(r){return r.amazonWidget={},r.currentUser=t.currentUser,"new"===t.type?t.CreatorAmazonWidgetsCount.get({urlname:t.currentUser.urlname},function(t){return t.data===e.createdLimitCount&&(r.warnMessage="Amazon\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u306e\u767b\u9332\u6570\u306f\u6700\u5927"+e.createdLimitCount+"\u500b\u307e\u3067\u3067\u3059\u3002"),r.displayMode="edit"},function(e){return console.log(e)}):(t.widget&&(r.existingEdit=!0,r.amazonWidget.url=t.widget.item.linkWithAffCode||t.widget.item.link),r.displayMode="edit"),r.close=function(){return n.Popeye.closeCurrentModal()},r.preview=function(){return t.AmazonWidget.get({amazon_link:r.amazonWidget.url},function(e){return r.amazonWidget=e.data,r.displayMode="preview"},function(e){return r.errorMessage=e.data.data})},r.save=function(){return"new"===t.type?t.CreatorAmazonWidgets.create({urlname:t.currentUser.urlname,amazon_widget:{asin:r.amazonWidget.asin,author:r.amazonWidget.author,name:r.amazonWidget.name,image:r.amazonWidget.image,link:r.amazonWidget.link,aff_code:r.amazonWidget.affCode,publish_date:r.amazonWidget.publishDate,product_group:r.amazonWidget.productGroup,publisher:r.amazonWidget.publisher}},function(){return t.$window.location.reload(),r.close()},function(e){return console.log(e)}):"edit"===t.type?t.CreatorAmazonWidgets.update({urlname:t.currentUser.urlname,id:t.widget.id,amazon_widget:{asin:r.amazonWidget.asin,author:r.amazonWidget.author,name:r.amazonWidget.name,image:r.amazonWidget.image,link:r.amazonWidget.link,aff_code:r.amazonWidget.affCode,publish_date:r.amazonWidget.publishDate,product_group:r.amazonWidget.productGroup,publisher:r.amazonWidget.publisher}},function(){return t.$window.location.reload(),r.close()},function(e){return console.log(e)}):void 0},r.back=function(){return r.displayMode="edit",r.amazonWidget=null,r.isRegistered=!1},r.transitionPremiumPage=function(){return r.close(),t.$window.location.href="/premium"},r.isWidgetBook=function(){return"Book"===r.amazonWidget.productGroup||"eBooks"===r.amazonWidget.productGroup}}}(this)]})},e}(),angular.module("noteApp").directive("amazonWidgetEditModal",["Popeye","$state","$stateParams",function(){return{restrict:"E",controller:t.call(e.incects).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",widget:"=",type:"@",text:"@"},template:'<a ng-click="$ctrl.open()">{{ $ctrl.text }}</a>',scope:{}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.MyCreditCard=t,this.Popeye=n,this.initProps()}return e.inject=["$state","MyCreditCard","Popeye"],e.prototype.initProps=function(){var e,t;return this.months=[1,2,3,4,5,6,7,8,9,10,11,12],e=(new Date).getFullYear(),this.years=function(){t=[];for(var n=e,r=e+10;r>=e?r>=n:n>=r;r>=e?n++:n--)t.push(n);return t}.apply(this),this.creditCard={},this.errorMsg=null,this.isUpdating=!1,this.viewMode="input"},e.prototype.saveCreditcard=function(){return this.isUpdating=!0,this.MyCreditCard.save(this.creditCard,function(e){return function(){return e.isUpdating=!1,e.currentUser.can_checkout=!0,e.viewMode="confirm"}}(this),function(e){return function(t){return console.log(t),e.isUpdating=!1,e.errorMsg=t.data.error}}(this))},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.showInput=function(){return this.viewMode="input"},e.prototype.onPurchase=function(){return this.callbackSaved?this.callbackSaved({paymentMethod:"creditcard"}):void 0},e}(),angular.module("noteApp").directive("purchaseCreditCardInput",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"=",callbackSaved:"&",paymentContext:"@"},templateUrl:"/templates/modal/renewal/purchase_credit_card_input",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.$location=l,this.AfterActionModal=c,this.initProps()}return e.inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","$location","AfterActionModal"],e.prototype.initProps=function(){return this.currentUser?(this.viewMode="initial",this.support={},this.support.amount="",this.support.withSupport=!1,this.support.messageLength=0,this.support.kind="",this.support.text="",this.submitting=!1,this.paymentMethod=this.PurchaseService.defaultSelectedPayment(this.currentUser),this.errorMessage=null):this.viewMode="nologin"},e.prototype.setViewMode=function(e){return this.viewMode=e},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/"+this.magazine.user.urlname+"/m/"+this.magazine.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl():this.$location.path(),e+="?modal=support",this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.onClickWithSupport=function(){return this.support.withSupport=!this.support.withSupport,this.support.kind=this.support.withSupport?"s100":null},e.prototype.changeSupportKind=function(e){return this.support.kind=e},e.prototype.showSelectPeyment=function(){var e;return this.support.withSupport&&(e=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),e.errorMessage)?void(this.errorMessage=e.errorMessage):this.viewMode="select_payment_method"},e.prototype.callbackConfirm=function(e){var t;if(this.errorMessage=null,this.support.withSupport){if(t=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),t.errorMessage)return void(this.errorMessage=t.errorMessage);this.support.price=t.amount,this.support.text=this.PurchaseService.cleanSupportText(this.support.text)}return this.paymentMethod=e,this.setViewMode("confirm")},e.prototype.goToMagazineHome=function(){return this.CustomDomainContext.isCdAccess()&&"magazine"===this.CustomDomainContext.type&&this.CustomDomainContext.key===this.magazine.key?this.$state.go("cdMagazine.home",{},{reload:!0}):this.ContentLink.go("magazine",this.magazine,{reload:!0})},e.prototype.showCreditcardInput=function(){return this.setViewMode("creditcard")},e.prototype.submit=function(){var e;return e={magazine_key:this.magazine.key,check_price:this.magazine.price,payment_method:this.paymentMethod},this.support.withSupport&&(e.support_price=this.support.price,e.message=this.support.text,e.via_content_type="Magazine",e.via_content_id=this.magazine.id),this.PurchaseService.isCarrierPaymentMethod(this.paymentMethod)&&(e.return_domain=""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),e.return_url=location.href),this.submitting=!0,this.PurchaseService.purchaseMagazine(e,this.support.withSupport).then(function(e){return function(t){var n,r,i,a,o;if(!t.error||(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),!e.errorMessage))switch(e.paymentMethod){case"creditcard":return t.error?(e.errorMessage="payment_error_message"===(o=t.error.code)||"suspended"===o||"blocked"===o?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)):(e.dismiss(),e.submitting=!1,a=e.magazine.user.purchaseAppealText||e.magazine.user.purchase_appeal_text,i=e.magazine.user.userProfileImagePath||e.magazine.user.profile_image_path,n=window.PREFETCH.NOTE.defaultImage.note_logo_url,e.AfterActionModal.show({magazine:e.magazine,action:"purchase_magazine",title:"\u8cfc\u5165\u5b8c\u4e86",image:a?i:n,message:a||e.AfterActionModal.defaultNotePurchaseMsg,share:!0,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1},template:"/templates/modal/renewal/after_purchase"}),e.FacebookPixel.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Magazine"}),e.goToMagazineHome());case"docomo":case"au":case"softbank":return r=e.PurchaseService.createGMOCarrierForm(t.data.carrier_payment.start_url,t.data.carrier_payment.access_id,t.data.carrier_payment.token),$("body").append(r),r.submit()}}}(this))},e}(),angular.module("noteApp").directive("purchaseMagazine",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",magazine:"="},templateUrl:"/templates/modal/renewal/purchase_magazine",scope:{}}})}.call(this),function(){"use strict";NOTE.CTRL.PurchaseNoteCtrl=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.$location=l,this.GuestPurchase=c,this.$window=u,this.$analytics=d,this.PurchaseRightsApply=p,this.AfterActionModal=h,this.initProps()}return e.$inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","$location","GuestPurchase","$window","$analytics","PurchaseRightsApply","AfterActionModal"],e.prototype.initProps=function(){return this.currentUser?(this.support={},this.support.amount="",this.support.withSupport=!1,this.support.messageLength=0,this.support.kind="",this.support.text="",this.submitting=!1,this.errorMessage=null,this.viewMode="initial",this.paymentMethod=this.PurchaseService.defaultSelectedPayment(this.currentUser),this.defaultPaymentMethod=this.PurchaseService.defaultSelectedPayment(this.currentUser),this.snakizeCreatorProperties(this.note.user),this.appMode=this.$window.PREFETCH.NOTE.mode,this.freeBodyLastName=null,this.scrollToPaywall&&"TextNote"===this.note.type&&angular.element(".note-body .body-wrapper p").last()?this.freeBodyLastName=angular.element(".note-body .body-wrapper p").last().attr("name"):void 0):void(this.viewMode="nologin")},e.prototype.snakizeCreatorProperties=function(e){return e.custom_domain=e.customDomain?e.customDomain:e.custom_domain,e.disable_support=e.disableSupport?e.disableSupport:e.disable_support,e.user_profile_image_path=e.userProfileImagePath?e.userProfileImagePath:e.user_profile_image_path},e.prototype.setViewMode=function(e){return this.viewMode=e},e.prototype.cancelClicked=function(){var e,t;return t="payment",this.$window.confirm("\u672c\u5f53\u306b\u8cfc\u5165\u3092\u4e2d\u6b62\u3057\u307e\u3059\u304b\uff1f")?(e="confirm-cancel-pressed-ok",this.$analytics.eventTrack(e,{category:t,label:e}),this.dismiss()):(e="confirm-cancel-pressed-cancel",void this.$analytics.eventTrack(e,{category:t,label:e}))},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.back=function(){return this.setViewMode("initial"),this.errorMessage=null},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/notes/"+this.note.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl()+"/n/"+this.note.key:this.$location.path(),this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.pageToInitial=function(){return this.setViewMode("initial")},e.prototype.showSelectPeyment=function(){var e;return this.support.withSupport&&(e=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),e.errorMessage)?void(this.errorMessage=e.errorMessage):this.setViewMode("select_payment_method")},e.prototype.callbackConfirm=function(e){var t;if(this.errorMessage=null,this.support.withSupport){if(t=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),t.errorMessage)return void(this.errorMessage=t.errorMessage);this.support.price=t.amount,this.support.text=this.PurchaseService.cleanSupportText(this.support.text)}return this.paymentMethod=e,this.setViewMode("confirm")},e.prototype.confirmGuest=function(){return this.guestPurchase.error={},this.guestPurchase.cardNumber?-1===this.guestPurchase.cardNumber.search(/^[0-9]+/)&&(this.guestPurchase.error.cardNumberPattern=!0):this.guestPurchase.error.cardNumberRequired=!0,this.guestPurchase.cardCvc?-1===this.guestPurchase.cardCvc.search(/^[0-9]+/)&&(this.guestPurchase.error.cvcNumberPattern=!0):this.guestPurchase.error.cvcNumberRequired=!0,null==this.guestPurchase.email||0===this.guestPurchase.email.trim().length?this.guestPurchase.error.emailRequired=!0:-1===this.guestPurchase.email.search(/^.+@.+\..{2,}$/)&&(this.guestPurchase.error.emailPattern=!0),this.guestPurchase.expiryMonth&&this.guestPurchase.expiryYear||(this.guestPurchase.error.expiryRequired=!0),Object.keys(this.guestPurchase.error).length>0?void 0:this.setViewMode("confirm")},e.prototype.changeSupportKind=function(e){return this.support.kind=e},e.prototype.onClickWithSupport=function(){return this.support.withSupport=!this.support.withSupport,this.support.kind=this.support.withSupport?"s100":null},e.prototype.showCreditcardInput=function(){return this.setViewMode("creditcard")},e.prototype.submit=function(){var e;return e={noteId:this.note.id,check_price:this.note.price,payment_method:this.paymentMethod,is_prior_sale:this.note.prior_sale&&this.note.prior_sale.activated===!0},this.support.withSupport&&(e.support_price=this.support.price,e.message=this.support.text,e.via_content_type="Note",e.via_content_id=this.note.id),this.PurchaseService.isCarrierPaymentMethod(this.paymentMethod)&&(e.return_domain=""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),e.return_url=location.href),this.submitting=!0,this.PurchaseService.purchaseNote(e,this.support.withSupport).then(function(e){return function(t){var n,r,i,a,o;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return void(e.errorMessage=t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"payment_error_message"===(o=t.error.code)||"invalid"===o||"blocked"===o||"oneshot_already_bought_by_magazine"===o||"oneshot_already_subscribed"===o||"oneshot_limited"===o?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}switch(e.paymentMethod){case"creditcard":if(e.FacebookPixel.trackPurchase({id:e.note.id,price:e.note.price,type:e.note.type}),e.note.can_read=!0,e.dismiss(),e.submitting=!1,a=e.note.user.purchaseAppealText||e.note.user.purchase_appeal_text,i=e.note.user.userProfileImagePath||e.note.user.user_profile_image_path,n=window.PREFETCH.NOTE.defaultImage.note_logo_url,e.AfterActionModal.show({note:e.note,title:"\u8cfc\u5165\u5b8c\u4e86",action:"purchase_note",image:a?i:n,message:a||e.AfterActionModal.defaultNotePurchaseMsg,share:!0,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1},template:"/templates/modal/renewal/after_purchase"}),"origin"===e.appMode)return e.CustomDomainContext.isCdAccess()&&"magazine"===e.CustomDomainContext.type&&e.CustomDomainContext.isCdAccess()&&"creator"===CustomDomainContext.type&&e.note.user.urlname===e.CustomDomainContext.key?e.$state.go("cdMyNote",{key:e.note.key},{reload:!0}):e.ContentLink.go("note",e.note,{reload:!0});if("asp"===e.appMode)return e.$state.go("article.detail",{category:e.note.category.eng_name,slug:e.note.slug},{reload:!0});break;case"docomo":case"au":case"softbank":return r=e.PurchaseService.createGMOCarrierForm(t.data.carrier_payment.start_url,t.data.carrier_payment.access_id,t.data.carrier_payment.token),$("body").append(r),r.submit()}}}(this))},e}(),angular.module("noteApp").directive("purchaseNote",function(){return{restrict:"E",controller:NOTE.CTRL.PurchaseNoteCtrl,controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",note:"=",scrollToPaywall:"="},templateUrl:"/templates/modal/renewal/purchase_note",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l){this.$state=e,this.Popeye=t,this.CustomDomainContext=n,this.$location=r,this.GuestPurchase=i,this.SignUp=a,this.$timeout=o,this.$window=s,this.GMOTokenAuth=l,this.initProps()}return e.inject=["$state","Popeye","CustomDomainContext","$location","GuestPurchase","SignUp","$timeout","$window","GMOTokenAuth"],e.prototype.initProps=function(){var e,t;return this.viewMode="initial",this.guestPurchase={},this.guestPurchase.error={},this.paymentMethod="creditcard",this.months=[1,2,3,4,5,6,7,8,9,10,11,12],e=(new Date).getFullYear(),this.years=function(){t=[];for(var n=e,r=e+10;r>=e?r>=n:n>=r;r>=e?n++:n--)t.push(n);return t}.apply(this),this.authorizationNumber=null},e.prototype.setViewMode=function(e){return this.errorMessage=null,this.guestPurchase.error={},this.viewMode=e},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/notes/"+this.note.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl()+"/n/"+this.note.key:this.$location.path(),this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.maskifyCardNo=function(e){return e?e.replace(/.(?=.{4,})/g,"*"):null},e.prototype.confirm=function(){return this.guestPurchase.error={},this.guestPurchase.cardNumber?-1===this.guestPurchase.cardNumber.search(/^[0-9]+/)&&(this.guestPurchase.error.cardNumberPattern=!0):this.guestPurchase.error.cardNumberRequired=!0,this.guestPurchase.cardCvc?-1===this.guestPurchase.cardCvc.search(/^[0-9]+/)&&(this.guestPurchase.error.cvcNumberPattern=!0):this.guestPurchase.error.cvcNumberRequired=!0,this.guestPurchase.expiryMonth&&this.guestPurchase.expiryYear||(this.guestPurchase.error.expiryRequired=!0),this.guestPurchase.cardName?-1===this.guestPurchase.cardName.search(/^[A-Z ]*$/)&&(this.guestPurchase.error.cardNamePattern=!0):this.guestPurchase.error.cardNameRequired=!0,null==this.guestPurchase.email||0===this.guestPurchase.email.trim().length?this.guestPurchase.error.emailRequired=!0:-1===this.guestPurchase.email.search(/^.+@.+\..{2,}$/)&&(this.guestPurchase.error.emailPattern=!0),Object.keys(this.guestPurchase.error).length>0?void 0:this.setViewMode("confirm")},e.prototype.purchase=function(){var e;return e={note_id:this.note.id,check_price:this.note.price,payment_method:this.paymentMethod,is_prior_sale:this.note.prior_sale===!0,email:this.guestPurchase.email,card_no:"000000000000"+this.guestPurchase.cardNumber.substr(-4,4),cvc:"",expiry_month:this.guestPurchase.expiryMonth,expiry_year:this.guestPurchase.expiryYear},this.errorMessage=null,this.sending=!0,this.GMOTokenAuth.getToken(this.guestPurchase.cardNumber,this.guestPurchase.expiryYear.toString()+(this.guestPurchase.expiryMonth<10?"0"+this.guestPurchase.expiryMonth.toString():this.guestPurchase.expiryMonth.toString()),this.guestPurchase.cardCvc,"",function(t){return function(n){return e.tokens=n.tokenObject.token,t.GuestPurchase.create(e,function(e){return e.error?void(t.errorMessage=e.error.message):(t.authorizationNumber=e.data.authorizationNumber,t.setViewMode("guest_signup"),t.sending=!1)},function(e){return console.log(e.data),t.errorMessage=e.data.data,t.sending=!1})}}(this))},e.prototype.register=function(){var e;return this.guestPurchase.error={},this.guestPurchase.checkTerms?this.guestPurchase.password&&0!==this.guestPurchase.password.trim().length?(e={email:this.guestPurchase.email,password:this.guestPurchase.password,password_confirmation:this.guestPurchase.password,redirect_path:this.$location.path(),card_no:"000000000000"+this.guestPurchase.cardNumber.substr(-4,4),cvc:"",expiry_month:this.guestPurchase.expiryMonth,expiry_year:this.guestPurchase.expiryYear,card_name:this.guestPurchase.cardName},this.sending=!0,this.GMOTokenAuth.getToken(this.guestPurchase.cardNumber,this.guestPurchase.expiryYear.toString()+(this.guestPurchase.expiryMonth<10?"0"+this.guestPurchase.expiryMonth.toString():this.guestPurchase.expiryMonth.toString()),this.guestPurchase.cardCvc,"",function(t){return function(n){return e.tokens=n.tokenObject.token,t.SignUp.save(e,function(e){if(!e.error)return t.viewMode="email_sent",t.$timeout(function(){return t.$window.location.reload()},1e3,!1);switch(t.sending=!1,e.error.code){case"duplicate_urlname":alert(e.error.message);break;case"internal":alert(e.error.message)}})}}(this))):void(this.guestPurchase.error.passwordRequired=!0):void(this.guestPurchase.error.termsRequired=!0)},e}(),angular.module("noteApp").directive("purchaseNoteGuest",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"="},templateUrl:"/templates/modal/renewal/purchase_note_guest",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.Popeye=t,this.$window=n,this.initProps()}return e.inject=["$state","Popeye","$window"],e.prototype.initProps=function(){return this.viewMode="select",this.paymentMethod="creditcard",this.appMode=this.$window.PREFETCH.NOTE.mode},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.selectPaymentMethod=function(e){return this.paymentMethod=e},e.prototype.showCreditcardInput=function(){return this.viewMode="creditcard"},e.prototype.showSelectPeyment=function(){return this.viewMode="select_payment_method"},e.prototype.confirm=function(){return this.execConfirmCallback(this.paymentMethod)},e.prototype.execConfirmCallback=function(e){return this.confirmCallback({paymentMethod:e})},e}(),angular.module("noteApp").directive("purchaseSelectPeyment",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"=",confirmCallback:"&",paymentContext:"@"},templateUrl:"/templates/modal/renewal/purchase_select_peyment",scope:{}}
})}.call(this),function(){"use strict";NOTE.CTRL.PurchaseSubscribeMagazineCtrl=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.MagazineSubscription=l,this.CouponApply=c,this.MagazinePurchase=u,this.$location=d,this.$window=p,this.PurchaseRightsApply=h,this.AfterActionModal=m,this.initProps()}return e.$inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","MagazineSubscription","CouponApply","MagazinePurchase","$location","$window","PurchaseRightsApply","AfterActionModal"],e.prototype.initProps=function(){return this.currentUser?(this.viewMode="initial",this.submitting=!1,this.paymentMethod=this.PurchaseService.defaultSelectedPayment(this.currentUser),this.magazine.is_oneshot_subscribe_magazine?this.paymentMethod=null:(!this.paymentMethod||this.PurchaseService.isCarrierPaymentMethod(this.paymentMethod))&&(this.paymentMethod="creditcard"),this.serialCodeApplied=!1,this.errorMessage=null,this.monthlyCarrierKind="docomo",this.yearlyCarrierKind="docomo",this.usingCoupon=!1,this.couponCode=null,this.couponError=null,this.convenienceParams={},this.convenienceParams.customerNameLast=null,this.convenienceParams.customerNameFirst=null,this.convenienceParams.customerNameLastKana=null,this.convenienceParams.customerNameFirstKana=null,this.convenienceParams.customerTelNo=null):this.viewMode="nologin"},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/"+this.magazine.user.urlname+"/m/"+this.magazine.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl():this.$location.path(),e+="?modal=support",this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.showCreditcardInput=function(){return this.viewMode="creditcard"},e.prototype.selectPaymentMethod=function(e){return this.paymentMethod=e},e.prototype.selectMonthlyCarrierKind=function(e){return this.monthlyCarrierKind=e},e.prototype.selectYearlyCarrierKind=function(e){return this.yearlyCarrierKind=e},e.prototype.callbackConfirm=function(){return this.viewMode="initial"},e.prototype.submit=function(){var e;switch(this.paymentMethod){case"monthly_carrier":switch(this.monthlyCarrierKind){case"docomo":this.paymentMethod="monthly_docomo";break;case"au":this.paymentMethod="monthly_au";break;case"softbank":this.paymentMethod="monthly_softbank"}break;case"yearly_carrier":this.paymentMethod=this.yearlyCarrierKind}switch(this.submitting=!0,this.paymentMethod){case"creditcard":case"serialcode":case"monthly_au":case"monthly_docomo":case"monthly_softbank":return e={magazine_key:this.magazine.key,payment_method:this.paymentMethod,coupon_applied:this.couponApplied,serial_code_applied:this.serialCodeApplied},this.serialCodeApplied&&(e.serial_code=this.couponCode),this.MagazineSubscription.put(e,function(e){return function(t){var n,r,i,a,o;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return void(e.errorMessage="payment_error_message"===(o=t.error.code)||"invalid"===o||"blocked"===o||"oneshot_already_subscribed"===o||"oneshot_limited"===o?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}switch(e.paymentMethod){case"creditcard":case"serialcode":return e.noCreditCardWhenCoupon?void e.dismiss():(e.submitting=!1,a=e.magazine.user.purchaseAppealText||e.magazine.user.purchase_appeal_text,i=e.magazine.user.userProfileImagePath||e.magazine.user.profile_image_path,n=window.PREFETCH.NOTE.defaultImage.note_logo_url,e.AfterActionModal.show({magazine:e.magazine,action:"subscribe_magazine",title:"\u8cfc\u8aad\u5b8c\u4e86",image:a?i:n,message:a||e.AfterActionModal.defaultMagazineSubscribeMsg,share:!0,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1},template:"/templates/modal/renewal/after_purchase"}),e.FacebookPixel.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Subscription"}),e.goToMagazineHome());case"monthly_au":case"monthly_docomo":case"monthly_softbank":return r=e.PurchaseService.createGMOCarrierForm(t.data.start_url,t.data.access_id,t.data.token),$("body").append(r),r.submit()}}}(this),function(e){return function(){return e.errorMessage="\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u8aad\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002",e.submitting=!1}}(this));case"au":case"docomo":case"softbank":case"yearly_creditcard":return e={check_price:this.magazine.price,magazine_key:this.magazine.key,payment_method:this.paymentMethod,return_domain:""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),subscribable:1},e.return_url=this.$state.is("magazine.home")?location.href:""+location.protocol+"//"+location.host+"/"+this.magazine.user.urlname+"/m/"+this.magazine.key,this.MagazinePurchase.save(e,function(e){return function(t){var n,r,i,a,o;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return void(e.errorMessage="payment_error_message"===(o=t.error.code)||"invalid"===o||"blocked"===o||"oneshot_already_subscribed"===o||"oneshot_limited"===o?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}return"yearly_creditcard"===e.paymentMethod?(e.submitting=!1,a=e.magazine.user.purchaseAppealText||e.magazine.user.purchase_appeal_text,i=e.magazine.user.userProfileImagePath||e.magazine.user.profile_image_path,n=window.PREFETCH.NOTE.defaultImage.note_logo_url,e.AfterActionModal.show({magazine:e.magazine,action:"subscribe_magazine",title:"\u8cfc\u8aad\u5b8c\u4e86",image:a?i:n,message:a||e.AfterActionModal.defaultMagazineSubscribeMsg,share:!0,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1},template:"/templates/modal/renewal/after_purchase"}),e.FacebookPixel.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Subscription"}),e.goToMagazineHome()):(r=e.PurchaseService.createGMOCarrierForm(t.data.carrier_payment.start_url,t.data.carrier_payment.access_id,t.data.carrier_payment.token),$("body").append(r),r.submit())}}(this),function(e){return function(){return e.errorMessage="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",e.submitting=!1}}(this));case"convenience":return e={check_price:this.magazine.price,magazine_key:this.magazine.key,payment_method:this.paymentMethod,return_domain:""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),subscribable:1,convenience:this.selectedConvenience,customer_name_last:this.convenienceParams.customerNameLast,customer_name_first:this.convenienceParams.customerNameFirst,customer_name_last_kana:this.convenienceParams.customerNameLastKana,customer_name_first_kana:this.convenienceParams.customerNameFirstKana,tel_no:this.convenienceParams.customerTelNo},this.MagazinePurchase.save(e,function(e){return function(t){var n;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return void(e.errorMessage="payment_error_message"===(n=t.error.code)||"invalid"===n||"blocked"===n||"oneshot_already_subscribed"===n||"oneshot_limited"===n?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}return e.dismiss(),e.submitting=!1,e.Cookie.put("rd_flash","magazine_subscription_convenience_purchase"),e.FacebookPixel.trackPurchase({id:e.magazine.id,price:e.magazine.price,type:"Subscription"}),e.goToMagazineHome()}}(this),function(){return this.errorMessage="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",this.submitting=!1})}},e.prototype.useCoupon=function(){return this.usingCoupon=!0},e.prototype.applyCoupon=function(){return this.couponCode&&0!==this.couponCode.length?(this.submitting=!0,this.CouponApply.save({code:this.couponCode,magazine_key:this.magazine.key},function(e){return function(t){return e.magazine.free_subscription_ended_at=t.data.discount.free_subscription_ended_at,e.magazine.discount_amount=t.data.discount.amount,e.serialCodeApplied=t.data.is_subscription_serial===!0,e.paymentMethod="creditcard",e.serialCodeApplied?e.paymentMethod="serialcode":(e.magazine.discount_price=t.data.discount.price,e.magazine.extended_payment_date=t.data.discount.payment_started_at,e.magazine.reserved_free_subscription_ended_at=t.data.discount.reserved_free_subscription_ended_at),e.couponApplied=!0,e.submitting=!1}}(this),function(e){return function(t){switch(t.data.error){case"Already subscribed":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u65e2\u306b\u8cfc\u8aad\u6e08\u307f\u3067\u3059\u3002";break;case"unsubscribable":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u5b9a\u671f\u8cfc\u8aad\u30de\u30ac\u30b8\u30f3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002";break;case"forbidden":e.couponError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Serial code had expired":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u5931\u52b9\u3057\u3066\u3044\u307e\u3059\u3002";break;case"Serial code had been used":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Already coupon used":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306b\u4ed6\u306e\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Already coupon code used":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Not found":e.couponError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Not the first subscription":e.couponError="\u30af\u30fc\u30dd\u30f3\u306f\u65b0\u898f\u8cfc\u8aad\u6642\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002";break;default:e.couponError="\u30af\u30fc\u30dd\u30f3\u306e\u9069\u7528\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"}return e.submitting=!1}}(this))):this.couponError="\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},e.prototype.goToMagazineHome=function(){return this.CustomDomainContext.isCdAccess()&&"magazine"===this.CustomDomainContext.type&&this.CustomDomainContext.key===this.magazine.key?this.$state.go("cdMagazine.home",{},{reload:!0}):this.ContentLink.go("magazine",this.magazine,{reload:!0})},e}(),angular.module("noteApp").directive("purchaseSubscribeMagazine",function(){return{restrict:"E",controller:NOTE.CTRL.PurchaseSubscribeMagazineCtrl,controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",magazine:"=",tmpl:"="},scope:{},templateUrl:"/templates/modal/renewal/purchase_subscribe_magazine"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.PremiumSubscription=l,this.$window=c,this.initProps()}return e.inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","PremiumSubscription","$window"],e.prototype.initProps=function(){return this.viewMode="initial",this.submitting=!1,this.errorMessage=null,this.premium={},this.premium.plan=null,this.premium.agreement=null,this.PremiumSubscription.get(null,function(e){return function(t){return e.premium.plan=t.data.premium_plans[0]}}(this),function(e){return function(){return e.errorMessage="\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002"}}(this))},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.showCreditcardInput=function(){return this.viewMode="creditcard"},e.prototype.selectPaymentMethod=function(e){return this.paymentMethod=e},e.prototype.callbackConfirm=function(){return this.viewMode="initial"},e.prototype.submit=function(){return this.submitting=!0,this.PremiumSubscription.put({premium_plan_key:this.premium.plan.key},function(e){return function(t){var n;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return e.errorMessage="payment_error_message"===t.error.code?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"blocked"===(n=t.error.code)?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)}return e.dismiss(),e.submitting=!1,e.Cookie.put("rd_flash","premium_subscription"),e.$window.location.href="/settings/premium"}}(this),function(e){return function(){return e.errorMessage="\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",e.submitting=!1}}(this))},e}(),angular.module("noteApp").directive("purchaseSubscribePremium",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"="},templateUrl:"/templates/modal/renewal/purchase_subscribe_premium",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.$location=a,this.$analytics=o,this.AfterActionModal=s,this.initProps()}return e.inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","$location","$analytics","AfterActionModal"],e.prototype.initProps=function(){return this.currentUser?(this.viewMode="select",this.support={},this.support.amount="",this.support.messageLength=0,this.setDefaultSupportAmount(),this.support.text="",this.submitting=!1,this.paymentMethod=this.PurchaseService.defaultSelectedPayment(this.currentUser),this.errorMessage=null):this.viewMode="nologin"},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.setDefaultSupportAmount=function(){var e,t;return this.support.kind="s500",this.defaultSupportAmount=this.support.kind,t="open-support-modal",e="open-support-modal-"+this.defaultSupportAmount,this.$analytics.eventTrack(t,{category:"payment",label:e})},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl()+"/n/"+this.note.key:this.$location.path(),this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.changeSupportKind=function(e){return this.support.kind=e||"s100"},e.prototype.confirmCheckout=function(){var e,t,n;return this.errorMessage=null,n=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),n.errorMessage?void(this.errorMessage=n.errorMessage):(this.support.price=n.amount,this.support.text=this.PurchaseService.cleanSupportText(this.support.text),this.viewMode="confirm",t="confirm-checkout-support",e=""+t+"-default-"+this.defaultSupportAmount+"-result-"+this.support.price,this.$analytics.eventTrack(t,{category:"payment",label:e}))},e.prototype.showSelectPeyment=function(){return this.viewMode="select_payment_method"},e.prototype.callbackCreditCardSave=function(){return this.paymentMethod="creditcard",this.support.viewMode="confirm"},e.prototype.toFullPaymentMethodName=function(e){return this.PurchaseService.toFullPaymentMethodName(e)},e.prototype.callbackConfirm=function(e){return this.paymentMethod=e,this.viewMode="confirm"},e.prototype.showCreditcardInput=function(){return this.viewMode="creditcard"},e.prototype.submit=function(){var e;return e={urlname:this.creator.urlname,amount:this.support.price,via_content_type:this.viaContentType,via_content_id:this.viaContent.id,payment_method:this.paymentMethod},this.support.messageLength>0&&(e.message=this.support.text),("docomo"===this.paymentMethod||"au"===this.paymentMethod||"softbank"===this.paymentMethod)&&(e.return_domain=""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),e.return_url=location.href),this.submitting=!0,this.PurchaseService.purchaseSupport(e).then(function(e){return function(t){var n,r,i,a,o;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return e.errorMessage=t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"payment_error_message"===(o=t.error.code)||"invalid"===o||"blocked"===o||"oneshot_already_bought_by_magazine"===o||"oneshot_already_subscribed"===o||"oneshot_limited"===o?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)}switch(e.paymentMethod){case"creditcard":return a=e.creator.purchaseAppealText||e.creator.purchase_appeal_text,i=e.creator.userProfileImagePath||e.creator.user_profile_image_path,n=window.PREFETCH.NOTE.defaultImage.note_logo_url,e.AfterActionModal.show({action:"purchase_support",title:"\u30b5\u30dd\u30fc\u30c8\u5b8c\u4e86",image:a?i:n,message:a||e.AfterActionModal.defaultSupportPurchaseMsg,share:!1,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1},template:"/templates/modal/renewal/after_purchase"});case"docomo":case"au":case"softbank":return r=e.PurchaseService.createGMOCarrierForm(t.data.carrier_payment.start_url,t.data.carrier_payment.access_id,t.data.carrier_payment.token),$("body").append(r),r.submit()}}}(this))},e}(),angular.module("noteApp").directive("purchaseSupport",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",viaContentType:"=",viaContent:"="},templateUrl:"/templates/modal/renewal/purchase_support",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a){this.Popeye=e,this.$state=t,this.$analytics=n,this.CurrentUserAPI=r,this.PurchaseService=i,this.$window=a}return e.inject=["Popeye","$state","$analytics","CurrentUserAPI","PurchaseService","$window"],e.prototype.open=function(){return this.canOpenModal()?this.CurrentUserAPI.get({additionals:!0},function(e){return function(t){return e.currentUser=t.error?null:t.data,e.Popeye.openModal({click:e.currentUser?!1:!0,templateUrl:"/templates/modal/renewal/purchase",controller:["$scope",function(t){return t.creator=e.creator,t.currentUser=e.currentUser,t.purchaseType=e.purchaseType,t.content=e.content,t.viaContentType=e.viaContentType,t.viaContent=e.viaContent,t.appMode=e.$window.PREFETCH.NOTE.mode,t.scrollToPaywall=e.scrollToPaywall,t.close=function(){return e.Popeye.closeCurrentModal()}}]}),e.sendAnalyticsStat()}}(this),function(e){return console.log(e)}):void 0},e.prototype.canOpenModal=function(){return"subscribe_magazine"!==this.purchaseType||!this.content.is_pre_suspended||confirm("\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f"+this.content.suspended_at+"\u306b\u505c\u6b62\u3057\u307e\u3059\u3002\u305d\u308c\u3067\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")?"support"===this.purchaseType&&"Note"===this.viaContentType&&this.viaContent.is_my_note?(alert("\u81ea\u5206\u306b\u5bfe\u3057\u3066\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002"),!1):!0:void 0},e.prototype.sendAnalyticsStat=function(){var e,t,n,r,i,a,o,s;return e="open-modal-purchase-note",n=e,a=this.currentUser&&this.currentUser!=={}?!0:!1,a?(o=this.currentUser.can_checkout?"isLoginWithCreditcard":"isLoginNoCreditcard",s=this.PurchaseService.defaultSelectedPayment(this.currentUser),r=s?s:"none",i="DefaultMethod-"+r):o="notLogin",t=n+"-"+o,a&&(t=t+"-"+i),this.$analytics.eventTrack(e,{category:"payment",label:t})},e}(),angular.module("noteApp").directive("purchaseModal",function(){return{restrict:"A",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{purchaseType:"@",creator:"=",content:"=",viaContentType:"@",viaContent:"=",scrollToPaywall:"="},scope:{},link:function(e,t){return t.on("click",function(){return e.$ctrl.open()})}}})}.call(this),function(){"use strict";var e,t,n,r;angular.module("noteApp").directive("renewalNotificationBell",function(){var e,t,n,i,a;return n=1,i=0,a=6e4,e=null,t={templateUrl:"/templates/common/renewal/navbar_notification",restrict:"AE",link:function(e,t){var n,i,a,o;n=angular.element(document.querySelector(".renewal-c-popover--notification")),a=angular.element(document.querySelector(".renewal-p-icon--notification")),a.on("click",function(e){var i;return e.preventDefault(),i=t.find(".renewal-p-icon--notification"),r(n,i)}),i=angular.element(document.querySelector("span.renewal-p-count")),i.on("click",function(e){var i;return e.preventDefault(),i=t.find(".renewal-p-icon--notification"),r(n,i)}),o=angular.element(document.querySelector("ul.renewal-p-notificationList")),o.on("scroll",function(){var t;t=30,o.scrollTop()>o[0].scrollHeight-o.height()-t&&e.notificationModel.readMore()})},controller:["$scope","$rootScope","$state","$interval","Notification","NotificationCount","NotificationReadAll","Bridge","Title","ContentLink","Admin","CustomDomainContext",function(t,r,o,s,l,c,u,d,p,h,m,f){var g;return t.notificationModel=t.notificationModel||{notifications:[]},t.loading=!1,t.notificationModel.tick=function(){t.currentUser&&m.isAdminCheck!==!0&&(i+=1,i>10&&i%5!==0||c.get(null,function(e){e.error||e.data.notification_count!==t.notificationModel.notificationNum&&l.get(null,function(e){var n;if(!e.error){for(t.notificationModel.lastPage=e.data.last_page,n=e.data.notifications.length;n--;)e.data.notifications[n].read_flag||t.notificationModel.notifications.unshift(e.data.notifications[n]);return d.notification.count=t.notificationModel.notificationNum=e.data.notification_num,p.setNotification(t.notificationModel.notificationNum)}},function(){return console.log("Failed to get notification")})},function(){return console.log("Failed to get notification count")}))},t.notificationModel.click=function(){if(t.currentUser){if(1===n)return t.load_ok=!1,l.get(null,function(r){return t.load_ok=!0,r.error?void 0:(n+=1,t.isSearch=!1,t.notificationModel.notifications=r.data.notifications,t.notificationModel.notificationNum=r.data.notification_num,t.notificationModel.lastPage=r.data.last_page,e=r.data.last_displayed_id,d.notification.count=t.notificationModel.notificationNum,m.isAdminCheck!==!0?u.save(null,function(e){return e.error?void 0:(t.notificationModel.notificationNum-=e.data.update_num,d.notification.count=t.notificationModel.notificationNum,p.setNotification(t.notificationModel.notificationNum))}):void 0)},function(){return console.log("Error occurred")});if(0!==t.notificationModel.notificationNum)return m.isAdminCheck!==!0?u.save(null,function(e){return e.error?void 0:(t.notificationModel.notificationNum-=e.data.update_num,d.notification.count=t.notificationModel.notificationNum,p.setNotification(t.notificationModel.notificationNum))}):void 0}},t.notificationModel.readMore=function(){var n;if(!t.loading&&!t.notificationModel.lastPage)return t.loading=!0,n={last_displayed_id:e},l.get(n,function(n){var r,i,a,o;if(t.loading=!1,!n.error)for(t.notificationModel.lastPage=n.data.last_page,e=n.data.last_displayed_id,o=n.data.notifications,i=0,a=o.length;a>i;i++)r=o[i],t.notificationModel.notifications.push(r)},function(){return t.loading=!1})},t.notificationModel.navUserElemClicked=function(e,t){return e.no_urlname_user?location.href=f.isCdAccess()?f.getNoteBaseUrl()+("/_nourlname?user_id="+e.id):location.origin+("/_nourlname?user_id="+e.id):(h.go("user",e),t.preventDefault())},t.notificationModel.navCommentElemClicked=function(e,t){return h.go("note",e),t.preventDefault()},t.notificationModel.navMagazineElemClicked=function(e,t){return h.go("magazine",e,{location:!0,reload:!0}),t.preventDefault()},t.notificationModel.navMagazineNoteAddElemClicked=function(e,t){return h.go("note",e),t.preventDefault()},t.notificationModel.navElemClicked=function(e,t){return t.target&&angular.element(t.target).hasClass("action-user-urlname")?void 0:(h.go("note",e),t.preventDefault())},g=s(t.notificationModel.tick,a,!1),t.$on("$destroy",function(){s.cancel(g)})}]}}),angular.module("noteApp").directive("compileNotificationMessage",["$compile",function(e){return{restrict:"A",link:function(t,n,r){var i,a;return a=r.compileNotificationMessage,i=n.html(a),e(i.contents())(t)}}}]),angular.module("noteApp").directive("renewalSettingMenu",function(){var t;return t={templateUrl:"/templates/common/renewal/navbar_setting_menu",restrict:"E",scope:{user:"="},controller:["$window","$scope","$rootScope","OpenPickUrlnameModalService",function(e,t,n,r){return t.isPC=n.isPC,t.isSmartPhone=n.isSmartPhone,t.showEcCart=e.PREFETCH.NOTE.show_ec_cart,t.ecItemTotal=e.PREFETCH.NOTE.user.ec_item_total,t.$window=e,t.checkNoUrlnameUser=function(){var e;return t.user.no_urlname_user?(e=function(){return location.reload()},r.open(e,"note"),!0):!1}}],link:function(t,n){var i,a;return i=angular.element(document.querySelector(".renewal-c-popover--mymenu")),a=n.find(".c-avatar.c-avatar--boxShadow"),n.on("click",function(e){return e.preventDefault(),r(i,a)}),n.find("li").on("click","a",function(t){return t.stopPropagation(),e(i,a)})}}}),r=function(r,i){return t(r)?e(r,i):n(r,i)},n=function(n,r){var i,a,o;return a=angular.element(document.body),o=angular.element(document.documentElement),a.addClass("renewal-c-popover--noScroll"),o.addClass("renewal-c-popover--noScroll"),n.css("display","block"),r.addClass("is-active"),i=angular.element(document),i.on("mouseup",function(i){var a;return i.preventDefault(),a=angular.element(i.target),a.hasClass("on-navbar-button")||a.hasClass("nav-bar-notification-read-more")||a.hasClass("is-active")||a.hasClass("renewal-p-notificationList")||!t(n)?void 0:e(n,r)})},e=function(e,t){var n,r,i;return r=angular.element(document.body),i=angular.element(document.documentElement),r.removeClass("renewal-c-popover--noScroll"),i.removeClass("renewal-c-popover--noScroll"),e.css("display","none"),t.removeClass("is-active"),n=angular.element(document),n.off("mouseup")},t=function(e){return"none"!==e.css("display")}}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/note_action_other.html","<li class='renewal-p-action__other' ng-show='isIconShow && currentUser'> <a> <i ng-click='toggle()' class='renewal-p-icon renewal-p-icon--dots'></i> </a> <div ng-show='isShow' class='renewal-c-popover renewal-c-popover--action renewal-c-popover--top' ng-class=\"{'renewal-c-popover--topRight': isSmartPhone}\"> <div> <ul> <li class='renewal-c-popover__item'> <a ng-if='currentUser.id && (currentUser.id != note.user.id)' note='note' user-id='currentUser.id' violation-modal> \u5831\u544a\u3059\u308b </a> </li> </ul> </div> </div> </li>")}]),angular.module("noteApp").directive("noteActionOther",function(){return{templateUrl:"common/note_action_other.html",replace:!0,scope:{note:"=",currentUser:"="},link:function(){},controller:["$scope","$timeout","$rootScope",function(e,t,n){return 0===Object.keys(e.currentUser).length&&(e.currentUser=null),e.isIconShow=!e.note.is_my_note,e.isSmartPhone=n.isSmartPhone,e.isShow=!1,e.toggle=function(){var n;return n=angular.element(document),e.isShow?(n.off("mouseup"),e.isShow=!1,!1):(e.isShow=!0,n.on("mouseup",function(r){return r.preventDefault(),t(function(){return e.isShow=!1},0),n.off("mouseup")}),!1)}}]}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["UserAgent","Popeye","$state","$location","$scope"],t=function(){function t(t,n,r){var i,a,o,s;for(i=o=0,s=e.length;s>o;i=++o)a=e[i],this[a]=arguments[i];this.isSmartPhone=t.isSmartPhone,this.isTablet=t.isTablet,this.noteDelete=function(){var e,t,r;if("published"===(r=this.note.status)||"draft"===r||"reserved"===r)return t=this.note.id,e=n.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$resource","$scope",function(n,r){return r.ok=function(){return n("/api/v1/notes/"+t)["delete"]({},function(){return e.close(),location.href="/"},function(){return console.log("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")})},r.cancel=function(){return e.close()}}]})},this.deleteDraftNote=function(){var e,t;return t=this.note.id,e=n.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$resource","$scope",function(n,r){return r.draft=!0,r.ok=function(){return n("/api/v1/text_notes/draft_delete")["delete"]({id:t},function(){return e.close(),location.href="/"},function(){return console.log("Error occurred")})},r.cancel=function(){return e.close()}}]})},this.goTextNoteEdit=function(){var e,t;t=this.note.key,"draft"===this.note.status?this.$location.url("/notes/"+t+"/edit").replace():this.note.has_draft?e=n.openModal({templateUrl:"/templates/modal/confirm_textnote_edit",controller:["$resource","$scope",function(n,i){return i.startReEditNote=function(){return e.close(),r.go("editTextNote",{key:t,reedit:!0})},i.editExistsNote=function(){return e.close(),r.go("editTextNote",{key:t})}}]}):this.$state.go("editTextNote",{key:t})},this.isLoggedIn=0===Object.keys(this.currentUser).length?!1:!0}return t}(),angular.module("noteApp").directive("noteHeader",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{note:"=",currentUser:"="},templateUrl:"/templates/notes/renewal/note_header",scope:{}}})}.call(this),function(){"use strict";var e,t,n,r;angular.module("noteApp").directive("postNoteFromNavBar",["OpenPickUrlnameModalService",function(t){return{restrict:"E",templateUrl:"/templates/common/renewal/_navbar_post_note",link:function(n,i){var a,o,s;return a=angular.element(document.querySelector("#js-post-note-toggle")),o=angular.element(document.querySelector(".renewal-c-popover--postNote")),i.on("click",function(e){return e.preventDefault(),s(n)?!1:r(a,o)}),i.find("li").on("click","a",function(t){return t.stopPropagation(),e(a,o)}),s=function(e){var n;return e.currentUser.no_urlname_user?(n=function(){return location.reload()},t.open(n,"note"),!0):!1}},controller:["$scope","$window","$state",function(e,t,n){return e.setCreateNoteEvent=function(e){var t;return t="navbar"===e?"create-note":"create-textNote","home.home"===n.current.name?t+"-from-home":"creator.home"===n.current.name?t+"-from-creator":"magazine.home"===n.current.name?t+"-from-magazine":"showTextNoteFriendly"===n.current.name?t+"-from-note":t}}]}}]),r=function(t,r){return t.hasClass("is-active")?e(t,r):n(t,r)},n=function(n,r){var i,a,o;return a=angular.element(document.body),o=angular.element(document.documentElement),a.addClass("renewal-c-popover--noScroll"),o.addClass("renewal-c-popover--noScroll"),r.css("display","block"),n.addClass("is-active"),i=angular.element(document),i.on("mouseup",function(i){var a;return i.preventDefault(),a=angular.element(i.target),a.hasClass("on-navbar-button")||a.hasClass("nav-bar-notification-read-more")||a.hasClass("is-active")||a.hasClass("inner")||a.hasClass("renewal-p-icon")||!t(n)?void 0:e(n,r)})},e=function(e,t){var n,r,i;return r=angular.element(document.body),i=angular.element(document.documentElement),r.removeClass("renewal-c-popover--noScroll"),i.removeClass("renewal-c-popover--noScroll"),t.css("display","none"),e.removeClass("is-active"),n=angular.element(document),n.off("mouseup")
},t=function(e){return"none"!==e.css("display")}}.call(this),function(){"use strict";angular.module("noteApp").directive("repeatFinished",["$timeout",function(e){return{restrict:"A",link:function(t,n){return t.$last?e(function(){return t.$emit("repeatFinishedEventFired",n)}):void 0}}}])}.call(this),function(){"use strict";var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r=[].slice;e=["$stateParams","Searches","$rootScope","$scope","$state","Title","$timeout","UserAgent"],t=function(){function e(e,t,r,i,a,o,s,l){this.$stateParams=e,this.Searches=t,this.$rootScope=r,this.$scope=i,this.$state=a,this.Title=o,this.$timeout=s,this.UserAgent=l,this.setTitle=n(this.setTitle,this),this.setCallbacks(),this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.$rootScope.isMobile||document.querySelectorAll(".renewal-p-searchInput input")[0].focus(),this.menus={note:{name:"Note",context:"note",ja:"\u30ce\u30fc\u30c8"},magazine:{name:"Magazine",context:"magazine",ja:"\u30de\u30ac\u30b8\u30f3"},user:{name:"User",context:"user",ja:"\u30e6\u30fc\u30b6\u30fc"},hashtag:{name:"Hashtag",context:"hashtag",ja:"\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0"}},this.$stateParams.context?(this.context=this.$stateParams.context,/,/.test(this.context)&&(this.context=this.context.split(/,/)[0])):this.context="note",this.query=this.$stateParams.q,"note"===this.context?(this.size=this.$stateParams.size||6,this.sort="popular",!this.$stateParams.sort||"popular"!==this.$stateParams.sort&&"new"!==this.$stateParams.sort&&"hot"!==this.$stateParams.sort&&"like"!==this.$stateParams.sort||(this.sort=this.$stateParams.sort)):this.size=this.$stateParams.size||10,this.weight=this.$stateParams.weight,this.start=0,this.gravity=this.$stateParams.gravity?this.$stateParams.gravity:null,this.mode=this.$stateParams.mode?this.$stateParams.mode:null,this.loading=!1,this.loadedAll=!1,this.cursor={note:"initial",magazine:"initial",user:"initial",hashtag:"initial"},this.totalCount=void 0,this.data=[],this.setTitle(),this.query&&this.getSearchContents()}return e.prototype.setCallbacks=function(){return this.sb=this.UserAgent.isSmartPhone&&"note"===this.$stateParams.context?this.$scope.$on("$inViewportElementForPaging",function(e){return function(){return e.query?e.getSearchContents():void 0}}(this)):this.$scope.$on("$scrollBottom",function(e){return function(){return e.query?e.getSearchContents():void 0}}(this)),this.$scope.$on("$destroy",function(e){return function(){return e.sb()}}(this))},e.prototype.getSearchContents=function(){return this.loading||this.loadedAll?void 0:(this.loading=!0,this.Searches.get({context:this.context,q:this.query,size:this.size,cursor:this.cursor,start:this.start,sort:this.sort,weight:this.weight,gravity:this.gravity,mode:this.mode}).$promise.then(function(e){return function(t){var n,r,i,a;if("initial"===e.cursor[e.context]&&0===e.start)e.data=t.data[""+e.context+"s"].contents;else for(a=t.data[""+e.context+"s"].contents,r=0,i=a.length;i>r;r++)n=a[r],e.data.push(n);return e.totalCount=t.data[""+e.context+"s"].totalCount,0===t.data[""+e.context+"s"].contents.length?(e.loading=!0,e.loadedAll=!0):(e.cursor=t.data.cursor,e.loading=!1),e.size=e.$stateParams.size||10,e.weight=t.data.weight,e.start=e.data.length,e.analytics={on:"click",event:"search",category:"button",label:"search-weight-"+t.data.weight},e.UserAgent.isSmartPhone&&"note"===e.context?e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.data.length):void 0}}(this),function(){return function(e){return console.error(e)}}(this)))},e.prototype.search=function(e){return 13===e.which&&(this.$state.go("search",{context:this.context,q:this.query},{reload:!0}),this.query&&this.addToHistories(this.query)),!0},e.prototype.addToHistories=function(e){var t;return t=this.$rootScope.historyWords.indexOf(e),t>=0&&this.$rootScope.historyWords.splice(t,1),this.$rootScope.historyWords.unshift(e),this.$rootScope.historyWords.length>10?this.$rootScope.historyWords.pop():void 0},e.prototype.setTitle=function(){var e,t,n;return e="note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002",t=this.query?"\u300c"+this.query+"\u300d\u306e":"",t+="note"===this.context?(n="popular"===this.sort?"\u4eba\u6c17\u306e":"hot"===this.sort?"\u6025\u4e0a\u6607\u306e":"new"===this.sort?"\u65b0\u7740\u306e":"like"===this.sort?"\u5b9a\u756a\u306e":"\u4eba\u6c17\u306e",""+n+"\u30ce\u30fc\u30c8\u4e00\u89a7"):"magazine"===this.context?"\u30de\u30ac\u30b8\u30f3\u4e00\u89a7":"user"===this.context?"\u30e6\u30fc\u30b6\u30fc\u4e00\u89a7":"hashtag"===this.context?"\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u4e00\u89a7":void 0,this.query||(t="\u691c\u7d22"),this.Title.set(t,null,e)},e.prototype.eventInViewport=function(e,t){var n,r;if(e&&(r=6===this.start?t-4:t-6,n=t-1,!(0>r)))return this.$timeout(function(t){return function(){return inViewport(e[r],function(e){return t.$scope.$emit("$inViewportElementForPaging",e)}),inViewport(e[n],function(e){return t.loading?void 0:t.$scope.$emit("$inViewportElementForPaging",e)})}}(this),500)},e}(),angular.module("noteApp").directive("search",function(){return{restrict:"E",controller:r.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{},templateUrl:"/templates/search/index",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$scope","$state"],t=function(){function e(e,t){this.$scope=e,this.$state=t}return e.prototype.changeContext=function(e){return this.context!==e?this.$state.go("search",{context:e,q:this.$scope.$ctrl.query},{reload:!0}):void 0},e}(),angular.module("noteApp").directive("searchMenu",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{menus:"=",context:"=",query:"=",totalCount:"="},templateUrl:"/templates/search/search_menu",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=[],t=function(){function e(){}return e}(),angular.module("noteApp").directive("searchResult",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{data:"=",context:"=",loadedAll:"=",currentUser:"=",query:"=",menus:"=",analytics:"=",sort:"="},templateUrl:"/templates/search/search_result",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=[],t=function(){function e(){}return e}(),angular.module("noteApp").directive("searchResultHashtag",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{data:"=",context:"="},templateUrl:"/templates/search/search_result_hashtag",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$scope","$rootScope"],t=function(){function e(e,t){this.$scope=e,this.$rootScope=t,this.$rootScope.$on("$MagazineFollowToggle",function(e){return function(t,n){var r,i;return i=e.data.indexOf(n),r=e.data[i],r.isFollowing=!r.isFollowing}}(this))}return e.prototype.snakizeMagazineProperties=function(e){return e?(e.coverRectangle&&(e.cover_rectangle=e.coverRectangle),e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain?(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key):void 0):void 0},e}(),angular.module("noteApp").directive("searchResultMagazine",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{data:"=",context:"=",currentUser:"="},templateUrl:"/templates/search/search_result_magazine",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=["$state","UserAgent","ContentLink"],t=function(){function e(e,t,n){this.$state=e,this.UserAgent=t,this.ContentLink=n,this.isSmartPhone=this.UserAgent.isSmartPhone,this.kind="search",this.gaPrefix="search-timeline"}return e.prototype.onClickSort=function(e){return this.sort=e,this.$state.go("search",{context:this.context,q:this.query,sort:this.sort},{reload:!0})},e.prototype.snakizeNoteProperties=function(e){var t,n,r,i;if(e.is_liked=e.isLiked,e.like_count=e.likeCount,e.comment_count=e.commentCount,e.is_limited=e.isLimited,e.is_treasured_note=e.isTreasuredNote,e.can_read=e.canRead,e.is_author=e.isAuthor,e.external_url=e.externalUrl,e.disable_comment=e.disableComment,e.limited_message=e.limitedMessage,e.audio&&(e.audio.artist_name=e.audio.artistName),e.limitedMessage)for(e.limited_message.user_name=e.limitedMessage.userName,i=e.limitedMessage.magazines,n=0,r=i.length;r>n;n++)t=i[n],t.customDomain&&(t.custom_domain=t.customDomain),t.user.customDomain&&(t.user.custom_domain=t.user.customDomain);return e.priorSale&&(e.prior_sale={},e.prior_sale.activated=e.priorSale.activated,e.prior_sale.first_served_sales_count=e.priorSale.firstServedSalesCount,e.prior_sale.is_sellout=e.priorSale.isSellout,e.prior_sale.now_on_sale=e.priorSale.nowOnSale,e.prior_sale.on_sale_price=e.priorSale.onSalePrice,e.prior_sale.stock_count=e.priorSale.stockCount),e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),this.isSmartPhone?(e.user.user_profile_image_path=e.user.userProfileImagePath,e.sp_eyecatch=e.spEyecatch,e.publish_at=e.publishAt):void 0},e}(),angular.module("noteApp").directive("searchResultNote",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{data:"=",context:"=",currentUser:"=",analytics:"=",sort:"=",query:"="},templateUrl:"/templates/search/search_result_note",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;e=[],t=function(){function e(){}return e.prototype.snakizeCreatorProperties=function(e){return e.is_following=e.isFollowing,e.user_profile_image_path=e.profileImageUrl,e.is_official=e.isOfficial,e.is_myself=e.isMyself,e.custom_domain=e.customDomain},e}(),angular.module("noteApp").directive("searchResultUser",function(){return{restrict:"E",controller:n.call(e).concat([t]),controllerAs:"$ctrl",bindToController:{data:"=",context:"=",currentUser:"="},templateUrl:"/templates/search/search_result_user",scope:{}}})}.call(this),function(){"use strict";var e,t,n=[].slice;angular.module("noteApp").run(["$templateCache","$sce",function(e){return e.put("templates/widgets/amazon.html","\n<div class='renewal-p-widget renewal-p-widget--amazon'>\n  <div class='renewal-p-widget__img renewal-p-widget__img--verticallyLong'>\n    <a href='{{ $ctrl.amazonLink() }}' target='_blank'>\n      <img ng-src='{{ $ctrl.widget.item.image }}' ng-class=\"{'type-book': $ctrl.isWidgetBook()}\">\n    </a>\n  </div>\n  <div class='renewal-p-widget__info'>\n    <h3 class='renewal-p-widget__title'>\n      <a href='{{ $ctrl.amazonLink() }}' target='_blank'>\n        {{ $ctrl.widget.item.name }}\n      </a>\n    </h3>\n    <p class='renewal-p-widget__author'>\n      <a href='{{ $ctrl.amazonLink()}}' target='_blank'>\n        {{ $ctrl.widget.item.author }}\n      </a>\n    </p>\n    <div class='renewal-p-widget__other'>\n      <p class='renewal-p-widget__url'>\n        <i class='renewal-p-icon renewal-p-icon--amazon'></i>\n        <a href='http://www.amazon.co.jp/' target='_blank'>\n          www.amazon.co.jp\n        </a>\n      </p>\n      <div ng-if='$ctrl.widget && $ctrl.currentUser && $ctrl.currentUser.urlname == $ctrl.urlname' class='renewal-p-widget__edit'>\n        <a ng-click='otherList = !otherList'>\n          <i class='renewal-p-icon renewal-p-icon--settings'></i>\n        </a>\n        <div class='renewal-c-popover renewal-c-popover--action renewal-c-popover--topRight' ng-show='otherList'>\n          <div ng-click='otherList = false'>\n            <ul>\n              <li class='renewal-c-popover__item'>\n                <a ng-click='$ctrl.fourceTop()'>\u4e00\u756a\u4e0a\u306b\u79fb\u52d5</a>\n              </li>\n              <li class='renewal-c-popover__separator'></li>\n              <li class='renewal-c-popover__item'>\n                <amazon-widget-edit-modal type='edit' widget='$ctrl.widget' text='\u7de8\u96c6'/>\n              </li>\n              <li class='renewal-c-popover__separator'></li>\n              <li class='renewal-c-popover__item'>\n                <a ng-click='$ctrl.delete()'>\u524a\u9664</a>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n")}]),t=["CreatorAmazonWidgets","MessageModal","$q","$window","CustomDomainContext","$state"],e=function(){function e(e,t,n,r,i,a){this.CreatorAmazonWidgets=e,this.MessageModal=t,this.$q=n,this.$window=r,this.CustomDomainContext=i,this.$state=a,this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.$state.params.urlname,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null)}return e.prototype.fourceTop=function(){var e;return e=this,this.CreatorAmazonWidgets.update({urlname:this.currentUser.urlname,id:this.widget.id,fource_top:!0},function(){return function(){return e.$window.location.reload()}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype["delete"]=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorAmazonWidgets["delete"]({urlname:t.currentUser.urlname,id:t.widget.id},function(){return function(){return t.$window.location.reload(),e.resolve()}}(this),function(){return function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}}(this)),e.promise},this.MessageModal.confirm({title:"Amazon\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u3092\u524a\u9664\u3059\u308b",message:"Amazon\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",isTermination:!0,process:e})},e.prototype.isWidgetBook=function(){return"Book"===this.widget.item.productGroup||"eBooks"===this.widget.item.productGroup},e.prototype.amazonLink=function(){return this.widget.item.linkWithAffCode||this.widget.item.link},e}(),angular.module("noteApp").directive("amazonWidget",function(){return{restrict:"E",scope:{},bindToController:{widget:"="},templateUrl:"templates/widgets/amazon.html",controller:n.call(t).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("templates/widgets/social_widgets.html",'<!-- smartphone -->\n<div class="p-footerBar--transparent u-displaySp is-show" ng-if="isSmartPhone">\n  <div class="p-footerBar__inner">\n    <div class="p-articleAction" ng-class="{\'is-ios\':isIPhone}">\n      <div class="p-articleAction__share p-articleAction__share--first">\n        <a href="{{twShareUrl}}" class="p-articleAction__sns" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="Twitter" analytics-on="click">\n          <i class="renewal-p-icon--footerBarTwitter"></i>\n        </a>\n      </div>\n      <div class="p-articleAction__share">\n        <a href="" ng-click="windowShare(fbShareUrl, \'share_on_facebook\', 550, 450)" class="p-articleAction__sns" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="Facebook" analytics-on="click">\n          <i class="renewal-p-icon--footerBarFacebook"></i>\n        </a>\n      </div>\n      <div class="p-articleAction__share">\n        <a href="" ng-click="windowShare(hatehaShareUrl, \'share_on_hatena_bookmark\', 800, 600)"  class="p-articleAction__sns" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="hatebu" analytics-on="click">\n          <i class="renewal-p-icon--footerBarHatena"></i>\n        </a>\n      </div>\n      <div class="p-articleAction__share">\n        <a href="{{lineShareUrl}}" class="p-articleAction__sns" target="_blank" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="Line" analytics-on="click">\n          <i class="renewal-p-icon--footerBarLine"></i>\n        </a>\n      </div>\n      <div class="p-articleAction__suki">\n        <like-link likable="note" likable-type="notes" like-style="booster-animation" analytics-category="note-detail-booster-like" analytics-event="like" analytics-label="Like" analytics-on="click"></like-link>\n      </div>\n    </div>\n  </div>\n</div>\n\n<!-- pc -->\n<div class="p-articleActions" ng-class="{\'is--active\': showFooter}">\n  <div class="p-articleActions__inner">\n    <div class="p-articleActions__note">\n      <like-link likable="note" likable-type="notes" like-style="booster-animation-pc" analytics-category="note-detail-booster-like" analytics-event="like" analytics-label="Like" analytics-on="click"></like-link>\n      <div class="p-articleActions__item" add-to-magazine-modal note="note" init-action="init_action" can-multiple-limited-note="{{note.can_multiple_limited_note}}" analytics-category="note-detail-booster-magazine" analytics-event="add-to-magazine" analytics-label="Magazine" analytics-on="click">\n        <i class="c-icon c-icon--magazineAdd"></i>\n      </div>\n    </div>\n    <div class="p-articleActions__share">\n      <a href="{{twShareUrl}}" class="p-articleActions__item" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="Twitter" analytics-on="click">\n        <i class="c-icon c-icon--twitterFill"></i>\n      </a>\n      <a class="p-articleActions__item" href="" ng-click="windowShare(fbShareUrl, \'share_on_facebook\', 550, 450)" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="Facebook" analytics-on="click">\n        <i class="c-icon c-icon--facebookFill"></i>\n      </a>\n      <a class="p-articleActions__item" href="" ng-click="windowShare(hatehaShareUrl, \'share_on_hatena_bookmark\', 800, 600)" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="hatebu" analytics-on="click">\n        <i class="c-icon c-icon--hatenaFill"></i>\n      </a>\n      <a class="p-articleActions__item" href="{{lineShareUrl}}" target="_blank" analytics-category="note-detail-social-share" analytics-event="share" analytics-label="Line" analytics-on="click">\n        <i class="c-icon c-icon--lineFill"></i>\n      </a>\n    </div>\n  </div>\n</div>\n\n')}]),angular.module("noteApp").directive("socialWidget",["$timeout","$filter","Title","CustomDomainContext","$window","UserAgent","$rootScope","Popeye","SocialText",function(e,t,n,r,i,a,o,s,l){var c;return c={restrict:"E",templateUrl:"templates/widgets/social_widgets.html",link:function(e){return e.showFooter=!0,e.lastSt=0,e.isIPhone=a.isIPhone,e.isAndroid=a.isAndroid,e.isSmartPhone=o.isSmartPhone,e.isSmartPhone||angular.element(i).on("scroll.socialWidget",function(){return function(){if(e.st=angular.element(i).scrollTop(),e.st<e.lastSt){if(Math.abs(e.st-e.lastSt)<60)return;e.showFooter=!0}else{if(Math.abs(e.st-e.lastSt)<120)return;e.showFooter=!1}return e.lastSt=e.st,e.$apply()}}(this)),e.$on("$destroy",function(){return e.isSmartPhone?void 0:angular.element(i).off("scroll.socialWidget")}),l.generate(e)},scope:{note:"=",fbShare:"&",magazine:"="},controller:["$scope","$window","Popeye",function(e,t,n){return e.windowShare=function(e,n,r,i){var a,o,s;a=screen.availWidth/2-r/2,s=screen.availHeight/2-i/2,o="width="+r+", height="+i+", personalbar=0, toolbar=0, scrollbars=1, resizable=1, top="+s+", left="+a,t.open(e,n,o)},e.showEmbed=function(){var t,r;r=e,t=n.openModal({templateUrl:"/templates/modal/embed_tag",controller:["$scope","$rootScope",function(e){return e.embedNoteUrl=r.embedNoteUrl,e.embedNoteScript=r.embedNoteScript,e.close=function(){return t.close()}}]})}}]}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$state=e,this.init()}return e.inject=["$state"],e.prototype.init=function(){return this.salesTypeList=[{key:"note_magazine",label:"\u30ce\u30fc\u30c8\u30fb\u30de\u30ac\u30b8\u30f3"},{key:"ec",label:"\u7269\u8ca9"}],this.salesType=this.$state.current.name==="sitesettings.ec_"+this.pageType?"ec":"note_magazine"},e.prototype.goToSelectedSalesPage=function(){return this.$state.go("ec"===this.salesType?"sitesettings.ec_"+this.pageType:"sitesettings."+this.pageType)},e}(),angular.module("noteApp").directive("salesTypeMenu",function(){return{restrict:"E",scope:{},templateUrl:"/templates/sitesettings/sales_type_menu",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"=",pageType:"="}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("saveNoteModal",["$rootScope","$window","$state","$sce","$timeout","TextNote","NoteNotifyUpdate","Popeye","NoteForm",function(e,t,n,r,i,a,o,s,l){var c;return c={restrict:"A",scope:{noteBody:"=",noteLead:"=",noteName:"=",noteSeparator:"=",stateFlag:"=",fromEdit:"=",editStatus:"=",note:"=",currentUser:"=",hashtags:"=",categories:"=",stockPhotoImageId:"=",removeDomEvent:"&"},link:function(i,a){var c,u,d;return d=function(){return $("div.note-name").find('div[contenteditable="true"]').text().trim()},u=function(){var e,t;return t=$("div.note-lead").find('div[contenteditable="true"]'),t?(e=t.html(),e?e.trim():null):null},c=function(){return $("div.note-body").find('div[contenteditable="true"]').html().trim()},a.on("click",function(){var a,p,h,m,f,g,v,y,b,_,w,k,x,C,S;if(!t.NOTE.editor||t.NOTE.editor.readyToSave===!0){if(_=i.fromEdit?d():i.noteName,f=i.fromEdit?c():r.getTrustedHtml(i.noteBody),"success"!==i.stateFlag){if(!(_&&_.length>0||f&&f.length>0))return alert("\u30bf\u30a4\u30c8\u30eb\u3001\u672c\u6587\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");if(!(_&&_.length>0))return alert("\u30bf\u30a4\u30c8\u30eb\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");if(!(f&&f.length>0))return alert("\u672c\u6587\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}for(h=window.PREFETCH.NOTE.allowed_image_src_regexes,a=$("#note-body").find("img"),g=document.createElement("a"),k=0,C=a.length;C>k;k++){for(p=a[k],g.href=p.src,v=!1,x=0,S=h.length;S>x;x++){if(w=h[x],-1!==g.hostname.search(w)){v=!1;break}v=!0}if(v){if(m=confirm("\u5916\u90e8\u30b5\u30a4\u30c8\u306e\u753b\u50cf\u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f"),m===!0)break;return}}return b=s.openModal({templateUrl:"/templates/modal/save_note",backdrop:"static",click:!1,controller:["$scope","$window","TextNote","MagazineNote","PostingSettingStash","EditorManager","SocialText",function(t,a,s,l,p,h,m){switch(t.pageHist=[],t.noteBody=i.noteBody,t.noteLead=i.noteLead,t.noteName=i.noteName,t.noteSeparator=i.noteSeparator,t.stateFlag=i.stateFlag,t.fromEdit=i.fromEdit,t.editStatus=i.editStatus,t.note=angular.copy(i.note),t.note.notetype="TextNote",t.currentUser=i.currentUser,t.settings={hashtag:{list:[],notekey:t.note.key}},t.removeDomEvent=i.removeDomEvent(),t.$window=a,t.categories=i.categories,t.stockPhotoImageId=i.stockPhotoImageId,t.pageHist.push(t.stateFlag),y(t),t.windowShare=function(e,t,n,r){var i,o,s;i=screen.availWidth/2-n/2,s=screen.availHeight/2-r/2,o="width="+n+", height="+r+", personalbar=0, toolbar=0, scrollbars=1, resizable=1, top="+s+", left="+i,a.open(e,t,o)},t.onSubmit=function(){return this.textNoteForm.$valid?(t.settings.authordIds=t.note.authors.map(function(e){return e.id}),t.note.paid_flag===!0?t.moveToPayPart():t.saveTextNote()):void 0},t.moveToPayPart=function(){return t.settings.hashtag.list&&t.settings.hashtag.list.length>100?void alert("1\u3064\u306e\u30ce\u30fc\u30c8\u306b\u3064\u304d\u3001\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u306f100\u500b\u307e\u3067\u306e\u307f\u767b\u9332\u3067\u304d\u307e\u3059"):(t.settings.notePaidFlag=t.note.paid_flag,t.settings.notePrice=t.note.price,t.note.prior_sale_activated&&(t.settings.firstServedSalesCount=t.note.first_served_sales_count,t.settings.priorSaleAciteved=t.note.prior_sale_activated,t.settings.changePriorSaleCount=t.note.change_prior_sale_count),p.stash(t.settings),t.removeDomEvent&&t.removeDomEvent(),n.go("paypartDetermineTextNote",{key:t.note.key}),b.close())},t.openAddToMagazine=function(){return $("div.modal-dialog").hide(),setTimeout(function(){return $("span[add-to-magazine-modal]").click()},0)},t.toggleFree=function(){return t.is_free=!t.is_free},t.toggleReserve=function(){return t.reserve=!t.reserve},t.saveTextNote=function(){var n,i,a,o,l,p,h;return t.settings.hashtag.list&&t.settings.hashtag.list.length>100?void alert("1\u3064\u306e\u30ce\u30fc\u30c8\u306b\u3064\u304d\u3001\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u306f100\u500b\u307e\u3067\u306e\u307f\u767b\u9332\u3067\u304d\u307e\u3059"):(t.fromEdit&&(t.noteName=d(),t.noteLead=r.trustAsHtml(u()),t.noteBody=r.trustAsHtml(c())),n="",h="",o=!0,l=r.getTrustedHtml(t.noteLead),a=r.getTrustedHtml(t.noteBody),$(a).each(function(){var e,r;return _=$(this).attr("name"),r=this.tagName,r&&-1!==r.toLowerCase().search(/^h2|h3|p|pre|blockquote|figure|ul|li$/)&&_&&_.length&&(o?n+=$(this).clone().wrap("<div>").parent().html():h+=$(this).clone().wrap("<div>").parent().html(),_===t.noteSeparator)?(o=!1,e=1):void 0}),!t.note.paid_flag&&h.length>0?void alert("\u7121\u6599\u30ce\u30fc\u30c8\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u6709\u6599\u90e8\u5206\u304c\u5b58\u5728\u3057\u3066\u3044\u307e\u3059"):(i=e.tempHashtagsList&&e.tempHashtagsList.length>0?e.tempHashtagsList.map(function(e){return e.text}):t.settings.hashtag.list?t.settings.hashtag.list.map(function(e){return e.text}):[],e.tempHashtagsList=[],t.isInitialPublish=""===t.note.status||"draft"===t.note.status?!0:!1,t.settings.normalize(),p={name:t.noteName,description:l,free_body:n,pay_body:h,price:t.note.price,separator:t.noteSeparator,status:t.settings.reserved?"reserved":"published",edit_status:t.editStatus,notify_update:t.notify_update,hashtags:i,related_notes:t.relatedNotes,magazine_ids:t.settings.magazineIds,limited:t.settings.limited,publish_at:t.settings.publishAt,prior_sale_activated:t.settings.priorSaleAciteved,first_served_sales_count:t.settings.firstServedSalesCount,change_prior_sale_count:t.settings.changePriorSaleCount,category_id:t.settings.category_id,meta_datum:t.settings.meta_datum,author_ids:t.settings.authordIds,stock_photo_image_id:t.stockPhotoImageId,slug:t.note.slug,is_pr:t.settings.isPr,catch_copy:t.settings.catchCopy,sponsered_by:t.settings.sponseredBy,is_login_required:t.settings.isLoginRequired},t.currentUser.turnoff_comment_available&&(p.disable_comment=t.settings.enable_comment===!1),s.put({noteId:t.note.id},p,function(e){return e.error?(t.noteSaveModalState="error",void(t.error_message=e.error.message)):(e.data.exist_purchased_user===!0&&e.data.content_changed&&!e.data.first_publish&&(t.exist_purchased_user=!0),t.noteSaveModalState=t.settings.reserved?"reservation_success":"success",t.note=e.data,t.note.user=t.currentUser,t.rand=Math.floor(6*Math.random())+1,t=m.generate(t))},function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})))},t.notify_update=function(){return t.loading?void 0:(t.loading=!0,o.save({key:t.note.key},function(){return b.close(),n.go("showTextNote",{reload:!0,key:t.note.key})}))},t.cancel=function(){return b.close()},t.success_ok=function(){var e,r,i,a,o;if(t.removeDomEvent&&t.removeDomEvent(),h.destroyEditor(),b.close(),t.settings.reserved)return n.go("showTextNoteFriendly",{urlname:t.currentUser.urlname,key:t.note.key});if("asp"===window.PREFETCH.NOTE.mode){for(e=null,o=t.categories,i=0,a=o.length;a>i;i++)if(r=o[i],r.id===t.settings.category_id){e=r;break}return n.go("article.detail",{reload:!0,category:e.engName,slug:t.note.slug})}return"asp_manage"===window.PREFETCH.NOTE.mode?n.go("manage.articles.home"):n.go("showTextNote",{reload:!0,key:t.note.key})},t.back=function(){return t.pageHist.pop(),0===t.pageHist.length?void b.close():("price"===t.pageHist[t.pageHist.length-1]&&(t.notePriceBeFreeFlag=!1),t.noteSaveModalState=t.pageHist[t.pageHist.length-1])},t.currentPage=function(){return 0!==t.pageHist.length?t.pageHist[t.pageHist.length-1]:void 0},t.modalSaveNoteStateChange=function(e){if("price"===t.currentPage()){if(-1===t.note.price.toString().search(/^[0-9]+$/))return void(t.error_message="\u6570\u5024\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");if(t.note.price<100)return void(t.error_message="\u8ca9\u58f2\u4fa1\u683c\u306f100\u5186\u301c10,000\u5186\u307e\u3067\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002");if(t.note.price>1e4)return void(t.error_message="\u8ca9\u58f2\u4fa1\u683c\u306f100\u5186\u301c10,000\u5186\u307e\u3067\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002")}return t.note.price=parseInt(t.note.price,10),!t.inputForm||t.inputForm.$valid?(t.error_message="",t.pageHist.push(e),t.noteSaveModalState=e):void 0},t.stateFlag){case"choice_free_pay":return t.noteSaveModalState="choice_free_pay";case"complete":return t.settings=p.stashPop(),t.note.paid_flag=t.settings.notePaidFlag,t.note.price=t.note.paid_flag?t.settings.notePrice:0,t.saveTextNote();default:return alert("\u4e0d\u6b63\u306a\u9077\u79fb\u3067\u3059")}}]}),y=function(e){return l.initEdit(e)}}})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("sendMessageModal",["Popeye","$state","$stateParams",function(e){return{restrict:"A",replace:!0,scope:{user:"=",purchaseContentId:"=",orderId:"="},link:function(t,n){var r;return r=["$scope","$rootScope","Auth","UserMessage","EcMessages",function(n,r,i,a,o){return n.obj={},n.obj.user=t.user,n.obj.purchase_content_id=t.purchaseContentId,n.obj.order_id=t.orderId,n.obj.submited=!1,n.obj.submitting=!1,n.obj.message="",n.obj.error_msg="",n.sendMessage=function(){return n.obj.submitting?void 0:(n.obj.submitting=!0,n.obj.message?n.obj.message.length>2e3?(n.obj.error_msg="\u30e1\u30c3\u30bb\u30fc\u30b8\u306f2000\u6587\u5b57\u4ee5\u5185\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002",void(n.obj.submitting=!1)):void i.then(function(e){return e.error?void 0:(n.currentUser=e.data,n.obj.order_id?o.save({to_user_id:n.obj.user.id,body:n.obj.message,order_id:n.obj.order_id},function(){return n.obj.submited=!0,n.obj.submitting=!1,r.$broadcast("$SendThankyouMessageFinished",n.obj.order_id)},function(e){return console.log(e),e.data.data?alert(e.data.data):void 0}):a.save({user_id:n.obj.user.id},{body:n.obj.message,sender_name:n.currentUser.nickname||n.currentUser.urlname,to_user_id:n.obj.user.id,via:"thankyou",purchase_content_id:n.obj.purchase_content_id},function(e){return e.error?void alert(e.error.message):(n.obj.submited=!0,n.obj.submitting=!1,r.$broadcast("$SendThankyouMessageFinished",n.obj.purchase_content_id))},function(e){return console.log(e.message)}))}):(n.obj.error_msg="\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",void(n.obj.submitting=!1)))},n.dismiss=function(){return e.closeCurrentModal()}}],n.on("click",function(){var t;return t=e.openModal({templateUrl:"/templates/modal/send_message",click:!1,controller:r})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("signUpBar",function(){return{restrict:"A",link:function(e,t){return e.$watch("isDisplayed",function(e){return e===!0?t.show():t.hide()})},controller:["$scope","$rootScope","$state","$timeout","Cookie","Auth",function(e,t,n,r,i,a){return a.then(function(t){return t.error?e.isLoggedIn=!1:(e.currentUser=t.data,e.isLoggedIn=!0),e.$on("$stateChangeSuccess",function(){return e.isDisplayed=n.is("home.home")||"SessionsCtrl"===n.current.controller||e.isLoggedIn?!1:!0})}),e.closeBar=function(){return i.put("sign_in_bar",!0),e.isDisplayed=!1}}]}})}.call(this),function(){"use strict";angular.module("noteApp").directive("sliderImageLoad",function(){var e;return e={restrict:"A",link:function(e,t){return e.check=!0,t.on("load",function(){var t,n,r,i;return e.check&&(i=document.querySelector(".Wallop--slide"),e.slider=new Wallop(i),e.check=!1),t=3e3,r=void 0,n=function(){var t;return t=(e.slider.currentItemIndex+1)%e.slider.allItemsArray.length,e.slider.goTo(t)},r=setTimeout(function(){return n()},t),e.slider.on("change",function(){return clearTimeout(r),r=setTimeout(function(){return n()},t)})})}}})}.call(this),function(){"use strict";angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/social_plugin.html","<ul class='sns-button-list' ng-hide='hide_social_plugin'><li><div class='fb-share-button' ng-href='{{url}}' type='button_count' data-href=\"{{url}}\"></div></li><li><a class='twitter-share-button' data-counturl='{{counturl}}' data-lang='ja' data-text='{{note.tweet_text || text}}' data-url='{{url}}' ng-href='https://twitter.com/share'> \u30c4\u30a4\u30fc\u30c8 </a><span class='sns-button-twitter-balloon'><a ng-href='https://twitter.com/search?q={{url}}' target='_blank'>List</a></span> </li><li ng-if='isPC'><a class='hatena-bookmark-button' data-hatena-bookmark-lang='ja' data-hatena-bookmark-layout='standard-balloon' data-hatena-bookmark-title='note' href='http://b.hatena.ne.jp/entry/{{ url }}' title='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0'> <img alt='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0' height='20' src='https://b.st-hatena.com/images/entry-button/button-only@2x.png' style='border: none;' width='20'> </a> <script async='async' charset='utf-8' src='https://b.st-hatena.com/js/bookmark_button.js' type='text/javascript'></script></li><li ng-if='isSmartPhone'><a class='hatena-bookmark-button' data-hatena-bookmark-layout='simple-balloon' data-hatena-bookmark-title='note' href='http://b.hatena.ne.jp/entry/{{ url }}' title='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0'> <img alt='\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u3092\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306b\u8ffd\u52a0' height='20' src='https://b.st-hatena.com/images/entry-button/button-only@2x.png' style='border: none;' width='20'> </a> <script async='async' charset='utf-8' src='https://b.st-hatena.com/js/bookmark_button.js' type='text/javascript'></script></li> </ul>")
}]),angular.module("noteApp").directive("socialPlugin",["$filter","$sce","$stateParams","Title","UserAgent","CustomDomainContext","$window",function(e,t,n,r,i,a,o){var s;return s={restrict:"E",templateUrl:"common/social_plugin.html",link:function(s,l){var c;return c=665869046808089,s.$watch("initFin",function(){var u,d,p,h,m,f,g,v,y,b,_;if(s.initFin)return null!=s.note?(s.hide_social_plugin=!1,"TalkNote"===s.note.type&&s.note.is_limited?void(s.hide_social_plugin=!0):(s.url="https://"+o.PREFETCH.NOTE.production_host+"/"+s.note.user.urlname+"/n/"+s.note.key,s.counturl="https://"+o.PREFETCH.NOTE.production_host+"/"+s.note.user.urlname+"/n/"+s.note.key,(a.isCdAccess()&&"magazine"===a.type&&-1!==s.note.belonging_magazine_keys.indexOf(a.key)||a.isCdAccess()&&"creator"===a.type&&s.note.user.urlname===a.key)&&(m=""+a.getProtocol()+"://"+a.host,s.url=""+m+"/n/"+s.note.key,s.counturl=""+m+"/n/"+s.note.key),s.fbUrl=t.trustAsResourceUrl("//www.facebook.com/plugins/like.php?href="+encodeURIComponent(s.url)+"&width=110&layout=button_count&action=like&show_faces=false&share=false&height=21&appId="+c),h=140,p=23,u=7,d=h-(p+u),y="TalkNote"===s.note.type?s.note.plane_body:s.note.name,f=s.note.user.nickname||s.note.user.urlname,v=null!=n.magazine_key?s.magazine.name:"",b="note\uff08\u30ce\u30fc\u30c8\uff09",s.isSmartPhone=i.isSmartPhone,s.isPC=i.isPC,_=[],v?(y+v+b).length<d?_.push(y,v,b):(y+b).length<d?_.push(y,b):_.push(y.length<d?y:e("truncate")(y,d)):(y+f+b).length<d?_.push(y,f,b):(y+b).length<d?_.push(y,b):_.push(y.length<d?y:e("truncate")(y,d)),s.text=r.create(_),window.FB&&FB.XFBML.parse(),l.append('<script async type="text/javascript" src="//platform.twitter.com/widgets.js"></script>'),g='<script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId='+c+"\";fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script>",l.append(g))):void 0})},scope:{note:"=",initFin:"=",magazine:"="}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("mediaElementHowler",["$filter","$timeout","$rootScope","UserAgent",function(e,t,n,r){var i;return i={templateUrl:"/templates/common/_sound_howler_player",restrict:"A",scope:{src:"@src",duration:"@",preload:"=?preload",canRead:"="},link:function(i,a){var o;return i.durationTime=angular.isDefined(i.canRead)&&i.canRead?e("soundDuration")(String(i.duration)):"00:30",i.timer="00:00",i.progress="0%",i.playing=!1,i.startAt=0,i.checkStart=!0,i.progressWidth=0,i.timeWidth=0,i.preload=angular.isDefined(i.preload)?i.preload:!1,o=r.original.toLowerCase(),-1!==o.indexOf("safari")&&-1===o.indexOf("chrome")&&(i.preload=!1),angular.element(window).bind("resize",function(){return i.resizeProgress(),i.$digest()}),i.sound=new Howl({src:i.src,html5:!0,volume:.5,preload:i.preload,onplay:function(){requestAnimationFrame(i.step.bind(self))},onload:function(){i.durationTime=i.formatTime(Math.round(i.sound.duration())),i.resizeProgress()},onend:function(){i.playing=!1,i.checkStart=!1},onpause:function(){i.checkStart=!1},onstop:function(){}}),i.$on("$destroy",function(){return i.sound.stop(),i.soundPauseEvent()}),i.soundPauseEvent=n.$on("pauseSound",function(e,t){return i.soundId!==t?(i.sound.pause(i.soundId),i.playing=!1):void 0}),i.resizeProgress=function(){var e,t;return e=2,t=a.find(".mejs-container").width()-a.find(".mejs-time").width()-a.find(".mejs-playpause-button").width(),i.progressWidth=t-e+"px",i.timeWidth=t-20+"px"},t(function(){return i.resizeProgress()},100),i.jumpTime=function(e){return i.startAt=e.offsetX/e.target.clientWidth,i.checkStart=!0,i.seek(i.startAt),i.timer=i.formatTime(Math.round(i.startAt*i.sound.duration())),i.progress=(100*i.startAt||0)+"%"},i.formatTime=function(e){var t,n;return t=Math.floor(e/60)||0,n=e-60*t||0,(10>t?"0":"")+t+":"+(10>n?"0":"")+n},i.seek=function(e){return i.sound.playing()?i.sound.seek(i.sound.duration()*e):void 0},i.step=function(){var e;return e=i.sound.seek()||0,i.timer=i.formatTime(Math.round(e)),i.progress=(e/i.sound.duration()*100||0)+"%",i.$digest(),i.sound.playing()?requestAnimationFrame(i.step.bind(this)):void 0},i.play=function(){return i.sound&&i.sound.playing()?(i.playing=!1,i.sound.pause()):(i.playing=!0,i.soundId=i.sound.play(),i.checkStart&&i.seek(i.startAt),n.$emit("pauseSound",i.soundId))}}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("soundNoteModal",["Popeye","NoteForm","$timeout",function(e,t,n){var r;return r={restrict:"A",scope:{note:"=",currentUser:"="},link:function(r,i,a){var o,s;return i.on("click",function(){var t;return t=e.openModal({templateUrl:"/templates/modal/edit_sound_note",backdrop:"static",click:!1,controller:["$scope","$rootScope","$window","$upload","SoundNote","NoteNotifyUpdate","MagazineNote","SoundNoteDraft","DraftSaveAlert","$state","ContentLink","Auth","Bridge","$analytics",function(e,i,l,c,u,d,p,h,m,f,g,v,y,b){return o(r,a,l,e,v,y),e.clickSoundNoteImageUpload=function(){return n(function(){return angular.element("#cover-input").click()},10),null},e.onNoteAudioSelect=function(t){var n;return e.image_uploading=!0,n=t[0],e.upload=c.upload({url:"/api/v1/file_upload/audio",file:n}).success(function(t){var n;return t.error?void(e.uploadError="file_type_not_allowed"===t.error.code?"\u30d5\u30a1\u30a4\u30eb\u306e\u5f62\u5f0f\u304c\u9055\u3046\u304b\u3001\u30b5\u30a4\u30ba\u304c50MB\u3092\u8d85\u3048\u3066\u3044\u307e\u3059\u3002":"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"):(e.uploadError="",n=t.data,n.url=decodeURIComponent(n.url),n.url_for_download=decodeURIComponent(n.url_for_download),n.preview_url=decodeURIComponent(n.preview_url),e.note.audio=n,e.note.name||(e.note.name=n.original_filename.replace(/\.\S+$/,"")),e.note.price>0?e.onDragAreaClicked("p.btn-form[ng-click]"):void 0)})},e.onNoteSoundCoverSelect=function(t){var n,r;return n=t[0],(r=n.type.indexOf("gif")>=0?!0:!1)?void alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):(e.image_uploading=!0,e.upload=c.upload({url:"/api/v1/image_upload/sound_cover",file:n}).success(function(t){return e.image_uploading=!1,null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):(e.note.cover=t.data,e.note.audio.cover=e.note.cover.url,!0)}))},e.clickSoundNoteImageUpload=function(){return n(function(){return angular.element("#cover-input").click()},10),null},e.onDragAreaClicked=function(e){return angular.element(e).click(),null},e.deleteSoundFile=function(){return e.note.audio=null,$("div.soundnote-edit").length>0?$("div.soundnote-edit").find("div.mejs-audio").remove():$("div.mejs-audio").remove(),!0},e.deleteSoundCover=function(){return e.note.cover=null,e.note.audio.cover=null},e.saveSoundNoteDraft=function(){var n,o,l,c,u;if(!e.afterSubmit&&(o=m.getMessage(e.note,e.settings),o&&alert(o),e.afterSubmit=!0,l=e.note,l.name&&l.audio))return u=parseInt(l.price,10),l.paid_flag===!0?(l.enableDownload=!0,l.price=u):l.price=0,e.settings.normalize(),"edit"!==a.soundNoteModal?(s(f,b,"soundNoteDraft"),n=new h,n.status="draft",n.name=e.note.name,n.artist_name=e.note.artist_name,n.audio_key=e.note.audio.key,n.paid_flag=e.note.paid_flag,n.price=e.note.price,n.cover_key=e.note.cover&&e.note.cover.key||null,n.description=e.note.description||null,n.enable_download=!!e.note.enableDownload,n.magazine_ids=e.settings.magazineIds,n.limited=e.settings.limited,e.note.publish_at=e.note.is_reserved?e.settings.publishAt:null,e.note.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],n.$save(null,function(n){return n.error?(alert(n.error.message),void(e.afterSubmit=!1)):"draft"===e.note.status?(null!=n.data.audio.cover?e.note.audio.cover=n.data.audio.cover:e.note.cover=null,e.note.name=n.data.name,e.note.description=n.data.description,e.note.price=n.data.price,e.note.audio.artist_name=n.data.audio.artist_name,e.note.audio.key=n.data.audio.key,e.note.audio.url=n.data.audio.url,e.note.audio.preview_url=n.data.audio.preview_url,e.note.audio.url_for_download=n.data.audio.url_for_download,e.note.audio.downloadable=n.data.audio.downloadable,e.note.audio.cover=n.data.audio.cover,e.note.hashtag_notes=n.data.hashtag_notes,i.$emit("createNoteDraftFromNavBar",n.data),t.close()):void 0})):(c={status:"draft",name:l.name,artist_name:l.artist_name,audio_key:l.audio.key,paid_flag:l.paid_flag,price:l.price,cover_key:l.cover&&l.cover.key||null,description:l.description||null,enable_download:!!l.enableDownload,magazine_ids:e.settings.magazineIds,limited:e.settings.limited},c.publish_at=e.note.is_reserved?e.settings.publishAt:null,c.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],h.save({id:l.id},c,function(n){return n.error?(alert(n.error.message),void(e.afterSubmit=!1)):("draft"===r.note.status&&(null!=n.data.audio.cover?r.note.audio.cover=n.data.audio.cover:r.note.cover=null,r.note.name=n.data.name,r.note.description=n.data.description,r.note.price=n.data.price,r.note.audio.artist_name=n.data.audio.artist_name,r.note.audio.key=n.data.audio.key,r.note.audio.url=n.data.audio.url,r.note.audio.preview_url=n.data.audio.preview_url,r.note.audio.url_for_download=n.data.audio.url_for_download,r.note.audio.downloadable=n.data.audio.downloadable,r.note.audio.cover=n.data.audio.cover,r.note.hashtag_notes=n.data.hashtag_notes),e.afterSubmit=!1,void t.close())},function(){alert(res.error.message),e.afterSubmit=!1}),void 0)},e.save=function(){var n,o,l,c;if(!e.afterSubmit&&(e.afterSubmit=!0,n=e.note,n.name&&n.audio))return l=parseInt(n.price,10),n.paid_flag===!0?(n.enableDownload=!0,n.price=l):n.price=0,e.settings.normalize(),"edit"===a.soundNoteModal?(o={status:"published",name:n.name,artist_name:n.artist_name,audio_key:n.audio.key,paid_flag:n.paid_flag,price:n.price,cover_key:n.cover&&n.cover.key||null,description:n.description||null,enable_download:n.enableDownload||!1,magazine_ids:e.settings.magazineIds,limited:e.settings.limited,publish_at:e.settings.reserved||e.note.is_draft?e.settings.publishAt:null,hashtags:e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],prior_sale_activated:e.note.prior_sale_activated,first_served_sales_count:e.note.first_served_sales_count,change_prior_sale_count:e.note.change_prior_sale_count},e.currentUser.turnoff_comment_available&&(o.disable_comment=e.settings.enable_comment===!1),u.put({noteId:n.id},o,function(n){var i,a;return n.error?(alert(n.error.message),void(e.afterSubmit=!1)):(null!=n.data.audio.cover?r.note.audio.cover=n.data.audio.cover:r.note.cover=null,r.note.name=n.data.name,r.note.description=n.data.description,r.note.price=n.data.price,r.note.audio.artist_name=n.data.audio.artist_name,r.note.audio.key=n.data.audio.key,r.note.audio.url=n.data.audio.url,r.note.audio.preview_url=n.data.audio.preview_url,r.note.audio.url_for_download=n.data.audio.url_for_download,r.note.audio.downloadable=n.data.audio.downloadable,r.note.audio.cover=n.data.audio.cover,r.note.hashtag_notes=n.data.hashtag_notes,r.note.prior_sale=n.data.prior_sale,"published"===r.note.status?o.limited===!0?(a=e.settings.magazineIds,r.note.is_limited=!0,r.note.limited_note_include_magazines=function(){var t,n,r;for(r=[],t=0,n=a.length;n>t;t++)i=a[t],r.push(e.settings.magChecks[i].magazine);return r}()):(r.note.is_limited=!1,r.note.limited_note_include_magazines=[]):e.settings.reserved&&(r.note.reserved_publish_at=e.settings.publishAt),r.note.disable_comment=n.data.disable_comment,e.afterSubmit=!1,n.data.exist_purchased_user&&n.data.content_changed?e.ask_notify_update=!0:t.close(),"draft"===r.note.status?g.go("note",e.note,{reload:!0}):void 0)},function(){return alert(res.error.message),e.afterSubmit=!1})):(s(f,b,"soundNote"),c=new u,e.settings.normalize(),c.status="published",c.name=n.name,c.artist_name=n.artist_name,c.audio_key=n.audio.key,c.paid_flag=n.paid_flag,c.price=n.price,c.cover_key=n.cover&&n.cover.key||null,c.description=n.description||null,c.enable_download=n.enableDownload||!1,c.magazine_ids=e.settings.magazineIds,c.limited=e.settings.limited,c.publish_at=e.settings.publishAt,c.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],c.prior_sale_activated=n.prior_sale_activated,c.first_served_sales_count=n.first_served_sales_count,c.change_prior_sale_count=n.change_prior_sale_count,e.currentUser.turnoff_comment_available&&(c.disable_comment=e.settings.enable_comment===!1),c.$save(null,function(n){var r,a;return n.error?(alert(n.error.message),void(e.afterSubmit=!1)):(null!=n.data.audio.cover?e.note.audio.cover=n.data.audio.cover:e.note.cover=null,e.note.name=n.data.name,e.note.description=n.data.description,e.note.price=n.data.price,e.note.audio.artist_name=n.data.audio.artist_name,e.note.audio.key=n.data.audio.key,e.note.audio.url=n.data.audio.url,e.note.audio.preview_url=n.data.audio.preview_url,e.note.audio.url_for_download=n.data.audio.url_for_download,e.note.audio.downloadable=n.data.audio.downloadable,e.note.audio.cover=n.data.audio.cover,e.note.hashtag_notes=n.data.hashtag_notes,e.note.prior_sale=n.data.prior_sale,e.note.status=n.data.status,e.note.user=n.data.user,e.note.custom_domain=n.data.user.custom_domain,e.note.key=n.data.key,e.note.note_days_count=n.data.note_days_count,e.note.note_days_text=n.data.note_days_text,e.settings.reserved===!0?(t.close(),f.go("showTextNoteFriendly",{urlname:n.data.user.urlname,key:n.data.key})):("published"===e.note.status&&(e.settings.limited===!0?(a=e.settings.magazineIds,e.note.is_limited=!0,e.note.limited_note_include_magazines=function(){var t,n,i;for(i=[],t=0,n=a.length;n>t;t++)r=a[t],i.push(e.settings.magChecks[r].magazine);return i}()):(e.note.is_limited=!1,e.note.limited_note_include_magazines=[])),e.note.disable_comment=n.data.disable_comment,e.afterSubmit=!1,i.$emit("createNoteFromNavBar",n.data),n.data.exist_purchased_user&&n.data.content_changed?e.ask_notify_update=!0:e.isPublishedNote=!0,"draft"===e.note.status?g.go("note",e.note,{reload:!0}):void 0))},function(){return alert(res.error.message),e.afterSubmit=!1}))},e.notify_update=function(){return d.save({key:e.note.key},function(){return t.close()})},e.cancel_without_restore=function(){return t.close()}}]}),"edit"===a.soundNoteModal&&r.note.price>0?n(function(){return $("div.soundnote-edit").find("p.btn-form[ng-click]").click()},100):void 0}),o=function(e,n,r,i,a,o){var s;return i.$window=r,"edit"===n.soundNoteModal?(i.note=angular.copy(e.note),i.currentUser=e.currentUser,i.note.artist_name=e.note.audio.artist_name,i.note.enableDownload=e.note.audio.downloadable,i.note.cover={},i.settings={hashtag:{notekey:i.note.key}},null!=e.note.audio.cover&&(s=e.note.audio.cover.match(/square_middle_(.*)\.jpg/))?(i.note.cover.key=s[1],i.note.cover.url=e.note.audio.cover):i.note.cover.key=null,i.originalNote=angular.copy(e.note),i.note.paid_flag=i.note.price>0,i.note.limitedCheck=i.note.is_limited,t.initEdit(i)):(i.hideNoteModalHeaderFlag=!0,i.note={paid_flag:!1,audio:null,enableDownload:!1,status:"draft",type:"SoundNote"},i.settings={hashtag:{list:[]},enable_comment:!0},t.init(i,a,o))},s=function(e,t,n){var r,i;return i="create-"+n,"home.home"===e.current.name&&(r=i+"-from-home"),"creator.home"===e.current.name&&(r=i+"-from-creator"),"magazine.home"===e.current.name&&(r=i+"-from-magazine"),"showTextNoteFriendly"===e.current.name&&(r=i+"-from-note"),t.eventTrack(r,{category:"button",label:"link"})}}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("soundDownloadLog",["ActivityLog","$timeout",function(e){return{scope:{kind:"=",actableKey:"=",actableType:"=",actedArea:"="},restrict:"A",link:function(t,n,r){return n.click(function(n){var i;return n.preventDefault(),i=e.save({kind:t.kind,actable_key:t.actableKey,actable_type:t.actableType}),i.then(function(){return location.href=r.href})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("talkNoteModal",["Popeye","NoteForm",function(e,t){var n;return n={restrict:"A",scope:{note:"=",currentUser:"=",isDraft:"="},link:function(n,r,i){return r.on("click",function(){var r,a,o;return a=e.openModal({templateUrl:"/templates/modal/edit_talk_note",backdrop:"static",click:!1,controller:["$scope","$rootScope","$upload","Note","TalkNote","NoteNotifyUpdate","MagazineNote","TalkNoteDraft","$state","ContentLink","Auth","Bridge","DraftSaveAlert","$analytics","$timeout",function(e,t,s,l,c,u,d,p,h,m,f,g,v,y,b){var _;return r(n,i,e,f,g),e.saveTalkNoteDraft=function(){var r,s,l,c,u;if("edit"!==i.talkNoteModal){if(o(h,y,"talkNoteDraft"),r=v.getMessage(e.note,e.settings),r&&alert(r),e.isSubmitting||_())return;if(e.note.pictures.length>0&&(l=e.note.pictures[0].key),s=e.note.body&&e.note.body.trim().length>0,!l&&!s)return;return u=new p,u.message=e.note.body,e.note.pictures.length>0&&(u.image_key=e.note.pictures[0].key),u.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.isSubmitting=!0,u.$save(null,function(n){e.isSubmitting=!1,e.note.body=null,e.note.pictures=null,e.settings.hashtag.list=null,t.$emit("createNoteDraftFromNavBar",n.data),a.close(),n.error&&alert(n.error.message)},function(){return e.isSubmitting=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})}e.settings.hashtag.list.length>0&&alert("\u4e0b\u66f8\u304d\u4fdd\u5b58\u3067\u306f\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u3001\u30de\u30ac\u30b8\u30f3\u3078\u306e\u8ffd\u52a0\u304c\u3055\u308c\u307e\u305b\u3093\u306e\u3067\u3001\u6295\u7a3f\u6642\u306b\u518d\u5ea6\u8a2d\u5b9a\u3092\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002"),e.afterSubmit||(e.afterSubmit=!0,c={message:e.note.body},"undefined"!=typeof e.note.pictures&&0!==e.note.pictures.length&&(c.image_key=e.note.pictures[0].key),c.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.note.is_reserved&&(c.publish_at=e.settings.publishAt),p.save({id:e.note.id},c,function(t){return t.error?(alert(t.error.message),void(e.afterSubmit=!1)):((n.isDraft||"draft"===n.note.status)&&(n.note.body=t.data.body,t.data.image_url!==n.note.image_url&&(n.note.image_url=null,b(function(){return n.note.image_url=t.data.image_url},100)),n.note.pictures=t.data.pictures,n.note.hashtag_notes=t.data.hashtag_notes),a.close(),void(e.afterSubmit=!1))}))},e.save=function(){var r,s;if(!e.isSubmitting&&!e.afterSubmit)return e.afterSubmit=!0,"edit"===i.talkNoteModal?(r={status:"published",message:e.note.body,image_key:"undefined"!=typeof e.note.pictures&&0!==e.note.pictures.length?e.note.pictures[0].key:void 0,hashtags:e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],limited:e.settings.limited,publish_at:e.note.is_reserved||e.note.is_draft?e.settings.publishAt:null},e.currentUser.turnoff_comment_available&&(r.disable_comment=e.settings.enable_comment===!1),c.put({noteId:e.note.id},r,function(t){var i;return t.error?(alert(t.error.message),void(e.afterSubmit=!1)):(n.note.body=t.data.body,t.data.image_url!==n.note.image_url&&(n.note.image_url=null,b(function(){return n.note.image_url=t.data.image_url},100)),n.note.pictures=t.data.pictures,n.note.hashtag_notes=t.data.hashtag_notes,n.note.is_edited=!0,n.note.plane_body&&(n.note.plane_body=t.data.body),"published"===n.note.status?r.limited===!0?(i=e.settings.magazineIds[0],n.note.is_limited=!0,n.note.limited_note_include_magazine=e.settings.magChecks[i].magazine):(n.note.is_limited=!1,n.note.limited_note_include_magazine=null):n.note.is_reserved&&(n.note.reserved_publish_at=e.settings.publishAt),n.note.disable_comment=t.data.disable_comment,t.data.exist_purchased_user&&t.data.content_changed?e.ask_notify_update=!0:a.close(),e.afterSubmit=!1,void(n.isDraft&&m.go("note",e.note,{reload:!0})))})):(o(h,y,"talkNote"),s=new c,s.status="published",s.message=e.note.body,"undefined"!=typeof e.note.pictures&&0!==e.note.pictures.length&&(s.image_key=e.note.pictures[0].key),s.hashtags=e.settings.hashtag.list?e.settings.hashtag.list.map(function(e){return e.text}):[],e.currentUser.turnoff_comment_available&&(s.disable_comment=e.settings.enable_comment===!1),e.isSubmitting=!0,s.$save(null,function(n){return e.isSubmitting=!1,n.error?void alert(n.error.message):(t.$emit("createNoteFromNavBar",n.data),e.note.body=n.data.body,e.uploadImage=null,e.settings.hashtag.list=null,e.note.user=n.data.user,e.note.custom_domain=n.data.user.custom_domain,e.note.key=n.data.key,e.note.note_days_count=n.data.note_days_count,e.note.note_days_text=n.data.note_days_text,e.isPublishedNote=!0,e.afterSubmit=!1)},function(){return e.isSubmitting=!1,alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}))},e.notify_update=function(){return u.save({key:e.note.key},function(){return a.close()})},e.cancel_without_restore=function(){return a.close()},e.deleteTalkNoteImage=function(){return"undefined"==typeof e.note.body?alert("You can't remove image when message is emty"):(e.note.pictures.splice(0,1),e.note.image_url=null)},e.onFileSelect=function(t){var n;return e.image_uploading=!0,n=t[0],e.upload=s.upload({url:"/api/v1/image_upload/note_picture",file:n}).success(function(t){return e.image_uploading=!1,null!=t.error&&"file_size_limit_exceeded"===t.error.code?alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):null!=t.error&&"file_type_not_allowed"===t.error.code?alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u306e\u307f\u3067\u3059\u3002"):("undefined"==typeof e.note.pictures&&(e.note.pictures=[]),e.note.pictures[0]=t.data,e.note.image_url=t.data.url)})},e.countBody=function(){var t,n,r,i,a,o,s;return t=140,r=/https?:\/\/\S*[^\s.;,(){}<>]/g,n=22,null!=e.note.body&&(s=e.note.body.match(r)),o=s?s.length*n:0,a=null!=e.note.body&&(i=e.note.body.replace(r,""))?i.length:0,e.note.textCount=t-(a+o)},_=function(){var t;return e.currentUser.no_urlname_user?(t=function(){return location.reload()},OpenPickUrlnameModalService.open(t,"note"),!0):!1}}]}),r=function(e,n,r,i,a){return"edit"===n.talkNoteModal?(r.note=angular.copy(e.note),r.currentUser=e.currentUser,r.settings={hashtag:{notekey:r.note.key},enable_comment:r.note.disable_comment===!1},r.note.textCount=0,e.note.plane_body&&(r.note.body=e.note.plane_body),t.initEdit(r)):(r.hideNoteModalHeaderFlag=!0,r.note={body:"",textCount:0,pictures:[],status:"draft",type:"TalkNote"},r.settings={hashtag:{list:[]},enable_comment:!0},t.init(r,i,a))},o=function(e,t,n){var r,i;return i="create-"+n,"home.home"===e.current.name&&(r=i+"-from-home"),"creator.home"===e.current.name&&(r=i+"-from-creator"),"magazine.home"===e.current.name&&(r=i+"-from-magazine"),"showTextNoteFriendly"===e.current.name&&(r=i+"-from-note"),t.eventTrack(r,{category:"button",label:"link"})}})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("textCount",function(){var e,t,n,r;return e=140,n=/https?:\/\/\S*[^\s.;,(){}<>]/g,t=22,r={restrict:"AE",templateUrl:"/text_count.html",link:function(t){return t.$parent.textCount=e,t.$watch("$parent.noteBody",function(e){return t.count(e)})},scope:{text:"="},controller:["$scope",function(r){var i;return r.expanded=!1,i=$("p.txt-count"),r.count=function(i){var a,o,s,l;return null!=i&&(l=i.match(n)),s=l?l.length*t:0,o=null!=i&&(a=i.replace(n,""))?a.length:0,r.$parent.textCount=e-(o+s)},r.$on("$talkNoteFormExpanded",function(){return r.expanded=!0,i.show()}),r.$on("$talkNoteFormCollapsed",function(){return r.expanded=!1,i.hide()})}]}})}.call(this),function(){"use strict";NOTE.CTRL.SpTimelineCtrl=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f){this.$scope=e,this.$rootScope=t,this.$state=n,this.$anchorScroll=r,this.$location=i,this.$timeout=a,this.HomeTimeLine=o,this.Auth=s,this.Bridge=l,this.TimelineStash=c,this.Pageview=u,this.ContentLink=d,this.$resource=p,this.$stateParams=h,this.Hashtag=m,this.Title=f,this.initProps(),this.onScrollBottom()}return e.inject=["$scope","$rootScope","$state","$anchorScroll","$location","$timeout","HomeTimeLine","Auth","Bridge","TimelineStash","Pageview","ContentLink","$resource","$stateParams","Hashtag","Title"],e.prototype.initProps=function(){return this.currentUser={},this.noteModel={notes:[],firstPage:null,lastPage:null,nextPage:null},this.isLoggedIn=null,this.rssPath=""+this.$location.path()+"/rss",this.resource=this.$resource(this.endpoint),this.subEndpoint?this.subResource=this.$resource(this.subEndpoint):void 0},e.prototype.eventInViewport=function(e,t){var n,r;if(e&&(r=t-6,n=t-1,!(0>r)))return this.$timeout(function(t){return function(){return inViewport(e[r],function(e){return t.$scope.$emit("$inViewportElementForPaging",e)}),inViewport(e[n],function(e){return t.loading?void 0:t.$scope.$emit("$inViewportElementForPaging",e)})}}(this),500)},e.prototype.sortTransition=function(e){(e||null!==this.$stateParams.sort)&&"new"===e&&"new"===this.$stateParams.sort},e.prototype.initTimeline=function(){},e.prototype.nextPage=function(){},e.prototype.onScrollBottom=function(){return this.pagingEvent=this.$scope.$on("$inViewportElementForPaging",function(e){return function(){return e.nextPage(e.kind)}}(this)),this.$scope.$on("$destroy",function(e){return function(){return e.pagingEvent()}}(this))},e.prototype.savePageView=function(e){return Object.keys(this.currentUser).length>0&&this.currentUser.is_admin?void 0:this.$timeout(function(t){return function(){return t.Pageview.save(e)}}(this),1e4,!1)},e.prototype.initSubContents=function(){!angular.isDefined(this.subResource)},e.prototype.setContainerClass=function(e){return null==e&&(e=[]),{"l-container--column_1column":!this.subEndpoint||this.subEndpoint&&0===e.length,"l-container--column_2column":this.subEndpoint&&e.length>0}},e}()}.call(this),function(){"use strict";NOTE.CTRL.TimelineNoteCtrl=function(){function e(e){this.$window=e}return e.inject=["$window"],e.prototype.changeStyleByKind=function(e){return 0===e.lastIndexOf("library",0)||"search"===e||"creatorTop"===e||"magazine"===e?!1:!0},e}()}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initProps=function(){var e;return t.__super__.initProps.call(this),e={manga:"\u30de\u30f3\u30ac",column:"\u30b3\u30e9\u30e0",novel:"\u5c0f\u8aac",photo:"\u5199\u771f",music:"\u97f3\u697d",business:"\u30d3\u30b8\u30cd\u30b9",lifestyle:"\u30e9\u30a4\u30d5\u30b9\u30bf\u30a4\u30eb",tech:"\u30c6\u30af\u30ce\u30ed\u30b8\u30fc",entertainment:"\u30a8\u30f3\u30bf\u30e1"},this.sort=this.$stateParams.sort||"trend",this.category=this.$stateParams.category,this.timelineTitle=e[this.$stateParams.category],this.sortObject=[{kind:"trend",label:"\u4eba\u6c17"},{kind:"new",label:"\u65b0\u7740"}],this.Title.set("\u300c"+e[this.category]+"\u300d\u30ab\u30c6\u30b4\u30ea\u306e"+("trend"===this.sort?"\u4eba\u6c17":"\u65b0\u7740")+"\u306e\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.sortTransition=function(e){return t.__super__.sortTransition.call(this,e),this.sort=this.$stateParams.sort||"trend",this.$state.go("categories",{category:this.category,sort:e},{reload:!0})},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.$state.includes("home.libraries.*")||"home.magazines"===this.$state.current.name?void 0:this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get({note_intro_only:!0,category:e.category,sort:e.$stateParams.sort,method:e.$stateParams.method},function(t){var n,r,i,a,o,s;if(e.loading=!1,t.error)return void(e.error=t.error);for(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length),r=[],o=t.data.notes,s=[],i=0,a=o.length;a>i;i++)n=o[i],s.push(r.push(n.id));return s})}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({note_intro_only:!0,page:this.noteModel.nextPage,category:this.category,sort:this.$stateParams.sort,method:this.$stateParams.method},function(e){return function(t){var n,r,i,a,o,s,l,c,u,d,p,h,m;if(e.loading=!1,t.error)return void(e.error=t.error);for(i={},d=e.noteModel.notes,a=0,l=d.length;l>a;a++)n=d[a],n.key&&(i[n.key]=!0);for(p=t.data.notes,o=0,c=p.length;c>o;o++)n=p[o],i[n.key]||e.noteModel.notes.push(n);for(e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length),r=[],h=t.data.notes,m=[],s=0,u=h.length;u>s;s++)n=h[s],m.push(r.push(n.id));return m}}(this))):void 0},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("categoryTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("timelineFeed",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_feed",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",index:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this),this.sort=this.$stateParams.f||"new",this.hashtag=this.$stateParams.hashtag,this.timelineTitle="#"+this.hashtag,this.relatedHashtags=[],this.sortObject=[{kind:"new",label:"\u65b0\u7740"},{kind:"trend",label:"\u4eba\u6c17"}]},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.sortTransition=function(e){return t.__super__.sortTransition.call(this,e),this.sort=this.$stateParams.sort||"new",this.$state.go("hashtag.home",{hashtag:this.hashtag,f:e},{reload:!0})},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.$state.includes("home.libraries.*")||"home.magazines"===this.$state.current.name?void 0:(this.initHashtagInfo(),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get({note_intro_only:!0,hashtag:e.$stateParams.hashtag,f:e.$stateParams.f},function(t){var n,r,i,a,o,s;if(e.loading=!1,t.error)return void(e.error=t.error);for(e.count=t.data.hashtag.count,e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length),r=[],o=t.data.notes,s=[],i=0,a=o.length;a>i;i++)n=o[i],s.push(r.push(n.id));return s
})}}(this)))},t.prototype.initHashtagInfo=function(){return this.Title.set("\u300c#"+this.$stateParams.hashtag+"\u300d\u306e"+("trend"===this.sort?"\u4eba\u6c17":"\u65b0\u7740")+"\u30bf\u30b0\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002"),this.Hashtag.get({hashtag:this.hashtag},function(e){return function(t){return e.relatedHashtags=t.data.relatedHashtags}}(this),function(){return function(e){return console.log(e)}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({note_intro_only:!0,page:this.noteModel.nextPage,hashtag:this.$stateParams.hashtag,f:this.$stateParams.f},function(e){return function(t){var n,r,i,a,o,s,l,c,u,d,p,h,m;if(e.loading=!1,t.error)return void(e.error=t.error);for(i={},d=e.noteModel.notes,a=0,l=d.length;l>a;a++)n=d[a],n.key&&(i[n.key]=!0);for(p=t.data.notes,o=0,c=p.length;c>o;o++)n=p[o],i[n.key]||e.noteModel.notes.push(n);for(e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length),r=[],h=t.data.notes,m=[],s=0,u=h.length;u>s;s++)n=h[s],m.push(r.push(n.id));return m}}(this))):void 0},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("hashtagTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@"}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.$rootScope.$on("$stateChangeStart",function(e){return function(t,n){return e.isCurrentStateIsTimeline()?(e.$rootScope.scrollPosNoteKey=e.currentFocusNoteKey,e.TimelineStash.stash(e.noteModel)):"home.home"!==n.name&&"timeline"!==n.name?e.TimelineStash.clear():void 0}}(this)),this.isCurrentStateIsTimeline()&&this.$rootScope.$on("createNoteFromNavBar",function(e){return function(t,n){return e.noteModel.notes.unshift(n)}}(this))}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this)},t.prototype.captureCurrentFocusNote=function(e){return this.isCurrentStateIsTimeline()?this.currentFocusNoteKey=e.key:void 0},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.$state.includes("home.libraries.*")||"home.magazines"===this.$state.current.name?void 0:this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0,e.loadTimelineFromStash(e.$state.current.name)?void 0:(e.loading=!0,e.resource.get({note_intro_only:!0},function(t){var n,r,i,a,o;if(e.loading=!1,t.error)return void(e.error=t.error);for(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length),r=[],o=t.data.notes,i=0,a=o.length;a>i;i++)n=o[i],r.push(n.id);return e.savePageView({ids:r,page:1})})))}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({since_created_at:this.noteModel.next_since_created_at,note_intro_only:!0,page:this.noteModel.nextPage},function(e){return function(t){var n,r,i,a,o,s,l,c,u,d,p,h;if(e.loading=!1,t.error)return void(e.error=t.error);for(i={},d=e.noteModel.notes,a=0,l=d.length;l>a;a++)n=d[a],n.key&&(i[n.key]=!0);for(p=t.data.notes,o=0,c=p.length;c>o;o++)n=p[o],i[n.key]||e.noteModel.notes.push(n);for(e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length),r=[],h=t.data.notes,s=0,u=h.length;u>s;s++)n=h[s],r.push(n.id);return e.savePageView({ids:r,page:e.noteModel.nextPage})}}(this))):void 0},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t.prototype.savePageView=function(e){return t.__super__.savePageView.call(this,e)},t.prototype.loadTimelineFromStash=function(e){var t;return t=null,("home.home"===e||"timeline"===e)&&(t=this.TimelineStash.stashPop()),t?(this.noteModel=angular.copy(t),this.TimelineStash.clear(),this.eventInViewport(document.getElementsByClassName("p-timeline__item"),this.noteModel.notes.length),this.$timeout(function(e){return function(){return e.$rootScope.scrollPosNoteKey?(e.$location.hash(e.$rootScope.scrollPosNoteKey),e.$anchorScroll(),e.$location.hash("")):void 0}}(this),10),this.loading=!1,!0):!1},t.prototype.isCurrentStateIsTimeline=function(){return"home.home"===this.$state.current.name||"timeline"===this.$state.current.name},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("homeTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@"}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.inject=[],t.prototype.changeStyleByKind=function(e){return t.__super__.changeStyleByKind.call(this,e)},t.prototype.imageCount=function(){return angular.isDefined(this.note.pictures_count)?this.note.pictures_count-1:angular.isDefined(this.note.pictures)?this.note.pictures.length-1:0},t}(NOTE.CTRL.TimelineNoteCtrl),angular.module("noteApp").directive("timelineImageNote",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_image_note",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",index:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this),this.Title.set("\u30b9\u30ad\u3092\u3064\u3051\u305f\u30ce\u30fc\u30c8",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get({note_intro_only:!0},function(t){var n;return e.loading=!1,t.error?void(e.error=t.error):(n=e.sortByArray(t.data.notes,t.data.liked_note_ids),e.noteModel.notes=n,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length))})}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({note_intro_only:!0,page:this.noteModel.nextPage},function(e){return function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length))}}(this))):void 0},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t.prototype.sortByArray=function(e,t){var n,r,i,a,o,s,l;if(null==t||0===t.length)return e;for(i=[],a=0,s=t.length;s>a;a++)for(n=t[a],o=0,l=e.length;l>o;o++)r=e[o],n===r.id&&i.push(r);return i},t.prototype.switchLibraryFilter=function(e){var t;return this.libraryFilterShow=!1,t="home.libraries."+e,this.$state.go(t)},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("libraryLikedNoteTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@",subNav:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this),this.Title.set("\u8cfc\u5165\u3057\u305f\u30ce\u30fc\u30c8",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get({note_intro_only:!0},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=t.data.notes,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length))})}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({note_intro_only:!0,page:this.noteModel.nextPage},function(e){return function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length))}}(this))):void 0},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t.prototype.switchLibraryFilter=function(e){var t;return this.libraryFilterShow=!1,t="home.libraries."+e,this.$state.go(t)},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("libraryPurchasedTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@",subNav:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this),this.Title.set("\u6700\u8fd1\u307f\u305f\u30ce\u30fc\u30c8",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get({note_intro_only:!0},function(t){var n;return e.loading=!1,t.error?void(e.error=t.error):(n=e.sortByArray(t.data.notes,t.data.liked_note_ids),e.noteModel.notes=n,e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.libraryFilterShow=!1)})}}(this))},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t.prototype.sortByArray=function(e,t){var n,r,i,a,o,s,l;if(null==t||0===t.length)return e;for(i=[],a=0,s=t.length;s>a;a++)for(n=t[a],o=0,l=e.length;l>o;o++)r=e[o],n===r.id&&i.push(r);return i},t.prototype.switchLibraryFilter=function(e){var t;return this.libraryFilterShow=!1,t="home.libraries."+e,this.$state.go(t)},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("libraryViewedNoteTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@",subNav:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.inject=[],t.prototype.changeStyleByKind=function(e){return t.__super__.changeStyleByKind.call(this,e)},t}(NOTE.CTRL.TimelineNoteCtrl),angular.module("noteApp").directive("timelineMovieNote",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_movie_note",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",index:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$window=e,this.$document=t,this.$timeout=n,this.currentUser=this.$window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.otherList=!1}return e.inject=["$window","$document","$timeout"],e.prototype.toggleOtherList=function(){return this.otherList?(this.$document.off("mouseup"),this.otherList=!1,!1):(this.otherList=!0,this.$document.on("mouseup",function(e){return function(t){return t.preventDefault(),e.$timeout(function(){return e.otherList=!1},0),e.$document.off("mouseup")}}(this)),!1)},e}(),angular.module("noteApp").directive("timelineNoteAction",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_note_action",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("timelineNoteFooter",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_note_footer",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("timelineNoteStatus",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_note_status",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",gaPrefix:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this),this.sort=this.$stateParams.pickup_key||"sort1",this.sortObject=[{kind:"sort1",label:"\u30eb\u30fc\u30eb1"},{kind:"sort2",label:"\u30eb\u30fc\u30eb2"},{kind:"sort3",label:"\u30eb\u30fc\u30eb3"}],this.rssPath=null,this.Title.set("\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002")},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.sortTransition=function(e){return t.__super__.sortTransition.call(this,e),this.sort=e||"sort1",this.$state.go("pickups",{pickup_key:e},{reload:!0})},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get({note_intro_only:!0,pickup_key:e.$stateParams.pickup_key,sort:e.$stateParams.sort,method:e.$stateParams.method},function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.notes=e.noteModel.notes.concat(t.data.notes),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length))})}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({note_intro_only:!0,pickup_key:this.$stateParams.pickup_key,page:this.noteModel.nextPage},function(e){return function(t){var n,r,i,a,o,s,l,c;if(e.loading=!1,t.error)return void(e.error=t.error);for(r={},l=e.noteModel.notes,i=0,o=l.length;o>i;i++)n=l[i],n.key&&(r[n.key]=!0);for(c=t.data.notes,a=0,s=c.length;s>a;a++)n=c[a],r[n.key]||e.noteModel.notes.push(n);return e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.noteModel.next_since_created_at=t.data.next_since_created_at,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length)}}(this))):void 0},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("pickupTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@"}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.$rootScope.isNotePage=!0,this.magazines=null,this.noteModel.nextNotes=[],this.$scope.$on("repeatFinishedEventFired",function(e){return function(){return e.loading=!1}}(this)),this.$scope.$on("$MagazineFollowToggle",function(){return function(e,t){return t.isFollowing=!t.isFollowing}}(this))}return n(t,e),t.prototype.initProps=function(){return t.__super__.initProps.call(this),this.rssPath="recommend/rss","home.recommend"===this.$state.current.name?this.Title.set("\u304a\u3059\u3059\u3081\u306e\u8a18\u4e8b\u4e00\u89a7",null,"note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002"):void 0},t.prototype.eventInViewport=function(e,n){return t.__super__.eventInViewport.call(this,e,n)},t.prototype.sortTransition=function(e){return t.__super__.sortTransition.call(this,e)},t.prototype.initTimeline=function(){return t.__super__.initTimeline.call(this),this.timelineTitle="\u7de8\u96c6\u90e8\u306e\u304a\u3059\u3059\u3081",this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.Bridge.currentUser=t.data,e.isLoggedIn=!0),e.loading=!0,e.resource.get(null,function(t){var n,r,i,a,o;if(e.loading=!1,t.error)return void(e.error=t.error);for(o=t.data.articles,r=i=0,a=o.length;a>i;r=++i)n=o[r],2>r?e.noteModel.notes.push(n):e.noteModel.nextNotes.push(n);return e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length+e.noteModel.nextNotes.length)})}}(this))},t.prototype.nextPage=function(e,n){return t.__super__.nextPage.call(this,e,n),!this.loading&&this.noteModel.nextPage?(this.loading=!0,this.resource.get({page:this.noteModel.nextPage},function(e){return function(t){return e.loading=!1,t.error?void(e.error=t.error):(e.noteModel.nextNotes=e.noteModel.nextNotes.concat(t.data.articles),e.noteModel.firstPage=t.data.first_page,e.noteModel.lastPage=t.data.last_page,e.noteModel.nextPage=t.data.next_page,e.eventInViewport(document.getElementsByClassName("p-timeline__item"),e.noteModel.notes.length+e.noteModel.nextNotes.length))}}(this))):void 0},t.prototype.initSubContents=function(){return t.__super__.initSubContents.call(this),this.subResource.get(null,function(e){return function(t){return e.magazines=t.data.contents}}(this),function(){return function(e){return console.log(e)}}(this))},t.prototype.onScrollBottom=function(){return t.__super__.onScrollBottom.call(this)},t.prototype.snakizeMagazineProperties=function(e){return e?(e.cover_rectangle=e.coverRectangle,e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),e.subscriptionInfo&&(e.subscription_info={},e.subscription_info.can_advance_purchase=e.subscriptionInfo.canAdvancePurchase,e.subscription_info.payment_date=e.subscriptionInfo.paymentDate,e.subscription_info.payment_date_carrier=e.subscriptionInfo.paymentDateCarrier,e.subscription_info.renewal_date=e.subscriptionInfo.renewalDate,e.subscription_info.reserved_end_date=e.subscriptionInfo.reservedEndDate,e.subscription_info.reserved_price=e.subscriptionInfo.reservedPrice,e.subscription_info.reserved_start_date=e.subscriptionInfo.reservedStartDate,e.subscription_info.conveniences=e.subscriptionInfo.conveniences),e.hasCoupon&&(e.has_coupon=e.hasCoupon),e.isOneshotSubscribeMagazine?e.is_oneshot_subscribe_magazine=e.isOneshotSubscribeMagazine:void 0):void 0},t.prototype.magazineDescTruncateLen=function(){return 30},t}(NOTE.CTRL.SpTimelineCtrl),angular.module("noteApp").directive("recommendTimeline",function(){return{restrict:"E",templateUrl:"/templates/common/timeline/_timeline",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{endpoint:"@",subEndpoint:"@",sortArea:"=",kind:"@",gaPrefix:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){this.$window=e,this.Contest=t,this.contests=[],this.getContests()}return e.inject=["$window","Contest"],e.prototype.getContests=function(){return this.Contest.get({camelize:!1}).$promise.then(function(e){return function(t){var n;return e.contests=t.data.contests,n=[],angular.forEach(e.contests,function(t){return n.push(t.hashtag.name.substr(1)===e.hashtag&&"opened"===t.state?!0:!1)}),e.isContest=n.indexOf(!0)>=0}}(this),function(e){return console.log(e)})},e}(),angular.module("noteApp").directive("timelineSortArea",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_sort_area",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{kind:"=",sort:"=",count:"=",hashtag:"=",rssPath:"=",sortObject:"=",relatedHashtags:"=",sortTransition:"&",timelineTitle:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.prototype.changeStyleByKind=function(e){return t.__super__.changeStyleByKind.call(this,e)},t}(NOTE.CTRL.TimelineNoteCtrl),angular.module("noteApp").directive("timelineSoundNote",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_sound_note",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",index:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$state=e}return e.inject=["$state"],e}(),angular.module("noteApp").directive("timelineSubNav",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_sub_nav",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{libraryFilterShow:"=",switchLibraryFilter:"&"}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.inject=[],t.prototype.changeStyleByKind=function(e){return t.__super__.changeStyleByKind.call(this,e)},t}(NOTE.CTRL.TimelineNoteCtrl),angular.module("noteApp").directive("timelineTalkNote",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_talk_note",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",index:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";var e,t={}.hasOwnProperty,n=function(e,n){function r(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].slice;e=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,e),t.inject=[],t.prototype.changeStyleByKind=function(e){return t.__super__.changeStyleByKind.call(this,e)},t}(NOTE.CTRL.TimelineNoteCtrl),angular.module("noteApp").directive("timelineTextNote",function(){return{restrict:"E",scope:{},templateUrl:"/templates/common/timeline/_timeline_text_note",controller:r.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",index:"=",gaPrefix:"=",kind:"="}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("topArticleImage",["$state","$rootScope",function(e,t){return{restrict:"A",scope:{note:"="},link:function(e,n){var r,i;if(e.note.first_picture)return r=e.note.first_picture,r.portrait=r.height>r.width,r.landscape=r.width>=r.height,i=new Image,i.src=t.isPC?r.picture_pc_url:r.picture_mobile_url,i.onload=function(){var e;return e=r.portrait?"p-post--image--portrait":"p-post--image--landscape",r.portrait&&i.width>=i.height?e="p-post--image--landscape":r.landscape&&i.height>i.width&&(e="p-post--image--portrait"),n.addClass(e),n.css("background-image","url("+i.src+")")}}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("transferRequestModal",["$rootScope","$state","$location","Popeye","RequestTransfer","EcTransfers","BankStatus",function(e,t,n,r,i,a,o){var s;return s={restrict:"A",scope:{sales:"=",salesActually:"=",salesType:"="},link:function(e,n){return n.on("click",function(){var n;return n=r.openModal({templateUrl:"/templates/modal/transfer_request",controller:["$scope",function(r){return r.sales=e.sales,r.salesActually=e.salesActually,r.phase="loading",o.get({},function(e){return r.phase="valid_bank_account"===e.data.status?"confirm":"invalid_bank_account"===e.data.status?"invalid_bank_account":"bank_account_not_found"},function(){return console.log("error")}),r.goBankAccountSettingPage=function(){return n.close(),t.go("settings.fee")},r.cancel=function(){return n.close()},r.ok=function(){var t,n;return"ec"===e.salesType?(n=a,t="/sitesettings/salesmanage/ec"):(n=i,t="/sitesettings/salesmanage"),n.save({sales:r.sales,actual_sales:r.salesActually},function(e){return null!=e.error?alert("\u632f\u8fbc\u4f9d\u983c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3001\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"):(r.phase="success",location.href=t)},function(e){return alert(e.data.data?e.data.data:"\u632f\u8fbc\u4f9d\u983c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3001\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")})}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("treasureNote",["$rootScope","TreasuredNote",function(e,t){var n;return n={templateUrl:"/templates/common/_timeline_note_favourite",restrict:"AE",link:function(e,n){var r;return r=n.find(".fav_btn"),e.note.is_treasured?r.attr("disabled","disabled").addClass("btn-disable").text("\u8ffd\u52a0\u6e08"):void r.on("click",function(i){var a;return i.preventDefault(),a=n.find(".fav_comment"),t.post({key:e.note.key,comment:a.val()},function(t){return t.success?(e.note.is_treasured=!0,r.attr("disabled","disabled").addClass("btn-disable").text("\u8ffd\u52a0\u6e08")):alert("This note could not be added to trend list")}),!1})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("addToTreasuredNote",["$state","$stateParams",function(){return{restrict:"AE",controller:["$scope","$rootScope","TreasuredNote","Auth",function(e,t,n){return e.addToTreasuredNote=function(){return e.note.is_treasured_note?void 0:n.post({key:e.note.key},function(t){return t.error?void alert(t.error.message):t.success?(alert("\u30c8\u30ec\u30b8\u30e3\u30fc\u306b\u8ffd\u52a0\u3057\u307e\u3057\u305f"),e.note.is_treasured_note=!0):alert("\u30c8\u30ec\u30b8\u30e3\u30fc\u3078\u306e\u8ffd\u52a0\u304c\u5931\u6557\u3057\u307e\u3057\u305f")})}}]}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("trendSearch",function(){var e;return e=1,{restrict:"A",controller:["$rootScope","$scope","HomeTimeLine","NoteTrend","HotTrend","$timeout",function(e,t,n,r,i){var a;return t.init=function(){return t.searchDate=moment().format("YYYY.MM.DD"),a()},t.isShowNext=function(){return t.searchDate!==moment().format("YYYY.MM.DD")?!0:!1},t.searchByDate=function(e){return t.searchDate="add"===e?moment(t.searchDate,"YYYY.MM.DD").add("days",1).format("YYYY.MM.DD"):moment(t.searchDate,"YYYY.MM.DD").add("days",-1).format("YYYY.MM.DD"),a()},t.searchAll=function(){return a()},t.sort=function(e){return t.selectedSortType=e,a({note_type:t.selectedNoteType,sort_type:e})},t.hot_trend=function(){t.selectedSortType="trend",t.noteModel.notes=[],t.loading=!0,t.enableUpperStageLoad=!0,t.selectedNoteType=t.selectedNoteType,i.get({note_intro_only:!0,page:1,search_date:moment(t.searchDate,"YYYY.MM.DD").format("YYYY-MM-DD")},function(e){var n,r,i,a;if(t.loading=!1,t.enableUpperStageLoad=!1,e.error)return void(t.error=e.error);if(e.data.notes){for(a=e.data.notes,r=0,i=a.length;i>r;r++)n=a[r],t.noteModel.notes.push(n);return t.noteModel.firstPage=e.data.first_page,t.noteModel.lastPage=e.data.last_page,t.noteModel.nextPage=e.data.next_page}})},t.nextPage=function(){return t.noteModel&&!(t.noteModel.notes&&0===t.noteModel.notes.length||t.noteModel.lastPage||t.loading)?(t.loading=!0,t.enableLowerStageLoad=!0,"trend"===t.selectedSortType?i.get({note_intro_only:!0,page:t.noteModel.nextPage,search_date:moment(t.searchDate,"YYYY.MM.DD").format("YYYY-MM-DD")},function(e){var n,r,i,a,o,s,l,c,u,d,p,h,m;if(t.loading=!1,t.enableLowerStageLoad=!1,e.error)return void(t.error=e.error);for(i={},d=t.noteModel.notes,a=0,l=d.length;l>a;a++)n=d[a],n.key&&(i[n.key]=!0);for(p=e.data.notes,o=0,c=p.length;c>o;o++)n=p[o],i[n.key]||t.noteModel.notes.push(n);for(t.noteModel.lastPage=e.data.last_page,t.noteModel.nextPage=e.data.next_page,r=[],h=e.data.notes,m=[],s=0,u=h.length;u>s;s++)n=h[s],m.push(r.push(n.id));
return m}):r.get({note_intro_only:!0,page:t.noteModel.nextPage,note_type:t.selectedNoteType,sort_type:t.selectedSortType,search_date:moment(t.searchDate,"YYYY.MM.DD").format("YYYY-MM-DD")},function(e){var n,r,i,a,o,s,l,c,u,d,p,h,m;if(t.loading=!1,t.enableLowerStageLoad=!1,e.error)return void(t.error=e.error);for(i={},d=t.noteModel.notes,a=0,l=d.length;l>a;a++)n=d[a],n.key&&(i[n.key]=!0);for(p=e.data.notes,o=0,c=p.length;c>o;o++)n=p[o],i[n.key]||t.noteModel.notes.push(n);for(t.noteModel.lastPage=e.data.last_page,t.noteModel.nextPage=e.data.next_page,r=[],h=e.data.notes,m=[],s=0,u=h.length;u>s;s++)n=h[s],m.push(r.push(n.id));return m})):void 0},t.$on("$scrollBottom",function(){return t.nextPage()}),t.search=function(e){return a({note_type:e})},this.search=function(e){return null==e&&(e={}),a(e)},a=function(e){return null==e&&(e={}),t.noteModel.notes=[],t.loading=!0,t.enableUpperStageLoad=!0,t.selectedNoteType=e.note_type,r.get({note_intro_only:!0,page:1,note_type:e.note_type,sort_type:e.sort_type,search_date:moment(t.searchDate,"YYYY.MM.DD").format("YYYY-MM-DD")},function(e){var n,r,i,a;if(t.loading=!1,t.enableUpperStageLoad=!1,e.error)return void(t.error=e.error);if(e.data.notes){for(a=e.data.notes,r=0,i=a.length;i>r;r++)n=a[r],t.noteModel.notes.push(n);return t.noteModel.firstPage=e.data.first_page,t.noteModel.lastPage=e.data.last_page,t.noteModel.nextPage=e.data.next_page}})}}]}})}.call(this),function(){"use strict";var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("noteApp").config(["$provide",function(t){return t.decorator("uiSrefDirective",["$delegate","$window","$state","$timeout","CustomDomainContext",function(t,n,r,i,a){var o,s,l,c,u;return l=t[0],c=function(e){var t;if(t=e.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/),!t||4!==t.length)throw new Error("Invalid state ref '"+e+"'");return{state:t[1],paramExpr:t[3]||null}},u=function(e){var t;return t=e.parent().inheritedData("$uiView"),t&&t.state&&t.state.name?t.state:void 0},o=["location","inherit","reload"],s=function(t,n,s,l){var d,p,h,m,f,g,v,y,b,_;return y=c(s.uiSref),v=null,_=null,p=u(n)||r.$current,h="FORM"===n[0].nodeName,d=h?"action":"href",m=!0,f={relative:p},g=t.$eval(s.uiSrefOpts)||{},angular.forEach(o,function(t){return e.call(g,t)>=0?f[t]=g[t]:void 0}),b=function(t){var i,o,s;return t&&(v=t),m?(o=r.href(y.state,v,f),l&&l.$$setStateInfo(y.state,v),o?(i=a.isCdAccess()&&(s=y.state,e.call(a.allowedStates,s)<0)?a.getNoteBaseUrl():"",n[0][d]=""+i+o):(m=!1,!1)):void 0},y.paramExpr&&(t.$watch(y.paramExpr,function(e){return e!==v?b(e):void 0},!0),v=t.$eval(y.paramExpr)),b(),h?void 0:n.bind("click",function(t){var o,s;return o=t.which||t.button,o>1||t.ctrlKey||t.metaKey||t.shiftKey||n.attr("target")||a.isCdAccess()&&!(a.isCdAccess()&&(s=y.state,e.call(a.allowedStates,s)>=0))?void 0:(i(function(){return r.go(y.state,v,f)}),t.preventDefault())})},l.compile=function(){return function(e,n,r,i){return s.call(t,e,n,r,i)}},t}])}])}.call(this),function(){"use strict";angular.module("noteApp").directive("unDroppable",function(){return{restrict:"A",link:function(e,t){var n,r,i;return i=t[0],n=function(e){return e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"},r=function(e){return e.preventDefault(),e.stopPropagation()},t.on("dragover",n),t.on("dragleave",n),t.on("drop",r)}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("unsubscribeModal",["Popeye","MagazineSubscription",function(e){var t;return t=["$scope","$window","Cookie","SerialApply","MagazineSubscription",function(e,t,n,r,i){return e.serial={code:null,usage:!1},e.unsubscribeMagazine=function(){return e.submitting=!0,i["delete"]({magazine_key:e.subscribable.key},function(n){var r;return n.error?(e.submitting=!1,e.close(),alert("cancel_error_too_early"===n.error.code?"\u8cfc\u8aad\u505c\u6b62\u306f\u8cfc\u8aad\u958b\u59cb\u304b\u308930\u5206\u4ee5\u4e0a\u306e\u7d4c\u904e\u304c\u5fc5\u8981\u306a\u305f\u3081\u3001\u304a\u624b\u6570\u3067\u3059\u304c\u3057\u3070\u3089\u304f\u7d4c\u3063\u3066\u304b\u3089\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002":"cancel_error_no_transaction"===n.error.code?"\u8a72\u5f53\u306e\u30de\u30ac\u30b8\u30f3\u3092\u8cfc\u8aad\u3057\u3066\u3044\u306a\u3044\u72b6\u614b\u3067\u3059\u3002\u3082\u3057\u8cfc\u8aad\u4e2d\u306e\u8868\u793a\u304c\u51fa\u308b\u5834\u5408\u306f\u904b\u55b6("+t.PREFETCH.NOTE.support_email_address+")\u307e\u3067\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002":"\u8cfc\u8aad\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u305f\u3081\u3057\u304f\u3060\u3055\u3044\u3002")):n.data.start_url?(r=$("<form name='DocomoStartCall' action='"+n.data.start_url+"' method='post'>"),r.append($("<input type='hidden' name='AccessID' value='"+n.data.access_id+"'>")),r.append($("<input type='hidden' name='Token' value='"+n.data.token+"'>")),$("body").append(r),r.submit()):(e.subscribable.is_canceled=!0,e.subscribable.subscription.canceled_at=n.data.canceled_at,e.submitting=!1,t.location.reload(),e.close(),alert("\u8cfc\u8aad\u3092\u89e3\u9664\u3057\u307e\u3057\u305f\u3002"))},function(){return alert("\u8cfc\u8aad\u306e\u89e3\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})},e.showConfirmation=function(t){return e.confirm=t===!1?!1:!0},e.close=function(){return e.modal.close()},e.useSerial=function(){return e.serial.usage=!0},e.verifySerial=function(){var t;return t=(e.serial.code||"").trim(),0===t.length?e.serialError="\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002":(e.submitting=!0,void r.save({code:t,magazine_key:e.subscribable.key},function(t){return e.subscribable.free_subscription_ended_at=t.data.discount.free_subscription_ended_at,e.subscribable.discount_amount=t.data.discount.amount,e.subscribable.discount_price=t.data.discount.price,e.subscribable.extended_payment_date=t.data.discount.payment_started_at,e.subscribable.reserved_free_subscription_ended_at=t.data.discount.reserved_free_subscription_ended_at,e.serial.verified=!0,e.submitting=!1},function(t){switch(t.data.error){case"unsubscribable":e.serialError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u5b9a\u671f\u8cfc\u8aad\u30de\u30ac\u30b8\u30f3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002";break;case"forbidden":e.serialError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Serial code had expired":e.serialError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u5931\u52b9\u3057\u3066\u3044\u307e\u3059\u3002";break;case"Serial code had been used":e.serialError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Not found":e.serialError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;default:e.serialError="\u30af\u30fc\u30dd\u30f3\u306e\u9069\u7528\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"}return e.submitting=!1}))},e.applySerial=function(){var r;return e.submitting=!0,r={magazine_key:e.subscribable.key,payment_method:"serialcode",coupon_applied:!0,serial_code_applied:!0,serial_code:e.serial.code},i.put(r,function(r){return r.error?(alert("blocked"===r.error.code?r.error.message:"\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u8aad\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),void e.close()):(n.put("rd_flash","magazine_subscription"),t.location.href="/"+e.subscribable.user.urlname+"/m/"+e.subscribable.key)},function(){return alert("\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u8aad\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})},e.cancelable=function(){var t;return t=e.subscribable.subscription,!t.canceled_at&&!t.reserved&&!t.is_serial}}],{restrict:"A",scope:{subscribable:"="},link:function(n,r){return r.click(function(){return n.modal=e.openModal({templateUrl:"/templates/modal/unsubscribe_magazine",controller:t,scope:n})})},controller:t}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("userListModal",["Popeye","$state","$stateParams","ContentLink","CustomDomainContext",function(e,t,n,r,i){return{restrict:"A",scope:{users:"=",title:"@"},link:function(t,n){var a;return a=["$scope",function(n){return n.title=t.title,n.users=t.users,n.close=function(){return e.closeCurrentModal()},n.goAndClose=function(t,n){return n.urlname?r.go("user",n):location.href=i.isCdAccess()?i.getNoteBaseUrl()+("/_nourlname?user_id="+n.id):location.origin+("/_nourlname?user_id="+n.id),e.closeCurrentModal(),t.preventDefault()}}],n.on("click",function(){var t;return t=e.openModal({templateUrl:"/templates/modal/user_list",controller:a})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").directive("userPagingListModal",["Popeye","$state","$stateParams","ContentLink","CreatorFollowings","CreatorFollowers","$rootScope","$timeout","CustomDomainContext",function(e,t,n,r,i,a,o,s,l){return{restrict:"A",scope:{user:"=",title:"@",kind:"@"},link:function(t,n){var o;return o=["$scope",function(n){return n.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(n.currentUser).length&&(n.currentUser=null),n.user=t.user,n.kind=t.kind,n.title=t.title,n.currentPage=1,n.isLastPage=!0,n.isLoading=!1,n.follows=[],n.$on("$UserFollowed",function(e,t){var r,i,a,o;for(o=n.follows,i=0,a=o.length;a>i;i++)if(r=o[i],r.id===t){r.isFollowing=!0;break}return n.user.id===n.currentUser.id?n.user.followingCount++:void 0}),n.$on("$UserUnFollowed",function(e,t){var r,i,a,o;for(o=n.follows,i=0,a=o.length;a>i;i++)if(r=o[i],r.id===t){r.isFollowing=!1;break}return n.user.id===n.currentUser.id?n.user.followingCount--:void 0}),n.snakizeFollowUserProperties=function(e){return e.is_following=e.isFollowing},n.loadUsers=function(){switch(n.kind){case"following":return n.isLoading=!0,i.get({urlname:t.user.urlname,page:n.currentPage},function(){return function(e){var t,r,i,a;for(a=e.data.follows,r=0,i=a.length;i>r;r++)t=a[r],n.follows.push(t);return n.isLastPage=e.data.isLastPage,n.isLoading=!1}}(this),function(){return function(e){return console.log(e)}}(this));case"follower":return n.isLoading=!0,a.get({urlname:t.user.urlname,page:n.currentPage},function(){return function(e){var t,r,i,a;for(a=e.data.follows,r=0,i=a.length;i>r;r++)t=a[r],n.follows.push(t);return n.isLastPage=e.data.isLastPage,n.isLoading=!1}}(this),function(){return function(e){return console.log(e)}}(this));default:return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),e.closeCurrentModal()}},n.moreRead=function(){return n.currentPage++,n.loadUsers()},n.close=function(){return e.closeCurrentModal()},n.goAndClose=function(t,n){return n.urlname?r.go("user",n):location.href=l.isCdAccess()?l.getNoteBaseUrl()+("/_nourlname?user_id="+n.id):location.origin+("/_nourlname?user_id="+n.id),e.closeCurrentModal(),t.preventDefault()}}],n.on("click",function(){var t;return t=e.openModal({templateUrl:"/templates/modal/user_paging_list",controller:o})})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.Users=e,this.$stateParams=t,this.Title=n,this.$scope=r,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.notes=[],this.currentPage=this.$stateParams.page?+this.$stateParams.page:1,this.nextPage=null,this.size=20,this.isLastPage=!1,this.initUsers(),this.Title.set("\u30e6\u30fc\u30b6\u30fc\u4e00\u89a7",null,"note\uff08\u30ce\u30fc\u30c8\uff09"),this.$scope.$on("$UserFollowed",function(e,t){return this.$scope.currentUser.id===this.$scope.user.id?this.$scope.user.following_count++:this.$scope.user.id===t?(this.$scope.user.follower_count++,this.$scope.user.is_following=!0):void 0}),this.$scope.$on("$UserUnFollowed",function(e,t){return this.$scope.currentUser.id===this.$scope.user.id?this.$scope.user.following_count--:this.$scope.user.id===t?(this.$scope.user.follower_count--,this.$scope.user.is_following=!1):void 0})}return e.inject=["Users","$stateParams","Title","$scope"],e.prototype.initUsers=function(){return this.Users.get({size:this.size,page:this.currentPage},function(e){return function(t){return e.users=t.data.contents,e.nextPage=Number(e.currentPage+1),t.data.isLastPage&&(e.isLastPage=!0),e.totalCount=t.data.totalCount}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.snakizeCreatorProperties=function(e){return e.is_following=e.isFollowing,e.is_official=e.isOfficial,e.custom_domain=e.customDomain},e}(),angular.module("noteApp").directive("users",function(){return{restrict:"E",templateUrl:"/templates/users/list.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("violationModal",["Popeye","$resource","TextNote","ViolationReport",function(e,t,n,r){var i;return i={restrict:"A",scope:{note:"=",user:"=",comment:"=",userId:"=",context:"@"},link:function(t,n){return n.on("click",function(){var n;return n=e.openModal({templateUrl:"/templates/modal/violation",controller:["$scope","$resource",function(e){return e.userId=t.userId,e.user=t.user,e.note=t.note,e.comment=t.comment,e.page="input",e.violation={},e.violation.type="rrated",e.context=t.context,e.cancel=function(){return n.close()},e.ok=function(){var t,n;return e.submitted=!0,e.violationForm.$invalid?void 0:(e.note?(n="Note",t=e.note.id):e.user?(n="User",t=e.user.id):e.comment&&(n="Comment",t=e.comment.id),r.save({message:e.violation.message,kind:e.violation.type,report_user_id:e.userId,content_type:n,content_id:t,context:e.context},function(){return e.page="success"},function(){return alert("\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))}}]})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").filter("imageSize",function(){var e;return e=function(e,t){return null!=e?(null==t&&(t="middle"),e.replace(/_(small|middle|large|thumb|thumb_2x)/,"_"+t.toLowerCase())):e}}),angular.module("noteApp").filter("imageShape",function(){var e;return e=function(e,t){return null!=e?(null==t&&(t="square"),e.replace(/(rectangle|square)_/,""+t.toLowerCase()+"_").replace(/_type_2/,"")):e}}),angular.module("noteApp").filter("defaultMagazineCover",function(){var e;return e=function(e){return null!=e&&e.length>0?e:window.PREFETCH.NOTE.defaultImage.magazineWallpaper}}),angular.module("noteApp").filter("defaultRenewMagazineCover",function(){var e;return e=function(e){return null!=e&&e.length>0?e:window.PREFETCH.NOTE.defaultImage.magazineCover}}),angular.module("noteApp").filter("defaultMagazineCoverList",function(){var e;return e=function(e){return null!=e&&e.length>0?e:window.PREFETCH.NOTE.defaultImage.magazineWallpaperList}}),angular.module("noteApp").filter("defaultNoteCover",function(){var e;return e=function(e){return null!=e&&e.length>0?e:window.PREFETCH.NOTE.defaultImage.wallpaper}})}.call(this),function(){"use strict";angular.module("noteApp").filter("noteTypeFilter",function(){var e;return e=function(e,t){var n,r,i,a;for(r=[],i=0,a=e.length;a>i;i++)n=e[i],(null==t||""===t||n.type===t)&&r.push(n);return r}}),angular.module("noteApp").filter("noteTypeName",function(){var e,t;return t={talknote:"\u30c8\u30fc\u30af",textnote:"\u30c6\u30ad\u30b9\u30c8",imagenote:"\u30a4\u30e1\u30fc\u30b8",soundnote:"\u30b5\u30a6\u30f3\u30c9",movienote:"\u30e0\u30fc\u30d3\u30fc"},e=function(e){return t[e.toLowerCase()]}}),angular.module("noteApp").filter("notePurchaseStatusName",function(){var e,t;return t={success:"\u8cfc\u5165\u6e08",refund:"\u8fd4\u91d1\u6e08"},e=function(e){return t[e.toLowerCase()]}}),angular.module("noteApp").filter("noteTypeShort",function(){var e;return e=function(e){return null!=e?e.toLowerCase().replace(/note/,""):e}})}.call(this),function(){"use strict";angular.module("noteApp").filter("nl2br",function(){var e;return e=function(e){return null!=e?e.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2").replace(/&#1[03];/g,"<br>"):void 0}}),angular.module("noteApp").filter("trim",function(){var e;return e=function(e){return null!=e?e.replace(/^\s+|\s+$/g,""):void 0}}),angular.module("noteApp").filter("truncate",function(){var e;return e=function(e,t,n){return null==t&&(t=1e4),null==n&&(n="..."),null!=e&&e.length>t?e.substr(0,t)+n:e}}),angular.module("noteApp").filter("wordCount",function(){var e;return e=function(e){var t,n,r,i,a,o;return n=/https?:\/\/\S*[^\s.;,(){}<>]/g,t=22,null!=e&&(o=e.match(n)),a=o?o.length*t:0,i=null!=e&&(r=e.replace(n,""))?r.length:0,i+a}}),angular.module("noteApp").filter("hashtag",["$sce","$compile","$rootScope","CustomDomainContext",function(e,t,n,r){return function(e){var t,n;if(null!=e)return t=/(\s|^)(#|\uff03)(w*[\u4e00-\u9fa0\u3005\u3007_\u3041-\u3093_\u30a1-\u30f4\u30fc\uff41-\uff5a\uff21-\uff3a\uff10-\uff19a-zA-Z0-9]+|[a-zA-Z0-9_]+|[a-zA-Z0-9_]w*)/g,n=r.isCdAccess()?r.getNoteBaseUrl():"",e.replace(t,'$1<a target="_blank" href="'+n+'/hashtag/$3">#$3</a>')}}]),angular.module("noteApp").filter("hashtagAsp",["$sce","$compile","$rootScope","CustomDomainContext",function(){return function(e){var t;if(null!=e)return t=/(\s|^)(#|\uff03)(w*[\u4e00-\u9fa0\u3005\u3007_\u3041-\u3093_\u30a1-\u30f4\u30fc\uff41-\uff5a\uff21-\uff3a\uff10-\uff19a-zA-Z0-9]+|[a-zA-Z0-9_]+|[a-zA-Z0-9_]w*)/g,e.replace(t,'$1<a target="_blank" href="/hashtags/$3">#$3</a>')}}]),angular.module("noteApp").filter("truncateWithLink",["$filter",function(e){var t;return t=function(t,n,r){var i,a,o,s,l,c,u,d;if(a=/([\s|\S]*?)(https?:\/\/\S*[^\s.;,(){}<>])([\s|\S]*)/,o=/https?:\/\/\S*[^\s.;,(){}<>]/,i=new RegExp("^(https?://"+location.host+"/[0-9a-z_]+/n/n[0-9A-Za-z]{12})"),null==n&&(n=1e4),null==r&&(r="..."),l="",d=t,null==t)return t;if(s=function(e){var t,r,o,s,c;if(e)return(t=e.match(a))?(o=t[1],c=t[2],s=t[3],(r=c.match(i))&&(c=r[1]),l.length+o.length<=n?(l+=o,l.length+c.length<=n?(l+=c,d=s):d=""):(l+=o,d="")):(l+=e,d="")},(c=t.match(a))&&((u=c[2].match(i))&&(t=u[1]),""===c[1]&&""===c[3]))return t;for(;l.length<=n&&d;)s(d);return 0===l.length?t:t.length>n?e("truncate")(l.trim(),n,"")+"...":e("truncate")(l.trim(),n,r)}}]),angular.module("noteApp").filter("truncateWithByte",function(){var e;return e=function(e,t,n){var r,i,a,o;for(null==t&&(t=1e4),null==n&&(n="..."),o=0,a=0,i=0;a<e.length;)r=e.charCodeAt(a),r>=0&&129>r||63728===r||r>=65377&&65440>r||r>=63729&&63732>r?(i++,o+=.5):o+=1,a++;return null!=e&&o>t+.5*i?e.substr(0,t+.5*i)+n:e}}),angular.module("noteApp").filter("stripTags",function(){var e;return e=function(e){return null!=e?e.replace(/(<([^>]+)>)/gi,""):void 0}}),angular.module("noteApp").filter("sanitize",function(){var e;return e=function(e){return null!=e&&(e=e.replace(/</g,"&lt;")),null!=e&&(e=e.replace(/>/g,"&gt;")),null!=e&&(e=e.replace(/"/g,"&quot;")),null!=e&&(e=e.replace(/&/g,"&amp;")),null!=e?e=e.replace(/'/g,"&#39;"):void 0}}),angular.module("noteApp").filter("seeMoreLink",function(){var e;return e=function(e,t,n){return n?e+('<a class="txt-grey" href="'+t+'"> ...\u3082\u3063\u3068\u307f\u308b</a>'):e}}),angular.module("noteApp").filter("soundDuration",function(){var e;return e=function(e){var t,n;return n=function(e){return("0"+e).slice(-2)},t=moment.duration(+e,"seconds"),t.hours()>=1?""+n(t.hours())+":"+n(t.minutes())+":"+n(t.seconds()):""+n(t.minutes())+":"+n(t.seconds())}})}.call(this),function(){"use strict";angular.module("noteApp").filter("relativeTime",["$filter",function(e){var t;return t=function(t){var n,r,i;return n=new Date,t=new Date(t),i=Math.ceil((n.getTime()-t.getTime())/1e3),r=0>=i?"\u305f\u3063\u305f\u4eca":i>0&&60>i?""+i+"\u79d2\u524d":3600>i?""+Math.floor(i/60)+"\u5206\u524d":86400>i?""+Math.floor(i/3600)+"\u6642\u9593\u524d":172800>i?"\u6628\u65e5":i>=172800&&604800>i?""+Math.floor(i/86400)+"\u65e5\u524d":n.getFullYear()===t.getFullYear()?e("date")(t,"MM/dd"):e("date")(t,"yyyy/MM/dd")}}])}.call(this),function(){"use strict";angular.module("noteApp").filter("encodeURIComponent",function(){return window.encodeURIComponent}),angular.module("noteApp").filter("decodeURIComponent",function(){return window.decodeURIComponent}),angular.module("noteApp").filter("nofollow",function(){var e;return e=function(e){return null!=e?e.replace(/<a ([^>]+)>/g,'<a $1 rel="nofollow">'):void 0}})}.call(this),function(){angular.module("noteApp").factory("LogInterceptor",["$q","$injector",function(e,t){var n;return n=null,{request:function(e){return e},response:function(e){var r,i,a,o;if(r=e.config,a=r.method,o=r.url,i=e.data,i&&"post"===a.toLowerCase()&&/\/api\/v1\/(.*)/.test(o)){if(/\/api\/v1\/(.*)activities(.*)/.test(o)||!i.data||i.error)return e;n=n||t.get("ActivityLog"),n.log({url:o,key:i.data.key,area:""})}return e},responseError:function(t){var n,r;return r=function(e,t,n){var r;return t=t.toLowerCase(),403===e&&"post"===t?(r=["^/api/v1/followings","^/api/v1/note/[0-9]+/likes","^/api/v1/note/[0-9]+/comments"].map(function(e){return new RegExp(e)}),r.some(function(e){return e.test(n)})):!1},n=t.config,r(t.status,n.method,n.url)&&alert("\u3053\u306e\u6a5f\u80fd\u306e\u5229\u7528\u5ea6\u304c\u8a31\u5bb9\u30ec\u30d9\u30eb\u3092\u8d85\u3048\u305f\u305f\u3081\u3001\u3053\u306e\u6a5f\u80fd\u306e\u3054\u5229\u7528\u3092\u4e00\u5b9a\u6642\u9593\u505c\u6b62\u3057\u307e\u3057\u305f\u3002\u304a\u6642\u9593\u3092\u304a\u3044\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044"),e.reject(t)}}}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("ActivationResend",["$resource",function(t){return t(""+e+"/sessions/activation_resend")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Activity",["$resource",function(t){return t(""+e+"/activities")}]),angular.module("noteApp").factory("ActivityLogs",["$resource",function(t){return t(""+e+"/activities/log",{post:{method:"POST"}})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("BankStatus",["$resource",function(t){return t(""+e+"/banks/status")}]),angular.module("noteApp").factory("Bank",["$resource",function(t){return t(""+e+"/banks")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("BankAccount",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/my/bank_account")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Block",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/blocks/:id",{id:"@id"})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("BankBranch",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/banks/:bankCode/branches")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Comment",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/:commentables/:commentableId/comments/:commentId",null,{update:{method:"PUT"}})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("CouponApply",["$resource",function(t){return t(""+e+"/coupons/apply")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("CurrentUser",["$resource","$q","$timeout",function(e,t,n){var r;return r=t.defer(),n(function(){var e,t;return e={},t=window.PREFETCH.NOTE.user,angular.equals({},t)?e.error={code:"not_found",message:"\u30e6\u30fc\u30b6\u30fc\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"}:e.data=t,r.resolve(e)},0),r.promise}]),angular.module("noteApp").factory("CurrentUserAPI",["$resource","$q",function(e){var t;return t="/api/v1",e(""+t+"/current_user",{require_notificaton_num:"@require_notificaton_num"},{update:{method:"PUT"}})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("EmbedContent",["$resource",function(t){return t(""+e+"/embed")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("FanClubConfirm",["$resource",function(t){return t(""+e+"/fan_clubs/:urlname/confirm",{urlname:"@urlname"})}]),angular.module("noteApp").factory("FanClubTransfer",["$resource",function(t){return t(""+e+"/fan_clubs/:urlname/transfer",{urlname:"@urlname"})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Follower",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/followers/:userId")}]),angular.module("noteApp").factory("FollowerList",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/followers/:urlname/list")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Following",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/followings/:userId")}]),angular.module("noteApp").factory("FollowingList",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/followings/:urlname/list")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("HashtagSearch",["$resource",function(t){return t(""+e+"/search/hashtags")}]),angular.module("noteApp").factory("NoteHashtags",["$resource",function(t){return t(""+e+"/hashtags/:noteKey",{noteKey:"@noteKey"})}]),angular.module("noteApp").factory("SuggestedHashtags",["$resource",function(t){return t(""+e+"/hashtags/suggested/:notetype",{notetype:"@notetype"})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ImageNote",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/image_notes/:noteId",{},{put:{method:"PUT"}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ImageUploadNoteEyecatchDelete",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/image_upload/note_eyecatch/delete",{},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("ImageUploadMagazineCoverDelete",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/image_upload/magazine_cover/delete",{},{put:{method:"PUT"}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Launch",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/launch/:urlname",{id:"@id"})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("MagazineLayout",["$resource",function(t){return t(""+e+"/layout/magazine/:magazine_key",{magazine_key:"@magazine_key"})}]),angular.module("noteApp").factory("MagazineSectionLayout",["$resource",function(t){return t(""+e+"/layout/magazine/:magazine_key/section",{magazine_key:"@magazine_key"})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Like",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/:likables/:likableId/likes")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Magazine",["$resource",function(t){return t(""+e+"/magazines/:magazine_key",{magazine_key:"@magazine_key"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("MagazineNotes",["$resource",function(t){return t(""+e+"/magazines/:magazine_key/notes",{magazine_key:"@magazine_key"})}]),angular.module("noteApp").factory("MagazineFollowers",["$resource",function(t){return t(""+e+"/magazines/:magazine_key/followers",{magazine_key:"@magazine_key"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("MagazineSubscribers",["$resource",function(t){return t(""+e+"/magazines/:magazine_key/subscribers",{magazine_key:"@magazine_key",page:"@page",status:"@status"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("MagazineSubscriberDuration",["$resource",function(t){return t(""+e+"/magazines/:magazine_key/subscriber_durations",{magazine_key:"@magazine_key"})}]),angular.module("noteApp").factory("MagazinePurchasers",["$resource",function(t){return t(""+e+"/magazines/:magazine_key/purchasers",{magazine_key:"@magazine_key",page:"@page",per_page:"@per_page"})}]),angular.module("noteApp").factory("MagazineHavingTheNote",["$resource",function(t){return t(""+e+"/magazines/having_the_note")}]),angular.module("noteApp").factory("RandomMagazine",["$resource",function(t){return t(""+e+"/magazines/random")}]),angular.module("noteApp").factory("UserMagazine",["$resource",function(t){return t(""+e+"/magazines/:magazine_key",{magazine_key:"@magazine_key"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("UserPickupMagazine",["$resource",function(t){return t(""+e+"/magazines/pickup")}]),angular.module("noteApp").factory("MyMagazine",["$resource",function(t){var n;return n=""+e+"/my/magazines/:magazine_key",t(n,{magazine_key:"@magazine_key"},{put:{method:"PUT"},suspend:{url:""+n+"/suspend",method:"PUT"}})}]),angular.module("noteApp").factory("MagazineNote",["$resource",function(t){return t(""+e+"/my/magazines/:magazine_key/notes/:note_key",{note_key:"@note_key",magazine_key:"@magazine_key"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("AllMagazineNote",["$resource",function(t){return t(""+e+"/my/magazines/:magazine_key",{magazine_key:"@magazine_key"})}]),angular.module("noteApp").factory("MagazineNoteRearrange",["$resource",function(t){return t(""+e+"/my/magazines/:magazine_key/notes/rearrange",{magazine_key:"@magazine_key"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("MyFollowingMagazine",["$resource",function(t){return t(""+e+"/my/magazines/followings")}]),angular.module("noteApp").factory("MyPurchasedMagazine",["$resource",function(t){return t(""+e+"/my/magazines/purchased")}]),angular.module("noteApp").factory("MySubscribedMagazine",["$resource",function(t){return t(""+e+"/my/magazines/subscribed")}]),angular.module("noteApp").factory("EditableMagazine",["$resource",function(t){return t(""+e+"/my/magazines/editable")}]),angular.module("noteApp").factory("MagazineReadHistory",["$resource",function(t){return t(""+e+"/magazine_read_history/")}]),angular.module("noteApp").factory("ManualRecommendedMagazines",["$resource",function(t){return t(""+e+"/manual_recommended_magazines/")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("OurMagazine",["$resource",function(t){var n;return n=""+e+"/our/magazines/:magazine_key",t(n,{magazine_key:"@magazine_key"},{put:{method:"PUT"},sales:{url:""+n+"/sales",method:"GET"}})}]),angular.module("noteApp").factory("OurMagazineNote",["$resource",function(t){var n;return n=""+e+"/our/magazines/:magazine_key/notes/:note_key",t(n,{magazine_key:"@magazine_key",note_key:"@note_key"},{put:{method:"PUT"},rearrange_notes:{url:""+n+"/rearrange",method:"PUT"}})}]),angular.module("noteApp").factory("MagazineEditor",["$resource",function(t){var n;return n=""+e+"/our/magazines/:magazine_key/editors/:user_id",t(n,{magazine_key:"@magazine_key",user_id:"@user_id"},{put:{method:"PUT"},auth:{url:""+n+"/auth",method:"GET"},invite:{url:""+n+"/invite",method:"POST",isArray:!0},update_magazine:{url:""+n+"/update_magazine",method:"PUT"},leave:{url:""+n+"/leave",method:"PUT"},rolify:{url:""+n+"/rolify",method:"PUT"},update_ratio:{url:""+n+"/update_ratio",method:"PUT"}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("MovieNote",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/movie_notes/:noteId",{},{put:{method:"PUT"}})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("MyCreditCard",["$resource",function(t){return t(""+e+"/my/credit_card")}]),angular.module("noteApp").factory("MyEmail",["$resource",function(t){return t(""+e+"/my/email/:action",{action:"@action"})}]),angular.module("noteApp").factory("MyTokusyo",["$resource",function(t){return t(""+e+"/my/tokusyo/:action",{action:"@action"})}]),angular.module("noteApp").factory("MySupportBox",["$resource",function(t){return t(""+e+"/my/support_box")}]),angular.module("noteApp").factory("MyPassword",["$resource",function(t){return t(""+e+"/my/password")}]),angular.module("noteApp").factory("MyUserSettings",["$resource",function(t){return t(""+e+"/my/user_setting")}]),angular.module("noteApp").factory("MySettings",["$resource",function(t){return t(""+e+"/my/setting")}]),angular.module("noteApp").factory("MyNoticeSettings",["$resource",function(t){return t(""+e+"/my/notice_setting")}]),angular.module("noteApp").factory("MyFollowNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/follow")}]),angular.module("noteApp").factory("MyPurchaseNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/purchase")}]),angular.module("noteApp").factory("MyCommentNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/comment")}]),angular.module("noteApp").factory("MyLikeNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/like")}]),angular.module("noteApp").factory("MyNewsletterSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/newsletter")}]),angular.module("noteApp").factory("MyCommentToNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/comment_to")
}]),angular.module("noteApp").factory("MyMagazineNoteAddNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/magazine_note_add")}]),angular.module("noteApp").factory("MyFollowingMagazineNoteAddNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/following_magazine_note_add")}]),angular.module("noteApp").factory("MyPurchaseMagazineNoteAddNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/purchase_magazine_note_add")}]),angular.module("noteApp").factory("MyStockPhotoNoticeSetting",["$resource",function(t){return t(""+e+"/my/notice_setting/stock_photo")}]),angular.module("noteApp").factory("MyPremium",["$resource",function(t){return t(""+e+"/my/premium")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Note",["$resource",function(t){return t(""+e+"/notes/:noteKey",{noteKey:"@noteKey"})}]),angular.module("noteApp").factory("Article",["$resource",function(t){return t(""+e+"/articles/:slug",{slug:"@slug"})}]),angular.module("noteApp").factory("HomeTimeLine",["$resource",function(t){return t(""+e+"/notes/timeline")}]),angular.module("noteApp").factory("Recently",["$resource",function(t){return t(""+e+"/notes/recently")}]),angular.module("noteApp").factory("LikedNote",["$resource",function(t){return t(""+e+"/notes/liked")}]),angular.module("noteApp").factory("RandomNote",["$resource",function(t){return t(""+e+"/notes/random")}]),angular.module("noteApp").factory("ReadHistory",["$resource",function(t){return t(""+e+"/read_history/")}]),angular.module("noteApp").factory("MagazineNoteTimeLine",["$resource",function(t){return t(""+e+"/notes/magazine")}]),angular.module("noteApp").factory("HashtagTimeLine",["$resource",function(t){return t(""+e+"/hashtag/:hashtag",{hashtag:"@hashtag"})}]),angular.module("noteApp").factory("NoteNotifyUpdate",["$resource",function(t){return t(""+e+"/notes/:key/notify_update",{key:"@key"})}]),angular.module("noteApp").factory("Pageview",["$resource",function(t){return t(""+e+"/pageview",{ids:"@ids"},{post:{method:"POST"},query:{method:"POST",isArray:!0,ignoreLoadingBar:!0}})}]),angular.module("noteApp").factory("NoteTrend",["$resource",function(t){return t(""+e+"/notes/trend")}]),angular.module("noteApp").factory("HotTrend",["$resource",function(t){return t(""+e+"/notes/hot_trend")}]),angular.module("noteApp").factory("TreasuredNote",["$resource",function(t){return t(""+e+"/notes/:key/treasured_notes",{key:"@key"},{post:{method:"POST"}})}]),angular.module("noteApp").factory("CategoryTimeLine",["$resource",function(t){return t(""+e+"/categories/:category",{category:"@category"})}]),angular.module("noteApp").factory("PickupTimeLine",["$resource",function(t){return t(""+e+"/pickups/:pickup_key",{pickup_key:"@pickup_key"})}]),angular.module("noteApp").factory("ReservedNote",["$resource",function(t){return t(""+e+"/reserved_note/:noteKey",{noteKey:"@noteKey"})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("NoteDraft",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/text_notes/draft_save")}]),angular.module("noteApp").factory("TalkNoteDraft",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/talk_notes/draft_save")}]),angular.module("noteApp").factory("ImageNoteDraft",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/image_notes/draft_save")}]),angular.module("noteApp").factory("SoundNoteDraft",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/sound_notes/draft_save")}]),angular.module("noteApp").factory("MovieNoteDraft",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/movie_notes/draft_save")}]),angular.module("noteApp").factory("DraftTimeline",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/notes/drafts")}]),angular.module("noteApp").factory("ReservedTimeline",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/notes/reserved")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Notification",["$resource",function(t){return t(""+e+"/notifications")}]),angular.module("noteApp").factory("NotificationReadAll",["$resource",function(t){return t(""+e+"/notifications/read_all")}]),angular.module("noteApp").factory("NotificationCount",["$resource",function(t){return t(""+e+"/notifications/count",null,{get:{method:"GET"},query:{method:"GET",isArray:!0,ignoreLoadingBar:!0}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("OAuth",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/oauth/connections/:provider")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Purchase",["$resource",function(t){return t(""+e+"/purchase/:targetType/:targetId")}]),angular.module("noteApp").factory("NotePurchase",["$resource",function(t){return t(""+e+"/purchase/note/:noteId",{noteId:"@noteId"})}]),angular.module("noteApp").factory("NotePurchaseWithSupport",["$resource",function(t){return t(""+e+"/purchase/note_with_support/:noteId",{noteId:"@noteId"})}]),angular.module("noteApp").factory("PurchaseHistory",["$resource",function(t){return t(""+e+"/purchase/history")}]),angular.module("noteApp").factory("MagazinePurchase",["$resource",function(t){return t(""+e+"/purchase/magazine/:magazine_key",{magazine_key:"@magazine_key"})}]),angular.module("noteApp").factory("MagazinePurchaseWithSupport",["$resource",function(t){return t(""+e+"/purchase/magazine_with_support/:magazine_key",{magazine_key:"@magazine_key"})}]),angular.module("noteApp").factory("ConvenienceStoreMagazineUnpaid",["$resource",function(t){return t(""+e+"/purchase/convenience_store/magazine/:magazine_key/unpaid",{magazine_key:"@magazine_key"})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("SerialApply",["$resource",function(t){return t(""+e+"/coupons/verify_serial")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("PickUrlname",["$resource",function(t){return t(""+e+"/sessions/pick_urlname")}]),angular.module("noteApp").factory("TempAuth",["$resource",function(t){return t(""+e+"/sessions/auth")}]),angular.module("noteApp").factory("ActivationResend",["$resource",function(t){return t(""+e+"/sessions/activation_resend")}]),angular.module("noteApp").factory("SignUp",["$resource",function(t){return t(""+e+"/sessions/sign_up")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("SoundNote",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/sound_notes/:noteId",{},{put:{method:"PUT"}})}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Pv",["$resource",function(t){return t(""+e+"/stats/pv")}]),angular.module("noteApp").factory("TransferHistory",["$resource",function(t){return t(""+e+"/stats/transfer_history")}]),angular.module("noteApp").factory("Sales",["$resource",function(t){return t(""+e+"/stats/sales")}]),angular.module("noteApp").factory("SalesDetail",["$resource",function(t){return t(""+e+"/stats/sales_detail")}]),angular.module("noteApp").factory("RequestTransfer",["$resource",function(t){return t(""+e+"/stats/request_transfer")}]),angular.module("noteApp").factory("Purchasers",["$resource",function(t){return t(""+e+"/stats/purchasers")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("Subscription",["$resource",function(t){return t(""+e+"/subscriptions")}]),angular.module("noteApp").factory("SubscriptionHistory",["$resource",function(t){return t(""+e+"/subscriptions/history")}]),angular.module("noteApp").factory("MagazineSubscription",["$resource",function(t){return t(""+e+"/subscriptions/magazines/:magazine_key",{magazine_key:"@magazine_key"},{put:{method:"PUT"}})}]),angular.module("noteApp").factory("PremiumSubscription",["$resource",function(t){var n;return n=""+e+"/subscriptions/premium_plans",t(""+n+"/:premium_plan_key",{premium_plan_key:"@premium_plan_key"},{put:{method:"PUT"},check_cancelable:{method:"GET",url:""+n+"/check_cancelable"}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Support",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/supports/:urlname",{urlname:"@urlname"},{put:{method:"PUT"}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("TagList",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/tag/:kind",{kind:"@kind"})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("TalkNote",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/talk_notes/:noteId",{},{put:{method:"PUT"}})}])}.call(this),function(){"use strict";angular.module("noteApp").factory("TextNote",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/text_notes/:noteId",null,{put:{method:"PUT"}})}])}.call(this),function(){}.call(this),function(){"use strict";angular.module("noteApp").factory("TopArticle",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/top_articles")}])}.call(this),function(){"use strict";var e;e="/api/v1",angular.module("noteApp").factory("User",["$resource",function(t){return t(""+e+"/users/:userId",null,{update:{method:"PUT"}})}]),angular.module("noteApp").factory("RandomUser",["$resource",function(t){return t(""+e+"/users/random")}]),angular.module("noteApp").factory("UserMessage",["$resource",function(t){return t(""+e+"/users/:user_id/message")}]),angular.module("noteApp").factory("ArriveHistory",["$resource",function(t){return t(""+e+"/arrive_history")}]),angular.module("noteApp").factory("UserSearch",["$resource",function(t){return t(""+e+"/search/users")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ViolationReport",["$resource",function(e){var t;return t="/api/v2",e(""+t+"/violations")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Withdrawal",["$resource",function(e){var t;return t="/api/v1",e(""+t+"/withdrawals",null,{update:{method:"PUT"}})}])}.call(this),function(){"use strict";angular.module("noteApp").service("GMOTokenAuth",["$window",function(e){var t;return t={getToken:function(){return function(t,n,r,i,a){var o,s;return o={cardno:t,expire:n,securitycode:r,holdername:i,tokennumber:2},s="production"===e.PREFETCH.NOTE.conf.env?"9000305400966":"tshop00008198",e.Multipayment.init(s),e.Multipayment.getToken(o,a)}}(this)}}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Address",["$resource",function(t){return t(""+e+"/addresses/:zipcode",{zipcode:"@zipcode"})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("AmazonWidget",["$resource",function(t){return t(""+e+"/amazon_widget")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("AnonymousVotes",["$resource",function(t){return t(""+e+"/anonymous_votes/")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Authors",["$resource",function(t){return t(""+e+"/authors")}]),angular.module("noteApp").factory("Author",["$resource",function(t){return t(""+e+"/authors/:urlname")}]),angular.module("noteApp").factory("AuthorContent",["$resource",function(t){return t(""+e+"/authors/:urlname/contents")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Bundle",["$resource",function(t){return t(""+e+"/bundles/:id",{id:"id"})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Bundles",["$resource",function(t){return t(""+e+"/bundles")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Category",["$resource",function(t){return t(""+e+"/categories")}]),angular.module("noteApp").factory("FollowingBoosterCategory",["$resource",function(t){return t(""+e+"/categories/users",{kind:"following_booster"})}]),angular.module("noteApp").factory("FollowingBoosterCategoryUsers",["$resource",function(t){return t(""+e+"/categories/users/:id")}]),angular.module("noteApp").factory("FollowingBoosterCategoryMagazines",["$resource",function(t){return t(""+e+"/categories/magazines/:id")}]),angular.module("noteApp").factory("CategoryRelatedNotes",["$resource",function(t){return t(""+e+"/categories/:eng_name/related_notes")}]),angular.module("noteApp").factory("CategoryIndex",["$resource",function(t){return t(""+e+"/category_index")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("ChildNotes",["$resource",function(t){return t(""+e+"/child_notes")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Contest",["$resource",function(t){return t(""+e+"/contests")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Creators",["$resource",function(t){return t(""+e+"/creators/:urlname",{urlname:"@urlname"},{update:{method:"PUT"}})}]),angular.module("noteApp").factory("CreatorContents",["$resource",function(t){return t(""+e+"/creators/:urlname/contents")}]),angular.module("noteApp").factory("CreatorArchives",["$resource",function(t){return t(""+e+"/creators/:urlname/archives")}]),angular.module("noteApp").factory("CreatorPickupContents",["$resource",function(t){return t(""+e+"/creators/:urlname/pickup_contents",{kind:"@kind"})}]),angular.module("noteApp").factory("CreatorFollowings",["$resource",function(t){return t(""+e+"/creators/:urlname/followings")}]),angular.module("noteApp").factory("CreatorFollowers",["$resource",function(t){return t(""+e+"/creators/:urlname/followers")}]),angular.module("noteApp").factory("CreatorPinnedContents",["$resource",function(t){return t(""+e+"/creators/:urlname/pinned_contents/:id",{urlname:"@urlname",id:"@id"})}]),angular.module("noteApp").factory("CreatorRecommendContents",["$resource",function(t){return t(""+e+"/creators/:urlname/recommend_contents/:id",{urlname:"@urlname",id:"@id"})}]),angular.module("noteApp").factory("CreatorAmazonWidgets",["$resource",function(t){return t(""+e+"/creators/:urlname/amazon_widgets/:id",{urlname:"@urlname",id:"@id"},{create:{method:"POST"},"delete":{method:"DELETE"},update:{method:"PATCH"}})}]),angular.module("noteApp").factory("CreatorAmazonWidgetsCount",["$resource",function(t){return t(""+e+"/creators/:urlname/amazon_widgets/count",{urlname:"@urlname"})}]),angular.module("noteApp").factory("CreatorCustomMenus",["$resource",function(t){return t(""+e+"/creators/:urlname/custom_menus")}])}.call(this),function(){"use strict";var e,t,n;e="/api/v2/ec",t=""+e+"/backend",n=""+e+"/frontend",angular.module("noteApp").factory("EcItems",["$resource",function(e){var n;return n=""+t+"/items/:key",e(n,{key:"@key"},{update:{method:"PUT"},update_position:{url:""+n+"/update_position",method:"PUT"}})}]),angular.module("noteApp").factory("EcVariants",["$resource",function(e){return e(""+t+"/variants")}]),angular.module("noteApp").factory("EcWareHouses",["$resource",function(e){var n;return n=""+t+"/warehouses/:number",e(n,{number:"@number"},{update:{method:"PUT"}})}]),angular.module("noteApp").factory("EcWarehouseLabel",["$resource","$window",function(e,n){return e(""+t+"/warehouses/:number/label",{number:"@number"},{download:{method:"GET",responseType:"arraybuffer",cache:!1,transformResponse:function(e){var t,r;return r="",e&&(t=new Blob([e],{type:"application/pdf"}),r=n.URL.createObjectURL(t)),{url:r}}}})}]),angular.module("noteApp").factory("EcAvailableStocks",["$resource",function(e){return e(""+t+"/stocks/available")}]),angular.module("noteApp").factory("EcHistoryWarehouses",["$resource",function(e){return e(""+t+"/history/warehouses")}]),angular.module("noteApp").factory("EcHistoryStocks",["$resource",function(e){return e(""+t+"/history/stocks")}]),angular.module("noteApp").factory("EcStoreItems",["$resource",function(e){return e(""+n+"/stores/:urlname/items/:key",{urlname:"@urlname",key:"@key"})}]),angular.module("noteApp").factory("EcHistoryOrders",["$resource","Cookie",function(e){var t;return t=""+n+"/history/orders/:number",e(t,{number:"@number"})}]),angular.module("noteApp").factory("EcCarts",["$resource",function(e){var t,r;return r=localStorage.orderToken,t=""+n+"/orders/:number",e(t,{number:"@number"},{populate:{url:""+t+"/populate",method:"POST",headers:{"X-Order-Token":r}},current:{url:""+t+"/current",method:"GET",headers:{"X-Order-Token":r}},update:{url:""+t,method:"PUT",headers:{"X-Order-Token":r}},checkout:{url:""+t+"/checkout",method:"PUT",headers:{"X-Order-Token":r}}})}]),angular.module("noteApp").factory("EcCheckouts",["$resource",function(e){var t;return t=""+n+"/checkouts/:number",e(t,{number:"@number"},{update:{url:""+t,method:"PUT"}})}]),angular.module("noteApp").factory("EcOrders",["$resource",function(e){var t;return t=""+n+"/orders/:number",e(t,{number:"@number"},{cancel:{url:""+t+"/cancel",method:"PUT"}})}]),angular.module("noteApp").factory("EcSales",["$resource",function(e){return e(""+n+"/dashboard/sales/:month",{month:"@month"})}]),angular.module("noteApp").factory("EcTransfers",["$resource",function(e){return e(""+n+"/dashboard/transfers/apply",{},{save:{method:"POST"}})}]),angular.module("noteApp").factory("EcTransferHistories",["$resource",function(e){return e(""+n+"/dashboard/transfer_histories")}]),angular.module("noteApp").factory("EcPurchasers",["$resource",function(e){return e(""+n+"/dashboard/purchasers")}]),angular.module("noteApp").factory("EcMessages",["$resource",function(e){return e(""+n+"/dashboard/messages")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Followings",["$resource",function(t){return t(""+e+"/following/")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("GettyImagesSearch",["$resource",function(t){return t(""+e+"/getty_images")}]),angular.module("noteApp").factory("GettyImagesDetail",["$resource",function(t){return t(""+e+"/getty_images/:id",{id:"id"})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("GuestPurchase",["$resource",function(t){return t(""+e+"/guest/purchase",{},{create:{method:"POST"}})}]),angular.module("noteApp").factory("GuestEmailCheck",["$resource",function(t){return t(""+e+"/guest/email_check",{email:"@email"})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Hashtag",["$resource",function(t){return t(""+e+"/hashtags/:hashtag",{hashtag:"@hashtag"})}]),angular.module("noteApp").factory("Hashtags",["$resource",function(t){return t(""+e+"/hashtags")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Images",["$resource",function(t){return t(""+e+"/images/:key",{key:"@key"})}]),angular.module("noteApp").factory("UserImages",["$resource",function(t){return t(""+e+"/images")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("InstagramImage",["$resource",function(t){return t(""+e+"/instagram_images")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Magazines",["$resource",function(t){return t(""+e+"/magazines")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("ManageAuthor",["$resource",function(t){return t(""+e+"/manage/authors/:id",{},{update:{method:"PUT"}})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("ManageBundle",["$resource",function(t){return t(""+e+"/manage/bundles/:id/:action",{},{update:{method:"PUT"},deleteCache:{url:""+e+"/manage/bundles/:id/delete_cache",method:"DELETE"}})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("NoteListContents",["$resource",function(t){return t(""+e+"/note_list/contents")}]),angular.module("noteApp").factory("NoteListArchives",["$resource",function(t){return t(""+e+"/note_list/archives")}]),angular.module("noteApp").factory("NoteListSticker",["$resource",function(t){return t(""+e+"/note_list/sticker/:id",{id:"@id"},{create:{method:"POST"},"delete":{method:"DELETE"},update:{method:"PATCH"}})}]),angular.module("noteApp").factory("NoteListStickerNote",["$resource",function(t){return t(""+e+"/note_list/sticker_note/",{},{create:{method:"POST"},"delete":{method:"DELETE"}})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("NotePreviewAccessToken",["$resource",function(t){return t(""+e+"/notes/:note_key/access_tokens/:token",{note_key:"@note_key",token:"@token"})}]),angular.module("noteApp").factory("NotePreviewAccessTokenPublisher",["$resource",function(t){return t(""+e+"/notes/:note_key/access_tokens",{note_key:"@note_key"},{post:{method:"POST"}})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Notes",["$resource",function(t){return t(""+e+"/notes")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("PurchaseRightsApply",["$resource",function(t){return t(""+e+"/purchase_rights/:id/apply",{id:"@id"})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("RelatedNotes",["$resource",function(t){return t(""+e+"/related_notes/:noteKey",{noteKey:"@noteKey"})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Searches",["$resource",function(t){return t(""+e+"/searches")}]),angular.module("noteApp").factory("SearchHistories",["$resource",function(t){return t(""+e+"/search_histories",{word:"@word",mode:"@mode"})}]),angular.module("noteApp").factory("UserSearches",["$resource",function(t){return t(""+e+"/searches",{context:"user"})}]),angular.module("noteApp").factory("ManageAuthorSearches",["$resource",function(t){return t(""+e+"/manage/authors/searches")}]),angular.module("noteApp").factory("ManageUserSearches",["$resource",function(t){return t(""+e+"/manage/users/searches")}]),angular.module("noteApp").factory("ManageStaticPageSearches",["$resource",function(t){return t(""+e+"/manage/static_pages/searches")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("StockPhotoImages",["$resource",function(t){return t(""+e+"/stock_photo_images")}]),angular.module("noteApp").factory("DeleteStockPhotoImage",["$resource",function(t){return t(""+e+"/stock_photo_images/:id",{id:"@id"},{destroy:{method:"DELETE"}})}]),angular.module("noteApp").factory("UploadStockPhotoImages",["$resource",function(t){return t(""+e+"/image_upload/stock_photo_images/:id",{id:"@id"},{update:{method:"PUT"}})}]),angular.module("noteApp").factory("EvaluateStockPhotoImages",["$resource",function(t){return t(""+e+"/stock_photo_images/:id/evaluation",{id:"@id"},{update:{method:"PUT"}})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("CreateStockPhotoImageLogs",["$resource",function(t){return t(""+e+"/stock_photo_image_logs",{create:{method:"POST"}})}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("Users",["$resource",function(t){return t(""+e+"/users")}])}.call(this),function(){"use strict";var e;e="/api/v2",angular.module("noteApp").factory("BreadCrumbsService",["$resource",function(t){return t(""+e+"/bread_crumbs")}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ActivityLog",["Activity","ActivityLogs","StateMap",function(e,t,n){var r;return r={save:function(t){var r;return t.acted_area=t.acted_area||n.getAreaName(),r=e.save(t),r.$promise},log:function(e){var r;return e.area=e.area||n.getAreaName(),r=t.save(e),r.$promise}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Admin",["$window",function(e){var t;return t={isAdminCheck:e.PREFETCH.NOTE.adminCheck===!0}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("AfterActionModal",["Popeye","Cookie",function(e){var t;return t={defaultNotePurchaseMsg:"\u3054\u8cfc\u5165\u3044\u305f\u3060\u304d\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\u3054\u3086\u3063\u304f\u308a\u304a\u697d\u3057\u307f\u304f\u3060\u3055\u3044\uff01",defaultMagazinePurchaseMsg:"\u3054\u8cfc\u5165\u3044\u305f\u3060\u304d\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\u3054\u3086\u3063\u304f\u308a\u304a\u697d\u3057\u307f\u304f\u3060\u3055\u3044\uff01",defaultMagazineSubscribeMsg:"\u3054\u8cfc\u8aad\u3044\u305f\u3060\u304d\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\u3054\u3086\u3063\u304f\u308a\u304a\u697d\u3057\u307f\u304f\u3060\u3055\u3044\uff01",defaultSupportPurchaseMsg:"\u30af\u30ea\u30a8\u30a4\u30bf\u30fc\u3092\u30b5\u30dd\u30fc\u30c8\u3044\u305f\u3060\u304d\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\u611f\u8b1d\u306e\u6c17\u6301\u3061\u304c\u5c4a\u304d\u307e\u3059\u3088\u3046\u306b\uff01",show:function(t){var n;return n=e.openModal({templateUrl:t.template,controller:["$scope","SocialText",function(e,r){var i,a,o;if(t.note?e.note=t.note:t.magazine&&(e.magazine=t.magazine),t.share&&(e=r.generate(e),e.twShareUrl=decodeURIComponent(e.twShareUrl),e.fbShareUrl=e.fbShareUrl,e.windowShare=e.windowShare,e.noteUrl=e.noteUrl),e.title=t.title||"note\u304b\u3089\u306e\u304a\u77e5\u3089\u305b",e.message=t.message,e.image=t.image,e.action=t.action,e.share=t.share,t.showParams){o=t.showParams;for(i in o)a=o[i],e[i]=a}return e.close=function(){return t.callback&&t.callback(),n.close()}}]}),n.opened.then(function(){return angular.element(".p-achievementsModal__message a").on("click",function(){return n.close()})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Auth",["$q","$timeout","$rootScope","CurrentUser","Bridge",function(e,t,n){var r;return r=e.defer(),t(function(){var e,t;return e={},t=window.PREFETCH.NOTE.user,angular.equals({},t)?e.error={code:"not_found",message:"\u30e6\u30fc\u30b6\u30fc\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"}:e.data=t,n.isBlankUrlname=t&&(""===t.urlname||null===t.urlname),r.resolve(e)},0),r.promise}])}.call(this),function(){"use strict";angular.module("noteApp").factory("AutoHideNotification",["$rootScope","$compile",function(e,t){var n;return n={success:function(e,t,n){return this.show("success",e,t,n)},error:function(e,t,n){return this.show("error",e,t,n)},warn:function(e,t,n){return this.show("warn",e,t,n)},info:function(e,t,n){return this.show("info",e,t,n)},close:function(){return angular.element("#autohide").remove()},show:function(n,r,i,a){var o,s;return 0!==a&&(a||(a=2e3)),o=angular.element("<autohide />"),o.attr({type:n,title:r,message:i,delay:a}),s=t(o)(e.$new()),angular.element("body").append(s)}}}]),angular.module("noteApp").directive("autohide",function(){var e;return e={restrict:"E",templateUrl:"/templates/common/autoHideNotification",link:function(e,t,n){return e.type=n.type,e.title=n.title,e.message=n.message,e.delay=n.delay,e.animate(angular.element("#autohide"))},controller:["$scope",function(e){return e.animate=function(t){return 0===parseInt(e.delay,10)?t.fadeIn("slow"):t.fadeIn("slow").delay(e.delay).fadeOut("slow",function(){return angular.element("autohide").remove()})}}]}})}.call(this),function(){"use strict";angular.module("noteApp").factory("BundleUtils",["$upload","Searches","ManageStaticPageSearches",function(e,t,n){var r;return r={getHybridSearches:function(e){switch(e){case"note":return t;case"static_page":return n}},createHybridBundleContent:function(e,t){var n;return n=function(){switch(e){case"note":return"Note";case"static_page":return"StaticPage"}}(),{content:t,contentableType:n,contentableId:t.id,hasPeriod:!1,startedAt:r.defaultDatetime(),endedAt:r.defaultDatetime(),visible:!0,style:{opacity:.5}}},getSearches:function(e){switch(e){case"note_manual":return t;case"static_page_manual":return n}},createBundleContent:function(e,t){var n;return n=function(){switch(e.type){case"note_manual":return"Note";case"instagram":return"InstagramImage";case"static_page_manual":return"StaticPage"}}(),{content:t,contentableType:n,contentableId:t.id,hasPeriod:!1,startedAt:r.defaultDatetime(),endedAt:r.defaultDatetime(),visible:!0,style:{opacity:.5}}},decode:function(e){return{id:e.id,bundleKey:e.bundleKey,imageUrl:e.imageUrl,name:e.name,description:e.description,type:e.type,bundleContentsCount:e.bundleContentsCount,bundleContents:e.bundleContents.map(function(e){var t,n,i;return n=!(!e.startedAt||!e.endedAt),i=n?r.toDatetime(e.startedAt):r.defaultDatetime(),t=n?r.toDatetime(e.endedAt):r.defaultDatetime(),{content:e.content,contentableType:e.contentableType,contentableId:e.contentableId,hasPeriod:n,startedAt:i,endedAt:t,visible:"actived"===e.status}})}},defaultDatetime:function(){var e;return e=moment({hour:0,minute:0}).toString(),r.toDatetime(e)},encode:function(e){return{id:e.id,bundle_key:e.bundleKey,imageUrl:e.imageUrl,name:e.name,description:e.description,type:e.type,bundle_contents:e.bundleContents.map(function(e){var t,n,i,a,o;return i=e.hasPeriod?(a=$.extend({},e.startedAt,{second:0}),r.toDatetimeStr(a)):null,t=e.hasPeriod?(n=$.extend({},e.endedAt,{second:59}),r.toDatetimeStr(n)):null,o=e.visible?"actived":"inactived",{contentable_type:e.contentableType,contentable_id:e.contentableId,started_at:i,ended_at:t,status:o}})}},filterSuggests:function(e,t){var n;return n={notes:"Note",static_pages:"StaticPage"},["notes","static_pages"].reduce(function(r,i){var a,o;return o=n[i],t[i]?(a=t[i].contents.filter(function(t){var n;return n=e.filter(function(e){var n,r;return r=e.contentableType===o,n=e.contentableId===t.id,r&&n}),0===n.length}),r.concat(a)):r},[])},isEqBundleContent:function(e,t){var n,r;return r=e.contentableType===t.contentableType,n=e.contentableId===t.contentableId,r&&n},searchContext:function(e){switch(e){case"Bundle::NoteManual":return"note"}},toDatetime:function(e){var t;return t=moment(e),{year:t.year(),month:t.month(),day:t.date(),hour:t.hour(),minute:t.minute()}},toDatetimeStr:function(e){var t,n,r,i,a,o;return o=e.year,i=e.month,t=e.day,n=e.hour,r=e.minute,a=e.second,moment({year:o,month:i,day:t,hour:n,minute:r,second:a}).format()},uploadImage:function(t){var n,r,i;return n=t.bundleId,r=t.imageFile,i={url:"/api/v2/images",data:{bundle_id:n,file:r,kind:"tmp_bundle"}},e.upload(i)}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ContentLink",["$window","$state","CustomDomainContext",function(e,t,n){var r;return r={go:function(n,r,i){var a,o,s,l;return null==i&&(i={}),a=this.getLinkContext(n,r,i),s=i.target?i.target:null,"state"===a.linkMethod?(o={},i.reload===!0&&(o.reload=!0),i.inherit===!0&&(o.inherit=!0),"_blank"===s?(l=t.href(a.toState,a.stateParams,o),e.open(l,"_blank"),!0):t.go(a.toState,a.stateParams,o)):"_blank"===s?(e.open(a.url,"_blank"),!0):e.location.href=a.url},getLinkContext:function(e,r,i){var a,o,s,l,c,u,d;return null==i&&(i={}),o=n.isCdAccess()&&r.custom_domain&&n.host===r.custom_domain.host||!n.isCdAccess()&&!r.custom_domain?"state":"http",u="note"===e&&r.custom_domain?"cdMyNote":"magazine"===e&&r.custom_domain&&"magazine"===r.custom_domain.type?"cdMagazine.home":"magazine"===e&&r.custom_domain&&"creator"===r.custom_domain.type?"cdMyMagazine.home":"user"===e&&r.custom_domain?"cdCreator.home":"note"!==e||r.custom_domain?"magazine"!==e||r.custom_domain?"user"!==e||r.custom_domain?"item"===e?"ecStore.item":void 0:"creator.home":r.user?"magazine.home":"magazine.homeShort":r.user?"showTextNoteFriendly":"showTextNote",c={},"note"===e?(r.user&&(c.urlname=r.user.urlname),c.key=r.key,i.magazine&&(c.magazine_key=i.magazine.key),i.scrollpos&&(c.scrollpos=i.scrollpos)):"magazine"===e?(r.user&&(c.urlname=r.user.urlname),c.key=r.key):"item"===e?(r.user&&(c.urlname=r.user.urlname),c.key=r.key):"user"===e&&(c.urlname=r.urlname),d="http"===o?(a=r.custom_domain?(l=r.custom_domain.tls?"https":"http",""+l+"://"+r.custom_domain.host):n.getNoteBaseUrl(),s=t.href(u,c),""+a+s):void 0,{linkMethod:o,toState:u,stateParams:c,url:d}}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Cookie",["$cookies","CustomDomainContext",function(e,t){var n;return n={opts:t.isCdAccess()?{domain:t.host.split(":")[0]}:null,get:function(t){return e.get(t)},getObject:function(t){return e.getObject(t)},getAll:function(){return e.getAll()},put:function(t,n){return e.put(t,n,this.opts)},remove:function(t){return e.remove(t,this.opts)}}}])}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n,r){this.Popeye=e,this.$timeout=n,this.$q=r,this.openCropperModal=t(this.openCropperModal,this),this.fileLoadHandler=t(this.fileLoadHandler,this),this.getFile=t(this.getFile,this),this.image={source:null,type:null,mime:null,name:null},this.modal=null}return e.$inject=["Popeye","$timeout","$q"],e.prototype.getFile=function(e,t){return null==e&&(e="profile"),null==t&&(t=".jpg,.png,image/jpeg,image/png"),this.$q(function(n){return function(r,i){var a;
return a=document.createElement("input"),a.setAttribute("style","display: none"),a.setAttribute("type","file"),a.setAttribute("accept",t),a.onchange=function(t){return n.fileLoadHandler(t,e).then(function(e){return n.openCropperModal(e).then(function(e){return r(e)},function(e){return i(e)})})},a.click()}}(this))},e.prototype.fileLoadHandler=function(e,t){return this.$q(function(n){return function(r){var i,a;if(a=new FileReader,a.onload=function(e){return n.$timeout(function(){return r({source:e.target.result,type:t,mime:i.type,name:i.name})})},e.originalEvent){if(i=e.originalEvent.dataTransfer.files[0])return a.readAsDataURL(i)}else if(i=e.target.files[0])return a.readAsDataURL(i)}}(this))},e.prototype.openCropperModal=function(e){return this.$q(function(t){return function(n,r){return t.modal=t.Popeye.openModal({click:!1,templateUrl:"/templates/modal/image_cropper",controller:["$scope",function(i){return i.image={source:e.source,type:e.type,getCropped:function(){return{}}},i.cropData={width:0,height:0,x:0,y:0},i.upload={cancel:function(){return r(),t.modal.close()},proceed:function(){var r;return r=angular.copy(e),$.extend(r,{cropped:i.image.getCropped()}),n({result:r,cropData:i.cropData}),t.modal.close()}},"cover"===e.type?(i.modalStyle="width: 550px; margin-left: -88px;",i.style=i.canvas={height:288,width:550},i.cropSize={height:670,width:1280}):"profile"===e.type?(i.style=i.canvas={height:330,width:330},i.cropSize={height:330,width:330}):"creator-header"===e.type?(i.modalStyle="width: 800px; margin-left: -210px;",i.style=i.canvas={height:284,width:800},i.cropSize={height:568,width:1600}):"item"===e.type?(i.style=i.canvas={height:330,width:330},i.cropSize={height:330,width:330}):void 0}]})}}(this))},e.prototype.base64ToBinary=function(e){var t,n,r,i,a,o;for(t=atob(e.split(",")[1]),i=t.length,n=new Uint8Array(i),r=a=0,o=i-1;o>=0?o>=a:a>=o;r=o>=0?++a:--a)n[r]=t.charCodeAt(r);return n.buffer},e}(),angular.module("noteApp").service("CropperModalService",e)}.call(this),function(){"use strict";angular.module("noteApp").factory("CustomDomainContext",["$window",function(e){var t;return t={tls:e.PREFETCH.NOTE.customDomain?e.PREFETCH.NOTE.customDomain.tls:!1,host:e.PREFETCH.NOTE.customDomain?e.PREFETCH.NOTE.customDomain.host:null,type:e.PREFETCH.NOTE.customDomain?e.PREFETCH.NOTE.customDomain.type:null,key:e.PREFETCH.NOTE.customDomain?e.PREFETCH.NOTE.customDomain.key:null,urlname:e.PREFETCH.NOTE.customDomain?e.PREFETCH.NOTE.customDomain.urlname:null,logoUrl:e.PREFETCH.NOTE.customDomain?e.PREFETCH.NOTE.customDomain.logo_url:null,allowedStates:["cdMagazine.home","cdCreator.home","cdCreator.magazines","cdCreator.menu","cdCreator.ecStore","cdCreator.archives","cdCreator.archives.year","cdCreator.archives.month","cdMyNote","cdMagazine.menu","cdMagazine.hashtag","cdMagazine.archive","cdMyMagazine.home","cdMyMagazine.menu","cdMyMagazine.hashtag","cdMyMagazine.archive"],isCdAccess:function(){return this.host?e.location.host===this.host:!1},getProtocol:function(){return this.tls?"https":"http"},getBaseUrl:function(){return""+this.getProtocol()+"://"+this.host},getNoteBaseUrl:function(){return""+this.getProtocol()+"://"+this.getNoteHost()},getNoteHost:function(){return e.PREFETCH.NOTE.host}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("DistributionRatioModal",["Popeye","MagazineEditor",function(e,t){var n;return n={show:function(n){var r;return r=e.openModal({templateUrl:"/templates/modal/distribution_ratio",controller:["$scope",function(e){return e.state="ready",e.editors=n.editors,e.checkAmount=function(){var t,n,r,i,a;for(n=0,a=e.editors,r=0,i=a.length;i>r;r++)t=a[r],n+=t.distribution_ratio;return e.validAmount=100===n},e.complete=function(){var r,i,a,o,s;for(e.processing=!0,i={},s=e.editors,a=0,o=s.length;o>a;a++)r=s[a],i[r.user_id]=r.distribution_ratio;return t.update_ratio({magazine_key:n.magazineKey,ratios:i},function(){return e.processing=!1,e.changeState("done")},function(t){return e.processing=!1,e.changeState("failed"),e.message=t.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})},e.changeState=function(t){return e.state=t},e.close=function(){return n.callback&&n.callback(),r.close()},e.checkAmount()}]})}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("DraftSaveAlert",function(){var e;return e={getMessage:function(e,t){var n;return n="",t.hashtag&&t.hashtag.list&&t.hashtag.list.length>0&&t.magazineIds&&t.magazineIds.length>0?n+="\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u3001\u30de\u30ac\u30b8\u30f3\u3078\u306e\u8ffd\u52a0":t.hashtag&&t.hashtag.list&&t.hashtag.list.length>0?n+="\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u306e\u8ffd\u52a0":t.magazineIds&&t.magazineIds.length>0&&(n+="\u30de\u30ac\u30b8\u30f3\u3078\u306e\u8ffd\u52a0"),e.prior_sale_activated===!0&&(n.length>0&&(n+="\u3001"),n+="\u6570\u91cf\u9650\u5b9a\u8a2d\u5b9a"),n.length>0?"\u4e0b\u66f8\u304d\u4fdd\u5b58\u3067\u306f"+n+"\u304c\u3055\u308c\u307e\u305b\u3093\u306e\u3067\u3001\u6295\u7a3f\u6642\u306b\u518d\u5ea6\u8a2d\u5b9a\u3092\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002":null}}})}.call(this),function(){"use strict";angular.module("noteApp").service("EcService",["$state","$rootScope",function(e,t){var n;return this.warehouse={},this.urlname=null,n={isEcEnabled:function(t){return null==t&&(t=!0),window.PREFETCH.NOTE.enable_ec?!0:(t&&e.go("_404"),!1)},setWarehouse:function(e){return function(t){return e.warehouse=t}}(this),getWarehouse:function(e){return function(){return e.warehouse}}(this),setUrlname:function(e){return function(n){var r;return r=t.prevPage.match(/([0-9A-Za-z_]+)\/(i\/i[0-9a-f]{12}.*|store)/),e.urlname=n.length>0?n[0].variant.creatorUrlname:r?r[1]:void 0}}(this),getUrlname:function(e){return function(){return e.urlname}}(this),clearOrder:function(){return localStorage.removeItem("orderNumber"),localStorage.removeItem("orderToken")},toItemStatusName:function(e){var t;return t={"public":"\u516c\u958b","private":"\u975e\u516c\u958b"},t[e]},toWarehouseStatusName:function(e){var t;return t={waiting:"\u5165\u5eab\u5f85\u3061",received:"\u691c\u54c1\u5f85\u3061",checking:"\u691c\u54c1\u4e2d",checked:"\u691c\u54c1\u6e08\u307f",stocked:"\u5165\u5eab\u6e08\u307f"},t[e]},toHistoryTypeName:function(e){var t;return t={warehouse:"\u5165\u5eab",shipment:"\u51fa\u5eab",blocked:"\u4fdd\u7559"},t[e]},toShipmentStateName:function(e){var t;return t={ready:"\u767a\u9001\u6e96\u5099\u4e2d",waiting:"\u767a\u9001\u51e6\u7406\u4e2d",working:"\u767a\u9001\u51e6\u7406\u4e2d",shipped:"\u767a\u9001\u6e08\u307f",pending:"\u4fdd\u7559\u4e2d",canceled:"\u30ad\u30e3\u30f3\u30bb\u30eb",backorder:"\u5165\u8377\u5f85\u3061"},"canceled"===e.state?"\u30ad\u30e3\u30f3\u30bb\u30eb":t[e.shipmentState]},toPaymentMethodName:function(e){var t;return t={1:"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9"},t[e]},displayImage:function(){return function(e,t){var n;return null==t&&(t=0),n=window.PREFETCH.NOTE.defaultImage.magazineWallpaper,e.length<1?n:e[t].url||n}}(this),getWarehouseCount:function(e,t){var n,r,i,a;for(r=0,i=0,a=e.length;a>i;i++)n=e[i],"quantity"===t&&(r+=n.quantity),"received"===t&&(r+=n.received);return r},handleError:function(t,n){return null==n&&(n=null),n&&alert(n),404===t.status?e.go("_404",null,{location:!1}):"cart"===t.data.redirect_location?this.backToCart():"address"===t.data.redirect_location?e.go("ecStore.checkoutAddress"):"payment"===t.data.redirect_location?e.go("ecStore.checkoutPayment"):void 0},backToCart:function(){return e.go("ecStore.cart")}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("EditorManager",["$window","Popeye",function(e){var t;return t={createEditor:function(t){return this.destroyEditor(),e.NOTE.editor=new NoteEditor(".editable",t)},destroyEditor:function(){return e.NOTE.editor?(e.NOTE.editor.destroy(),e.NOTE.editor=null):void 0}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("FacebookPixel",function(){var e;return e={trackPv:function(){var e;if(window.enableFbPixel!==!1&&void 0!==window.fbq)try{return window.fbq("track","PageView")}catch(t){e=t}},trackPurchase:function(e){var t,n,r;try{if(t=e.type.match(/(Text|Image|Sound)Note/)?"n":"m",r={value:""+e.price+".00",currency:"JPY",content_name:e.type,content_ids:[""+t+e.id],content_type:"product"},window.enableFbPixel===!1||void 0===window.fbq)return;return window.fbq("track","Purchase",r)}catch(i){n=i}}}})}.call(this),function(){"use strict";angular.module("noteApp").factory("FlashModal",["$window","$rootScope","Popeye","Cookie","AfterActionModal",function(e,t,n,r,i){var a;return a={init:function(){return t.$on("$stateChangeSuccess",function(){var t,a,o,s,l,c,u,d;if(null!=(a=r.get("rd_flash")))return l=n.openModal({templateUrl:"/templates/modal/flash_modal",controller:["$scope","Title",function(e,t){var n;return n={note_purchase:{type:"note_purchase",title:"\u8cfc\u5165\u5b8c\u4e86",message:"\u30ce\u30fc\u30c8\u306e\u8cfc\u5165\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},magazine_purchase:{type:"magazine_purchase",title:"\u8cfc\u5165\u5b8c\u4e86",message:"\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u5165\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},magazine_subscription:{type:"magazine_subscription",title:"\u8cfc\u8aad\u624b\u7d9a\u304d\u5b8c\u4e86",message:"\u5b9a\u671f\u30de\u30ac\u30b8\u30f3\u306e<br>\u8cfc\u8aad\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},support:{type:"support",title:"\u30b5\u30dd\u30fc\u30c8\u5b8c\u4e86",message:"\u30b5\u30dd\u30fc\u30c8\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},carrier_payment_error:{type:"carrier_payment_error",title:"\u6c7a\u6e08\u5931\u6557",message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002<br>\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3001<br>\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"},carrier_payment_cancel:{type:"carrier_payment_cancel",title:"\u6c7a\u6e08\u30ad\u30e3\u30f3\u30bb\u30eb",message:"\u6c7a\u6e08\u3092\u4e2d\u6b62\u3057\u307e\u3057\u305f\u3002"},carrier_payment_subscription_cancel_complete:{type:"carrier_payment_subscription_cancel_complete",title:"\u8cfc\u8aad\u505c\u6b62",message:"\u8cfc\u8aad\u3092\u505c\u6b62\u3057\u307e\u3057\u305f\u3002"},carrier_payment_subscription_cancel_failure:{type:"carrier_payment_subscription_cancel_failure",title:"\u8cfc\u8aad\u505c\u6b62",message:"\u8cfc\u8aad\u505c\u6b62\u51e6\u7406\u304c\u5931\u6557\u3057\u307e\u3057\u305f\u3002"},magazine_subscription_convenience_purchase:{type:"magazine_subscription_convenience_purchase",title:"\u30b3\u30f3\u30d3\u30cb\u6c7a\u6e08\u7533\u3057\u8fbc\u307f\u5b8c\u4e86",message:"\u304a\u652f\u6255\u3044\u60c5\u5831\u304c\u8a18\u8f09\u3055\u308c\u305f<br>\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f"},premium_subscription:{type:"premium_subscription",title:"note\u30d7\u30ec\u30df\u30a2\u30e0\u767b\u9332\u5b8c\u4e86",message:"\u30d7\u30ec\u30df\u30a2\u30e0\u4f1a\u54e1\u767b\u9332\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},premium_cancellation:{type:"premium_cancellation",title:"note\u30d7\u30ec\u30df\u30a2\u30e0\u89e3\u7d04\u5b8c\u4e86",message:"\u30d7\u30ec\u30df\u30a2\u30e0\u4f1a\u54e1\u89e3\u7d04\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},warehouse:{type:"warehouse",title:"\u5165\u5eab\u4f9d\u983c\u5b8c\u4e86",message:"\u5165\u5eab\u4f9d\u983c\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"},checkout_complete:{type:"checkout_complete",title:"\u8cfc\u5165\u5b8c\u4e86",message:"\u6ce8\u6587\u304c\u78ba\u5b9a\u3055\u308c\u307e\u3057\u305f\u3002"}},e.dismiss=function(){return l.close()},e.getEncodedTitle=function(){return encodeURIComponent(t.get())},e.getEncodedUrl=function(e){return encodeURIComponent(e)},l.closed.then(function(){return r.remove("rd_flash")}),e.flashMessage=n[a],r.remove("rd_flash")}]});if(null!=(t=r.get("rd_flash_action"))){switch(d=r.get("rd_flash_purchase_appeal_text"),u=r.get("rd_flash_user_image"),o=e.PREFETCH.NOTE.defaultImage.note_logo_url,t){case"note_purchase":c="\u8cfc\u5165\u5b8c\u4e86",s=i.defaultNotePurchaseMsg;break;case"magazine_purchase":c="\u8cfc\u5165\u5b8c\u4e86",s=i.defaultNotePurchaseMsg;break;case"magazine_subscribe":c="\u8cfc\u8aad\u5b8c\u4e86",s=i.defaultMagazineSubscribeMsg;break;case"support":c="\u30b5\u30dd\u30fc\u30c8\u5b8c\u4e86",s=i.defaultSupportPurchaseMsg}return i.show({action:t,title:c,image:d?u:o,message:d||s,share:!1,career:!0,showParams:{showFooter:!0,showRightButton:!0,showLeftButton:!1},template:"/templates/modal/renewal/after_purchase"}),r.remove("rd_flash_action"),r.remove("rd_flash_purchase_appeal_text"),r.remove("rd_flash_user_image")}})}},a.init(),a}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ImageUploadValidationService",["MessageModal",function(e){var t;return t={errors:function(t,n,r){return null!=t&&"file_size_limit_exceeded"===t.code?e.show({message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f"+this.maxFileMegaByte+"MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):null!=t&&"file_type_not_allowed"===t.code?e.show({message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"}):null!=t&&null!=n&&null!=n[t.code]?e.show({message:n[t.code]}):r()},valid:function(t){var n;return n=window.PREFETCH.NOTE.upload_max_filesize/1024/1024,-1===this.imageTypes.indexOf(t[0].type)?(e.show({message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"}),!1):t[0].size>this.maxFileSize?(e.show({message:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f"+this.maxFileMegaByte+"MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),!1):!0},maxFileSize:window.PREFETCH.NOTE.upload_max_filesize,maxFileMegaByte:window.PREFETCH.NOTE.upload_max_filesize/1024/1024,imageTypes:["image/jpeg","image/png","image/gif"]}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("Lightbox",["Popeye","$window",function(e,t){var n;return n={show:function(n,r,i){var a;return null==i&&(i=0),a=e.openModal({containerTemplate:'<div class="popeye-modal-container popeye-modal-container--lightbox"><a class="popeye-modal__close" href ng-click="$close()"><i class="c-icon c-icon--close"></i></a><div class="popeye-modal popeye-modal--lightbox"></div></div>',template:this.template(n),locals:{pictures:r},containerClass:"lightbox",controller:["$scope","$timeout","$rootScope","$window",function(e,t,n,r){return e.pictures=a.options.locals.pictures.filter(function(e){return!!e.url}),e.displayNum=i,angular.element(r).on("keydown.moveImage",function(n){return t(function(){return 39===n.which?e.moveImage("right"):37===n.which?e.moveImage("left"):void 0})}),e.moveImage=function(t){if("left"===t){if(0===e.displayNum)return;return e.displayNum=e.displayNum-1}if(e.displayNum!==e.pictures.length-1)return e.displayNum=e.displayNum+1}}]}),a.closed.then(function(){return angular.element(t).off("keydown.moveImage")})},template:function(e){switch(e){case"profile":return'<img ng-repeat="p in pictures" ng-src="{{p.url}}" class="popeye-modal__profile"/>';case"note":return'<img ng-repeat="p in pictures" ng-src="{{p.url}}" class="popeye-modal__image"/>';case"multiple":return'<div class="popeye-modal__prevArea" ng-class="{\'is-active\':displayNum > 0 && pictures.length > 1}" ng-click="moveImage(\'left\')"> <div class="popeye-modal__prev"><i class="c-icon c-icon--arrowback"></i></div> </div> <div class="popeye-modal__nextArea" ng-class="{\'is-active\':displayNum < pictures.length - 1 &&  pictures.length > 1}" ng-click="moveImage(\'right\')"> <div class="popeye-modal__next"><i class="c-icon c-icon--arrowforward"></i></div> </div> <div class="popeye-modal__slideWrap"> <div class="popeye-modal__slideView" ng-click="$close()"> <div class="popeye-modal__slideItem" ng-class="{\'is-active\':displayNum == $index}"  ng-repeat="p in pictures" ng-click="$event.stopPropagation()"> <img class="popeye-modal__slideImage" ng-src="{{p.url}}" /> </div> </div> </div>'}}}}])}.call(this),function(){"use strict";angular.module("noteApp").service("MagazineSectionContextService",["MagazineSectionLayout",function(){this.searcnHashtagId=null,this.searchTargetYm=null,this.searchMenuId=null,this.fetchCallback=null,this.fetchSectionContentByHashtag=function(e){return this.callFetchCallback(null,e)},this.fetchSectionContentByArchive=function(e){return this.callFetchCallback(e,null)},this.fetchSectionContentByMenu=function(e){return this.callFetchCallback(null,null,e)},this.callFetchCallback=function(e,t,n){return this.searcnHashtagId=t,this.searchTargetYm=e,this.searchMenuId=n,this.fetchCallback(1)}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("NoteForm",["$q","NoteHashtags","SuggestedHashtags","MyMagazine","ReservedNote","RelatedNotes","Category","Contest",function(e,t,n,r,i,a,o,s){var l;return l={init:function(t,n,i){return t.loaded=!1,n.then(function(n){return function(a){var o;return a.error?(t.error=a.error,void(t.isLoggedIn=!1)):(t.currentUser=a.data,t.isLoggedIn=!0,i.user.urlname?t.user=i.user:t.$on("$UserLoaded",function(){return t.user=i.user}),o=function(){var n;return n=e.defer(),r.get({includes_editable:!0},function(e){return e.error?alert(e.error.message):(t.magazines=e.data.magazines,t.note=t.note||{},null!=t.magazines&&t.magazines.length>0&&(t.note.limitedMagazine=t.magazines[0]),t.note.limitedCheck=!1,n.resolve())},function(e){return alert("\u30de\u30ac\u30b8\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),n.reject(e)}),n.promise},e.all([n.setSuggestedHashtags(t),n.setContests(t),o()]).then(function(){return t.loaded=!0}))}}(this))},initEdit:function(t){return t.loaded=!1,e.all([this.setSuggestedHashtags(t),this.setContests(t),this.setHashtags(t),this.setMyMagazines(t),this.setReservation(t),this.setRelatedNotes(t),this.setCategories(t)]).then(function(){return t.loaded=!0})},setSuggestedHashtags:function(){return function(t){var r;return r=e.defer(),n.get({notetype:t.note.type},function(e){var n;return e.error?alert(e.error.message):(n=e.data.hashtags.map(function(e){return e.name}),t.settings.suggestedHashtags=n.filter(function(e,t){return n.indexOf(e)===t}),r.resolve())},function(e){return alert("\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),r.reject(e)}),r.promise}}(this),setContests:function(){return function(t){var n;return n=e.defer(),s.get({camelize:!1},function(e){return t.settings.openedContests=e.data.contests.filter(function(e){return"opened"===e.state}),n.resolve()},function(e){return console.log(e),n.reject(e)}),n.promise}}(this),setHashtags:function(){return function(n){var r;return r=e.defer(),t.get({noteKey:n.note.key},function(e){return e.error?alert(e.error.message):(n.settings.hashtag.list=e.data.hashtags.map(function(e){return e.name}),r.resolve())},function(e){return alert("\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),r.reject(e)}),r.promise}}(this),setMyMagazines:function(){return function(t){var n;return n=e.defer(),r.get({note_key:t.note.key,includes_editable:!0},function(e){return e.error?alert(e.error.message):(t.magazines=e.data.magazines,n.resolve())},function(e){return alert("\u30de\u30ac\u30b8\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),n.reject(e)}),n.promise}}(this),setReservation:function(){return function(t){var n;if(t.note.is_reserved===!0)return n=e.defer(),i.get({noteKey:t.note.key},function(e){return e.error?alert(e.error.message):(t.reservation=e.data,n.resolve())},function(e){return alert("\u4e88\u7d04\u6295\u7a3f\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),n.reject(e)}),n.promise}}(this),setRelatedNotes:function(){return function(t){var n;if("TextNote"===t.note.type&&window.PREFETCH.NOTE.relatedNote.enable)return n=e.defer(),a.get({noteKey:t.note.key},function(e){return e.error?alert(e.error.message):(t.relatedNotes=e.data.relatedNotes,n.resolve())},function(e){return alert("\u95a2\u9023\u8a18\u4e8b\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),n.reject(e)}),n.promise}}(this),setCategories:function(){return function(t){var n;if("TextNote"===t.note.type&&window.PREFETCH.NOTE.enable_force_assign_category)return n=e.defer(),o.get({},function(e){var r;return r=e.data.categories.filter(function(e){return void 0!==e.id}),t.categories=r,n.resolve()},function(e){return n.reject(e)}),n.promise}}(this)}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("OpenPickUrlnameModalService",["$state","Popeye","Auth","PickUrlname","$window",function(e,t,n,r){var i;return i={open:function(e,i){return n.then(function(n){var a;if(!n.error&&n.data.no_urlname_user)return a=["$scope","$window","$timeout",function(a,o,s){a.user={},a.via=i,angular.extend(a.user,n.data),a.init=function(){return a.$window=o,s(function(){var e;return e=o.document.getElementById("focus-me-top-priority"),e?e.focus():void 0},10)},a.submit=function(){return a.pickUrlname.$invalid?void 0:r.save({urlname:a.user.urlname},function(n){return n.error?void(a.user.error=n.error.message):e?(t.closeCurrentModal(),e()):t.closeCurrentModal()},function(e){return 422===e.status?a.urlname_invalid=!0:void 0})}}],t.openModal({templateUrl:"/templates/modal/pick_urlname",controller:a})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("PlaceholderImage",["$q",function(e){var t,n;return this.imageCaches={},t=100,this._resize=function(e,n){return e>t&&(n=Math.round(n*(t/e)),e=t),{w:e,h:n}},this.getBase64ResizedImage=function(t){return function(n,r){var i,a;return i="data:image/png;base64",a="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8+PnzfwAJjAPYgyf1SAAAAABJRU5ErkJggg==",e(function(e){var o,s;return(s=t.imageCaches[""+n+"x"+r])?void e(s):(o=new Image,o.onload=function(){var t,a;return t=document.createElement("canvas"),t.width=n,t.height=r,a=t.getContext("2d"),a.drawImage(o,0,0,n,r),e(t.toDataURL(i))},o.src=""+i+","+a)})}}(this),this.prepareImage=function(e){return function(t,n){return e.getBase64ResizedImage(t,n).then(function(r){return e.imageCaches[""+t+"x"+n]=r})}}(this),n={get:function(e){return function(t,n){var r;return null==t&&(t=800),null==n&&(n=284),r=e._resize(t,n),t=r.w,n=r.h,e.imageCaches[""+t+"x"+n]||null}}(this),cache:function(e){return function(t,n){var r;return r=e._resize(t,n),t=r.w,n=r.h,e.prepareImage(t,n)}}(this)}}])}.call(this),function(){"use strict";angular.module("noteApp").config(["$provide",function(e){return e.decorator("Popeye",["$delegate","$window",function(e,t){var n;return n=e.openModal,e.openModal=function(r){var i,a,o,s,l;if(null==r&&(r={}),a=t.document.createElement("div"),a.classList.add("popeye-modal-container"),"asp"===t.PREFETCH.NOTE.mode&&a.classList.add("ns-note"),r.containerClassList&&Array.isArray(r.containerClassList))for(l=r.containerClassList,o=0,s=l.length;s>o;o++)i=l[o],a.classList.add(i);return a.innerHTML='<div class="popeye-modal"><a class="popeye-close-modal" href ng-click="$close()"></a></div>',r.containerTemplate||(r.containerTemplate=a.outerHTML),n.call(e,r)},e}])}])}.call(this),function(){"use strict";angular.module("noteApp").factory("PostingSettingStash",function(){var e,t;return t=null,e={stash:function(e){return t=e},stashPop:function(){var e;return t?(e=angular.copy(t),t=null,e):void 0},isEmpty:function(){return!t}}})}.call(this),function(){"use strict";angular.module("noteApp").service("PurchaseService",["$q","Support","NotePurchaseWithSupport","NotePurchase","MagazinePurchaseWithSupport","MagazinePurchase","$filter",function(e,t,n,r,i,a,o){var s;return s={errCodeToMessage:function(e){var t;return t={email_activation:"\u767b\u9332\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u9001\u4fe1\u3055\u308c\u305f\u78ba\u8a8d\u30e1\u30fc\u30eb\u3088\u308a<br>\u8a8d\u8a3c\u3092\u5b8c\u4e86\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},t[e]},isCarrierPaymentMethod:function(e){return-1!==["docomo","au","softbank"].indexOf(e)},toFullPaymentMethodName:function(e){var t;return t={creditcard:"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9",docomo:"\u30c9\u30b3\u30e2 \u30b1\u30fc\u30bf\u30a4\u6255\u3044",au:"au\u304b\u3093\u305f\u3093\u6c7a\u6e08",softbank:"\u30bd\u30d5\u30c8\u30d0\u30f3\u30af\u307e\u3068\u3081\u3066\u652f\u6255\u3044",monthly_au:"au\u304b\u3093\u305f\u3093\u6c7a\u6e08\u5b9a\u671f\u8cfc\u8aad",monthly_docomo:"\u30c9\u30b3\u30e2\u5b9a\u671f\u8cfc\u8aad\u30b5\u30fc\u30d3\u30b9"},t[e]},purchaseSupport:function(n){var r;return r=e.defer(),t.save(n,function(){return function(e){return r.resolve(e)}}(this),function(e){return r.reject(e)}),r.promise},purchaseNote:function(t,i){var a,o;return null==i&&(i=!1),o=i?new n:new r,a=e.defer(),o.$save(t,function(){return function(e){return a.resolve(e)}}(this),function(e){return a.reject(e)}),a.promise},purchaseMagazine:function(t,n){var r,o;return null==n&&(n=!1),o=n?new i:new a,r=e.defer(),o.$save(t,function(){return function(e){return r.resolve(e)}}(this),function(e){return r.reject(e)}),r.promise},defaultSelectedPayment:function(e){return e.last_payment_method?-1===["creditcard","au","docomo","softbank"].indexOf(e.last_payment_method)?null:e.last_payment_method:e.can_checkout?"creditcard":null},createGMOCarrierForm:function(e,t,n){var r;return r=$("<form action='"+e+"' method='post'>"),r.append($("<input type='hidden' name='AccessID' value='"+t+"'>")),r.append($("<input type='hidden' name='Token' value='"+n+"'>")),r},cleanSupportText:function(e){return e=(e||"").trim(),e=o("stripTags")(e)},validateSupportPrice:function(e,t){var n;switch(n={amount:0,errorMessage:null},e){case"s100":n.amount=100;break;case"s500":n.amount=500;break;case"s1000":n.amount=1e3;break;case"sfree":if(!/^[1-9][0-9]*$/.test(t))return n.errorMessage="\u6570\u5b57\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044",n;if(100>t||t>1e4)return n.errorMessage="100\u5186\u304b\u308910000\u5186\u306e\u9593\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u4e0b\u3055\u3044\u3002",n;n.amount=t}return n}}}])}.call(this),function(){angular.module("noteApp").factory("SocialText",["CustomDomainContext","$window","Title","$filter",function(e,t,n,r){var i;return i={generate:function(i){var a,o,s,l,c,u,d,p,h,m,f,g,v,y,b;return l=140,s=23,a=7,o=l-(s+a),h=null!=i.magazine?i.magazine.name:"",v="note\uff08\u30ce\u30fc\u30c8\uff09",null!=i.note?(f=""+t.PREFETCH.NOTE.protocol+"://"+t.PREFETCH.NOTE.host+"/"+i.note.user.urlname+"/n/"+i.note.key,i.note.customDomain&&(i.note.custom_domain=i.note.customDomain),i.note.custom_domain&&(c=""+e.getProtocol()+"://"+i.note.custom_domain.host,f=""+c+"/n/"+i.note.key),null!=i.magazine&&(f=""+f),m=null!=i.note.body?""+(i.note.name||i.note.body.split("\n")[0]||""):""+(i.note.name||""),g="TalkNote"===i.note.type?i.note.body:i.note.name,u=i.note.user.nickname||i.note.user.urlname,y=[],h?(g+h+v).length<o?y.push(g,h,v):(g+v).length<o?y.push(g,v):y.push(g.length<o?g:r("truncate")(g,o)):(g+u+v).length<o?y.push(g,u,v):(g+v).length<o?y.push(g,v):y.push(g.length<o?g:r("truncate")(g,o)),m=encodeURIComponent(n.create(y)),i.fbShareUrl="https://www.facebook.com/share.php?u="+f+"&t="+m,b=i.note.tweet_text||i.note.tweetText,i.twShareUrl="https://twitter.com/intent/tweet?url="+f+"&text="+encodeURIComponent(b||m),i.hatehaShareUrl="http://b.hatena.ne.jp/add?url="+f,i.lineShareUrl="http://line.naver.jp/R/msg/text/?"+m+"%0A"+f,i.embedNoteUrl=""+location.protocol+"//"+location.host+"/embed/notes/"+i.note.key,i.embedNoteScript=""+location.protocol+"//"+location.host+"/scripts/embed.js",i.noteUrl=f):null!=i.magazine&&(p=""+t.PREFETCH.NOTE.protocol+"://"+t.PREFETCH.NOTE.host+"/"+i.magazine.user.urlname+"/m/"+i.magazine.key,i.magazine.customDomain&&(i.magazine.custom_domain=i.magazine.customDomain),i.magazine.custom_domain&&(c=""+e.getProtocol()+"://"+i.magazine.custom_domain.host,p=""+c+"/m/"+i.magazine.key),null!=i.magazine&&(p=""+p),d=""+(i.magazine.name||""),u=i.magazine.user.nickname||i.magazine.user.urlname,y=[],h?(h+h+v).length<o?y.push(h,h,v):(h+v).length<o?y.push(h,v):y.push(h.length<o?h:r("truncate")(h,o)):(h+u+v).length<o?y.push(h,u,v):(h+v).length<o?y.push(h,v):y.push(h.length<o?h:r("truncate")(h,o)),d=encodeURIComponent(n.create(y)),i.fbShareUrl="https://www.facebook.com/share.php?u="+p+"&t="+d,b=i.magazine.tweet_text||i.magazine.tweetText,i.twShareUrl="https://twitter.com/intent/tweet?url="+p+"&text="+encodeURIComponent(b||d),i.hatehaShareUrl="http://b.hatena.ne.jp/add?url="+p,i.lineShareUrl="http://line.naver.jp/R/msg/text/?"+d+"%0A"+p,i.embedMagazineUrl=""+location.protocol+"//"+location.host+"/embed/notes/"+i.magazine.key,i.embedMagazineScript=""+location.protocol+"//"+location.host+"/scripts/embed.js",i.magazineUrl=p),i.windowShare=function(e,n,r,i){var a,o,s;a=screen.availWidth/2-r/2,s=screen.availHeight/2-i/2,o="width="+r+", height="+i+", personalbar=0, toolbar=0, scrollbars=1, resizable=1, top="+s+", left="+a,t.open(e,n,o)},i}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("SpTopStash",function(){var e,t;return t=null,e={stash:function(e){return t=e},stashPop:function(){var e;return t?(e=angular.copy(t),t=null,e):void 0}}})}.call(this),function(){"use strict";angular.module("noteApp").factory("StateMap",["$state",function(e){var t;return t={map:{"home.home":"HomeTimeline","creator.home":"UserTimeline","creator.notes":"UserTimeline","magazine.home":"UserMagazine",showTextNoteFriendly:"NoteDetail"},getAreaName:function(){var t;return(t=this.map[e.current.name])?t:e.current.name}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("UserTimelineStash",["$rootScope",function(e){var t,n,r,i;return r=null,i=null,e.$on("$CreateLikeSuccessfully",function(e,t,n){var i,a,o,s,l,c,u,d,p,h;if(r){if("comment"===t){for(u=r.notes,p=[],o=0,l=u.length;l>o;o++)a=u[o],p.push(a.announce_type&&a.announce_type.length>0?void 0:function(){var e,t,r,o;for(r=a.comments,o=[],e=0,t=r.length;t>e;e++)i=r[e],i.id===n.id?(i.is_liked=n.is_liked,o.push(i.like_count++)):o.push(void 0);return o}());return p}if("note"===t){for(d=r.notes,h=[],s=0,c=d.length;c>s;s++)a=d[s],a.id===n.id?(a.is_liked=n.is_liked,h.push(a.like_count++)):h.push(void 0);return h}}}),e.$on("$DeleteLikeSuccessfully",function(e,t,n){var i,a,o,s,l,c,u,d,p,h;if(r){if("comment"===t){for(u=r.notes,p=[],o=0,l=u.length;l>o;o++)a=u[o],p.push(a.announce_type&&a.announce_type.length>0?void 0:function(){var e,t,r,o;for(r=a.comments,o=[],e=0,t=r.length;t>e;e++)i=r[e],i.id===n.id?(i.is_liked=n.is_liked,o.push(i.like_count--)):o.push(void 0);return o}());return p}if("note"===t){for(d=r.notes,h=[],s=0,c=d.length;c>s;s++)a=d[s],a.id===n.id?(a.is_liked=n.is_liked,h.push(a.like_count--)):h.push(void 0);return h}}}),e.$on("$commentSubmissionEnd",function(e,t){var n,i,a,o,s;if(t&&r){for(o=r.notes,s=[],i=0,a=o.length;a>i;i++)n=o[i],n.id===t.id?(n.comments=angular.copy(t.comments),s.push(n.comment_count=t.comment_count)):s.push(void 0);return s}}),t=function(){return!0},n={clear:function(){return t()?r=null:void 0},stash:function(e,n){return t()?(i=n,e?r=e:void 0):void 0},stashPop:function(e){var n;if(t())return e&&i&&e!==i?void(r=null):r?(n=angular.copy(r),r=null,n):void 0}}}]),angular.module("noteApp").factory("TimelineStash",["$rootScope",function(e){var t,n,r;return r=null,e.$on("$CreateLikeSuccessfully",function(e,t,n){var i,a,o,s,l,c,u,d,p,h;if(r){if("comment"===t){for(u=r.notes,p=[],o=0,l=u.length;l>o;o++)a=u[o],p.push(a.announce_type&&a.announce_type.length>0?void 0:function(){var e,t,r,o;for(r=a.comments,o=[],e=0,t=r.length;t>e;e++)i=r[e],i.id===n.id?(i.is_liked=n.is_liked,o.push(i.like_count++)):o.push(void 0);return o}());return p}if("note"===t){for(d=r.notes,h=[],s=0,c=d.length;c>s;s++)a=d[s],a.id===n.id?(a.is_liked=n.is_liked,h.push(a.like_count++)):h.push(void 0);return h}}}),e.$on("$DeleteLikeSuccessfully",function(e,t,n){var i,a,o,s,l,c,u,d,p,h;if(r){if("comment"===t){for(u=r.notes,p=[],o=0,l=u.length;l>o;o++)a=u[o],p.push(a.announce_type&&a.announce_type.length>0?void 0:function(){var e,t,r,o;for(r=a.comments,o=[],e=0,t=r.length;t>e;e++)i=r[e],i.id===n.id?(i.is_liked=n.is_liked,o.push(i.like_count--)):o.push(void 0);return o}());return p}if("note"===t){for(d=r.notes,h=[],s=0,c=d.length;c>s;s++)a=d[s],a.id===n.id?(a.is_liked=n.is_liked,h.push(a.like_count--)):h.push(void 0);return h}}}),e.$on("$commentSubmissionEnd",function(e,t){var n,i,a,o,s;
if(t&&r){for(o=r.notes,s=[],i=0,a=o.length;a>i;i++)n=o[i],n.id===t.id?(n.comments=angular.copy(t.comments),s.push(n.comment_count=t.comment_count)):s.push(void 0);return s}}),t=function(){return!0},n={clear:function(){return t()?r=null:void 0},stash:function(e){return t()&&e?r=e:void 0},stashPop:function(){var e;if(t())return r?(e=angular.copy(r),r=null,e):void 0}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("UrlPattern",function(){var e;return e={facebook:{message:"facebook\u306eURL\u3067\u306f\u3042\u308a\u307e\u305b\u3093",pattern:/^https?\:\/\/(www|m)?\.facebook\.com\/.+$/},twitter:{message:"twitter\u306eURL\u3067\u306f\u3042\u308a\u307e\u305b\u3093",pattern:/^https?\:\/\/(mobile\.)?twitter\.com\/.+$/},instagram:{message:"instagram\u306eURL\u3067\u306f\u3042\u308a\u307e\u305b\u3093",pattern:/^https?\:\/\/www\.instagram\.com\/.+$/},homepage:{message:"URL\u3067\u306f\u3042\u308a\u307e\u305b\u3093",pattern:/^https?\:\/\/.+$/}}})}.call(this),function(){"use strict";angular.module("noteApp").factory("UserAgent",function(){var e;return e={SMARTPHONE_REGEX:/Android.*Mobile|BlackBerry|iPhone|Windows\ Phone/,TABLET_REGEX:/iPad|Android/,isSmartPhone:!1,isTablet:!1,isPC:!1,isIPhone:!1,isIOSApp:!1,isAndroid:!1,isAndroidApp:!1,"short":null,original:null,isIE:!1,get:function(){var e;return this.original=navigator.userAgent,(e=this.original.match(this.SMARTPHONE_REGEX))?(this.isSmartPhone=!0,this.short=e[0]):(e=this.original.match(this.TABLET_REGEX))?(this.isTablet=!0,this.short=e[0]):(this.isPC=!0,this.short="PC"),(this.original.indexOf("MSIE")>0||this.original.indexOf("Trident")>0)&&(this.isIE=!0),-1!==this.original.indexOf("Safari")&&-1===this.original.indexOf("Chrome")&&(this.isSafari=!0),this.original.indexOf("iPhone")>0?this.isIPhone=!0:-1!==this.original.search(/Android.*Mobile/)&&(this.isAndroid=!0),-1!==this.original.indexOf("iPhone note")&&(this.isIOSApp=!0),-1!==this.original.indexOf("note-android")?this.isAndroidApp=!0:void 0}},e.get(),e})}.call(this),function(){angular.module("noteApp").factory("HashtagWhitelist",function(){var e;return e={whitelists:["#\u65e5\u8a18","#\u30a4\u30e9\u30b9\u30c8","#\u5199\u771f","#\u30a8\u30c3\u30bb\u30a4","#\u30b3\u30e9\u30e0","#\u5c0f\u8aac","#\u30de\u30f3\u30ac","#\u97f3\u697d","#\u7d75","#\u8a69","#\u6f2b\u753b","#\u30aa\u30ea\u30b8\u30ca\u30eb","#\u732b","#\u97f3\u58f0\u914d\u4fe1","#\u604b\u611b","#\u30e9\u30b8\u30aa","#\u6620\u753b","#\u30d6\u30ed\u30b0","#\u30d3\u30b8\u30cd\u30b9","#\u52d5\u753b","#DTM","#photo","#\u5b50\u80b2\u3066","#\u6599\u7406","#\u30a2\u30fc\u30c8","#\u77ed\u7de8\u5c0f\u8aac","#\u4ed5\u4e8b","#note","#\u30c7\u30b6\u30a4\u30f3","#\u306d\u3053","#\u80b2\u5150","#\u65e5\u5e38","#illustration","#4\u30b3\u30de\u6f2b\u753b","#\u3061\u3085\u3046\u30cf\u30e4","#\u30b7\u30e7\u30fc\u30c8\u30b7\u30e7\u30fc\u30c8","#\u5275\u4f5c","#\u77ed\u6b4c","#\u30ae\u30bf\u30fc","#\u65c5","#\u82b1","#\u65c5\u884c","#\u3064\u3076\u3084\u304d","#\u4eba\u751f","#\u8a00\u8449","#\u6e0b\u8c37\u306e\u30e9\u30b8\u30aa","#\u30dd\u30a8\u30e0","#\u52d5\u7269","#\u77e5\u6075\u888b_","#\u672c","#note\u304a\u3084\u3064\u90e8","#\u77ed\u7de8","#\u6d77\u5916","#\u307e\u3093\u304c","#cakes\u30b3\u30f3\u30c6\u30b9\u30c8","#\u8aad\u66f8","#\u4ff3\u53e5","#\u7d75\u65e5\u8a18","#ART","#\u30a4\u30e9\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3","#\u30d5\u30a1\u30c3\u30b7\u30e7\u30f3","#\u30b0\u30eb\u30e1","#\u30b3\u30f3\u30c6\u30f3\u30c4\u4f1a\u8b70","#\u9023\u8f09","#\u3072\u3068\u308a\u3054\u3068","#\u6771\u4eac","#\u30e9\u30a4\u30bf\u30fc","#\u6c96\u7e04","#4\u30b3\u30de","#\u7d75\u672c","#\u9023\u8f09\u5c0f\u8aac","#\u30cd\u30b3","#\u30b2\u30fc\u30e0","#\u30ad\u30e3\u30e9\u30af\u30bf\u30fc","#\u30d5\u30a1\u30f3\u30bf\u30b8\u30fc","#\u6b4c\u8a5e","#\u30ab\u30e1\u30e9","#\u30d5\u30ea\u30fc\u30e9\u30f3\u30b9","#\u30c0\u30a4\u30a8\u30c3\u30c8","#\u82f1\u8a9e","#\u30d4\u30a2\u30ce","#\u72ac","#\u685c","#youtube","#\u5922","#\u6d77\u5916\u751f\u6d3b","#music","#\u751f\u304d\u65b9","#\u8d77\u696d","#\u5f3e\u304d\u8a9e\u308a","#\u3089\u304f\u304c\u304d","#\u7a7a","#\u6625","#\u5bb6\u65cf","#\u30ab\u30d5\u30a7","#\u6d77","#\u5973\u306e\u5b50","#\u4eac\u90fd","#\u843d\u66f8\u304d","#\u6559\u80b2","#\u30b3\u30df\u30c3\u30af\u30a8\u30c3\u30bb\u30a4","#\u4f5c\u66f2","#\u30a4\u30d9\u30f3\u30c8","#\u5360\u3044","#\u304a\u91d1","#\u96d1\u8a18","#\uff14\u30b3\u30de","#\u30ec\u30b7\u30d4","#\u5927\u5b66\u751f","#\u30aa\u30ea\u30b8\u30ca\u30eb\u66f2","#SF","#\u7269\u8a9e","#note\u5f01\u5f53\u90e8","#\u30b3\u30d4\u30c3\u30af","#4\u30b3\u30de\u30de\u30f3\u30ac","#\u590f","#\u604b\u611b\u5c0f\u8aac","#\u7d50\u5a5a","#drawing","#\u304a\u5f01\u5f53","#\u30e9\u30a4\u30d6","#\u30a2\u30cb\u30e1","#\u3054\u306f\u3093","#\u6717\u8aad","#\u5c31\u6d3b","#\u54f2\u5b66","#\u30b7\u30e5\u30fc\u30eb","#\u30ae\u30e3\u30b0","#\u65e5\u672c","#\u30a2\u30e1\u30ea\u30ab","#Twitter","#\u30a4\u30e9\u30b9\u30c8\u30ec\u30fc\u30bf\u30fc","#\u81ea\u7531\u5f8b\u4ff3\u53e5","#\u83c5\u91ce\u840c","#\u611f\u60f3","#\u73fe\u4ee3\u8a69","#\u3054\u98ef","#\u30a8\u30c3\u30bb\u30a4\u6f2b\u753b","#\u30e9\u30a4\u30f4","#\u751f\u6d3b","#\u624b\u4f5c\u308a","#fashion","#LINE\u30b9\u30bf\u30f3\u30d7","#\u304a\u6c17\u306b\u5165\u308a","#SNS","#\u7559\u5b66","#\u304a\u7d75\u63cf\u304d","#\u30af\u30ea\u30b9\u30de\u30b9","#\u638c\u7de8\u5c0f\u8aac","#\u6563\u6b69","#\u8d85\u77ed\u7de8\u5c0f\u8aac","#\u30e9\u30f3\u30c1","#japan","#\u5317\u6d77\u9053","#\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0","#\u30b9\u30ca\u30c3\u30d7","#\u5065\u5eb7","#\u30b9\u30d4\u30ea\u30c1\u30e5\u30a2\u30eb","#note\u30af\u30ea\u30a8\u30a4\u30bf\u30fc","#\u5973\u6027","#\uff14\u30b3\u30de\u6f2b\u753b","#\u79fb\u4f4f","#\u30cf\u30f3\u30c9\u30e1\u30a4\u30c9","#\u30b9\u30a4\u30fc\u30c4","#\u65c5\u884c\u8a18","#\u304a\u306f\u3088\u3046","#\u82b1\u5199\u771f","#\u5b50\u3069\u3082","#\u4e2d\u56fd","#\u6620\u753b\u30ec\u30d3\u30e5\u30fc","#\u30dd\u30fc\u30c8\u30ec\u30fc\u30c8","#\u968f\u7b46","#\u6587\u7ae0","#\u66f8\u8a55","#\u65e5\u66dc\u4f5c\u66f2","#\u30d0\u30f3\u30c9","#\u98df\u4e8b","#\u98a8\u666f","#\u5e78\u305b","#\u30b7\u30a7\u30a2OK","#\u601d\u3044\u51fa","#\u30cb\u30e5\u30fc\u30b9","#\u30da\u30c3\u30c8","#\u4f3c\u9854\u7d75","#\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3","#\u50cd\u304d\u65b9","#\u30b3\u30e9\u30dc","#\u767a\u9054\u969c\u5bb3","#\u611b","#\u4eba\u9593\u95a2\u4fc2","#\u30aa\u30ea\u30b8\u30ca\u30eb\u5c0f\u8aac","#\u9ce5","#\u30a2\u30a4\u30c9\u30eb","#\u304a\u77e5\u3089\u305b","#Photography","#\u304b\u308f\u3044\u3044","#\u81ea\u5df1\u5553\u767a","#WEB\u6f2b\u753b","#\u9152","#tanka","#\u5a5a\u6d3b","#\u793e\u4f1a","#\u6587\u7e01\u306e\u53cb","#\u30a4\u30f3\u30bf\u30d3\u30e5\u30fc","#\u7f8e\u811a","#\u30b3\u30fc\u30d2\u30fc","#\u592b\u5a66","#\u604b","#note\u4ff3\u53e5\u90e8","#\u6d77\u5916\u65c5\u884c","#\u6669\u5fa1\u98ef","#\u96fb\u5b50\u66f8\u7c4d","#\u545f\u304d","#\u8a18\u9332","#\u306f\u3042\u3061\u3085\u3046","#life","#\u6b74\u53f2","#\u66f2\u4ed8\u3051OK","#\u30ec\u30d3\u30e5\u30fc","#\u8db3\u30d5\u30a7\u30c1","#\u30b5\u30c3\u30ab\u30fc","#\u6b4c","#\u690d\u7269","#\u30e9\u30a4\u30d5\u30b9\u30bf\u30a4\u30eb","#\u4ff3\u53e5\u90e8","#\u540d\u8a00","#illust","#\u30c6\u30ec\u30d3","#\u79cb","#\u8ee2\u8077","#\u30e1\u30e2","#\u30d1\u30f3\u30c0","#\u5b50\u4f9b","#\u30b7\u30a7\u30a2\u5927\u6b53\u8fce","#\u81ea\u7136","#\u30c9\u30ed\u30fc\u30a4\u30f3\u30b0","#\u8aad\u66f8\u65e5\u8a18","#\u671d\u3054\u306f\u3093","#blog","#\u52c9\u5f37","#\u9577\u7de8\u5c0f\u8aac","#\u72ec\u308a\u8a00","#\u30b8\u30e3\u30ba","#\u6587\u5b66","#\u5fc3\u7406\u5b66","#\u30aa\u30ea\u30b8\u30ca\u30eb\u30a2\u30af\u30bb\u30b5\u30ea\u30fc","#LGBT","#\u81ea\u5206","#\u30cd\u30c3\u30c8\u30e9\u30b8\u30aa","#\u96e8","#\u30a2\u30af\u30bb\u30b5\u30ea\u30fc\u901a\u8ca9","#\u88fd\u4f5c\u65e5\u8a18","#\u8003\u3048\u65b9","#\u30bf\u30a4","#\u51ac","#\u6570\u5b66","#\u30c7\u30b6\u30a4\u30ca\u30fc","#tororomuseum","#\u30e9\u30fc\u30e1\u30f3","#\u66ae\u3089\u3057","#\u56db\u30b3\u30de","#\u30ab\u30ec\u30fc","#140\u5b57\u5c0f\u8aac","#\u5b87\u5b99","#iphone","#\u897f\u6d0b\u5360\u661f\u8853","#\u624b\u63cf\u304d","#\u6563\u6587","#\u83c5\u91ce\u840c\u306e\u5360\u3044\u306f\u7537\u3068\u5973\u306e\u904b\u547d\u5b66","#\u7d4c\u55b6","#\u30a2\u30ca\u30ed\u30b0","#\u9577\u5d0e","#\u30ed\u30c3\u30af","#\u544a\u77e5","#\u30a4\u30f3\u30b9\u30c8","#\u304a\u83d3\u5b50","#\u5ba3\u4f1d","#\u3053\u3069\u3082","#\u30ea\u30be\u30fc\u30c8","#\u30a2\u30a4\u30c7\u30a2","#\u8fb2\u696d","#\u30af\u30ea\u30a8\u30a4\u30bf\u30fc","#\u8a95\u751f\u65e5","#\u638c\u7de8"],get:function(e){var t,n,r;for(t=this.whitelists.length-1;t>=0;)n=Math.floor(Math.random()*(t+1)),r=[this.whitelists[n],this.whitelists[t]],this.whitelists[t]=r[0],this.whitelists[n]=r[1],t--;return this.whitelists.slice(0,e)}}})}.call(this),function(){"use strict";var e,t;e=function(){function e(e,t,n,r,i,a){var o;this.$scope=e,this.$window=t,this.$q=n,this.$timeout=r,this.$upload=i,this.modal=a,this.fileLoaded=!1,this.processing=!1,this.maxFileSize=this.$window.PREFETCH.NOTE.upload_max_filesize,this.maxFileMegaByte=this.maxFileSize/1024/1024,this.submitButtonCaption="\u3053\u306e\u753b\u50cf\u3092\u633f\u5165";for(o in this.modal.options.locals)this[o]=this.modal.options.locals[o];this.ratio||(this.ratio={}),this.$scope.$ctrl=this}return e.$inject=["$scope","$window","$q","$timeout","$upload","modal"],e.prototype.init=function(){var e;return e=this.imageFile.name.split(".").pop().toLowerCase(),"jpg"!==e&&"jpeg"!==e&&"png"!==e&&"gif"!==e?this.reject("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002"):this.imageFile.size>this.maxFileSize?this.reject("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f"+this.maxFileMegaByte+"MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):this.fileLoadHandler(this.imageFile).then(function(e){return function(t){var n;return n=new Image,n.onload=function(){return e.generateCanvas(n),e.generateCropper(n)},n.src=t.source}}(this))},e.prototype.fileLoadHandler=function(e){return this.image={size:e.size},this.$q(function(t){return function(n){var r;return r=new FileReader,r.onload=function(r){return t.$timeout(function(){return t.fileLoaded=!0,n({source:r.target.result,mime:e.type,name:e.name})})},r.readAsDataURL(e)}}(this))},e.prototype.generateCanvas=function(e){var t;return this.canvas=this.$window.document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,t=this.canvas.getContext("2d"),t.drawImage(e,0,0,e.width,e.height)},e.prototype.generateCropper=function(e){var t,n,r;return this.cropCtx={cropperWidth:520,cropperHeight:520,scale:1,reducedScale:1},this.cropCtx.cropperHeight>=e.height&&this.cropCtx.cropperWidth>=e.width?(this.cropCtx.cropperWidth=e.width,this.cropCtx.cropperHeight=e.height):e.height>e.width?(this.cropCtx.scale=this.cropCtx.cropperHeight/e.height,this.cropCtx.reducedScale=1*e.height/this.cropCtx.cropperHeight,this.cropCtx.cropperWidth=e.width*this.cropCtx.scale):(this.cropCtx.scale=this.cropCtx.cropperWidth/e.width,this.cropCtx.reducedScale=1*e.width/this.cropCtx.cropperWidth,this.cropCtx.cropperHeight=e.height*this.cropCtx.scale),n=this.$window.document.querySelector("#cropImage"),n.width=this.cropCtx.cropperWidth,n.height=this.cropCtx.cropperHeight,r={movable:!1,zoomable:!1,viewMode:1,autoCropArea:1,crop:this.onCrop.bind(this)},Object.keys(this.ratio).length>0&&(r.aspectRatio=this.ratio.width/this.ratio.height),t=n.getContext("2d"),t.drawImage(e,0,0,e.width,e.height,0,0,this.cropCtx.cropperWidth,this.cropCtx.cropperHeight),this.cropper=new Cropper(n,r),this.cropData={}},e.prototype.onCrop=function(e){var t,n,r,i,a,o;return r=this.cropper.getImageData(),n=r.naturalWidth,t=r.naturalHeight,this.cropData.x=e.detail.x,this.cropData.y=e.detail.y,this.cropData.width=Math.round(e.detail.width)===n?this.cropCtx.cropperWidth:e.detail.width,this.cropData.height=Math.round(e.detail.height)===t?this.cropCtx.cropperHeight:e.detail.height,a=Math.round(this.cropData.width*this.cropCtx.reducedScale),i=Math.round(this.cropData.height*this.cropCtx.reducedScale),o=""+a+" x "+Math.round(i),this.resolutionElem=this.modal.element[0].querySelector("td.resolution"),this.resolutionElem.innerText=o},e.prototype.uploadImage=function(){var e,t;if(!this.processing)return this.processing=!0,this.submitButtonCaption="\u51e6\u7406\u4e2d",e=this.kind?this.kind:"note_picture","note_picture"===e?t="/api/v2/image_upload/text_note_picture":"eyecatch"===e&&(t="/api/v1/image_upload/note_eyecatch"),this.canvas.toBlob(function(e){return function(n){return e.$upload.upload({url:t,fileName:e.imageFile.name,file:n,data:{note_id:e.noteId,x:Math.round(e.cropData.x*e.cropCtx.reducedScale),y:Math.round(e.cropData.y*e.cropCtx.reducedScale),height:Math.round(e.cropData.height*e.cropCtx.reducedScale),width:Math.round(e.cropData.width*e.cropCtx.reducedScale)}}).success(function(t){return e.modal.closed.then(t.error&&"file_size_limit_exceeded"===error.code?function(){return e.reject("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f"+e.maxFileMegaByte+"MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}:t.error&&"file_type_not_allowed"===error.code?function(){return e.reject("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u753b\u50cf\u306e\u5f62\u5f0f\u306f\u3001JPEG\u3001PNG\u3001GIF\u306e\u307f\u3067\u3059\u3002")}:t.error?function(){return e.reject("\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}:function(){return e.resolve({url:t.data.url})}),e.modal.close()}).error(function(){return e.modal.closed.then(function(){return e.reject("\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002")}),e.modal.close()})}}(this),"image/jpeg")},e.prototype.cancel=function(){return this.modal.closed.then(function(e){return function(){return e.reject()}}(this)),this.modal.close()},e}(),t=function(){function t(e,t,n){this.$window=e,this.$q=t,this.Popeye=n}return t.$inject=["$window","$q","Popeye"],t.prototype.process=function(t){return this.$q(function(n){return function(r,i){var a;return a=n.$window.document.createElement("input"),a.setAttribute("style","display: none"),a.setAttribute("type","file"),a.setAttribute("accept",".jpg,.gif,.png,image/gif,image/jpeg,image/png"),a.onchange=function(a){return n.Popeye.openModal({templateUrl:"/templates/modal/renewal/_image_crop",click:!1,locals:{noteId:t.noteId,ratio:t.ratio,kind:t.kind,imageFile:a.target.files[0],resolve:r,reject:i},controller:e})},a.click()}}(this))},t}(),angular.module("noteApp").service("ImageCropperService",t)}.call(this),function(){"use strict";angular.module("noteApp").factory("MessageModal",["Popeye",function(e){var t;return t={show:function(t){var n;return n=e.openModal({templateUrl:"/templates/modal/message_modal",controller:["$scope",function(e){return e.mode="message",e.title=t.title,e.message=t.message,e.close=function(){return t.callback&&t.callback(),n.close()}}]})},showTemplate:function(t){var n;return n=e.openModal({templateUrl:t.templateUrl,controller:["$scope",function(e){return e.linkTo=function(e){return location.href=e},e.close=function(){return n.close()}}]})},confirm:function(t){var n;return n=e.openModal({templateUrl:"/templates/modal/message_modal",controller:["$scope","$q",function(e){return e.mode="confirm",e.state="ready",e.title=t.title,e.message=t.message,e.okButtonTitle=t.okButtonTitle?t.okButtonTitle:"OK",e.cancelButtonTitle=t.cancelButtonTitle?t.cancelButtonTitle:"\u30ad\u30e3\u30f3\u30bb\u30eb",e.proceed=function(){return e.processing=!0,t.process().then(function(){return e.processing=!1,t.isTermination?e.close():(e.message=t.doneMessage,e.state="done")},function(t){return e.processing=!1,t&&(e.message=t.message),e.state="failed"})},e.afterTreatment=function(){return t.callback&&t.callback(),e.close()},e.close=function(){return n.close()}}]})}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("UserPopupModal",["Popeye","SocialText",function(e,t){var n;return n={show:function(n){var r;return r=e.openModal({templateUrl:"/templates/modal/user_popups/user_popup_modal",click:!1,controller:["$scope",function(e){var i,a,o;if(e.mode="message",e.title=n.title||"note\u304b\u3089\u306e\u304a\u77e5\u3089\u305b",e.message=n.message,e.subMessage=n.subMessage,e.count=n.count,e.image=n.image,e.type=n.type,"EverydayNoteUserPopup"===e.type&&(e.rand=Math.floor(6*Math.random())+1),n.showParams){o=n.showParams;for(i in o)a=o[i],e[i]=a}return n.showParams.showShareButtons&&(n.note&&(e.note=n.note),n.magazine&&(e.magazine=n.magazine),e=t.generate(e),e.twShareUrl=decodeURIComponent(e.twShareUrl),e.fbShareUrl=e.fbShareUrl,e.windowShare=e.windowShare,e.twShareUrl&&e.fbShareUrl||(e.showShareButtons=!1)),e.close=function(){return n.callback&&n.callback(),r.close()}}]}),r.opened.then(function(){return angular.element(".p-achievementsModal__message a").on("click",function(){return r.close()})})}}}])}.call(this),function(){"use strict";angular.module("noteApp").factory("ScrollPositionObserver",["$rootScope","$state","$window","$document",function(e,t,n,r){return{observe:function(){return angular.element(n).bind("scroll",function(){var i,a;return i=angular.element(r).height(),a=angular.element(n).height()+angular.element(n).scrollTop(),.03*i>i-a?e.$broadcast("$scrollBottom",t):void 0})}}}]),angular.module("noteApp").factory("Bridge",function(){var e;return e={user:{},currentUser:{},notification:{count:0}}}),angular.module("noteApp").factory("Title",["Bridge","$state","CustomDomainContext",function(e,t,n){var r;return r={set:function(r,i,a){return null==i&&(i=null),null==a&&(a="note"),(null===i||void 0===i)&&(i="\uff5c"),"string"==typeof r?r.length>0?(r=[r],n.isCdAccess()||r.push(a),document.title=r.join(i)):document.title="note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002":Array.isArray(r)?(n.isCdAccess()||r.push(a),document.title=r.join(i)):document.title="note \u2015\u2015\u3064\u304f\u308b\u3001\u3064\u306a\u304c\u308b\u3001\u3068\u3069\u3051\u308b\u3002",t.current.name.indexOf("TextNote")>=0?void 0:this.setNotification(e.notification.count)},create:function(e){var t,n,r,i,a,o;if(t="\uff5c","string"==typeof e)return e.length>0?(n=[e,"note"].join(t),n.match(/\+\+/)?n+" ":n):"note";if(Array.isArray(e)){for(i=[],a=0,o=e.length;o>a;a++)r=e[a],(null!=r?r.trim():void 0)&&i.push(r);return n=i.join(t),n.match(/\+\+/)?n+" ":n}return"note"},setNotification:function(e){return document.title=-1!==document.title.search(/^\([0-9]+\)/)?e>0?document.title.replace(/^\([0-9]+\)/,"("+e+")"):document.title.replace(/^\([0-9]+\) /,""):e>0?"("+e+") "+document.title:document.title},get:function(){return document.title}}}]),angular.module("noteApp").factory("ContentLoading",["$rootScope","$window",function(e,t){return{set:function(n){var r;return r=["cdMyNote","article.detail","author.detail","search"],e.contentLoading=!1,n.name.indexOf("showTextNote")>=0||r.indexOf(n.name)>=0?(e.contentLoading=!0,t.scrollTo(0,0)):void 0}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["ArticleContextService"],e}(),angular.module("noteApp").directive("articleAction",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/action",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["ArticleContextService"],e}(),angular.module("noteApp").directive("articleAuthor",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/author",scope:{}}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n,r,i,a,o,s,l,c,u,d,p,h){var m,f,g;this.$rootScope=e,this.$scope=n,this.$state=r,this.$window=i,this.$timeout=a,this.$sce=o,this.$element=s,this.$filter=l,this.$location=c,this.$q=u,this.Article=d,this.ArticleContextService=p,this.SlickContextSercice=h,this.getOffset=t(this.getOffset,this),this.sanitizeNode=t(this.sanitizeNode,this),g=this.ArticleContextService.get(),this.doc=this.$window.document,this.articleBodyElem=this.$element[0],this.articleElem=this.articleBodyElem.querySelector("article"),this.bodyElem=this.articleBodyElem.querySelector("#note-body"),this.note=g.note,this.currentUser=g.currentUser,this.isLoggedIn=this.currentUser?!0:!1,this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.bottomEventSent=!1,this.authorName=function(){var e,t,n;if(this.note.additional_attr&&this.note.additional_attr.sponsered_by)return this.note.additional_attr.sponsered_by;for(f=[],n=this.note.authors,e=0,t=n.length;t>e;e++)m=n[e],f.push(m.name);return f.join(",")}.call(this),this.byLabel=this.note.additional_attr&&this.note.additional_attr.sponsered_by?"Sponsored by":this.authorName?"by":null,this.currentPageUrl=this.$window.location.href,this.currentPage=1,this.isLastPage=this.note.is_last_page,this.$timeout(function(e){return function(){return e.noteWrapperElem=e.doc.querySelector(".note-wrapper[data-note-id='"+e.note.id+"']")}}(this),0),this.attachEvents(),this.note.sanitizedBody="",this.note.body&&this.appendBody(this.sanitizeBody(this.note.body))}return e.$inject=["$rootScope","$scope","$state","$window","$timeout","$sce","$element","$filter","$location","$q","Article","ArticleContextService","SlickContextSercice"],e.prototype.attachEvents=function(){var e,t;return e=this.onIframeMessage.bind(this),this.$window.removeEventListener("message",e),this.$window.addEventListener("message",e),this.$scope.$on("$destroy",function(t){return function(){return t.$window.removeEventListener("message",e)}}(this)),this.$window.PREFETCH.NOTE.enable_split_page===!0||this.$window.PREFETCH.NOTE.enable_note_autoload===!0?(t=this.onScroll.bind(this),this.$window.removeEventListener("scroll",t),this.$window.addEventListener("scroll",t),this.$scope.$on("$destroy",function(e){return function(){return e.$window.removeEventListener("scroll",t)}}(this))):void 0},e.prototype.appendBody=function(e){var t,n,r,i;for(i=e.paragraphs,n=0,r=i.length;r>n;n++)t=i[n],this.bodyElem.appendChild(t,null);return this.$timeout(function(t){return function(){var n,r,i,a,o;for(a=e.embedKeys,o=[],r=0,i=a.length;i>r;r++)n=a[r],o.push(t.setEmbeddedContent(n));return o}}(this),0)},e.prototype.sanitizeBody=function(e){var t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b;for(p=this.doc.createElement("div"),p.innerHTML=e.replace(/<\/?script[^>]*>/gi,""),r=[],y=p.childNodes,m=0,g=y.length;g>m;m++){for(s=y[m],o=s.nodeName.toLowerCase(),l=this.doc.createElement(o),h=s.getAttribute("name"),u=s.getAttribute("style"),d=s.getAttribute("class"),h&&l.setAttribute("name",this.$filter("sanitize")(h)),u&&l.setAttribute("style",this.$filter("sanitize")(u)),d&&l.setAttribute("class",this.$filter("sanitize")(d)),"figure"===o&&(s.classList&&s.classList.contains("image-wrapper")?(i="image-wrapper",s.classList.contains("image-with-caption")&&(i+=" image-with-caption"),l.setAttribute("class",i)):(n=s.getAttribute("embedded-content-key"),c=s.getAttribute("embedded-service"),n&&l.setAttribute("embedded-content-key",this.$filter("sanitize")(n)),c&&l.setAttribute("embedded-service",this.$filter("sanitize")(c)),r.push(n))),s.innerHTML&&(a=this.$filter("hashtagAsp")(this.replaceFullSpace(s.innerHTML)),a=this.$filter("nofollow")(a),s.innerHTML=a),b=s.childNodes,f=0,v=b.length;v>f;f++)t=b[f],this.sanitizeNode(t);l.innerHTML=s.innerHTML,s.parentNode.replaceChild(l,s)}return{paragraphs:Array.prototype.slice.call(p.childNodes),embedKeys:r}},e.prototype.sanitizeNode=function(e){var t,n,r,i,a,o,s,l,c;if(e.nodeType===Node.ELEMENT_NODE){if(r=e.nodeName.toLowerCase(),"a"!==r&&"img"!==r&&"br"!==r&&"iframe"!==r&&"figcaption"!==r){if(a=this.doc.createElement(r),o=e.getAttribute("style"),o&&a.setAttribute("style",this.$filter("sanitize")(o)),e.childNodes&&e.childNodes.length>0)for(c=e.childNodes,s=0,l=c.length;l>s;s++)t=c[s],this.sanitizeNode(t);a.innerHTML=e.innerHTML,e.parentNode.replaceChild(a,e)}if("figcaption"===r&&(i=e.previousElementSibling,i&&"img"===i.nodeName.toLowerCase()&&i.classList.contains("getty-image")&&(n=this.doc.createElement("a"),n.href="http://welcome-to-gettyimages.jp/licensed-by-gettyimages/",n.target="_blank",n.textContent=this.$window.PREFETCH.NOTE.getty_caption||"Licensed by Getty Images",e.innerHTML=n.outerHTML)),"img"===r&&(e.removeAttribute("width"),e.removeAttribute("height"),e.getAttribute("style")&&this.$rootScope.isSmartPhone===!0))return e.removeAttribute("style")}},e.prototype.replaceFullSpace=function(e){return e?e.split("&#160;").join(" "):void 0},e.prototype.setEmbeddedContent=function(e){var t,n,r,i,a,o,s,l,c,u;for(r=null,u=this.note.embedded_contents,l=0,c=u.length;c>l;l++)if(n=u[l],n.key===e){r=n;break}return r?(t=this.bodyElem.offsetWidth,i=this.bodyElem.querySelector("[embedded-content-key='"+r.key+"']"),s=this.$window.document.createElement("div"),s.classList.add("fude-iframe-container"),a=this.$window.document.createElement("div"),a.classList.add("fude-iframe-container-"+r.service),this.$rootScope.isIPhone===!0&&(a.style.width=""+t+"px",a.style.overflow="auto"),s.appendChild(a),a.innerHTML=r.html_for_embed,this.$rootScope.isIPhone===!0&&(o=a.querySelector("iframe"),o&&(o.style.display="block",o.style.margin="0",o.style.width=""+t+"px",o.src=""+o.src+"?w="+t)),$(i).html(s.outerHTML)):void 0},e.prototype.onIframeMessage=function(e){var t,n,r,i,a,o,s;if(e.data&&(a=e.data.split("::"),3===a.length&&(r=a[0],o=a[1],s=a[2],n=this.articleBodyElem.querySelector("iframe[src='"+o+"']")))){if("height"===r)return this.$rootScope.isIPhone===!0?(t=n.parentNode,t.style.height=""+s+"px",n.removeAttribute(r),n.style.height=""+s+"px"):(n.removeAttribute(r),n.setAttribute(r,s));if("track"===r&&this.$window.ga)return i=""+this.note.category.eng_name+"/"+this.note.slug+"/slideshow",this.$window.ga("send","pageview",i)}},e.prototype.onScroll=function(){var e,t,n,r,i,a;return r=this.getOffset(this.articleElem),i=this.$window.pageYOffset+this.$window.innerHeight-r.top,t=this.doc.body.offsetHeight,i>=.9*this.articleElem.offsetHeight&&(this.canPaging()?this.paging().then(function(e){return function(){var t;return e.$window.ga&&"article.preview"!==e.$state.current.name?(t=""+e.note.category.eng_name+"/"+e.note.slug+"?page="+e.currentPage,e.$window.ga("send","pageview",t)):void 0}}(this)):this.isLastPage&&!this.note.isFetchedNext&&(this.noteWrapperElem||(this.noteWrapperElem=this.doc.querySelector(".note-wrapper[data-note-id='"+this.note.id+"']")),e=this.noteWrapperElem.offsetHeight-this.articleElem.offsetHeight,n=this.articleElem.offsetHeight+e/2,i>=n&&!this.bottomEventSent&&(a=this.doc.createEvent("HTMLEvents"),a.initEvent("scrollArticleBottom",!0,!0),this.articleBodyElem.parentNode.dispatchEvent(a),this.bottomEventSent=!0))),this.isVisible()&&this.isPageChanged()?(this.$state.go("article.detail",{category:this.categoryOrPreview(),slug:this.note.slug},{location:"replace",notify:!1}),this.$window.document.title=""+this.note.name+" | "+this.$window.PREFETCH.NOTE.siteName):void 0},e.prototype.isVisible=function(){var e,t,n,r,i;return i=this.$window.pageYOffset,r=i+this.$window.innerHeight,n=this.getOffset(this.articleElem),t=n.top,e=t+this.articleElem.offsetHeight,r>t&&e>r||i>t&&e>i},e.prototype.isPageChanged=function(){var e;return e=this.note&&"/"+this.categoryOrPreview()+"/"+this.note.slug,this.$location.path()!==e},e.prototype.categoryOrPreview=function(){return"article.preview"===this.$state.current.name?"preview":this.note.category.eng_name},e.prototype.getOffset=function(e){var t,n;return n=this.doc.documentElement,t=e.getBoundingClientRect(),{top:t.top+(this.$window.pageYOffset||n.scrollTop)-(n.clientTop||0),left:t.left+(this.$window.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}},e.prototype.canPaging=function(){return[!this.isLastPage,!this.isLoading,this.note&&"TextNote"===this.note.type].every(function(e){return e})},e.prototype.paging=function(){return this.$q(function(e){return function(t){var n;return e.isLoading=!0,n="article.preview"===e.$state.current.name?e.$state.params.prev_access_key:null,e.Article.get({slug:e.note.slug,magazine_key:e.$state.params.magazine_key,prev_access_key:n,page:e.currentPage+1}).$promise.then(function(n){return n.data.body&&e.appendBody(e.sanitizeBody(n.data.body)),e.note.is_last_page=n.data.is_last_page,e.currentPage+=1,e.isLastPage=n.data.is_last_page,e.isLoading=!1,t()})}}(this))},e}(),angular.module("noteApp").directive("articleBody",function(){return{restrict:"E",templateUrl:"/templates/asp/articles/body",scope:{isLoading:"=",mountEmbedded:"="},controller:e,controllerAs:"$ctrl",bindToController:!0}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["ArticleContextService"],e}(),angular.module("noteApp").directive("articleComment",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/comment",scope:{}}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n,r,i){this.$rootScope=e,this.$scope=n,this.$stateParams=r,this.$window=i,this.fetchNext=t(this.fetchNext,this),this.$rootScope.hideFooter=this.$window.PREFETCH.NOTE.enable_split_page||this.$window.PREFETCH.NOTE.enable_note_autoload,this.slugs=[this.$stateParams.slug],this.setCallbacks()}return e.inject=["$rootScope","$scope","$stateParams","$window"],e.prototype.fetchNext=function(e){return e.prev_note&&0===this.slugs.filter(function(){return function(t){return t===e.prev_note.slug}}(this)).length?this.slugs=this.slugs.concat(e.prev_note.slug):this.$rootScope.hideFooter?this.showFooter():void 0},e.prototype.setCallbacks=function(){return this.$scope.$on("$destroy",function(e){return function(){return $(e.$window).trigger("resize")}}(this))},e.prototype.showFooter=function(){return this.$rootScope.hideFooter=!1,$(this.$window).trigger("resize"),this.$scope.$apply()},e}(),angular.module("noteApp").directive("articleDetail",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/articles/detail",controller:n.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_){this.$analytics=e,this.$element=t,this.$location=n,this.$rootScope=r,this.$scope=i,this.$window=a,this.$document=o,this.$state=s,this.$stateParams=l,this.$filter=c,this.$sce=u,this.$timeout=d,this.$q=p,this.Auth=h,this.Note=m,this.Article=f,this.CustomDomainContext=g,this.Bridge=v,this.ReadHistory=y,this.Admin=b,this.ArticleContextService=_,this.doc=this.$window.document,this.currentUser={},this.commentModel={comments:[]},this.paywallContext={},this.collapsed=!0,this.currentPage=1,this.isFetchedNext=!1,this.isLoading=!1,this.isSmartPhone=this.$rootScope.isSmartPhone,this.initNote().then(function(e){return function(){return e.Admin.isAdminCheck!==!0&&e.ReadHistory.save({id:e.note.id,referrer:e.$rootScope.prevPage}),e.note.initFinished=!0,e.note.isFetchedNext=!1,e.ArticleContextService.set(e.note,e.currentUser,e.paywallContext),"article.preview"!==e.$state.current.name&&!e.isFirstPage&&e.note.category&&e.$analytics.pageTrack("/"+e.note.category.eng_name+"/"+e.note.slug),e.$timeout(function(){return e.$window.PREFETCH.NOTE.enable_split_page===!0||e.$window.PREFETCH.NOTE.enable_note_autoload===!0?(e.wrapperElem=e.doc.querySelector("[data-note-id='"+e.note.id+"']"),e.instanceScrollBottomListener=e.onScrollArticleBottom.bind(e),e.wrapperElem.removeEventListener("scrollArticleBottom",e.instanceScrollBottomListener),e.wrapperElem.addEventListener("scrollArticleBottom",e.instanceScrollBottomListener),e.$scope.$on("$destroy",function(){return e.wrapperElem.removeEventListener("scrollArticleBottom",e.instanceScrollBottomListener)
})):void 0},0)}}(this),function(e){return function(){return e.note&&e.note.prev_note?(e.note.is_last_page=!0,e.onScrollArticleBottom()):e.showFooter()}}(this))}return e.$inject=["$analytics","$element","$location","$rootScope","$scope","$window","$document","$state","$stateParams","$filter","$sce","$timeout","$q","Auth","Note","Article","CustomDomainContext","Bridge","ReadHistory","Admin","ArticleContextService"],e.prototype.initNote=function(){return this.$q(function(e){return function(t,n){return e.Auth.then(function(r){var i,a;return r.error&&(e.error=r.error,e.isLoggedIn=!1),r.data&&(e.currentUser=r.data,e.Bridge.currentUser=r.data,e.isLoggedIn=!0),i=e.$stateParams.magazine_key,a="article.preview"===e.$state.current.name?e.$stateParams.prev_access_key:null,e.Article.get({slug:e.slug,magazine_key:i,prev_access_key:a,page:e.currentPage},function(r){var i,a,o,s,l,c,u,d,p,h;if(r.error)return"not_found"===r.error.code&&e.$state.go("_404",null,{location:!1}),e.error=r.error,void n();if(e.note=r.data,e.commentModel.comments=e.note.comments,e.is_my_note=e.note.is_my_note,e.prev_note=e.note.prev_note,e.next_note=e.note.next_note,o=e.$window.PREFETCH.NOTE.relatedNote.max_count||3,e.note.recommendations=r.data.note_related_notes.concat(r.data.popular_sibling_notes),e.note.recommendations.splice(o),e.paywallContext.isShowLimitedPayNotePaywall=!1,e.note.limited_note_include_magazines)for(p=e.note.limited_note_include_magazines,l=0,u=p.length;u>l;l++)a=p[l],(a.is_purchased||a.is_subscribed)&&(e.paywallContext.isShowLimitedPayNotePaywall=!0);for(s=0,h=e.note.magazines_for_subscribe,c=0,d=h.length;d>c;c++)i=h[c],i.is_same_month_now_and_magazine_add&&(s+=1);return e.note.same_month_cnt=s,e.note.isReadOnlyPart=e.$window.PREFETCH.NOTE.enable_login_required_article&&e.note.additional_attr.is_login_required&&0===Object.keys(e.currentUser).length,e.note.category||"article.preview"===e.$state.current.name?t():n()})})}}(this))},e.prototype.onScrollArticleBottom=function(){return this.canFetchNext()?(this.isFetchedNext=!0,this.note.isFetchedNext=!0,this.fetchNext(this.note)):this.showFooter()},e.prototype.canFetchNext=function(){return["article.preview"!==this.$state.current.name,this.$window.PREFETCH.NOTE.enable_note_autoload,!this.isFetchedNext,this.note.is_last_page].every(function(e){return e})},e}(),angular.module("noteApp").directive("articleDetailPage",function(){return{restrict:"E",scope:{fetchNext:"=",showFooter:"=",isFirstPage:"=",slug:"="},templateUrl:"/templates/asp/articles/detail_page",controller:e,controllerAs:"$ctrl",bindToController:!0}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["ArticleContextService"],e}(),angular.module("noteApp").directive("articleHashtag",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/hashtag",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){var s;this.UserAgent=e,this.Popeye=t,this.$state=n,this.$stateParams=r,this.$window=i,this.$location=a,this.ArticleContextService=o,s=this.ArticleContextService.get(),this.note=s.note,this.currentUser=s.currentUser,this.isSmartPhone=this.UserAgent.isSmartPhone,this.isTablet=this.UserAgent.isTablet,this.isLoggedIn=0===Object.keys(this.currentUser).length?!1:!0}return e.inject=["UserAgent","Popeye","$state","$stateParams","$window","$location","ArticleContextService"],e.prototype.noteDelete=function(){var e,t,n;if("published"===(n=this.note.status)||"draft"===n||"reserved"===n)return t=this.note.id,e=this.Popeye.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$resource","$scope",function(n,r){return r.ok=function(){return n("/api/v1/notes/"+t)["delete"]({},function(){return e.close(),location.href="/"},function(){return console.log("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")})},r.cancel=function(){return e.close()}}]})},e.prototype.deleteDraftNote=function(){var e,t;return t=this.note.id,e=this.Popeye.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$resource","$scope",function(n,r){return r.draft=!0,r.ok=function(){return n("/api/v1/text_notes/draft_delete")["delete"]({id:t},function(){return e.close(),location.href="/"},function(){return console.log("Error occurred")})},r.cancel=function(){return e.close()}}]})},e.prototype.goTextNoteEdit=function(){var e,t;t=this.note.key,"draft"===this.note.status?this.$location.url("/notes/"+t+"/edit").replace():this.note.has_draft?e=this.Popeye.openModal({templateUrl:"/templates/modal/confirm_textnote_edit",controller:["$resource","$scope",function(n){return function(r,i){return i.startReEditNote=function(){return e.close(),n.$state.go("article.edit",{key:t,reedit:!0})},i.editExistsNote=function(){return e.close(),this.$state.go("article.edit",{key:t})}}}(this)]}):this.$state.go("article.edit",{key:t})},e}(),angular.module("noteApp").directive("articleHeader",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/header",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.NoteHashtags=e,this.tagNames=null,this.fetchTags()}return e.inject=["NoteHashtags"],e.prototype.fetchTags=function(){return this.NoteHashtags.get({noteKey:this.note.key},function(e){return function(t){return e.tagNames=t.data.hashtags.map(function(e){return e.name.slice(1)})}}(this),function(e){return console.error(e)})},e}(),angular.module("noteApp").directive("articleKeywords",function(){return{templateUrl:"/templates/asp/articles/keywords",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["ArticleContextService"],e}(),angular.module("noteApp").directive("articleMagazine",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/magazine",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){var n;this.rootScope=e,this.ArticleContextService=t,n=this.ArticleContextService.get(),this.note=n.note,this.currentUser=n.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["$rootScope","ArticleContextService"],e}(),angular.module("noteApp").directive("articlePager",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/pager",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("aspMagazinePaywall",function(){return{restrict:"E",scope:{},bindToController:{note:"=",isLoggedIn:"="},templateUrl:"/templates/asp/articles/asp_magazine_paywall",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("limitedSaleArticlePaywall",function(){return{restrict:"E",scope:{},bindToController:{note:"=",isLoggedIn:"="},templateUrl:"/templates/asp/articles/limited_sale_article_paywall",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.paywallContext=t.paywallContext,this.isLoggedIn=0!==Object.keys(this.currentUser).length}return e.inject=["ArticleContextService"],e.prototype.isLoginRequiredArticleCanNotRead=function(){return this.note.additional_attr.is_login_required&&!this.isLoggedIn},e.prototype.isPaidArticle=function(){return this.note.price>0},e.prototype.isArticleInPaidMagazine=function(){return this.note.magazines_for_buy.length>0||this.note.magazines_for_subscribe.length>0},e.prototype.isSimplePaidArticle=function(){return this.isPaidArticle()&&!this.isArticleInPaidMagazine()},e.prototype.isFreeArticleInPaidMagazine=function(){return 0===this.note.price&&this.note.is_limited},e.prototype.isPaidArticleInPaidMagazine=function(){return this.isPaidArticle()&&this.isArticleInPaidMagazine()&&!this.note.is_limited},e.prototype.isLimitedArticleInPaidMagazine=function(){return this.note.price>0&&this.note.is_limited},e}(),angular.module("noteApp").directive("outerArticlePaywall",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/paywall",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("paidArticleInPaidMagazinePaywall",function(){return{restrict:"E",scope:{},bindToController:{note:"=",isLoggedIn:"="},templateUrl:"/templates/asp/articles/paid_article_in_paid_magazine_paywall",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("paywallArticleItem",function(){return{restrict:"E",scope:{},bindToController:{note:"="},templateUrl:"/templates/asp/articles/paywall_article_item",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("paywallMagazineItem",function(){return{restrict:"E",scope:{},bindToController:{magazine:"="},templateUrl:"/templates/asp/articles/paywall_magazine_item",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){var t;this.ArticleContextService=e,t=this.ArticleContextService.get(),this.note=t.note,this.currentUser=t.currentUser,this.isLoggedIn=this.currentUser?!0:!1}return e.inject=["ArticleContextService"],e}(),angular.module("noteApp").directive("relatedArticle",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",templateUrl:"/templates/asp/articles/related",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$location=e}return e.inject=["$location"],e}(),angular.module("noteApp").directive("simplePaidArticlePaywall",function(){return{restrict:"E",scope:{},bindToController:{note:"=",context:"=",isLoggedIn:"="},templateUrl:"/templates/asp/articles/simple_paid_article_paywall",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("authorBase",function(){return{restrict:"E",scope:{},template:"<div ui-view></div>",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t,n,r,i,a=[].slice;i=function(){function e(){}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("authorContentTextNote",function(){return{templateUrl:"/templates/asp/authors/content_text_note",restrict:"E",scope:{},controller:a.call(i.INJECTS).concat([i]),controllerAs:"$ctrl",bindToController:{note:"="}}}),r=function(){function e(){}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("authorContentTalkNote",function(){return{templateUrl:"/templates/asp/authors/content_talk_note",restrict:"E",scope:{},controller:a.call(r.INJECTS).concat([r]),controllerAs:"$ctrl",bindToController:{note:"="}}}),t=function(){function e(){}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("authorContentMovieNote",function(){return{templateUrl:"/templates/asp/authors/content_movie_note",restrict:"E",scope:{},controller:a.call(t.INJECTS).concat([t]),controllerAs:"$ctrl",bindToController:{note:"="}}}),n=function(){function e(){this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null)}return e.INJECTS=["$scope"],e}(),angular.module("noteApp").directive("authorContentSoundNote",function(){return{templateUrl:"/templates/asp/authors/content_sound_note",restrict:"E",scope:{},controller:a.call(n.INJECTS).concat([n]),controllerAs:"$ctrl",bindToController:{note:"="}}}),e=function(){function e(e,t){this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isPC=t.isPC,this.isTablet=t.isTablet,this.isSmartPhone=t.isSmartPhone}return e.INJECTS=["$scope","$rootScope"],e}(),angular.module("noteApp").directive("authorContentImageNote",function(){return{templateUrl:"/templates/asp/authors/content_image_note",restrict:"E",scope:{},controller:a.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{note:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c){this.$state=e,this.$scope=t,this.CreatorContents=n,this.CreatorArchives=r,this.CreatorPickupContents=i,this.MessageModal=a,this.CustomDomainContext=o,this.$rootScope=s,this.CreatorCustomMenus=l,this.AuthorContextServive=c,this.AuthorContextServive.get().then(function(e){return function(t){return e.ctx=t,e.creator=e.ctx.author,e.urlname=e.ctx.author.urlname}}(this)),this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isPC=this.$rootScope.isPC,this.isSmartPhone=this.$rootScope.isSmartPhone,this.setCallbacks(),this.$rootScope.$on("createNoteFromNavBar",function(){return location.reload()})}return e.INJECTS=["$state","$scope","CreatorContents","CreatorArchives","CreatorPickupContents","MessageModal","CustomDomainContext","$rootScope","CreatorCustomMenus","AuthorContextServive"],e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$CreatorTopContensDelete",function(t,n){var r;return r=e.notes.indexOf(n),e.notes.splice(r,1)}),this.$scope.$on("$MagazineFollowToggle",function(t,n){var r,i;return i=e.magazines.indexOf(n),r=e.magazines[i],r.isFollowing=!r.isFollowing}),this.$scope.$on("$scrollBottom",function(){return function(){return e.paging()}}(this))},e.prototype.snakizeNoteProperties=function(e){var t,n,r,i;if(e.is_liked=e.isLiked,e.like_count=e.likeCount,e.is_limited=e.isLimited,e.is_treasured_note=e.isTreasuredNote,e.is_author=e.isAuthor,e.external_url=e.externalUrl,e.disable_comment=e.disableComment,e.limited_message=e.limitedMessage,e.audio&&(e.audio.artist_name=e.audio.artistName),e.limitedMessage)for(e.limited_message.user_name=e.limitedMessage.userName,i=e.limitedMessage.magazines,n=0,r=i.length;r>n;n++)t=i[n],t.customDomain&&(t.custom_domain=t.customDomain),t.user.customDomain&&(t.user.custom_domain=t.user.customDomain);return e.priorSale&&(e.prior_sale={},e.prior_sale.activated=e.priorSale.activated,e.prior_sale.first_served_sales_count=e.priorSale.firstServedSalesCount,e.prior_sale.is_sellout=e.priorSale.isSellout,e.prior_sale.now_on_sale=e.priorSale.nowOnSale,e.prior_sale.on_sale_price=e.priorSale.onSalePrice,e.prior_sale.stock_count=e.priorSale.stockCount),e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain?(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key):void 0},e.prototype.snakizeMagazineProperties=function(e){return e?(e.cover_rectangle=e.coverRectangle,e.customDomain&&(e.custom_domain={},e.custom_domain.tls=e.customDomain.tls,e.custom_domain.host=e.customDomain.host,e.custom_domain.type=e.customDomain.type,e.custom_domain.key=e.customDomain.key),e.user.customDomain&&(e.user.custom_domain={},e.user.custom_domain.tls=e.user.customDomain.tls,e.user.custom_domain.host=e.user.customDomain.host,e.user.custom_domain.type=e.user.customDomain.type,e.user.custom_domain.key=e.user.customDomain.key),e.subscriptionInfo&&(e.subscription_info={},e.subscription_info.can_advance_purchase=e.subscriptionInfo.canAdvancePurchase,e.subscription_info.payment_date=e.subscriptionInfo.paymentDate,e.subscription_info.payment_date_carrier=e.subscriptionInfo.paymentDateCarrier,e.subscription_info.renewal_date=e.subscriptionInfo.renewalDate,e.subscription_info.reserved_end_date=e.subscriptionInfo.reservedEndDate,e.subscription_info.reserved_price=e.subscriptionInfo.reservedPrice,e.subscription_info.reserved_start_date=e.subscriptionInfo.reservedStartDate,e.subscription_info.conveniences=e.subscriptionInfo.conveniences),e.hasCoupon&&(e.has_coupon=e.hasCoupon),e.isOneshotSubscribeMagazine?e.is_oneshot_subscribe_magazine=e.isOneshotSubscribeMagazine:void 0):void 0},e.prototype.isCurrentTabFor=function(e){return this.AuthorContextServive.isCurrentTabFor(e)},e.prototype.nedNote=function(){return this.AuthorContextServive.changeCurrentTab(this.AuthorContextServive.HOME_MENU)},e.prototype.isMySelf=function(){return this.currentUser?this.urlname===this.currentUser.urlname:!1},e.prototype.onChangeNoteArchives=function(){return this.AuthorContextServive.loadNotesByArchive()},e.prototype.paging=function(){return this.AuthorContextServive.paging()},e.prototype.magazineDescTruncateLen=function(){return this.isCurrentTabFor("magazine")?100:60},e.prototype.callbackMenu=function(e){return this.AuthorContextServive.changeCurrentTab(e)},e}(),angular.module("noteApp").directive("authorContents",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/authors/contents",controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l){this.$rootScope=e,this.$scope=t,this.$state=n,this.$window=r,this.SlickContextSercice=i,this.Author=a,this.ChildNotes=o,this.$q=s,this.AdManageService=l,this.isPC=this.$rootScope.isPC,this.setupAd(),this.urlname=this.$state.params.urlname,this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.links={},this.notes=[],this.firstCardNote=null,this.page=1,this.isLastPage=!0,this.Author.get({urlname:this.urlname},function(e){return function(t){var n,r,i,a;for(e.author=t.data,a=e.author.authorLinks,r=0,i=a.length;i>r;r++)n=a[r],e.links[n.kind]=n.url;return e.authorLoaded=!0,e.fetchNotes()}}(this),function(){return function(e){return console.error(e)}}(this))}return e.injects=["$rootScope","$scope","$state","$window","SlickContextSercice","Author","ChildNotes","$q","AdManageService"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4703502"),this.AdManageService.addTarget("cci","4703505"),this.AdManageService.addTarget("cci","4703504"),this.AdManageService.addTarget("cci","4703503"),this.AdManageService.addTarget("cci","4752951"),this.AdManageService.addTarget("cci","4752953")):(this.AdManageService.addTarget("cci","4703531"),this.AdManageService.addTarget("cci","4703528"),this.AdManageService.addTarget("cci","4703529"),this.AdManageService.addTarget("cci","4703530"),this.AdManageService.addTarget("cci","4752968"),this.AdManageService.addTarget("cci","4752967"))},e.prototype.fetchNotes=function(e){return null==e&&(e=null),this.ChildNotes.get({parent_type:"Author",parent_id:this.author.id,page:this.page,per:this.$window.PREFETCH.NOTE.author_note_per},function(t){return function(n){var r,i,a,o;for(o=n.data.notes,i=0,a=o.length;a>i;i++)r=o[i],t.notes.push(r);return t.firstCardNote||(t.firstCardNote=t.notes[0]),t.isLastPage=n.data.isLastPage,e?e.resolve():void 0}}(this),function(){return function(t){return console.error(t),e?e.reject(t):void 0}}(this))},e.prototype.toDate=function(e){return new Date(e)},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.isLastPage?void 0:(this.page++,this.fetchNotes(e),e.promise)},e}(),angular.module("noteApp").directive("authorDetail",function(){return{restrict:"E",templateUrl:"/templates/asp/authors/detail",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s){this.$rootScope=e,this.$scope=t,this.$state=n,this.SlickContextSercice=r,this.Authors=i,this.$http=a,this.$q=o,this.AdManageService=s,this.isPC=this.$rootScope.isPC,this.setupAd(),this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.Authors.get({per:24},function(e){return function(t){return e.authors=t.data.authors,e.nextUrl=t.data.nextUrl}}(this),function(){return function(e){return console.error(e)}}(this))}return e.injects=["$rootScope","$scope","$state","SlickContextSercice","Authors","$http","$q","AdManageService"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4703502"),this.AdManageService.addTarget("cci","4703505"),this.AdManageService.addTarget("cci","4703504"),this.AdManageService.addTarget("cci","4703503"),this.AdManageService.addTarget("cci","4752952"),this.AdManageService.addTarget("cci","4752951"),this.AdManageService.addTarget("cci","4752953"),this.AdManageService.addTarget("cci","4774711")):(this.AdManageService.addTarget("cci","4703531"),this.AdManageService.addTarget("cci","4703528"),this.AdManageService.addTarget("cci","4703529"),this.AdManageService.addTarget("cci","4703530"),this.AdManageService.addTarget("cci","4752969"),this.AdManageService.addTarget("cci","4752968"),this.AdManageService.addTarget("cci","4752967"),this.AdManageService.addTarget("cci","4774719"))},e.prototype.toDate=function(e){return new Date(e)},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.nextUrl?(this.$http.get(this.nextUrl).then(function(t){return function(n){var r,i,a,o;for(o=n.data.data.authors,i=0,a=o.length;a>i;i++)r=o[i],t.authors.push(r);return t.nextUrl=n.data.data.nextUrl,e.resolve()}}(this)),e.promise):void 0},e}(),angular.module("noteApp").directive("authorIndex",function(){return{restrict:"E",templateUrl:"/templates/asp/authors/index",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.AuthorContextServive=t,this.MessageModal=n,this.$window=r,this.AuthorContextServive.get().then(function(e){return function(t){return e.ctx=t,e.author=e.ctx.author,e.currentUser=e.ctx.user}}(this))}return e.INJECTS=["$scope","AuthorContextServive","MessageModal","$window"],e.prototype.onCreateMagazine=function(){return this.MessageModal.show({message:"\u30de\u30ac\u30b8\u30f3\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f"}),this.$window.location.reload()},e}(),angular.module("noteApp").directive("authorMagazines",function(){return{templateUrl:"/templates/asp/authors/magazines",restrict:"E",scope:{},controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$state=e,this.$scope=t,this.CreatorCustomMenus=n,this.AuthorContextServive=r,this.AuthorContextServive.get().then(function(e){return function(t){return e.ctx=t,e.urlname=e.ctx.author.urlname,e.setupMenus()}}(this)),this.activeMenu=this.AuthorContextServive.HOME_MENU,"creator_top"===this.via&&this.$scope.$on("$stateChangeSuccess",function(e){return function(){return e.activeMenu=e.selectActiveMenu(),e.AuthorContextServive.changeCurrentTab(e.activeMenu)}}(this))}return e.INJECTS=["$state","$scope","CreatorCustomMenus","AuthorContextServive"],e.prototype.setupMenus=function(){return this.CreatorCustomMenus.get({urlname:this.urlname},function(e){return function(t){var n,r,i,a;for(e.menus=[].concat(e.defaultMenus()),a=t.data,r=0,i=a.length;i>r;r++)n=a[r],e.menus.push(n);return e.activeMenu=e.selectActiveMenu(),"creator_top"===e.via?e.AuthorContextServive.changeCurrentTab(e.selectActiveMenu()):void 0}}(this),function(){return function(e){return console.log(e)}}(this))},e.prototype.defaultMenus=function(){return[this.AuthorContextServive.HOME_MENU,this.AuthorContextServive.MAGAZINE_MENU]},e.prototype.getActiveMenuKind=function(e){return"creator.home"===e||"cdCreator.home"===e?"home":"creator.magazines"===e||"cdCreator.magazines"===e?"magazine":"creator.menu"===e||"cdCreator.menu"===e?"menu":"search"},e.prototype.selectActiveMenu=function(){var e,t,n;return(t=this.$state.params.current_menu_id)?this.findMenu(t):(e=this.getActiveMenuKind(this.$state.current.name),"home"===e?this.AuthorContextServive.HOME_MENU:"magazine"===e?this.AuthorContextServive.MAGAZINE_MENU:"menu"===e?(n=this.$state.params.menu_id,this.findMenu(n)):"search"===e?this.AuthorContextServive.SEARCH_MENU:void 0)},e.prototype.isActiveMenu=function(e){return this.activeMenu.id===e.id},e.prototype.clickSearch=function(){return this.AuthorContextServive.changeCurrentTab(this.AuthorContextServive.SEARCH_MENU)},e.prototype.findMenu=function(e){var t,n,r,i;for(i=this.menus,n=0,r=i.length;r>n;n++)if(t=i[n],t.id===Number(e))return t;return null},e}(),angular.module("noteApp").directive("authorMenus",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/authors/menus",controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{via:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t){this.AuthorContextServive=t,this.AuthorContextServive.get().then(function(e){return function(t){return e.ctx=t,e.currentUser=e.ctx.user}}(this))}return e.INJECTS=["$scope","AuthorContextServive"],e}(),angular.module("noteApp").directive("authorNote",function(){return{templateUrl:"/templates/asp/authors/note",restrict:"E",scope:{},controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",enablePin:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m){this.$state=e,this.$scope=t,this.$upload=n,this.$filter=r,this.$timeout=i,this.$q=a,this.$window=o,this.Creators=s,this.MessageModal=l,this.Images=c,this.$rootScope=u,this.CustomDomainContext=d,this.CropperModalService=p,this.Title=h,this.AuthorContextServive=m,m.get().then(function(e){return function(t){return e.ctx=t,e.loadCreator()}}(this)),this.initProps(),this.setCallbacks()}return e.INJECTS=["$state","$scope","$upload","$filter","$timeout","$q","$window","Creators","MessageModal","Images","$rootScope","CustomDomainContext","CropperModalService","Title","AuthorContextServive"],e.prototype.initProps=function(){return this.isCdAccess=this.CustomDomainContext.isCdAccess(),this.urlname=this.isCdAccess?this.CustomDomainContext.key:this.$state.params.urlname,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.tempUpdateParams=this.defaultTempUpdateParams(),this.isSaving=!1,this.creator={nickname:"",profile:""},this.isPc=this.$rootScope.isPC,this.isSmartPhone=this.$rootScope.isSmartPhone,this.$rootScope.urlname_for_message=this.urlname,this.$rootScope.urlname_for_tokusyo=this.urlname},e.prototype.defaultTempUpdateParams=function(){return{images:{header:{url:null,key:null,isDelete:!1},profile:{url:null,key:null}},nickname:null,profile:null}},e.prototype.setCallbacks=function(){var e;return e=this,this.$scope.$on("$UserFollowToggle",function(){return e.creator.isFollowing=!e.creator.isFollowing,e.creator.isFollowing?e.creator.followerCount++:e.creator.followerCount--})},e.prototype.loadCreator=function(){return this.creator=this.ctx.author,this.Title.set(this.creator.nickname),this.snakizeCreatorProperties(this.creator),this.tempUpdateParams.nickname=this.creator.nickname,this.tempUpdateParams.profile=this.creator.profile},e.prototype.snakizeCreatorProperties=function(e){return e.is_following=e.isFollowing,e.user_profile_image_path=e.profileImageUrl},e.prototype.onChangeDisplayMode=function(e){return this.$rootScope.$broadcast("$SwitchDisplayMode",e)},e.prototype.headerImage=function(){return this.tempUpdateParams.images.header.isDelete?null:this.tempUpdateParams.images.header.url?this.tempUpdateParams.images.header.url:this.creator.headerImageUrl},e.prototype.profileImage=function(){return this.tempUpdateParams.images.profile.url?this.tempUpdateParams.images.profile.url:this.creator.profileImageUrl},e.prototype.onCancelProfile=function(){var e;return e=this,this.$timeout(function(){return e.tempUpdateParams=e.defaultTempUpdateParams(),e.tempUpdateParams.nickname=e.creator.nickname,e.tempUpdateParams.profile=e.creator.profile,e.onChangeDisplayMode("view")})},e.prototype.onUploadImage=function(e){"header"===e?this.$rootScope.isPC&&!this.$rootScope.isIE?this.CropperModalService.getFile("creator-header").then(function(t){return function(n){var r;return t.cropData=n.cropData,r=new Blob([t.CropperModalService.base64ToBinary(n.result.cropped)],{type:n.result.mime,encoding:"utf-8"}),t.uploadImage(e,r,n)}}(this)):(angular.element("#header-select-file").click(),this.tempUpdateParams.images.header.isDelete=!1):"profile"===e&&(this.$rootScope.isPC&&!this.$rootScope.isIE?this.CropperModalService.getFile("profile").then(function(t){return function(n){var r;return r=new Blob([t.CropperModalService.base64ToBinary(n.result.cropped)],{type:n.result.mime,encoding:"utf-8"}),t.uploadImage(e,r,n)}}(this)):angular.element("#profile-select-file").click())},e.prototype.onFileSelect=function(e,t){var n;if(e&&0!==e.length)return n=e[e.length-1],n.size>5242880?this.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u306f5MB\u4ee5\u4e0b\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}):this.uploadImage(t,n)},e.prototype.onDeleteImage=function(e){return"header"===e?(this.tempUpdateParams.images.header.resource=null,this.tempUpdateParams.images.header.file=null,this.tempUpdateParams.images.header.isDelete=!0):void 0},e.prototype.uploadImage=function(e,t,n){var r;return r={url:"/api/v2/images",data:{kind:"tmp_"+e}},$.extend(!0,r,t instanceof File?{data:{file:t}}:{fileName:n.result.name,file:t,data:{width:n.cropData.width,height:n.cropData.height,x:n.cropData.x,y:n.cropData.y}}),this.$upload.upload(r).success(function(t){return function(n){return t.$timeout(function(){return"header"===e?(t.tempUpdateParams.images.header.url=n.data.url,t.tempUpdateParams.images.header.key=n.data.key,t.tempUpdateParams.images.header.isDelete=!1):(t.tempUpdateParams.images.profile.url=n.data.url,t.tempUpdateParams.images.profile.key=n.data.key)})}}(this)).error(function(e){return function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u753b\u50cf\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"})}}(this))},e.prototype.imageDeletePromiss=function(e){var t,n;return t=this.$q.defer(),n="header"===e?this.creator.headerImageKey||this.tempUpdateParams.images.header.key:this.creator.profileImageKey||this.tempUpdateParams.images.profile.key,this.Images["delete"]({key:n},function(n){return function(){return"header"===e?(n.creator.headerImageUrl=null,n.creator.headerImageKey=null):(n.creator.profileImageUrl=null,n.creator.profileImageKey=null),t.resolve()}}(this),function(e){return function(){return e.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30e6\u30fc\u30b6\u60c5\u5831\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"}),e.isSaving=!1,t.reject()}}(this)),t.promise},e.prototype.creatorUpdatePromiss=function(){var e,t,n,r,i,a;return n=this.creator.nickname!==this.tempUpdateParams.nickname?this.tempUpdateParams.nickname:void 0,i=this.creator.profile!==this.tempUpdateParams.profile?this.tempUpdateParams.profile:void 0,t=this.tempUpdateParams.images.header.isDelete?void 0:this.tempUpdateParams.images.header.key,a=this.tempUpdateParams.images.profile.key?this.tempUpdateParams.images.profile.key:void 0,e=this.$q.defer(),r={urlname:this.urlname,nickname:n,profile:i,tmp_header_image_key:t,tmp_profile_image_key:a},this.$rootScope.isPC&&!this.$rootScope.isIE&&this.cropData&&(r.crop_data={width:this.cropData.width,height:this.cropData.height,x:this.cropData.x,y:this.cropData.y}),this.Creators.update(r,function(){return function(){return e.resolve()
}}(this),function(t){return function(){return t.MessageModal.show({title:"\u30a8\u30e9\u30fc",message:"\u30e6\u30fc\u30b6\u60c5\u5831\u306e\u66f4\u65b0\u51e6\u7406\u306b\u3066\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u6642\u9593\u3092\u7a7a\u3051\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"}),t.isSaving=!1,e.reject()}}(this)),e.promise},e.prototype.onSaveProfile=function(){var e;return this.isSaving=!0,e=[],this.tempUpdateParams.images.header.isDelete&&e.push(this.imageDeletePromiss("header")),e.push(this.creatorUpdatePromiss()),e.length>0?this.$q.all(e).then(function(e){return function(){return e.$window.location.reload()}}(this)):(this.onChangeDisplayMode("view"),void(this.isSaving=!1))},e}(),angular.module("noteApp").directive("authorProfile",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/authors/profile",controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){this.$scope=e,this.$rootScope=t,this.Popeye=n,this.$resource=r,this.CreatorPinnedContents=i,this.MessageModal=a,this.$q=o,this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.isSmartPhone=this.$rootScope.isSmartPhone,this.isTablet=this.$rootScope.isTablet}return e.INJECTS=["$scope","$rootScope","Popeye","$resource","CreatorPinnedContents","MessageModal","$q"],e.prototype.deleteNote=function(e){var t,n;return n=this,t=this.Popeye.openModal({templateUrl:"/templates/modal/note_delete_confirm",controller:["$scope",function(r){return r.ok=function(){return n.$resource("/api/v1/notes/"+e.id)["delete"]({},function(){return n.$rootScope.$broadcast("$CreatorTopContensDelete",e),t.close()},function(){return console.log("Error occurred")})},r.cancel=function(){return t.close()}}]})},e.prototype.pinnedNote=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorPinnedContents.save({urlname:t.user.urlname,content_type:"Note",content_id:t.note.id},function(){return t.pinnedNoteCallback({target:t.note}),e.resolve()},function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},this.MessageModal.confirm({title:"\u30ce\u30fc\u30c8\u3092\u5148\u982d\u306b\u56fa\u5b9a\u3059\u308b",message:"\u3053\u306e\u30ce\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u30ce\u30fc\u30c8\u3092\u56fa\u5b9a\u3057\u307e\u3057\u305f",process:e})},e.prototype.unPinnedNote=function(){var e,t;return t=this,e=function(){var e;return e=t.$q.defer(),t.CreatorPinnedContents["delete"]({urlname:t.user.urlname,id:t.note.pinnedUserNoteId},function(){return t.pinnedNoteCallback({target:t.note}),e.resolve()},function(){return e.reject({message:res.data.error||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002"})}),e.promise},this.MessageModal.confirm({title:"\u56fa\u5b9a\u3057\u305f\u30ce\u30fc\u30c8\u3092\u89e3\u9664\u3059\u308b",message:"\u3053\u306e\u30ce\u30fc\u30c8\u306e\u56fa\u5b9a\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f",doneMessage:"\u30ce\u30fc\u30c8\u306e\u56fa\u5b9a\u3092\u89e3\u9664\u3057\u307e\u3057\u305f",process:e})},e}(),angular.module("noteApp").directive("authorTimelineActions",function(){return{templateUrl:"/templates/asp/authors/timeline_actions",restrict:"E",scope:{},controller:t.call(e.INJECTS).concat([e]),controllerAs:"$ctrl",bindToController:{note:"=",user:"=",pinnedNoteCallback:"&"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$state=e,this.$scope=t,this.Creators=n,this.AuthorContextServive=r,this.Title=i,this.urlname=this.$state.params.urlname,this.AuthorContextServive.init(this.urlname),this.currentUser=window.PREFETCH.NOTE.user,0===Object.keys(this.currentUser).length&&(this.currentUser=null),this.AuthorContextServive.get().then(function(e){return function(t){return e.ctx=t,e.creator=e.ctx.author,e.Title.set(e.creator.nickname)}}(this),function(){return function(e){return console.log(e)}}(this)),this.displayMode="view",this.setCallbacks()}return e.inject=["$state","$scope","Creators","AuthorContextServive","Title"],e.prototype.setCallbacks=function(){return this.$scope.$on("$SwitchDisplayMode",function(e){return function(t,n){var r,i;return e.ctx.displayMode=n,i=angular.element(".renewal-l-header"),r=angular.element(".footer"),"edit"===n?(i.hide(),r.hide()):(i.show(),r.show())}}(this))},e.prototype.snakizeCreatorProperties=function(e){return e.is_following=e.isFollowing,e.user_profile_image_path=e.profileImageUrl},e}(),angular.module("noteApp").directive("authorTop",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/authors/detail",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e;angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/breadCrumbsInUiView.html",'<div class="breadcrumb">\n  <ul ng-if="$ctrl.breadCrumbs.length > 1">\n    <li ng-repeat="breadCrumb in $ctrl.breadCrumbs" style="display: inline-block;">\n      <a class="breadcrumb-item home" ng-if="breadCrumb.path == \'/\'" ng-href="{{breadCrumb.path}}"></a>\n      <a class="breadcrumb-item" ng-if="breadCrumb.path && breadCrumb.path != \'/\'" ng-href="{{breadCrumb.path}}">{{breadCrumb.label}}</a>\n      <span class="breadcrumb-item" ng-if="breadCrumb.path == null && breadCrumb.label != \'Top\'">{{breadCrumb.label}}</span>\n    </li>\n  </ul>\n</div>')}]),e=function(){function e(e,t,n,r,i,a,o,s){var l;this.$scope=e,this.$state=t,this.BreadCrumbsService=n,this.rootScope=r,this.$timeout=i,this.$sce=a,this.$q=o,this.$window=s,l=this,this.breadCrumbs=[],this.getBreadCrumbData(this.$state.current,this.$state.params)}return e.$inject=["$scope","$state","BreadCrumbsService","$rootScope","$timeout","$sce","$q","$window"],e.prototype.getBreadCrumbData=function(e,t){return this.$q(function(n){return function(r,i){var a,o,s,l;return o=n.$state.href(e.name,t),s=e.name.split("."),l="static"===s[0]&&s.length>1?s.slice(1,s.length).join("_"):s.join("_"),"search"===l?(n.breadCrumbs=[{label:"Top",path:"/"},{label:t.q?n.$sce.trustAsHtml(t.q):"\u691c\u7d22"}],r()):(a={state:l,state_params:n.stateParams(l,t)},o&&-1!==n.$window.PREFETCH.staticPage.paths.indexOf(o)&&(a.path=o),n.BreadCrumbsService.get(a,function(e){var t;return"hashtag_detail"===l&&e.data.breadCrumbs.length>1?(t=e.data.breadCrumbs[e.data.breadCrumbs.length-1],n.breadCrumbs=[{label:"Top",path:"/"},{label:"#"+t.label,path:null}]):n.breadCrumbs=e.data.breadCrumbs,r()},function(){return i()}))}}(this))},e.prototype.stateParams=function(e,t){switch(e){case"author_detail":return{urlname:t.urlname};case"hashtag_detail":return{name:t.hashtag};case"magazine_detail":return{key:t.key};case"category_detail":return{category:t.category};case"article_detail":return{slug:t.slug};default:return{}}},e}(),angular.module("noteApp").directive("breadCrumbsInUiView",function(){return{restrict:"E",scope:{},replace:!0,templateUrl:"common/renewal/breadCrumbsInUiView.html",controller:e,controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s){this.$rootScope=e,this.$scope=t,this.$state=n,this.$window=r,this.CategoryRelatedNotes=i,this.SlickContextSercice=a,this.$q=o,this.AdManageService=s,this.isPC=this.$rootScope.isPC,this.setupAd(),this.category=null,this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.loading=!1,this.relatedNotes=[],this.page=1,this.isLastPage=!0,this.firstCardBundleKey="first_card_category_"+this.$state.params.category,this.rankingFilter="category:eng_name:"+this.$state.params.category,this.fetchCategoryRelatedNotes()}return e.injects=["$rootScope","$scope","$state","$window","CategoryRelatedNotes","SlickContextSercice","$q","AdManageService"],e.prototype.setupAd=function(){switch(this.$state.params.category){case"fashion":return this.isPC?(this.AdManageService.addTarget("cci","4703488"),this.AdManageService.addTarget("cci","4703486"),this.AdManageService.addTarget("cci","4703487"),this.AdManageService.addTarget("cci","4703489")):(this.AdManageService.addTarget("cci","4703514"),this.AdManageService.addTarget("cci","4703512"),this.AdManageService.addTarget("cci","4703515"),this.AdManageService.addTarget("cci","4703513"));case"beauty":return this.isPC?(this.AdManageService.addTarget("cci","4703492"),this.AdManageService.addTarget("cci","4703491"),this.AdManageService.addTarget("cci","4703490"),this.AdManageService.addTarget("cci","4703493")):(this.AdManageService.addTarget("cci","4703518"),this.AdManageService.addTarget("cci","4703519"),this.AdManageService.addTarget("cci","4703517"),this.AdManageService.addTarget("cci","4703516"));case"lifestyle":return this.isPC?(this.AdManageService.addTarget("cci","4703494"),this.AdManageService.addTarget("cci","4703495"),this.AdManageService.addTarget("cci","4703496"),this.AdManageService.addTarget("cci","4703497"),this.AdManageService.addTarget("cci","4752943"),this.AdManageService.addTarget("cci","4752942"),this.AdManageService.addTarget("cci","4752944"),this.AdManageService.addTarget("cci","4774709")):(this.AdManageService.addTarget("cci","4703522"),this.AdManageService.addTarget("cci","4703521"),this.AdManageService.addTarget("cci","4703520"),this.AdManageService.addTarget("cci","4703523"),this.AdManageService.addTarget("cci","4752974"),this.AdManageService.addTarget("cci","4752975"),this.AdManageService.addTarget("cci","4752973"),this.AdManageService.addTarget("cci","4774717"));case"work":return this.isPC?(this.AdManageService.addTarget("cci","4703499"),this.AdManageService.addTarget("cci","4703498"),this.AdManageService.addTarget("cci","4703500"),this.AdManageService.addTarget("cci","4703501")):(this.AdManageService.addTarget("cci","4703525"),this.AdManageService.addTarget("cci","4703527"),this.AdManageService.addTarget("cci","4703524"),this.AdManageService.addTarget("cci","4703526"));case"person":return this.isPC?(this.AdManageService.addTarget("cci","4752930"),this.AdManageService.addTarget("cci","4752931"),this.AdManageService.addTarget("cci","4752932"),this.AdManageService.addTarget("cci","4774712")):(this.AdManageService.addTarget("cci","4752959"),this.AdManageService.addTarget("cci","4752958"),this.AdManageService.addTarget("cci","4752960"),this.AdManageService.addTarget("cci","4774720"));case"watch":return this.isPC?(this.AdManageService.addTarget("cci","4752933"),this.AdManageService.addTarget("cci","4752934"),this.AdManageService.addTarget("cci","4752935"),this.AdManageService.addTarget("cci","4774715")):(this.AdManageService.addTarget("cci","4752963"),this.AdManageService.addTarget("cci","4752961"),this.AdManageService.addTarget("cci","4752962"),this.AdManageService.addTarget("cci","4774723"));case"restaurant":return this.isPC?(this.AdManageService.addTarget("cci","4752936"),this.AdManageService.addTarget("cci","4752937"),this.AdManageService.addTarget("cci","4752938"),this.AdManageService.addTarget("cci","4774713")):(this.AdManageService.addTarget("cci","4752964"),this.AdManageService.addTarget("cci","4752965"),this.AdManageService.addTarget("cci","4752966"),this.AdManageService.addTarget("cci","4774721"));case"bodymake":return this.isPC?(this.AdManageService.addTarget("cci","4752941"),this.AdManageService.addTarget("cci","4752940"),this.AdManageService.addTarget("cci","4752939"),this.AdManageService.addTarget("cci","4774708")):(this.AdManageService.addTarget("cci","4752976"),this.AdManageService.addTarget("cci","4752977"),this.AdManageService.addTarget("cci","4752978"),this.AdManageService.addTarget("cci","4774716"));case"love":return this.isPC?(this.AdManageService.addTarget("cci","4752947"),this.AdManageService.addTarget("cci","4752949"),this.AdManageService.addTarget("cci","4752948"),this.AdManageService.addTarget("cci","4774710")):(this.AdManageService.addTarget("cci","4752972"),this.AdManageService.addTarget("cci","4752971"),this.AdManageService.addTarget("cci","4752970"),this.AdManageService.addTarget("cci","4774718"))}},e.prototype.toDate=function(e){return new Date(e)},e.prototype.fetchCategoryRelatedNotes=function(e){return this.CategoryRelatedNotes.get({eng_name:this.$state.params.category,page:this.page,per:this.$window.PREFETCH.NOTE.category_note_per},function(t){return function(n){var r,i,a,o;for(t.category=n.data.category,o=n.data.relatedNotes,i=0,a=o.length;a>i;i++)r=o[i],t.relatedNotes.push(r);return t.isLastPage=n.data.isLastPage,e?e.resolve():void 0}}(this),function(){return function(t){return console.error(t),e?e.reject(t):void 0}}(this))},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.isLastPage?void 0:(this.page++,this.fetchCategoryRelatedNotes(e),e.promise)},e}(),angular.module("noteApp").directive("categoryDetail",function(){return{restrict:"E",templateUrl:"/templates/asp/categories/detail",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$window=e,this.$element=t,this.$http=n,this.setting=angular.element(document.querySelector(".renewal-c-popover--mymenu")),this.target=t.find(".c-avatar.c-avatar--boxShadow"),this.$element.on("click",function(e){return function(t){return t.preventDefault(),e.toggle()}}(this)),this.$element.find("li").on("click","a",function(e){return function(t){return t.stopPropagation(),e.hide()}}(this))}return e.inject=["$window","$element","$http"],e.prototype.toggle=function(){return this.isDisplayed()?this.hide():this.show()},e.prototype.show=function(){var e,t,n;return t=angular.element(this.$window.document.body),n=angular.element(this.$window.document.documentElement),t.addClass("renewal-c-popover--noScroll"),n.addClass("renewal-c-popover--noScroll"),this.setting.css("display","block"),this.target.addClass("is-active"),e=angular.element(this.$window.document),e.on("mouseup",function(e){return function(t){var n;return t.preventDefault(),n=angular.element(t.target),n.hasClass("on-navbar-button")||n.hasClass("nav-bar-notification-read-more")||n.hasClass("is-active")||!e.isDisplayed()?void 0:e.hide()}}(this))},e.prototype.hide=function(){var e,t,n;return t=angular.element(this.$window.document.body),n=angular.element(this.$window.document.documentElement),t.removeClass("renewal-c-popover--noScroll"),n.removeClass("renewal-c-popover--noScroll"),this.setting.css("display","none"),this.target.removeClass("is-active"),e=angular.element(this.$window.document),e.off("mouseup")},e.prototype.isDisplayed=function(){return"none"!==this.setting.css("display")},e.prototype.logout=function(){return this.$http({method:"POST",url:"/api/v1/sessions/sign_out",timeout:3e4}).success(function(e){return function(){return e.$window.location.href="/"}}(this)).error(function(){return console.log("Error occurred")})},e}(),angular.module("noteApp").directive("accountMenu",function(){var n;return n={templateUrl:"/templates/asp/common/account_menu",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{user:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("adMagazine",function(){return{templateUrl:"/templates/asp/common/ad_magazine",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$rootScope=e,this.$scope=t,this.AdManageService=n,this.$timeout=r}return e.inject=["$rootScope","$scope","AdManageService","$timeout"],e.prototype.onTemplateLoaded=function(){return this.AdManageService.addDisplayed(this.kind,this.tagId)},e}(),angular.module("noteApp").directive("adTag",["$compile","$templateRequest",function(n){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{kind:"@",tagId:"@",styleClass:"@"},link:function(e,t){var r;switch(e.$ctrl.kind){case"cci":r="<div id='"+e.$ctrl.tagId+"' />\n<script>\n  if (window.PREFETCH.NOTE.enableAdCci) {\n    ADTECH.config.placements["+e.$ctrl.tagId+"] = {params: { alias: '', target: '_blank' }};\n    ADTECH.enqueueAd("+e.$ctrl.tagId+");\n  }\n</script>";break;case"aja":r="<div data-aja-ad data-aja-asi='"+e.$ctrl.tagId+"' />"}return t.html(r),"cci"===e.$ctrl.kind&&null!=e.$ctrl.styleClass&&t.find("#"+e.$ctrl.tagId).addClass(e.$ctrl.styleClass),n(t.contents())(e),e.$ctrl.onTemplateLoaded()}}}])}.call(this),function(){var e,t=[].slice;e=function(){function e(e,t){this.$interval=e,this.$window=t}return e.inject=["$interval","$window"],e.prototype.attachAnimate=function(e){var t,n;return t="fadein"===this.type?"fadeInUp":void 0,n=this,this.$interval(function(){return e.addClass(t),n.$interval.cancel(this)},1e3,!1)},e}(),angular.module("noteApp").directive("animate",function(){return{restrict:"A",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{type:"@"},scope:{},link:function(e,t){return e.$ctrl.attachAnimate(t)}}})}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("/templates/asp/common/back_top.html",'<a class="smooth" id="backtop" href="#document"><i class="i-caret-up"></i><span>TOP</span></a>')}]),e=function(){function e(){}return e.injects=[],e}(),angular.module("noteApp").directive("backTop",["$window","$interval",function(n,r){return{templateUrl:"/templates/asp/common/back_top.html",restrict:"E",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{},link:function(e,t){return t.on("click",function(e){return e.preventDefault(),$("html, body").animate({scrollTop:0},1e3)}),e.stopInterval=r(function(){return function(){return angular.element("#gnav .inner + category-list .category li").length>0?(angular.element(n).on("scroll.backTop resize.backTop",function(){return e.onScroll()}),r.cancel(e.stopInterval)):void 0}}(this),100),e.onScroll=function(){return function(){var e,t,r;return e=angular.element("#gnav"),t=e.outerHeight(),r=n.pageYOffset,r>t?angular.element("#backtop").addClass("show"):angular.element("#backtop").removeClass("show")}}(this)}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("categoryList",function(){var n;return n={templateUrl:"/templates/asp/common/category_list",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){this.bannerListSlickConfig={slide:".banner-item",arrows:!1,centerPadding:"0",slidesToShow:3,autoplay:!1,responsive:[{breakpoint:640,settings:{slidesToShow:1,variableWidth:!0,centerMode:!0,infinite:!0,autoplay:!0}}]}}return e.inject=[],e}(),angular.module("noteApp").directive("customFooter",function(){var n;return n={templateUrl:"/templates/asp/common/custom_footer",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("customSocialWidget",["$timeout","$filter","Title","$window",function(e,t,n,r){var i;return i={restrict:"E",templateUrl:"/templates/asp/articles/custom_social_widget",scope:{article:"=",pageEl:"="},link:function(e){var t;return t=e.pageEl.find(".share-group"),angular.element(r).on("scroll.customSocialWidget",function(){return function(){var n;return n=e.pageEl.find(".note-body")[0],n&&inViewport(n)?t.addClass("show").removeClass("hide"):t.addClass("hide").removeClass("show")}}(this)),e.$on("$destroy",function(){return angular.element(r).off("scroll.customSocialWidget")})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("hotKeywords",function(){return{templateUrl:"/templates/asp/common/hot_keywords",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e.prototype.toDate=function(e){return new Date(e)},e}(),angular.module("noteApp").directive("innerContent",function(){return{templateUrl:"/templates/asp/common/inner_content",restrict:"E",scope:{},bindToController:{content:"=",contentImage:"=",contentType:"@",disableNewTag:"=",params:"="},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.Popeye=t,this.$location=n}return e.inject=["$state","Popeye","$location"],e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:this.$location.path()}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.$location.path(),this.$state.go("login",{redirectPath:e}),this.dismiss()},e}(),angular.module("noteApp").directive("loginRequest",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{note:"="},templateUrl:"/templates/asp/common/login_request",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.Popeye=e,this.$state=t,this.$analytics=n,this.CurrentUserAPI=r,this.PurchaseService=i}return e.inject=["Popeye","$state","$analytics","CurrentUserAPI","PurchaseService"],e.prototype.open=function(){return this.canOpenModal()?this.CurrentUserAPI.get({additionals:!0},function(e){return function(t){return e.currentUser=t.error?null:t.data,e.Popeye.openModal({templateUrl:"/templates/asp/common/login_required_modal",controller:["$scope",function(t){return t.creator=e.creator,t.currentUser=e.currentUser,t.purchaseType=e.purchaseType,t.content=e.content,t.viaContentType=e.viaContentType,t.viaContent=e.viaContent,t.close=function(){return e.Popeye.closeCurrentModal()}}]})}}(this),function(e){return console.log(e)}):void 0},e.prototype.canOpenModal=function(){return"subscribe_magazine"!==this.purchaseType||!this.content.is_pre_suspended||confirm("\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f"+this.content.suspended_at+"\u306b\u505c\u6b62\u3057\u307e\u3059\u3002\u305d\u308c\u3067\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")?"support"===this.purchaseType&&"Note"===this.viaContentType&&this.viaContent.is_my_note?(alert("\u81ea\u5206\u306b\u5bfe\u3057\u3066\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002"),!1):!0:void 0},e}(),angular.module("noteApp").directive("loginRequiredModal",function(){return{restrict:"A",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{purchaseType:"@",creator:"=",content:"=",viaContentType:"@",viaContent:"="},scope:{},link:function(e,t){return t.on("click",function(){return e.$ctrl.open()})}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i){this.$window=e,this.$state=t,this.MyCreditCard=n,this.Popeye=r,this.GMOTokenAuth=i,this.initProps()}return e.inject=["$window","$state","MyCreditCard","Popeye","GMOTokenAuth"],e.prototype.initProps=function(){var e,t;return this.months=[1,2,3,4,5,6,7,8,9,10,11,12],e=(new Date).getFullYear(),this.years=function(){t=[];for(var n=e,r=e+10;r>=e?r>=n:n>=r;r>=e?n++:n--)t.push(n);return t}.apply(this),this.creditCard={},this.errorMsgs=[],this.isUpdating=!1,this.viewMode="input"},e.prototype.saveCreditcard=function(){return this.isUpdating=!0,this.$window.PREFETCH.NOTE.enable_gmo_token_auth?this.newSaveCreditToken():this.oldSaveCreditToken()},e.prototype.newSaveCreditToken=function(){var e;return e=new this.MyCreditCard,e.number="000000000000"+this.creditCard.number.substr(-4,4),e.expiryMonth=this.creditCard.expiryMonth,e.expiryYear=this.creditCard.expiryYear,e.name=this.creditCard.name,this.GMOTokenAuth.getToken(this.creditCard.number,this.creditCard.expiryYear.toString()+(this.creditCard.expiryMonth<10?"0"+this.creditCard.expiryMonth.toString():this.creditCard.expiryMonth.toString()),this.creditCard.cvc,this.creditCard.name,function(t){return function(n){return e.token=n.tokenObject.token,e.$save(null,function(e){return t.isUpdating=!1,t.currentUser.can_checkout=!0,t.callbackSaved?t.callbackSaved({creditCard:e}):void 0},function(e){return console.log(e),t.isUpdating=!1,t.errorMsg=e.data.error})}}(this))},e.prototype.oldSaveCreditToken=function(){return this.MyCreditCard.save(this.creditCard,function(e){return function(){return e.isUpdating=!1,e.currentUser.can_checkout=!0,e.callbackSaved?e.callbackSaved({creditCard:e.creditCard}):void 0}}(this),function(e){return function(t){return console.log(t),e.isUpdating=!1,e.errorMsg=t.data.error}}(this))},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.showInput=function(){return this.viewMode="input"},e.prototype.onPurchase=function(){return this.callbackSaved?this.callbackSaved({paymentMethod:"creditcard"}):void 0},e}(),angular.module("noteApp").directive("aspPurchaseCreditCardInput",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"=",callbackSaved:"&",callbackCancel:"&",paymentContext:"@"},templateUrl:"/templates/asp/common/modals/purchase_credit_card_input",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.$location=l,this.AfterActionModal=c,this.PurchaseRightsApply=u,this.MyCreditCard=d,this.initProps(),this.purchaseRightCode=null,this.purchaseRightCodeApproved=this.magazine.is_purchase_right_approved,this.purchaseRightCodeError=null}return e.inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","$location","AfterActionModal","PurchaseRightsApply","MyCreditCard"],e.prototype.initProps=function(){return this.currentUser?(this.viewMode="initial",this.support={},this.support.amount="",this.support.withSupport=!1,this.support.messageLength=0,this.support.kind="",this.support.text="",this.submitting=!1,this.paymentMethod="creditcard",this.errorMessage=null,this.MyCreditCard.get(null,function(e){return function(t){return e.creditCard=t.data}}(this))):this.viewMode="nologin"},e.prototype.setViewMode=function(e){return this.viewMode=e},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal(),"complete"===this.viewMode?this.$state.go(this.$state.current.name,this.$state.params,{reload:!0}):void 0},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/"+this.magazine.user.urlname+"/m/"+this.magazine.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl():this.$location.path(),e+="?modal=support",this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.changeSupportKind=function(e){return this.support.kind=e},e.prototype.showSelectPeyment=function(){var e;return this.support.withSupport&&(e=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),e.errorMessage)?void(this.errorMessage=e.errorMessage):this.viewMode="select_payment_method"},e.prototype.callbackConfirm=function(e){return this.creditCard=e,this.setViewMode("confirm")},e.prototype.goToMagazineHome=function(){return this.CustomDomainContext.isCdAccess()&&"magazine"===this.CustomDomainContext.type&&this.CustomDomainContext.key===this.magazine.key?this.$state.go("cdMagazine.home",{},{reload:!0}):this.ContentLink.go("magazine",this.magazine,{reload:!0})},e.prototype.showCreditcardInput=function(){return this.setViewMode("creditcard")},e.prototype.submit=function(){var e;return e={magazine_key:this.magazine.key,check_price:this.magazine.price,payment_method:this.paymentMethod},this.support.withSupport&&(e.support_price=this.support.price,e.message=this.support.text,e.via_content_type="Magazine",e.via_content_id=this.magazine.id),this.PurchaseService.isCarrierPaymentMethod(this.paymentMethod)&&(e.return_domain=""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),e.return_url=location.href),this.submitting=!0,this.PurchaseService.purchaseMagazine(e,this.support.withSupport).then(function(e){return function(t){var n;if(!t.error||(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),!e.errorMessage))switch(e.paymentMethod){case"creditcard":return t.error?(e.errorMessage="payment_error_message"===(n=t.error.code)||"suspended"===n||"blocked"===n?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002",void(e.submitting=!1)):(e.submitting=!1,e.viewMode="complete")}}}(this))},e.prototype.apllyPurchaseRightCode=function(){return this.PurchaseRightsApply.save({id:this.magazine.purchase_right.id,code:this.purchaseRightCode,content_type:"Magazine",content_id:this.magazine.id},function(e){return function(){return e.purchaseRightCodeApproved=!0,e.magazine.is_purchase_right_approved,e.purchaseRightCodeError=null}}(this),function(e){return function(t){return e.purchaseRightCodeError=t.data.data,e.purchaseRightCodeError?void 0:e.purchaseRightCodeError="\u4e88\u671f\u305b\u306c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}}(this))},e}(),angular.module("noteApp").directive("aspPurchaseMagazine",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",magazine:"="},templateUrl:"/templates/asp/common/modals/purchase_magazine",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.$location=l,this.GuestPurchase=c,this.$window=u,this.$analytics=d,this.PurchaseRightsApply=p,this.AfterActionModal=h,this.MyCreditCard=m,this.initProps()}return e.inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","$location","GuestPurchase","$window","$analytics","PurchaseRightsApply","AfterActionModal","MyCreditCard"],e.prototype.initProps=function(){return this.currentUser?(this.support={},this.support.amount="",this.support.withSupport=!1,this.support.messageLength=0,this.support.kind="",this.support.text="",this.submitting=!1,this.errorMessage=null,this.viewMode="initial",this.paymentMethod="creditcard",this.defaultPaymentMethod="creditcard",this.snakizeCreatorProperties(this.note.user),this.appMode=this.$window.PREFETCH.NOTE.mode,this.freeBodyLastName=null,this.scrollToPaywall&&"TextNote"===this.note.type&&angular.element(".note-body .body-wrapper p").last()&&(this.freeBodyLastName=angular.element(".note-body .body-wrapper p").last().attr("name")),this.purchaseRightCode=null,this.purchaseRightCodeApproved=this.note.is_purchase_right_approved,this.purchaseRightCodeError=null,this.MyCreditCard.get(null,function(e){return function(t){return e.creditCard=t.data}}(this))):void(this.viewMode="nologin")},e.prototype.snakizeCreatorProperties=function(e){return e.custom_domain=e.customDomain?e.customDomain:e.custom_domain,e.disable_support=e.disableSupport?e.disableSupport:e.disable_support,e.user_profile_image_path=e.userProfileImagePath?e.userProfileImagePath:e.user_profile_image_path},e.prototype.setViewMode=function(e){return this.viewMode=e},e.prototype.cancelClicked=function(){var e,t;return t="payment",this.$window.confirm("\u672c\u5f53\u306b\u8cfc\u5165\u3092\u4e2d\u6b62\u3057\u307e\u3059\u304b\uff1f")?(e="confirm-cancel-pressed-ok",this.$analytics.eventTrack(e,{category:t,label:e}),this.dismiss()):(e="confirm-cancel-pressed-cancel",void this.$analytics.eventTrack(e,{category:t,label:e}))},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal(),"complete"===this.viewMode?this.$state.go(this.$state.current.name,this.$state.params,{reload:!0}):void 0
},e.prototype.back=function(){return this.setViewMode("initial"),this.errorMessage=null},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/notes/"+this.note.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl()+"/n/"+this.note.key:this.$location.path(),this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.pageToInitial=function(){return this.setViewMode("initial")},e.prototype.showSelectPeyment=function(){var e;return this.support.withSupport&&(e=this.PurchaseService.validateSupportPrice(this.support.kind,this.support.amount),e.errorMessage)?void(this.errorMessage=e.errorMessage):this.setViewMode("select_payment_method")},e.prototype.callbackConfirm=function(e){return this.creditCard=e,this.setViewMode("confirm")},e.prototype.confirmGuest=function(){return this.guestPurchase.error={},this.guestPurchase.cardNumber?-1===this.guestPurchase.cardNumber.search(/^[0-9]+/)&&(this.guestPurchase.error.cardNumberPattern=!0):this.guestPurchase.error.cardNumberRequired=!0,this.guestPurchase.cardCvc?-1===this.guestPurchase.cardCvc.search(/^[0-9]+/)&&(this.guestPurchase.error.cvcNumberPattern=!0):this.guestPurchase.error.cvcNumberRequired=!0,null==this.guestPurchase.email||0===this.guestPurchase.email.trim().length?this.guestPurchase.error.emailRequired=!0:-1===this.guestPurchase.email.search(/^.+@.+\..{2,}$/)&&(this.guestPurchase.error.emailPattern=!0),this.guestPurchase.expiryMonth&&this.guestPurchase.expiryYear||(this.guestPurchase.error.expiryRequired=!0),Object.keys(this.guestPurchase.error).length>0?void 0:this.setViewMode("confirm")},e.prototype.changeSupportKind=function(e){return this.support.kind=e},e.prototype.onClickWithSupport=function(){return this.support.withSupport=!this.support.withSupport,this.support.kind=this.support.withSupport?"s100":null},e.prototype.showCreditcardInput=function(){return this.setViewMode("creditcard")},e.prototype.submit=function(){var e;return e={noteId:this.note.id,check_price:this.note.price,payment_method:this.paymentMethod,is_prior_sale:this.note.prior_sale&&this.note.prior_sale.activated===!0},this.support.withSupport&&(e.support_price=this.support.price,e.message=this.support.text,e.via_content_type="Note",e.via_content_id=this.note.id),this.PurchaseService.isCarrierPaymentMethod(this.paymentMethod)&&(e.return_domain=""+location.protocol+"//"+this.CustomDomainContext.getNoteHost(),e.return_url=location.href),this.submitting=!0,this.PurchaseService.purchaseNote(e,this.support.withSupport).then(function(e){return function(t){var n;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return void(e.errorMessage=t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"payment_error_message"===(n=t.error.code)||"invalid"===n||"blocked"===n||"oneshot_already_bought_by_magazine"===n||"oneshot_already_subscribed"===n||"oneshot_limited"===n?t.error.message:"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}switch(e.paymentMethod){case"creditcard":return e.FacebookPixel.trackPurchase({id:e.note.id,price:e.note.price,type:e.note.type}),e.submitting=!1,e.viewMode="complete"}}}(this))},e.prototype.apllyPurchaseRightCode=function(){return this.PurchaseRightsApply.save({id:this.note.purchase_right.id,code:this.purchaseRightCode,content_type:"Note",content_id:this.note.id},function(e){return function(){return e.purchaseRightCodeApproved=!0,e.purchaseRightCodeError=null}}(this),function(e){return function(t){return e.purchaseRightCodeError=t.data.data,e.purchaseRightCodeError?void 0:e.purchaseRightCodeError="\u4e88\u671f\u305b\u306c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}}(this))},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/"+this.note.category.eng_name+"/"+this.note.slug}),this.dismiss()},e}(),angular.module("noteApp").directive("aspPurchaseNote",function(){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",note:"="},templateUrl:"/templates/asp/common/modals/purchase_note"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$state=e,this.Popeye=t,this.$window=n,this.initProps()}return e.inject=["$state","Popeye","$window"],e.prototype.initProps=function(){return this.viewMode="select",this.paymentMethod="creditcard",this.appMode=this.$window.PREFETCH.NOTE.mode},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal()},e.prototype.selectPaymentMethod=function(e){return this.paymentMethod=e},e.prototype.showCreditcardInput=function(){return this.viewMode="creditcard"},e.prototype.showSelectPeyment=function(){return this.viewMode="select_payment_method"},e.prototype.confirm=function(){return this.execConfirmCallback(this.paymentMethod)},e.prototype.execConfirmCallback=function(e){return this.confirmCallback({paymentMethod:e})},e}(),angular.module("noteApp").directive("aspPurchaseSelectPayment",function(){return{restrict:"E",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{currentUser:"=",confirmCallback:"&",paymentContext:"@"},templateUrl:"/templates/asp/common/modals/purchase_select_payment",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f){this.$state=e,this.Popeye=t,this.$filter=n,this.PurchaseService=r,this.CustomDomainContext=i,this.FacebookPixel=a,this.Cookie=o,this.ContentLink=s,this.MagazineSubscription=l,this.CouponApply=c,this.MagazinePurchase=u,this.$location=d,this.$window=p,this.PurchaseRightsApply=h,this.AfterActionModal=m,this.MyCreditCard=f,this.initProps()}return e.inject=["$state","Popeye","$filter","PurchaseService","CustomDomainContext","FacebookPixel","Cookie","ContentLink","MagazineSubscription","CouponApply","MagazinePurchase","$location","$window","PurchaseRightsApply","AfterActionModal","MyCreditCard"],e.prototype.initProps=function(){return this.currentUser?(this.viewMode="initial",this.submitting=!1,this.paymentMethod="creditcard",this.serialCodeApplied=!1,this.errorMessage=null,this.monthlyCarrierKind="docomo",this.yearlyCarrierKind="docomo",this.usingCoupon=!1,this.couponCode=null,this.couponError=null,this.convenienceParams={},this.convenienceParams.customerNameLast=null,this.convenienceParams.customerNameFirst=null,this.convenienceParams.customerNameLastKana=null,this.convenienceParams.customerNameFirstKana=null,this.convenienceParams.customerTelNo=null,this.purchaseRightCode=null,this.purchaseRightCodeApproved=this.magazine.is_purchase_right_approved,this.purchaseRightCodeError=null,this.MyCreditCard.get(null,function(e){return function(t){return e.creditCard=t.data}}(this))):this.viewMode="nologin"},e.prototype.dismiss=function(){return this.Popeye.closeCurrentModal(),"complete"===this.viewMode?this.$state.go(this.$state.current.name,this.$state.params,{reload:!0}):void 0},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/"+this.magazine.user.urlname+"/m/"+this.magazine.key}),this.dismiss()},e.prototype.pageToLogin=function(){var e;return e=this.CustomDomainContext.isCdAccess()?""+this.CustomDomainContext.getBaseUrl():this.$location.path(),e+="?modal=support",this.$state.go("login",{redirectPath:e}),this.dismiss()},e.prototype.showCreditcardInput=function(){return this.viewMode="creditcard"},e.prototype.selectPaymentMethod=function(e){return this.paymentMethod=e},e.prototype.selectMonthlyCarrierKind=function(e){return this.monthlyCarrierKind=e},e.prototype.selectYearlyCarrierKind=function(e){return this.yearlyCarrierKind=e},e.prototype.callbackConfirm=function(e){return this.creditCard=e,this.viewMode="confirm"},e.prototype.submit=function(){var e;switch(this.submitting=!0,this.paymentMethod){case"creditcard":return e={magazine_key:this.magazine.key,payment_method:this.paymentMethod,coupon_applied:this.couponApplied,serial_code_applied:this.serialCodeApplied},this.serialCodeApplied&&(e.serial_code=this.couponCode),this.MagazineSubscription.put(e,function(e){return function(t){var n;if(t.error){if(e.errorMessage=e.PurchaseService.errCodeToMessage(t.error.code),e.errorMessage)return;return void(e.errorMessage="payment_error_message"===(n=t.error.code)||"invalid"===n||"blocked"===n||"oneshot_already_subscribed"===n||"oneshot_limited"===n?t.error.message:t.error.message.indexOf("42G830000")>-1?"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":"\u6c7a\u6e08\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u3057\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002")}return e.submitting=!1,e.viewMode="complete"}}(this),function(e){return function(){return e.errorMessage="\u30de\u30ac\u30b8\u30f3\u306e\u8cfc\u8aad\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002",e.submitting=!1}}(this))}},e.prototype.useCoupon=function(){return this.usingCoupon=!0},e.prototype.applyCoupon=function(){return this.couponCode&&0!==this.couponCode.length?(this.submitting=!0,this.CouponApply.save({code:this.couponCode,magazine_key:this.magazine.key},function(e){return function(t){return e.magazine.free_subscription_ended_at=t.data.discount.free_subscription_ended_at,e.magazine.discount_amount=t.data.discount.amount,e.serialCodeApplied=t.data.is_subscription_serial===!0,e.paymentMethod="creditcard",e.serialCodeApplied?e.paymentMethod="serialcode":(e.magazine.discount_price=t.data.discount.price,e.magazine.extended_payment_date=t.data.discount.payment_started_at,e.magazine.reserved_free_subscription_ended_at=t.data.discount.reserved_free_subscription_ended_at),e.couponApplied=!0,e.submitting=!1}}(this),function(e){return function(t){switch(t.data.error){case"Already subscribed":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u65e2\u306b\u8cfc\u8aad\u6e08\u307f\u3067\u3059\u3002";break;case"unsubscribable":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306f\u7d99\u7d9a\u8ab2\u91d1\u30de\u30ac\u30b8\u30f3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002";break;case"forbidden":e.couponError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Serial code had expired":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u5931\u52b9\u3057\u3066\u3044\u307e\u3059\u3002";break;case"Serial code had been used":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Already coupon used":e.couponError="\u3053\u306e\u30de\u30ac\u30b8\u30f3\u306b\u4ed6\u306e\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Already coupon code used":e.couponError="\u5165\u529b\u3057\u305f\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u306f\u65e2\u306b\u4f7f\u7528\u6e08\u307f\u3067\u3059\u3002";break;case"Not found":e.couponError="\u6b63\u3057\u3044\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002";break;case"Not the first subscription":e.couponError="\u30af\u30fc\u30dd\u30f3\u306f\u65b0\u898f\u8cfc\u8aad\u6642\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002";break;default:e.couponError="\u30af\u30fc\u30dd\u30f3\u306e\u9069\u7528\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"}return e.submitting=!1}}(this))):this.couponError="\u30af\u30fc\u30dd\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},e.prototype.goToMagazineHome=function(){return this.CustomDomainContext.isCdAccess()&&"magazine"===this.CustomDomainContext.type&&this.CustomDomainContext.key===this.magazine.key?this.$state.go("cdMagazine.home",{},{reload:!0}):this.ContentLink.go("magazine",this.magazine,{reload:!0})},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:"/magazines/"+this.magazine.key}),this.dismiss()},e.prototype.goToMagazineHome=function(){return this.$state.go("magazine.detail",{key:this.magazine.key},{reload:!0})},e.prototype.apllyPurchaseRightCode=function(){return this.PurchaseRightsApply.save({id:this.magazine.purchase_right.id,code:this.purchaseRightCode,content_type:"Magazine",content_id:this.magazine.id},function(e){return function(){return e.purchaseRightCodeApproved=!0,e.purchaseRightCodeError=null}}(this),function(e){return function(t){return e.purchaseRightCodeError=t.data.data,e.purchaseRightCodeError?void 0:e.purchaseRightCodeError="\u4e88\u671f\u305b\u306c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}}(this))},e}(),angular.module("noteApp").directive("aspPurchaseSubscribeMagazine",function(){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{creator:"=",currentUser:"=",magazine:"="},templateUrl:"/templates/asp/common/modals/purchase_subscribe_magazine"}})}.call(this),function(){"use strict";var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n=[].slice;e=function(){function e(e,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_){this.$scope=e,this.$rootScope=n,this.$timeout=r,this.$window=i,this.$location=a,this.$state=o,this.$http=s,this.Cookie=l,this.Auth=c,this.Notification=u,this.ActivationResend=d,this.FlashModal=p,this.Bridge=h,this.Title=m,this.CurrentUser=f,this.TimelineStash=g,this.UserAgent=v,this.MagazineLayout=y,this.$document=b,this.$interval=_,this.searchOff=t(this.searchOff,this),this.searchOn=t(this.searchOn,this),this.$scope.$location=this.$location,this.$rootScope.$location=this.$location,this.currentUser={},this.isLoggedIn=null,this.notificationModel=this.notificationModel||{notifications:[]},this.isIPhone=this.UserAgent.isIPhone,this.isAndroid=this.UserAgent.isAndroid,this.searchQuery=null,this.lastScrollTop=0,this.isSmartPhone=this.$rootScope.isSmartPhone,this.stopInterval=this.$interval(function(e){return function(){return angular.element("#gnav .inner + category-list .category li").length>0&&angular.element("#gnav .tag-list .tag-item").length>0?(e.onScroll(),e.$interval.cancel(e.stopInterval)):void 0}}(this),100),this.$scope.$on("$UserUnFollowed",function(e){return function(t,n){var r,i,a,o,s;for(o=e.notificationModel.notifications,s=[],i=0,a=o.length;a>i;i++)r=o[i],n===r.notified_user_id?(r.is_followed=!r.is_followed,s.push(r.is_just_followed=r.is_followed)):s.push(void 0);return s}}(this)),this.$scope.$on("$UserFollowed",function(e){return function(t,n){var r,i,a,o,s;for(o=e.notificationModel.notifications,s=[],i=0,a=o.length;a>i;i++)r=o[i],n===r.notified_user_id?(r.is_followed=!r.is_followed,s.push(r.is_just_followed=r.is_followed)):s.push(void 0);return s}}(this)),this.$scope.$on("$stateChangeSuccess",function(t){return function(){var n;return t.$state.is("home.home")&&!t.isLoggedIn||"SessionsCtrl"===t.$state.current.controller||(e.infoMsgDisplayed=!0),(t.$state.is("showTextNoteFriendly")||t.$state.is("showTextNote"))&&(n=t.$state.params.magazine_key,t.creatorUrlname=t.$state.params.creator_urlname,n&&t.MagazineLayout.get({magazine_key:n,no_section:!0},function(e){return e.error?void("not_found"===e.error.code&&t.$state.go("_404",null,{location:!1})):(t.magazine=e.data.magazine_layout,t.currentMenuId=t.$state.params.current_menu_id,t.magazineKey=n,t.magazineUrlname=t.magazine.user.urlname)})),angular.element(".renewal-l-header").show(),angular.element(".footer").show()}}(this)),this.$scope.$on("$stateChangeError",function(e){return function(){return e.showNoteLogo=!0}}(this)),this.$scope.$on("$ProfileImageChanged",function(e){return function(t,n){return e.currentUser.user_profile_image_path=n}}(this)),this.CurrentUser.then(function(e){return function(t){return t.error?(e.error=t.error,e.isLoggedIn=!1):(e.currentUser=t.data,e.isLoggedIn=!0,e.navBarLoaded=!0,e.notificationModel.notificationNum=t.data.unread_notification_num),!e.isLoggedIn&&e.isTablet&&"/"===e.$location.path()?angular.element(document.head).find('meta[name="viewport"]').attr("content","width=1024, user-scalable=no, maximum-scale=1.0"):angular.element(document.head).find('meta[name="viewport"]').attr("content","width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0")}}(this)),this.$scope.$on("$destroy",function(e){return function(){return angular.element(e.$window).off("scroll.fixedHeader")}}(this))}return e.inject=["$scope","$rootScope","$timeout","$window","$location","$state","$http","Cookie","Auth","Notification","ActivationResend","FlashModal","Bridge","Title","CurrentUser","TimelineStash","UserAgent","MagazineLayout","$document","$interval"],e.prototype.isCdUser=function(){return!1},e.prototype.clickNoteLogo=function(e){return e.preventDefault(),"home.home"===this.$state.current.name?this.$window.location.reload(!0):(this.$state.is("showTextNoteFriendly")&&this.TimelineStash.clear(),this.$state.go("home.home"))},e.prototype.searchOn=function(){return this.isSearch=!0},e.prototype.searchOff=function(){return this.isSearch=!1},e.prototype.closeAboveMsg=function(e){return this.hideTopNavMsg=this.hideTopNavMsg||{},this.Cookie.put(e,!0),this.hideTopNavMsg[e]=!0},e.prototype.moveToLogin=function(e){return e.preventDefault(),this.$state.go("login")},e.prototype.openMenu=function(e){return e.preventDefault(),this.menuModal||(this.menuModal=angular.element("[data-remodal-id=menumodal]").remodal({hashTracking:!1})),this.menuModal.open()},e.prototype.execSearch=function(e){return"click"===e.type||"keydown"===e.type&&13===e.which?(this.$state.go("search",{q:this.searchQuery}),this.$timeout(function(e){return function(){return e.searchQuery=null,e.isSearchWinsowShow=!1,angular.element("#search").blur()}}(this))):void 0},e.prototype.toggleSearch=function(){return this.isSearchWinsowShow=!this.isSearchWinsowShow},e.prototype.onScroll=function(){return this.gnavH=angular.element("#gnav").outerHeight(),angular.element("#page-content").css({"padding-top":this.gnavH}),angular.element(this.$window).on("scroll.fixedHeader",function(e){return function(){var t,n,r;return r=e.$window.pageYOffset,t=angular.element("#gnav"),r>e.gnavH-100?t.addClass("scrolled"):t.removeClass("scrolled"),Math.abs(e.lastScrollTop-r)<=5?void 0:(n=t.outerHeight(),angular.element("#page-content").css({"padding-top":n}),r<=e.gnavH&&e.gnavH!==angular.element("#page-content").css("padding-top")&&angular.element("#page-content").css({"padding-top":e.gnavH}),e.lastScrollTop=r,e.$scope.$apply())}}(this))},e.prototype.pageToSignup=function(){return this.$state.go("signup",{nourlname:!0,redirectPath:this.$location.path()})},e.prototype.pageToLogin=function(){return this.$state.go("login",{redirectPath:this.$location.path()})},e.prototype.logout=function(){return this.$http({method:"POST",url:"/api/v1/sessions/sign_out",timeout:3e4}).success(function(e){return function(){return e.$window.location.href="/"}}(this)).error(function(){return console.log("Error occurred")})},e}(),angular.module("noteApp").directive("navbar",function(){return{restrict:"E",templateUrl:"/templates/asp/common/navbar",scope:{},controller:n.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("navigatorItem",function(){return{templateUrl:"/templates/asp/common/navigator_item",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{navigator:"=",enableBigIcon:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.injects=[],e.prototype.enable=function(){return"true"===this.forceEnable?!0:this.baseDate&&moment().diff(moment(this.baseDate),"days")<=this.withinDays?!0:!1},e}(),angular.module("noteApp").directive("newLabel",function(){return{templateUrl:"/templates/asp/common/new_label",restrict:"E",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{baseDate:"@",withinDays:"@",forceEnable:"@"}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("notFound",function(){return{restrict:"E",templateUrl:"/templates/pages/404"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p){var h,m,f,g;this.$scope=e,this.$rootScope=t,this.$window=n,this.$state=r,this.$interval=i,this.$element=a,this.Notification=o,this.NotificationCount=s,this.NotificationReadAll=l,this.Bridge=c,this.Title=u,this.ContentLink=d,this.Admin=p,this.page=1,this.last_displayed_id=null,this.activity=angular.element(this.$window.document.querySelector(".renewal-c-popover--notification")),m=angular.element(this.$window.document.querySelector(".renewal-p-icon.renewal-p-icon--notification")),m.on("click",function(e){return function(t){return t.preventDefault(),e.target=e.$element.find(".renewal-p-icon.renewal-p-icon--notification"),e.toggle()}}(this)),h=angular.element(document.querySelector("span.renewal-p-count")),h.on("click",function(e){return function(t){return t.preventDefault(),e.target=e.$element.find(".renewal-p-icon.renewal-p-icon--notification"),e.toggle()}}(this)),f=angular.element(document.querySelector("ul.renewal-p-notificationList")),f.on("scroll",function(e){return function(){var t;t=30,f.scrollTop()>f[0].scrollHeight-f.height()-t&&e.notificationModel.readMore()}}(this)),this.notificationModel=this.notificationModel||{notifications:[]},this.loading=!1,this.notificationModel.tick=function(e){return function(){e.user&&e.Admin.isAdminCheck!==!0&&e.NotificationCount.get(null,function(t){t.error||t.data.notification_count!==e.notificationModel.notificationNum&&e.Notification.get(null,function(t){var n;if(!t.error){for(e.notificationModel.lastPage=t.data.last_page,n=t.data.notifications.length;n--;)t.data.notifications[n].read_flag||e.notificationModel.notifications.unshift(t.data.notifications[n]);return e.Bridge.notification.count=e.notificationModel.notificationNum=t.data.notification_num,e.Title.setNotification(e.notificationModel.notificationNum)}},function(){return console.log("Failed to get notification")})},function(){return console.log("Failed to get notification count")})}}(this),this.notificationModel.click=function(e){return function(){return e.user?(1===e.page&&(e.load_ok=!1,e.Notification.get(null,function(t){return e.load_ok=!0,t.error?void 0:(e.page+=1,e.isSearch=!1,e.notificationModel.notifications=t.data.notifications,e.notificationModel.notificationNum=t.data.notification_num,e.notificationModel.lastPage=t.data.last_page,e.last_displayed_id=t.data.last_displayed_id,e.Bridge.notification.count=e.notificationModel.notificationNum)},function(){return console.log("Error occurred")})),e.Admin.isAdminCheck!==!0?e.NotificationReadAll.save(null,function(t){return t.error?void 0:(e.notificationModel.notificationNum-=t.data.update_num,e.Bridge.notification.count=e.notificationModel.notificationNum,e.Title.setNotification(e.notificationModel.notificationNum))}):void 0):void 0}}(this),this.notificationModel.readMore=function(e){return function(){var t;if(!e.loading&&!e.notificationModel.lastPage)return e.loading=!0,t={last_displayed_id:e.last_displayed_id},e.Notification.get(t,function(t){var n,r,i,a;if(e.loading=!1,!t.error)for(e.notificationModel.lastPage=t.data.last_page,e.last_displayed_id=t.data.last_displayed_id,a=t.data.notifications,r=0,i=a.length;i>r;r++)n=a[r],e.notificationModel.notifications.push(n)},function(){return e.loading=!1})}}(this),this.notificationModel.navUserElemClicked=function(e){return function(t,n){return t.no_urlname_user?void 0:(e.ContentLink.go("user",t),n.preventDefault())}}(this),this.notificationModel.navCommentElemClicked=function(e){return function(t,n){return e.ContentLink.go("note",t),n.preventDefault()}}(this),this.notificationModel.navMagazineElemClicked=function(e){return function(t,n){return e.ContentLink.go("magazine",t,{location:!0,reload:!0}),n.preventDefault()}}(this),this.notificationModel.navMagazineNoteAddElemClicked=function(e){return function(t,n){return e.ContentLink.go("note",t),n.preventDefault()}}(this),this.notificationModel.navElemClicked=function(e){return function(t,n){return n.target&&angular.element(n.target).hasClass("action-user-urlname")?void 0:(e.ContentLink.go("note",t),n.preventDefault())}}(this),g=this.$interval(this.notificationModel.tick,6e4,!1),this.$scope.$on("$destroy",function(e){return function(){e.$interval.cancel(g)}}(this))}return e.inject=["$scope","$rootScope","$window","$state","$interval","$element","Notification","NotificationCount","NotificationReadAll","Bridge","Title","ContentLink","Admin"],e.prototype.toggle=function(){return this.target.hasClass("is-active")?this.hide():this.show()},e.prototype.show=function(){var e,t,n;return t=angular.element(this.$window.document.body),n=angular.element(this.$window.document.documentElement),t.addClass("renewal-c-popover--noScroll"),n.addClass("renewal-c-popover--noScroll"),this.activity.css("display","block"),this.target.addClass("is-active"),e=angular.element(this.$window.document),e.on("mouseup",function(e){return function(t){var n;return t.preventDefault(),n=angular.element(t.target),n.hasClass("on-navbar-button")||n.hasClass("nav-bar-notification-read-more")||n.hasClass("is-active")||n.hasClass("inner")||n.hasClass("renewal-p-icon")||!e.isDisplayed()?void 0:e.hide()}}(this))},e.prototype.hide=function(){var e,t,n;return t=angular.element(this.$window.document.body),n=angular.element(this.$window.document.documentElement),t.removeClass("renewal-c-popover--noScroll"),n.removeClass("renewal-c-popover--noScroll"),this.activity.css("display","none"),this.target.removeClass("is-active"),e=angular.element(this.$window.document),e.off("mouseup")},e.prototype.isDisplayed=function(){return"none"!==this.activity.css("display")},e}(),angular.module("noteApp").directive("notificationBell",function(){return{restrict:"E",templateUrl:"/templates/asp/common/notification_bell",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{user:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){this.links=[{stateName:"",url:"/aboutus",target:"",label:"ABOUT US"},{stateName:"",url:"http://www.adgentosha.com/",target:"_blank",label:"\u5e83\u544a\u63b2\u8f09"},{stateName:"",url:"https://form-gentosha.mediagrowth.jp/entry/gingerweb/contact",target:"_blank",label:"\u304a\u554f\u3044\u5408\u308f\u305b\uff08\u500b\u4eba\uff09"},{stateName:"",url:"https://form-gentosha.mediagrowth.jp/entry/gingerweb/contact-co",target:"_blank",label:"\u304a\u554f\u3044\u5408\u308f\u305b\uff08\u6cd5\u4eba\uff09"},{stateName:"magazine.home",url:"",target:"",label:"\u9023\u8f09\u4e00\u89a7"},{stateName:"author.home",url:"",target:"",label:"GINGER\u30ca\u30d3\u30b2\u30fc\u30bf\u30fc"},{stateName:"",url:"http://www.gentosha.co.jp/company/",target:"_blank",label:"\u904b\u55b6\u4f1a\u793e"},{stateName:"",url:"/privacy",target:"",label:"\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u30dd\u30ea\u30b7\u30fc"},{stateName:"",url:"/sitemap",target:"",label:"\u30b5\u30a4\u30c8\u30de\u30c3\u30d7"}]}return e.inject=[],e}(),angular.module("noteApp").directive("otherLinks",function(){return{templateUrl:"/templates/asp/common/other_links",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{via:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("/templates/asp/common/pager.html","<div class='list-button'> <a ng-show='!$ctrl.loading' class='button primary' href='#' ng-click='$ctrl.loadNextPage()'> <span ng-show='!$ctrl.loading'>LOAD MORE</span> </a> <a ng-show='$ctrl.loading' class='button primary loading' href='#'> <i class='i-spinner'></i> </a> </div>")}]),e=function(){function e(){this.loading=!1}return e.inject=[],e.prototype.loadNextPage=function(){return this.loading=!0,this.paging().then(function(e){return function(){return e.loading=!1}}(this),function(e){return console.error(e)})},e}(),angular.module("noteApp").directive("pager",["$window",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/common/pager.html",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{paging:"&"}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a){this.$scope=e,this.rootScope=t,this.$window=n,this.$state=r,this.$element=i,this.OpenPickUrlnameModalService=a,this.button=angular.element(this.$window.document.querySelector("#js-post-note-toggle")),this.target=angular.element(this.$window.document.querySelector(".renewal-c-popover--postNote")),this.$element.on("click",function(e){return function(t){return t.preventDefault(),e.checkNoUrlnameUser()?!1:e.toggle()}}(this)),this.$element.find("li").on("click","a",function(e){return function(t){return t.stopPropagation(),e.hide()}}(this))}return e.inject=["$scope","$rootScope","$window","$state","$element","OpenPickUrlnameModalService"],e.prototype.checkNoUrlnameUser=function(){var e;return this.user.no_urlname_user?(e=function(e){return function(){return e.$window.location.reload()}}(this),this.OpenPickUrlnameModalService.open(e,"note"),!0):!1},e.prototype.setCreateNoteEvent=function(e){var t;return t="navbar"===e?"create-note":"create-textNote","home.home"===this.$state.current.name?t+"-from-home":"creator.home"===this.$state.current.name?t+"-from-creator":"magazine.home"===this.$state.current.name?t+"-from-magazine":"showTextNoteFriendly"===this.$state.current.name?t+"-from-note":t},e.prototype.toggle=function(){return this.button.hasClass("is-active")?this.hide():this.show()},e.prototype.show=function(){var e,t,n;return t=angular.element(this.$window.document.body),n=angular.element(this.$window.document.documentElement),t.addClass("renewal-c-popover--noScroll"),n.addClass("renewal-c-popover--noScroll"),this.target.css("display","block"),this.button.addClass("is-active"),e=angular.element(this.$window.document),e.on("mouseup",function(e){return function(t){var n;return t.preventDefault(),n=angular.element(t.target),n.hasClass("on-navbar-button")||n.hasClass("nav-bar-notification-read-more")||n.hasClass("is-active")||n.hasClass("inner")||n.hasClass("renewal-p-icon")||!e.isDisplayed()?void 0:e.hide()}}(this))},e.prototype.hide=function(){var e,t,n;return t=angular.element(this.$window.document.body),n=angular.element(this.$window.document.documentElement),t.removeClass("renewal-c-popover--noScroll"),n.removeClass("renewal-c-popover--noScroll"),this.target.css("display","none"),this.button.removeClass("is-active"),e=angular.element(this.$window.document),e.off("mouseup")},e.prototype.isDisplayed=function(){return"none"!==this.button.css("display")},e}(),angular.module("noteApp").directive("postingMenu",function(){return{restrict:"E",templateUrl:"/templates/asp/common/posting_menu",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{user:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){this.currentRankingKind="weekly"}return e.inject=[],e.prototype.switchRanking=function(e){return this.currentRankingKind=e},e}(),angular.module("noteApp").directive("ranking",function(){return{templateUrl:"/templates/asp/common/ranking",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{filter:"@"}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("registerMenu",function(){return{templateUrl:"/templates/asp/common/register_menu",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("registeredConductor",function(){return{templateUrl:"/templates/asp/common/registered_conductor",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){this.$scope=e,this.$rootScope=t,this.$stateParams=n,this.$window=r,this.$location=i,this.$state=a,this.$document=o
}return e.inject=["$scope","$rootScope","$stateParams","$window","$location","$state","$document"],e}(),angular.module("noteApp").directive("renderPartial",["$compile","$templateRequest",function(n,r){return{restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{tmpl:"@",type:"@"},link:function(e,t){return r("/templates"+e.$ctrl.tmpl).then(function(r){return t.html(r),n(t.contents())(e)},function(e){return console.log("$templateRequest: not OK",e)})}}}])}.call(this),function(){"use strict";var e;e=function(){function e(e,t,n,r){var i,a;this.$window=e,this.$element=t,this.$filter=n,this.Title=r,a=encodeURIComponent(e.location.href),i=this.article?this.createTitle():"",this.share="facebook"===this.type?{title:"share on facebook",url:"https://www.facebook.com/sharer/sharer.php?u="+a+"&t="+i}:"twitter"===this.type?{title:"share on Twitter",url:"http://twitter.com/share?url="+a+"&text="+i}:"line"===this.type?{title:"share on Line",url:"http://line.naver.jp/R/msg/text/?"+i+"%0A"+a}:void 0,this.$element.on("click",function(e){return function(t){return t.preventDefault(),e.$window.open(e.share.url,e.share.title,"width=550, height=450,personalbar=0,toolbar=0,scrollbars=1,resizable=1")}}(this))}return e.$inject=["$window","$element","$filter","Title"],e.prototype.createTitle=function(){var e,t,n,r,i,a,o,s,l,c;return l=null!=this.article.body?""+(this.article.name||this.article.body.split("\n")[0]||""):""+(this.article.name||""),r=140,n=23,e=7,t=r-(n+e),i="TalkNote"===this.article.type?this.article.body:this.article.name,a=this.article.authors.name||this.article.authors.urlname,s=this.$window.document.querySelector("meta[property='og:site_name']"),o=s?s.getAttribute("content"):this.$window.location.host,c=[],(i+a+o).length<t?c.push(i,a,o):(i+o).length<t?c.push(i,o):c.push(i.length<t?i:this.$filter("truncate")(i,t)),encodeURIComponent(this.Title.create(c))},e}(),angular.module("noteApp").directive("socialLink",function(){return{restrict:"E",scope:{},transclude:!0,replace:!0,template:'<a ng-attr-class="{{::$ctrl.styleClass}}" ng-attr-id="{{::$ctrl.styleId}}" ng-transclude href="{{::$ctrl.share.url}}"></a>',bindToController:{type:"@",styleId:"@",styleClass:"@",article:"="},controller:e,controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$rootScope=e}return e.inject=["$rootScope"],e}(),angular.module("noteApp").directive("tagList",function(){var n;return n={templateUrl:"/templates/asp/common/tag_list",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").directive("notFound",function(){return{restrict:"E",templateUrl:"/templates/asp/errors/404",scope:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.$stateParams=e}return e.inject=["$stateParams"],e}(),angular.module("noteApp").directive("goetheCategoryList",function(){var n;return n={templateUrl:"/templates/asp/common/category_list",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("hatenaButton",function(){return{restrict:"E",templateUrl:"/templates/asp/articles/hatena_button",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{},link:function(e,t){return t.append('<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>')}}})}.call(this),function(){"use strict";var e,t=[].slice;angular.module("noteApp").run(["$templateCache",function(e){return e.put("common/renewal/goetheSlick.html",'<style>\n  .slick-prev,.slick-next,.slick-dots button{cursor: pointer;}\n</style>\n<slick ng-transclude\n  id="{{$ctrl.slickId}}"\n  ng-class="$ctrl.slickClass"\n  settings="$ctrl.slickSettings()"\n></slick>')}]),e=function(){function e(e){this.$timeout=e,this.mediaBPmobile=640,this.mediaBPtablet=992,this.settings=this[this.slickType]()}return e.inject=["$timeout"],e.prototype.slickSettings=function(){return this.settings},e.prototype.pickup=function(){return{slide:".post",slidesToShow:3,centerMode:!0,infinite:!0,responsive:[{breakpoint:this.mediaBPmobile,settings:{slidesToShow:1}}]}},e.prototype.gallery=function(){return{slide:".gallery-item",slidesToShow:5,dots:!0,centerMode:!0,infinite:!0,responsive:[{breakpoint:this.mediaBPtablet,settings:{slidesToShow:3}},{breakpoint:this.mediaBPmobile,settings:{slidesToShow:1}}]}},e.prototype.footer=function(){return{slide:".banner-item",arrows:!1,slidesToShow:3,autoplay:!1,infinite:!1,responsive:[{breakpoint:this.mediaBPmobile,settings:{slidesToShow:1,variableWidth:!0,centerMode:!0,infinite:!0,autoplay:!0}}]}},e.prototype.topCategory=function(){return{slide:".post",dots:!0,appendArrows:"."+this.slickClass+" .controls"}},e.prototype.topFor=function(){return{slide:".slide",slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,asNavFor:"#mainSliderNav",event:{init:function(e){return function(t,n){return e.$timeout(n.setPosition,0)}}(this)}}},e.prototype.topNav=function(){var e;return e={slide:".slide",slidesToShow:5,slidesToScroll:1,asNavFor:"#mainSliderFor",dots:!1,centerMode:!0,focusOnSelect:!0,arrows:!1},parseInt(this.slickLength)<=5&&(e.useTransform=!1,e.infinite=!1),e},e.prototype.goetheSlider=function(){return{slide:".post",slidesToShow:3,dots:!1,centerMode:!1,infinite:!1,responsive:[{breakpoint:this.mediaBPmobile,settings:{slidesToShow:1}}]}},e.prototype.articleFor=function(){return{slide:".slide",slidesToShow:1,slidesToScroll:1,adaptiveHeight:!0,asNavFor:".slider-nav"}},e.prototype.articleNav=function(){var e;return e={slide:".slide",slidesToShow:5,slidesToScroll:1,asNavFor:".slider-for",dots:!1,centerMode:!0,focusOnSelect:!0,arrows:!1,infinite:!0},parseInt(this.slickLength)<=5&&(e.useTransform=!1),e},e}(),angular.module("noteApp").directive("goetheSlick",function(){return{restrict:"E",templateUrl:"common/renewal/goetheSlick.html",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",transclude:!0,bindToController:{slickType:"@",slickId:"@",slickClass:"@",slickLength:"@"}}})}.call(this),function(){"use strict";angular.module("noteApp").directive("goetheSocialWidget",["$timeout","$filter","Title","$window",function(e,t,n,r){var i;return i={restrict:"E",templateUrl:"/templates/asp/articles/goethe_social_widget",scope:{article:"=",pageEl:"="},link:function(e){var t;return t=e.pageEl.find(".share-group"),angular.element(r).on("scroll.goetheSocialWidget",function(){return function(){var n;return n=e.pageEl.find(".note-body")[0],n&&inViewport(n)&&$("#gnav").hasClass("fixed")?t.addClass("show").removeClass("hide"):t.addClass("hide").removeClass("show")}}(this)),e.$on("$destroy",function(){return angular.element(r).off("scroll.goetheSocialWidget")})}}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){this.currentRanking="weekly"}return e.inject=[],e.prototype.changeRanking=function(e){return this.currentRanking=e},e.prototype.isCurrentRanking=function(e){return this.currentRanking===e},e}(),angular.module("noteApp").directive("switchRanking",function(){return{restrict:"E",templateUrl:"/templates/asp/articles/switch_ranking",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl",bindToController:{params:"="}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a){this.$rootScope=e,this.$scope=t,this.$state=n,this.SlickContextSercice=r,this.AdManageService=i,this.Hashtag=a,this.isPC=this.$rootScope.isPC,this.tag=this.$state.params.hashtag,this.currentTab=this.$state.params.tab||"newest",this.setupAd(),this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.Hashtag.get({hashtag:this.tag},function(e){return function(t){var n;return n=t.data.relatedHashtags,e.relatedHashtagNames=n.map(function(e){return e.name.slice(1)})}}(this),function(){return function(e){return console.error(e)}}(this))}return e.injects=["$rootScope","$scope","$state","SlickContextSercice","AdManageService","Hashtag"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4703502"),this.AdManageService.addTarget("cci","4703505"),this.AdManageService.addTarget("cci","4703504"),this.AdManageService.addTarget("cci","4703503"),this.AdManageService.addTarget("cci","4752952"),this.AdManageService.addTarget("cci","4752951"),this.AdManageService.addTarget("cci","4752953"),this.AdManageService.addTarget("cci","4774711")):(this.AdManageService.addTarget("cci","4703531"),this.AdManageService.addTarget("cci","4703528"),this.AdManageService.addTarget("cci","4703529"),this.AdManageService.addTarget("cci","4703530"),this.AdManageService.addTarget("cci","4752969"),this.AdManageService.addTarget("cci","4752968"),this.AdManageService.addTarget("cci","4752967"),this.AdManageService.addTarget("cci","4774719"))},e.prototype.bundleKind=function(){return"newest"===this.currentTab?"newest":"monthly_ranking"},e.prototype.bundleFilter=function(){return"hashtag:name:#"+this.tag},e.prototype.toDate=function(e){return new Date(e)},e}(),angular.module("noteApp").directive("hashtagDetail",function(){return{restrict:"E",templateUrl:"/templates/asp/hashtags/detail",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("bukatsu",function(){return{templateUrl:"/templates/asp/home/bukatsu",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("fortuneList",function(){return{templateUrl:"/templates/asp/home/fortune_list",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){this.Auth=e,this.$interval=t,this.$rootScope=n,this.$state=r,this.SlickContextSercice=i,this.$timeout=a,this.AdManageService=o,this.isPC=this.$rootScope.isPC,this.setupAd(),this.slickCtx=this.SlickContextSercice.get(),this.sparkSlickConfig=this.slickCtx.sparkSlickConfig,this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.collectionSlickConfig=this.slickCtx.collectionSlickConfig,this.instagramSlickConfig=this.slickCtx.instagramSlickConfig,this.showMainCatchCopy=!0,this.collectionBundleMethods={goStateArticleDetail:function(e){return function(t){return t.category?e.$state.go("article.detail",{category:t.category.engName,slug:t.slug}):void 0}}(this),shareUrl:function(e,t){var n;if(!t.category)return"#";switch(n=""+window.PREFETCH.NOTE.protocol+"://"+window.PREFETCH.NOTE.host+"/"+t.category.engName+"/"+t.slug,e){case"facebook":return"https://www.facebook.com/sharer/sharer.php?u="+n;case"twitter":return"http://twitter.com/share?url="+n;case"line":return"http://line.me/R/msg/text/?"+n}}},this.bundleAfterFetch=function(e){return function(){return e.$timeout(function(){return e.showMainCatchCopy=!1},5e3)}}(this)}return e.inject=["Auth","$interval","$rootScope","$state","SlickContextSercice","$timeout","AdManageService"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4752927"),this.AdManageService.addTarget("cci","4752929"),this.AdManageService.addTarget("cci","4752928"),this.AdManageService.addTarget("cci","4752926"),this.AdManageService.addTarget("cci","4762499"),this.AdManageService.addTarget("cci","4762498"),this.AdManageService.addTarget("cci","4774714"),this.AdManageService.addTarget("cci","4703480"),this.AdManageService.addTarget("cci","4703481"),this.AdManageService.addTarget("cci","4703482"),this.AdManageService.addTarget("cci","4703483"),this.AdManageService.addTarget("cci","4703485"),this.AdManageService.addTarget("aja","UIszEBEzR")):(this.AdManageService.addTarget("cci","4752956"),this.AdManageService.addTarget("cci","4752955"),this.AdManageService.addTarget("cci","4752954"),this.AdManageService.addTarget("cci","4752957"),this.AdManageService.addTarget("cci","4762520"),this.AdManageService.addTarget("cci","4762521"),this.AdManageService.addTarget("cci","4774722"),this.AdManageService.addTarget("cci","4703508"),this.AdManageService.addTarget("cci","4703509"),this.AdManageService.addTarget("cci","4703507"),this.AdManageService.addTarget("cci","4703506"),this.AdManageService.addTarget("cci","4703511"),this.AdManageService.addTarget("aja","bxFGLBPkg"))},e}(),angular.module("noteApp").directive("home",function(){return{restrict:"E",templateUrl:"/templates/asp/home/home",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("peopleList",function(){return{templateUrl:"/templates/asp/home/people_list",restrict:"E",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c){this.$rootScope=e,this.$scope=t,this.$state=n,this.$window=r,this.SlickContextSercice=i,this.Magazine=a,this.ChildNotes=o,this.$q=s,this.AdManageService=l,this.Author=c,this.isPC=this.$rootScope.isPC,this.setupAd(),this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.notes=[],this.firstCardNote=null,this.page=1,this.isLastPage=!0,this.Magazine.get({magazine_key:this.$state.params.key},function(e){return function(t){return e.magazine=t.data,e.fetchNotes()}}(this),function(){return function(e){return console.error(e)}}(this))}return e.injects=["$rootScope","$scope","$state","$window","SlickContextSercice","Magazine","ChildNotes","$q","AdManageService","Author"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4703502"),this.AdManageService.addTarget("cci","4703505"),this.AdManageService.addTarget("cci","4703504"),this.AdManageService.addTarget("cci","4703503"),this.AdManageService.addTarget("cci","4752952"),this.AdManageService.addTarget("cci","4752951"),this.AdManageService.addTarget("cci","4752953"),this.AdManageService.addTarget("cci","4774711")):(this.AdManageService.addTarget("cci","4703531"),this.AdManageService.addTarget("cci","4703528"),this.AdManageService.addTarget("cci","4703529"),this.AdManageService.addTarget("cci","4703530"),this.AdManageService.addTarget("cci","4752969"),this.AdManageService.addTarget("cci","4752968"),this.AdManageService.addTarget("cci","4752967"),this.AdManageService.addTarget("cci","4774719"))},e.prototype.toDate=function(e){return new Date(e)},e.prototype.fetchNotes=function(e){return null==e&&(e=null),this.ChildNotes.get({parent_type:"Magazine",parent_id:this.magazine.id,per:this.$window.PREFETCH.NOTE.magazine_note_per,page:this.page},function(t){return function(n){var r,i,a,o;for(o=n.data.notes,i=0,a=o.length;a>i;i++)r=o[i],t.notes.push(r);return t.firstCardNote||(t.firstCardNote=t.notes[0]),t.isLastPage=n.data.isLastPage,e?e.resolve():void 0}}(this),function(){return function(t){return console.error(t),e?e.reject(t):void 0}}(this))},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.isLastPage?void 0:(this.page++,this.fetchNotes(e),e.promise)},e}(),angular.module("noteApp").directive("magazineDetail",function(){return{restrict:"E",templateUrl:"/templates/asp/magazines/detail",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){this.$rootScope=e,this.$scope=t,this.$state=n,this.SlickContextSercice=r,this.Magazines=i,this.$q=a,this.AdManageService=o,this.isPC=this.$rootScope.isPC,this.setupAd(),this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.page=1,this.magazines=[],this.firstCardMagazine=null,this.isLastPage=!0,this.fetchMagazines()}return e.injects=["$rootScope","$scope","$state","SlickContextSercice","Magazines","$q","AdManageService"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4703502"),this.AdManageService.addTarget("cci","4703505"),this.AdManageService.addTarget("cci","4703504"),this.AdManageService.addTarget("cci","4703503"),this.AdManageService.addTarget("cci","4752952"),this.AdManageService.addTarget("cci","4752951"),this.AdManageService.addTarget("cci","4752953"),this.AdManageService.addTarget("cci","4774711")):(this.AdManageService.addTarget("cci","4703531"),this.AdManageService.addTarget("cci","4703528"),this.AdManageService.addTarget("cci","4703529"),this.AdManageService.addTarget("cci","4703530"),this.AdManageService.addTarget("cci","4752969"),this.AdManageService.addTarget("cci","4752968"),this.AdManageService.addTarget("cci","4752967"),this.AdManageService.addTarget("cci","4774719"))},e.prototype.toDate=function(e){return new Date(e)},e.prototype.fetchMagazines=function(e){return null==e&&(e=null),this.loading=!0,this.Magazines.get({page:this.page,per:14},function(t){return function(n){var r,i,a,o;for(o=n.data.magazines,i=0,a=o.length;a>i;i++)r=o[i],t.magazines.push(r);return t.firstCardMagazine||(t.firstCardMagazine=t.magazines[0]),t.isLastPage=n.data.isLastPage,e?e.resolve():void 0}}(this),function(){return function(t){return console.error(t),e?e.reject(t):void 0}}(this))},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.isLastPage?void 0:(this.page++,this.fetchMagazines(e),e.promise)},e}(),angular.module("noteApp").directive("magazineIndex",function(){return{restrict:"E",templateUrl:"/templates/asp/magazines/index",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){this.$rootScope=e,this.$scope=t,this.$state=n,this.SlickContextSercice=r,this.Searches=i,this.$q=a,this.AdManageService=o,this.isPC=this.$rootScope.isPC,this.setupAd(),this.query=this.$state.params.q,this.slickCtx=this.SlickContextSercice.get(),this.featureSlickConfig=this.slickCtx.featureSlickConfig,this.loadedAll=!0,this.cursor={note:"initial",magazine:"initial",user:"initial",hashtag:"initial"},this.start=0,this.totalCount=0,this.notes=[],this.firstCardNote=null,this.size=14,this.fetchNotes()}return e.injects=["$rootScope","$scope","$state","SlickContextSercice","Searches","$q","AdManageService"],e.prototype.setupAd=function(){return this.isPC?(this.AdManageService.addTarget("cci","4703502"),this.AdManageService.addTarget("cci","4703505"),this.AdManageService.addTarget("cci","4703504"),this.AdManageService.addTarget("cci","4703503"),this.AdManageService.addTarget("cci","4752952"),this.AdManageService.addTarget("cci","4752951"),this.AdManageService.addTarget("cci","4752953"),this.AdManageService.addTarget("cci","4774711")):(this.AdManageService.addTarget("cci","4703531"),this.AdManageService.addTarget("cci","4703528"),this.AdManageService.addTarget("cci","4703529"),this.AdManageService.addTarget("cci","4703530"),this.AdManageService.addTarget("cci","4752969"),this.AdManageService.addTarget("cci","4752968"),this.AdManageService.addTarget("cci","4752967"),this.AdManageService.addTarget("cci","4774719"))},e.prototype.toDate=function(e){return new Date(e)},e.prototype.fetchNotes=function(e){return null==e&&(e=null),this.Searches.get({context:"note",q:this.query,size:this.size,start:this.start,cursor:this.cursor,sort:"new"}).$promise.then(function(t){return function(n){var r,i,a,o;for(t.totalCount=n.data.notes.totalCount,o=n.data.notes.contents,i=0,a=o.length;a>i;i++)r=o[i],t.notes.push(r);return t.firstCardNote||(t.firstCardNote=t.notes[0]),n.data.notes.contents.length<t.size?t.loadedAll=!0:(t.loadedAll=!1,t.cursor=n.data.cursor,t.start=t.notes.length),e?e.resolve():void 0}}(this))},e.prototype.paging=function(){var e;return e=this.$q.defer(),this.loadedAll?void 0:(this.page++,this.fetchNotes(e),e.promise)},e}(),angular.module("noteApp").directive("searchIndex",function(){return{restrict:"E",templateUrl:"/templates/asp/searches/index",scope:{},controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl",bindToController:{}}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o){this.$window=e,this.$state=t,this.$http=n,this.$stateParams=r,this.Auth=i,this.Popeye=a,this.$timeout=o,this.Auth.then(function(e){return function(t){var n;return!t.error&&t.data.email_confirmed_flag?void e.$state.go("home.home"):(n=e.Popeye.openModal({click:e.currentUser?!1:!0,templateUrl:"/templates/asp/common/modals/activate_message",controller:["$scope",function(t){return t.activation_status="activating",e.$http({method:"POST",url:"/api/v1/sessions/activate",data:{token:r.token},timeout:3e4}).success(function(e){return e.error?"invalid"===e.error.code?(t.activation_status="error",console.log("Error occurred")):void 0:t.activation_status="complete"}),t.close=function(){return e.Popeye.closeCurrentModal()}}]}),n.closed.then(function(){return e.$window.location.href=e.$stateParams.redirectPath&&e.$stateParams.redirectPath.search(/^\/[^\/]/)>=0?e.$stateParams.redirectPath:"/"}))}}(this))}return e.inject=["$window","$state","$http","$stateParams","Auth","Popeye","$timeout"],e}(),angular.module("noteApp").directive("activate",function(){return{restrict:"E",templateUrl:"/templates/asp/sessions/activate",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l){this.$scope=e,this.$window=t,this.$location=n,this.$stateParams=r,this.$http=i,this.$timeout=a,this.$state=o,this.UserAgent=s,this.Auth=l,this.Auth.then(function(e){return e.error?void 0:e.data.id>0?o.go("home.home"):void 0})}return e.inject=["$scope","$window","$location","$stateParams","$http","$timeout","$state","UserAgent","Auth"],e.prototype.login_submit=function(){var e;if(this.$scope.login_form.$valid)return this.login&&this.login.length>0?this.password&&this.password.length>0?(this.loginError="",this.logining=!0,e={login:this.login,password:this.password,follow:this.$stateParams.follow,magazine_follow:this.$stateParams.magazineFollow,likable_id:this.$stateParams.likable_id,likables:this.$stateParams.likables},this.$http({method:"POST",url:"/api/v1/sessions/sign_in",data:e,timeout:3e4}).success(function(t){return function(n){return t.logining=!1,n.error?t.loginError=e.login.indexOf("@")>0?n.error.message.match(/cakes user/)?"cakes_user":"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304a\u3088\u3073\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002":"\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u304a\u78ba\u304b\u3081\u4e0b\u3055\u3044\u3002":t.$window.location.href=t.$stateParams.redirectPath?t.$stateParams.redirectPath:"/"}}(this)).error(function(e){return function(){return e.logining=!1,e.loginError="\u3057\u3070\u3089\u304f\u305f\u3063\u3066\u304b\u3089\u3082\u3046\u4e00\u5ea6\u304a\u8a66\u3057\u4e0b\u3055\u3044\u3002"}}(this)),"iPhone"===this.UserAgent.short||"iPad"===this.UserAgent.short?(scrollBy(0,-1),this.$timeout(function(){return scrollBy(0,1)},200)):void 0):this.loginError="\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u5165\u529b\u4e0b\u3055\u3044\u3002":this.loginError="\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u3054\u5165\u529b\u4e0b\u3055\u3044\u3002"},e}(),angular.module("noteApp").directive("login",function(){return{restrict:"E",templateUrl:"/templates/asp/sessions/login",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$scope=e,this.$location=t,this.$http=n}return e.inject=["$scope","$location","$http"],e.prototype.sendPasswordResetEmail=function(){return this.send_password_clicked=!0,this.$scope.resetPasswordForm.$invalid?void 0:(this.error=!1,this.$http({method:"POST",url:"/api/v1/sessions/reset_password",data:{email:this.email},timeout:3e4}).success(function(e){return function(t){return t.error?void(e.error=t.error.message):(e.logining=!1,e.emailSent=!0,e.send_password_clicked=!1)}}(this)).error(function(e){return function(){return e.logining=!1,e.error="\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002",e.send_password_clicked=!1}}(this)))},e}(),angular.module("noteApp").directive("resetPassword",function(){return{restrict:"E",templateUrl:"/templates/asp/sessions/reset_password",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d){return this.$window=e,this.$location=t,this.$scope=n,this.$http=r,this.$state=i,this.$stateParams=a,this.$timeout=o,this.Auth=s,this.Cookie=l,this.TempAuth=c,this.UserAgent=u,this.GuestEmailCheck=d,this.$location.search().email&&"email"===t.search().via&&(this.email=encodeURI(email).replace("%20","+"),this.GuestEmailCheck.get({email:this.email},function(e){return function(t){return"note_registerd"===t.data.status||"cakes_registerd"===t.data.status?e.guest_status=t.data.status:(e.via="email",e.hv=e.$location.search().hv)}}(this),function(){return function(e){return console.log(e.data),alert("\u304a\u624b\u6570\u3067\u3059\u304c\u3001\u6642\u9593\u3092\u7f6e\u3044\u3066\u304b\u3089\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044")}}(this))),this.Auth.then(function(e){return function(t){return t.error?void 0:t.data.id>0?e.$state.go("home.home"):void 0}}(this)),this.nourlname=!0,this.$stateParams.urlname&&this.$stateParams.code&&(this.Cookie.put("urlname",this.$stateParams.urlname),this.Cookie.put("urlnameCode",this.$stateParams.code)),this.$stateParams.page?void(this.submitted=1):void this.TempAuth.get(null,function(e){return function(t){var n;return t.error?void(e.urlname=e.Cookie.get("urlname")):(n=t.data,e.email=n.email,e.auth=n,e.urlname=e.nourlname?void 0:e.Cookie.get("urlname")||n.nickname)}}(this))}return e.inject=["$window","$location","$scope","$http","$state","$stateParams","$timeout","Auth","Cookie","TempAuth","UserAgent","GuestEmailCheck"],e.prototype.entry_submit=function(){var e,t,n,r;return t=!1,null==this.email||0===this.email.trim().length?(t=!0,this.emailRequired=!0):-1===this.email.search(/^.+@.+\..{2,}$/)?(t=!0,this.emailPattern=!0):(this.emailRequired=!1,this.emailPattern=!1),null==this.password||0===this.password.trim().length?(t=!0,this.passwordRequired=!0):this.password.trim().length<6?(t=!0,this.passwordLength=!0):(this.passwordRequired=!1,this.passwordLength=!1),this.nourlname||(null==this.urlname||0===this.urlname.trim().length?(t=!0,this.urlnameRequired=!0):this.urlnameRequired=!1,this.urlnameStartedWithUnderScore="_"===(null!=(r=this.urlname)?r.charAt(0):void 0)),null==this.terms||this.terms!==!0?(t=!0,this.noAgreement=!0):this.noAgreement=!1,!t&&this.$scope.entry_form.$valid?(this.sending=!0,n={email:this.email,password:this.password,password_confirmation:this.password,urlname:this.urlname,nickname:this.nickname,follow:this.$stateParams.follow,magazine_follow:this.$stateParams.magazineFollow,likable_id:this.$stateParams.likable_id,likables:this.$stateParams.likables,redirect_path:this.$stateParams.redirectPath,urlname_code:this.Cookie.get("urlnameCode"),captcha:this.captcha,captcha_key:$("#captcha_key").val(),provider:null!=this.auth?this.auth.provider:null,from:this.$stateParams.from,note_key:this.$stateParams.nkey,via:this.via,hv:this.hv},e=this.$window.document.querySelector("#g-recaptcha-response"),e&&(n.g_recaptcha_response=e.value),this.$http({method:"POST",url:"/api/v1/sessions/sign_up",data:n,timeout:3e4}).success(function(e){return function(t){return t.error?"duplicate_email"===t.error.code?(e.emailDuplicate=!0,e.emailDuplicateCakes=!!t.error.message.match(/cakes user/)):"duplicate_urlname"===t.error.code?e.urlnameDuplicate=!0:"invalid"===t.error.code?alert(t.error.message):"invalid_email_pattern"===t.error.code&&(e.emailPattern=!0):(e.Cookie.remove("urlname"),e.Cookie.remove("urlnameCode"),e.nourlname?e.submitted="email"===e.via?101:100:e.redirectAfterSignup()),e.sending=!1}}(this)).error(function(e){return function(t,n){return 403===n&&("Captcha required"===t.error?e.$window.location.href="/signup":alert("Captcha\u304c\u4e0d\u6b63\u3067\u3059\u3002")),e.sending=!1}}(this)),"iPhone"===this.UserAgent.short||"iPad"===this.UserAgent.short?(scrollBy(0,-1),this.$timeout(function(){return scrollBy(0,1)},200)):void 0):void 0},e.prototype.goHome=function(){return this.$window.location.href="/"},e.prototype.goToRedirectPath=function(){return this.$window.location.href=this.$location.search().redirectPath||"/"},e}(),angular.module("noteApp").directive("signup",function(){return{restrict:"E",templateUrl:"/templates/asp/sessions/signup",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r){this.$window=e,this.$stateParams=t,this.MyEmail=n,this.Cookie=r,this.activationStatus="updating",this.MyEmail.save({action:"confirm",token:this.$stateParams.token},function(e){return function(){return e.Cookie.put("email_updated",!0),setTimeout(function(){return e.$window.location.href="/settings/account"},2e3)}}(this),function(e){return function(){return e.Cookie.put("email_update_failed",!0),setTimeout(function(){return e.$window.location.href="/settings/account"},2e3)}}(this))}return e.inject=["$window","$stateParams","MyEmail","Cookie"],e}(),angular.module("noteApp").directive("updateEmail",function(){return{restrict:"E",templateUrl:"/templates/asp/sessions/update_email",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){this.$http=e,this.$scope=t,this.$stateParams=n,this.password="",this.password_confirmation="",this.error=!1,this.$http({method:"POST",url:"/api/v1/sessions/check_token",data:{token:this.$stateParams.token},timeout:3e4}).success(function(e){return function(t){return e.logining=!1,t.error?e.invalidTokenError=!0:void 0}}(this)).error(function(){return function(){}}(this))}return e.inject=["$http","$scope","$stateParams"],e.prototype.successConfirmation=function(){return this.password===this.password_confirmation},e.prototype.updatePassword=function(){return this.$scope.form.$valid?(this.error=!1,this.success=!1,this.$http({method:"POST",url:"/api/v1/sessions/update_password",data:{password:this.password,password_confirmation:this.password_confirmation,token:this.$stateParams.token},timeout:3e4}).success(function(e){return function(){return e.error=!1,e.success=!0}}(this)).error(function(e){return function(){return e.error=!0,e.success=!1}}(this))):void 0},e}(),angular.module("noteApp").directive("updatePassword",function(){return{restrict:"E",templateUrl:"/templates/asp/sessions/update_password",scope:{},controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_){this.$scope=e,this.$window=t,this.Auth=n,this.OAuth=r,this.MySettings=i,this.PickUrlname=a,this.CurrentUserAPI=o,this.MyEmail=s,this.MyPassword=l,this.MyNewsletterSetting=c,this.MyPurchaseNoticeSetting=u,this.MyFollowNoticeSetting=d,this.MyCommentNoticeSetting=p,this.MyLikeNoticeSetting=h,this.MyCommentToNoticeSetting=m,this.MyMagazineNoteAddNoticeSetting=f,this.MyPurchaseMagazineNoteAddNoticeSetting=g,this.MyUserSettings=v,this.MessageModal=y,this.Cookie=b,this.$http=_,this.providers={},this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,e.isLoggedIn=!0,e.emailFormData={email:e.currentUser.email},e.urlnameFormData={urlname:e.currentUser.urlname},e.nicknameFormData={nickname:e.currentUser.nickname},e.OAuth.get(null,function(t){var n,r,i,a;if(!t.error){for(a=t.data.authentications,r=0,i=a.length;i>r;r++)n=a[r],e.providers[n.provider]=n;return e.MySettings.get(null,function(t){return e.notice_settings=t.data.notice_settings,e.user_settings=t.data.user_settings,"true"===e.Cookie.get("email_updated")?(e.Cookie.remove("email_updated"),e.MessageModal.show({message:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"})):"true"===e.Cookie.get("email_update_failed")?(e.Cookie.remove("email_update_failed"),e.MessageModal.show({message:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u66f4\u65b0\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"})):void 0
})}},function(){return console.log("Error occurred")}))}}(this))}return e.injects=["$scope","$window","Auth","OAuth","MySettings","PickUrlname","CurrentUserAPI","MyEmail","MyPassword","MyNewsletterSetting","MyPurchaseNoticeSetting","MyFollowNoticeSetting","MyCommentNoticeSetting","MyLikeNoticeSetting","MyCommentToNoticeSetting","MyMagazineNoteAddNoticeSetting","MyPurchaseMagazineNoteAddNoticeSetting","MyUserSettings","MessageModal","Cookie","$http"],e.prototype.setEditMode=function(e){return this.currentUserBackup=angular.copy(this.currentUser),"email"===e?this.editEmail=!0:"password"===e?this.editPassword=!0:"tokusyo"===e?this.editTokusyo=!0:"urlname"===e?this.editUrlname=!0:"nickname"===e?this.editNickname=!0:void 0},e.prototype.cancelEditMode=function(e){return this.currentUser=this.currentUserBackup,this.tokusyo_ok_clicked=!1,"email"===e?(this.editEmail=!1,this.emailFormData={email:this.currentUser.email}):"password"===e?this.editPassword=!1:"tokusyo"===e?this.editTokusyo=!1:"urlname"===e?this.editUrlname=!1:"nickname"===e?this.editNickname=!1:void 0},e.prototype.removeProvider=function(e){return this.OAuth["delete"]({provider:e},function(t){return function(){return delete t.providers[e]}}(this),function(){return console.log("Error occurred")})},e.prototype.toggleEditMode=function(e){return this.editMode=!!e,this.editMode?(this.currentCreditCard=angular.copy(this.creditCard),this._email=this.currentUser.email,this._profile=this.currentUser.profile,this._nickname=this.currentUser.nickname,this.creditCard=this.creditCard,this.creditCard.number=""):void 0},e.prototype.toggleNoticeSetting=function(e){var t;if(!t)switch(t=!0,e.type){case"NewsletterSetting":return this.MyNewsletterSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"PurchaseNoticeSetting":return this.MyPurchaseNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"FollowNoticeSetting":return this.MyFollowNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"CommentNoticeSetting":return this.MyCommentNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"LikeNoticeSetting":return this.MyLikeNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"CommentToNoticeSetting":return this.MyCommentToNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"MagazineNoteAddNoticeSetting":return this.MyMagazineNoteAddNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this));case"PurchaseMagazineNoteAddNoticeSetting":return this.MyPurchaseMagazineNoteAddNoticeSetting.save(null,function(){return function(n){return e.send_flag=n.data.status,t=!1}}(this))}},e.prototype.toggleUserSetting=function(e){var t;switch(e.type){case"SupportEnableSetting":return t=!e.value,this.MyUserSettings.save({support_enabled:t},function(){return function(t){return e.value=t.data.status}}(this),function(){return function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}}(this));case"PromotionAllowSetting":return t=!e.value,this.MyUserSettings.save({promotion_allowed:t},function(){return function(t){return e.value=t.data.status}}(this),function(){return function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}}(this));case"CommentEnableSetting":return t=!e.value,this.MyUserSettings.save({comment_enabled:t},function(){return function(t){return e.value=t.data.status}}(this),function(){return function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}}(this));case"SerifEnableSetting":return t=!e.value,this.MyUserSettings.save({serif_enabled:t},function(){return function(t){return e.value=t.data.status}}(this),function(){return function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}}(this));case"PurchaseGuestAllowSetting":return t=!e.value,this.MyUserSettings.save({purchase_guest_allowed:t},function(){return function(t){return e.value=t.data.status}}(this),function(){return function(){return alert("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}}(this))}},e.prototype.updateUrlname=function(){return this.urlname_ok_clicked=!0,this.urlnameForm.$invalid?void 0:this.PickUrlname.save({urlname:this.urlnameFormData.urlname},function(e){return function(t){return e.sending=!1,t.error?void(e.error=t.error.message):(e.currentUser=t.data,e.editUrlname=!1)}}(this))},e.prototype.updateNickname=function(){var e;return this.nickname_ok_clicked=!0,this.$scope.nicknameForm.$invalid?void 0:(e={nickname:this.nicknameFormData.nickname},this.CurrentUserAPI.update(e,function(e){return function(t){return e.sending=!1,t.error?void(e.error=t.error.message):(e.currentUser=t.data,e.editNickname=!1)}}(this)))},e.prototype.updateEmail=function(){return this.email_ok_clicked=!0,this.$scope.emailForm.$invalid?void 0:this.MyEmail.save({email:this.emailFormData.email},function(e){return function(t){return t.error?void e.MessageModal.show((t.error.code="duplicate_email")?{message:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u65e2\u306b\u5b58\u5728\u3057\u307e\u3059\u3002"}:{message:"\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u3059\u3002"}):(e.MessageModal.show({message:"\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f\u3002"}),e.editEmail=!1)}}(this))},e.prototype.updatePassword=function(){return this.password_ok_clicked=!0,this.$scope.accountForm.$invalid?void 0:this.MyPassword.save({old_password:this.$scope.$parent.currentUser.password,new_password:this.$scope.$parent.currentUser.new_password},function(e){return function(t){return t.error?void e.MessageModal.show({message:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"}):(e.MessageModal.show({message:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002"}),e.editPassword=!1,e.$scope.$parent.currentUser.new_password=null,e.$scope.$parent.currentUser.password=null,e.password_ok_clicked=!1)}}(this),function(){return console.log("Error occurred")})},e.prototype.linkTo=function(e){return this.$window.location.href=e},e.prototype.logout=function(){return this.$http({method:"POST",url:"/api/v1/sessions/sign_out",timeout:3e4}).success(function(e){return function(){return e.$window.location.href="/"}}(this)).error(function(){return console.log("Error occurred")})},e}(),angular.module("noteApp").directive("accountSetting",["$timeout","$document",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/settings/account",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl"}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e){this.Auth=e,this.Auth.then(function(e){return e.error?this.isLoggedIn=!1:(this.currentUser=e.data,this.isLoggedIn=!0)})}return e.injects=["Auth"],e}(),angular.module("noteApp").directive("accountWithdrawal",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/settings/withdrawal",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n){var r,i,a;this.Auth=e,this.MyCreditCard=t,this.AutoHideNotification=n,r=new Date,i=r.getFullYear(),this.months=[1,2,3,4,5,6,7,8,9,10,11,12],this.years=function(){a=[];for(var e=i,t=i+10;t>=i?t>=e:e>=t;t>=i?e++:e--)a.push(e);return a}.apply(this),this.Auth.then(function(e){return function(t){return t.error?(e.error=t.error,void(e.isLoggedIn=!1)):(e.currentUser=t.data,e.isLoggedIn=!0,e.loaded=!1,e.MyCreditCard.get(null,function(t){return e.loaded=!0,null!=t.error?(e.creditCard.expiryMonth=month,void(e.creditCard.expiryYear=e.years[0])):e.creditCard=t.data},function(){return e.AutoHideNotification.error("","\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))}}(this))}return e.injects=["Auth","MyCreditCard","AutoHideNotification"],e.prototype.deleteCard=function(){return confirm("\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")?this.MyCreditCard["delete"](null,function(e){return function(t){return t.error?void("invalid"===t.error.code&&alert(t.error.message)):e.creditCard=null}}(this)):void 0},e.prototype.toggleEditMode=function(e){return this.editMode=!!e,this.editMode?(this.currentCreditCard=angular.copy(this.creditCard),this._email=this.currentUser.email,this._profile=this.currentUser.profile,this._nickname=this.currentUser.nickname,this.creditCard=this.creditCard,this.creditCard.number=""):void 0},e.prototype.cancelCreditCardEdit=function(){return this.creditCard=this.currentCreditCard,this.editMode=!1},e.prototype.updateCreditCardSetting=function(){var e;return e=new this.MyCreditCard,e.number=this.creditCard.number,e.expiryMonth=this.creditCard.expiryMonth,e.expiryYear=this.creditCard.expiryYear,e.name=this.creditCard.name,e.cvc=this.creditCard.cvc,e.$save(null,function(e){return function(){return e.AutoHideNotification.success("","\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002"),e.toggleEditMode(!1),e.creditCard.number="************"+e.creditCard.number.substr(-4,4),e.creditCard.cvc=null,e.errorMsgs=[]}}(this),function(e){return function(t){return e.AutoHideNotification.error("","\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.errorMsgs=t.data.error}}(this))},e}(),angular.module("noteApp").directive("creditCard",["$timeout","$document",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/settings/credit_card",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl"}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(e,t,n,r,i,a,o,s,l){this.$location=e,this.$stateParams=t,this.Auth=n,this.PurchaseHistory=r,this.SubscriptionHistory=i,this.AutoHideNotification=a,this.EcHistoryOrders=o,this.EcService=s,this.Popeye=l,this.purchaseTypes=[{key:"note_magazine",label:"\u8a18\u4e8b\u30fb\u9023\u8f09"}],this.ecService=this.EcService,this.Auth.then(function(e){return function(n){var r;return n.error?(e.error=n.error,void(e.isLoggedIn=!1)):(e.currentUser=n.data,e.isLoggedIn=!0,r=e.$stateParams.date,e.currentUser.is_item_purchased?(e.purchaseTypes.push({key:"item",label:"\u30a2\u30a4\u30c6\u30e0"}),e.purchaseType=e.setPurchaseType(t.type)):e.purchaseType="note_magazine","note_magazine"===e.purchaseType?e.PurchaseHistory.get({datespan:r},function(t){return null!=t.error?void(e.error=t.error):(e.purchaseHistory=t.data.payments,e.datespans=t.data.datespans,e.SubscriptionHistory.get({datespan:r},function(t){var n,i,a,o,s,l,c,u,d;if(null!=t.error)return void(e.error=t.error);for(e.subscriptionHistory=t.data.subscriptions,u=t.data.datespans,o=0,l=u.length;l>o;o++){for(i=u[o],n=!1,d=e.datespans,s=0,c=d.length;c>s;s++)a=d[s],i.span===a.span&&(n=!0);n||e.datespans.push(i)}return e.datespans=e.datespans.sort(function(e,t){return e.span-t.span}),e.processDatespans(r)},function(){return e.AutoHideNotification.error("","\u8cfc\u8aad\u5c65\u6b74\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}))},function(){return e.AutoHideNotification.error("","\u8cfc\u5165\u5c65\u6b74\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}):"item"===e.purchaseType?e.EcHistoryOrders.get({datespan:r},function(t){return t.error?void(e.error=t.error):(e.orderHistory=t.data.orders.orders,e.datespans=t.data.datespans,e.processDatespans(r))},function(){return e.AutoHideNotification.error("","\u8cfc\u5165\u5c65\u6b74\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}):void 0)}}(this))}return e.injects=["$location","$stateParams","Auth","PurchaseHistory","SubscriptionHistory","AutoHideNotification","EcHistoryOrders","EcService","Popeye"],e.prototype.processDatespans=function(e){return this.datespans.length>0?(this.datespan=this.datespans[this.datespans.length-1],angular.forEach(this.datespans,function(t){return function(n){return n.span===e?t.datespan=n:void 0}}(this))):void 0},e.prototype.updateDatespan=function(e,t){return this.$location.url("/settings/purchase_history?date="+e.span+("&type="+t)).replace()},e.prototype.showReceipt=function(e,t,n){var r;r=this.Popeye.openModal({templateUrl:"/templates/modal/receipt_address",controller:["$scope","$rootScope",function(i){return i.data={},i.close=function(){return r.close()},i.receipt=function(){var a,o,s,l,c;if(i.data.userAddress.length>0){o=document.createElement("form"),o.setAttribute("target","_blank"),o.setAttribute("method","post"),a="item"===n?"print_ec":"print",o.setAttribute("action","receipt/"+a),c={order_id:e,userAddress:i.data.userAddress,datespan:t};for(l in c)c.hasOwnProperty(l)&&(s=document.createElement("input"),s.setAttribute("type","hidden"),s.setAttribute("name",l),s.setAttribute("value",c[l]),o.appendChild(s));document.body.appendChild(o),o.submit()}else alert("Address cant be blank");return r.close()}}]})},e}(),angular.module("noteApp").directive("purchaseHistory",["$timeout","$document",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/settings/purchase_history",controller:t.call(e.injects).concat([e]),controllerAs:"$ctrl"}}])}.call(this),function(){"use strict";var e,t=[].slice;e=function(){function e(){}return e.inject=[],e}(),angular.module("noteApp").directive("settingBase",function(){return{restrict:"E",scope:{},templateUrl:"/templates/asp/settings/base",controller:t.call(e.inject).concat([e]),controllerAs:"$ctrl"}})}.call(this),function(){"use strict";angular.module("noteApp").service("AdManageService",function(){var e,t;return e=function(){function e(){this.manage={cci:{targets:[],displayeds:[]},aja:{targets:[],displayeds:[]}}}return e.prototype.addTarget=function(e,t){return this.manage[e].targets.push(t)},e.prototype.addDisplayed=function(e,t){return this.manage[e].displayeds.push(t),this.watch(e)},e.prototype.clear=function(e){return this.manage[e].targets=[],this.manage[e].displayeds=[]},e.prototype.watch=function(e){var t,n;switch(e){case"cci":window.PREFETCH.NOTE.enableAdCci&&ADTECH.executeQueue();break;case"aja":t=document.createElement("script"),t.src="https://cdn.as.amanad.adtdp.com/sdk/asot-v2.js",t.async=!0,t.setAttribute("data-aja-meta-search","true"),n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}return this.clear(e)},e}(),t=new e})}.call(this),function(){"use strict";angular.module("noteApp").factory("ArticleContextService",function(){var e,t;return t={},e={set:function(e,n,r){return t.note=e,t.currentUser=n,t.paywallContext=r},get:function(){return t}}})}.call(this),function(){"use strict";angular.module("noteApp").factory("AuthorContextServive",["$state","$rootScope","$q","$interval","Creators","CreatorContents","CreatorPickupContents","CreatorArchives",function(e,t,n,r,i,a,o,s){var l,c;return l=function(){function l(){this.$state=e,this.$rootScope=t,this.$q=n,this.$interval=r,this.Creators=i,this.CreatorContents=a,this.CreatorPickupContents=o,this.CreatorArchives=s}return l.prototype.HOME_MENU={id:-1,kind:"home"},l.prototype.MAGAZINE_MENU={id:-2,kind:"magazine"},l.prototype.SEARCH_MENU={id:-3,kind:"search"},l.prototype.init=function(e){return this.ctx={user:window.PREFETCH.NOTE.user,currentTab:null,isPC:this.$rootScope.isPC,isSmartPhone:this.$rootScope.isSmartPhone,notes:[],magazines:[],currentPage:0,isLoading:!1,isLastPage:!1,noteArchivesSelects:[],noteArchiveSelectedKey:null,notesTotalCount:0,magazinesTotalCount:0,pickupMagazinesCount:0,creatorWidgets:[],displayMode:"view"},this.Creators.get({urlname:e},function(e){return function(t){return e.ctx.author=t.data,e.ctx.author.is_following=e.ctx.author.isFollowing,e.ctx.author.user_profile_image_path=e.ctx.author.profileImageUrl,e.ctx.initialized=!0}}(this),function(){return function(e){return console.log(e)}}(this))},l.prototype.set=function(e,t){return this.ctx.author=e,this.ctx.user=t},l.prototype.get=function(){var e,t;return e=this.$q.defer(),t=this.$interval(function(n){return function(){return n.ctx.initialized?(n.$interval.cancel(t),e.resolve(n.ctx)):void 0}}(this),10),e.promise},l.prototype.changeCurrentTab=function(e){switch(this.ctx.currentTab=e.kind,this.ctx.currentTab){case"home":return this.loadNotes(),this.loadPickupContents();case"magazine":return this.loadMagazines();case"search":return this.loadArchives();default:return this.loadMenu(e)}},l.prototype.loadNotes=function(e){return null==e&&(e=1),this.loadContents("note",e)},l.prototype.loadMagazines=function(e){return null==e&&(e=1),this.loadContents("magazine",e)},l.prototype.loadContents=function(e,t,n,r,i){return null==t&&(t=1),null==n&&(n=null),null==r&&(r=!1),null==i&&(i=null),this.ctx.isLoading=!0,this.ctx.currentKind=e,this.ctx.currentPage=t,this.ctx.currentMenuId=i,this.CreatorContents.get({urlname:this.ctx.author.urlname,kind:e,page:t,publish_on:n,disabled_pinned:r,menu_id:i},function(e){return function(t){var n,r,i,a,o,s,l,c;if("note"===e.ctx.currentKind){for(l=t.data.contents,i=0,o=l.length;o>i;i++)r=l[i],e.ctx.notes.push(r);e.ctx.notesTotalCount=t.data.totalCount,!e.isCurrentTabFor("home")&&!e.isCurrentTabFor("custom_menu")||e.ctx.isPC||1!==e.ctx.currentPage||(e.ctx.notes.length<=2?(e.ctx.firstViewNotes=e.ctx.notes,e.ctx.secondViewNotes=[]):(e.ctx.firstViewNotes=e.ctx.notes.slice(0,2),e.ctx.secondViewNotes=e.ctx.notes.slice(2)),e.notes=[])}else{for(c=t.data.contents,a=0,s=c.length;s>a;a++)n=c[a],e.ctx.magazines.push(n);e.ctx.magazinesTotalCount=t.data.totalCount}return e.ctx.isLoading=!1,e.ctx.isLastPage=t.data.isLastPage}}(this),function(e){return function(t){return console.log(t),e.ctx.isLoading=!1}}(this))},l.prototype.loadPickupContents=function(){return this.CreatorPickupContents.get({urlname:this.ctx.author.urlname,kind:"magazine"},function(e){return function(t){return e.ctx.magazines=t.data.magazines,e.ctx.creatorWidgets=t.data.creatorWidgets,e.ctx.pickupMagazinesCount=e.ctx.magazines.length}}(this),function(){return function(e){return console.log(e)}}(this))},l.prototype.loadArchives=function(){return this.CreatorArchives.get({urlname:this.ctx.author.urlname},function(e){return function(t){var n,r,i,a,o,s;for(o=t.data,s=[],i=0,a=o.length;a>i;i++)r=o[i],s.push(function(){var e,t,i,a;for(i=r.details,a=[],e=0,t=i.length;t>e;e++)n=i[e],a.push(this.ctx.noteArchivesSelects.push({key:n.summaryDate,value:""+r.year+"\u5e74"+n.month+"\u6708"}));return a}.call(e));return s}}(this),function(){return function(){}}(this))},l.prototype.loadMenu=function(e){var t;return"link"===e.kind?(t={urlname:e.urlname,key:e.noteKey,creator_urlname:this.ctx.author.urlname,current_menu_id:e.id},this.$state.go("showTextNoteFriendly",t)):"tag"===e.kind?this.loadContents("note",1,null,!1,e.id):void 0},l.prototype.paging=function(){return this.ctx.currentPage>0&&!this.ctx.isLoading&&!this.ctx.isLastPage?this.isCurrentTabFor("home")||this.isCurrentTabFor("magazine")||this.isCurrentTabFor("custom_menu")?this.loadContents(this.ctx.currentKind,this.ctx.currentPage+1,null,!1,this.ctx.currentMenuId):this.loadContents(this.ctx.currentKind,this.ctx.currentPage+1,this.ctx.noteArchiveSelectedKey,!0):void 0},l.prototype.isCurrentTabFor=function(e){return this.ctx.currentTab===e?!0:"custom_menu"!==e||"tag"!==this.ctx.currentTab&&"link"!==this.ctx.currentTab?!1:!0},l.prototype.loadNotesByArchive=function(){return this.ctx.noteArchiveSelectedKey?(this.ctx.notes=[],this.loadContents("note",1,this.ctx.noteArchiveSelectedKey,!0)):void 0},l}(),c=new l}])}.call(this),function(){"use strict";angular.module("noteApp").factory("SlickContextSercice",function(){var e,t;return e=function(){function e(){this.ctx={},this.setSlickConfigs()}return e.prototype.get=function(){return this.ctx},e.prototype.setSlickConfigs=function(){return this.ctx.sparkSlickConfig={slide:".item",arrows:!1,slidesToShow:3,autoplay:!1,unslick:!0,appendArrows:"#spark .header",prevArrow:'<button type="button" class="slick-prev"><i class="i-arrow-left"></i></button>',nextArrow:'<button type="button" class="slick-next"><i class="i-arrow-right"></i></button>',method:{},responsive:[{breakpoint:640,settings:{arrows:!0,slidesToShow:2,variableWidth:!0,centerMode:!0,centerPadding:"0",infinite:!0,draggable:!0,autoplay:!0,autoplaySpeed:2e3,pauseOnHover:!1}}]},this.ctx.featureSlickConfig={infinite:!0,variableWidth:!0,centerPadding:"0",centerMode:!0,appendArrows:"#feature .header",prevArrow:'<button type="button" class="slick-prev"><i class="i-arrow-left"></i></button>',nextArrow:'<button type="button" class="slick-next"><i class="i-arrow-right"></i></button>',responsive:[{breakpoint:640,settings:{centerMode:!0}}]},this.ctx.collectionSlickConfig={slide:".item",infinite:!0,centerPadding:"0",variableWidth:!0,centerMode:!0,prevArrow:'<button type="button" class="slick-prev"><i class="i-arrow-left"></i></button>',nextArrow:'<button type="button" class="slick-next"><i class="i-arrow-right"></i></button>'},this.ctx.instagramSlickConfig={slide:".grid-item",infinite:!0,variableWidth:!0,arrows:!1,speed:14e3,autoplaySpeed:0,autoplay:!0,cssEase:"linear",slidesToShow:7}},e}(),t=new e})}.call(this),!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";var t=window.Slick||{};t=function(){function t(t,r){var i,a=this;a.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:e(t),appendDots:e(t),arrows:!0,asNavFor:null,prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(t,n){return e('<button type="button" data-role="none" role="button" tabindex="0" />').text(n+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},a.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},e.extend(a,a.initials),a.activeBreakpoint=null,a.animType=null,a.animProp=null,a.breakpoints=[],a.breakpointSettings=[],a.cssTransitions=!1,a.focussed=!1,a.interrupted=!1,a.hidden="hidden",a.paused=!0,a.positionProp=null,a.respondTo=null,a.rowCount=1,a.shouldClick=!0,a.$slider=e(t),a.$slidesCache=null,a.transformType=null,a.transitionType=null,a.visibilityChange="visibilitychange",a.windowWidth=0,a.windowTimer=null,i=e(t).data("slick")||{},a.options=e.extend({},a.defaults,r,i),a.currentSlide=a.options.initialSlide,a.originalSettings=a.options,"undefined"!=typeof document.mozHidden?(a.hidden="mozHidden",a.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(a.hidden="webkitHidden",a.visibilityChange="webkitvisibilitychange"),a.autoPlay=e.proxy(a.autoPlay,a),a.autoPlayClear=e.proxy(a.autoPlayClear,a),a.autoPlayIterator=e.proxy(a.autoPlayIterator,a),a.changeSlide=e.proxy(a.changeSlide,a),a.clickHandler=e.proxy(a.clickHandler,a),a.selectHandler=e.proxy(a.selectHandler,a),a.setPosition=e.proxy(a.setPosition,a),a.swipeHandler=e.proxy(a.swipeHandler,a),a.dragHandler=e.proxy(a.dragHandler,a),a.keyHandler=e.proxy(a.keyHandler,a),a.instanceUid=n++,a.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,a.registerBreakpoints(),a.init(!0)}var n=0;return t}(),t.prototype.activateADA=function(){var e=this;e.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},t.prototype.addSlide=t.prototype.slickAdd=function(t,n,r){var i=this;if("boolean"==typeof n)r=n,n=null;else if(0>n||n>=i.slideCount)return!1;i.unload(),"number"==typeof n?0===n&&0===i.$slides.length?e(t).appendTo(i.$slideTrack):r?e(t).insertBefore(i.$slides.eq(n)):e(t).insertAfter(i.$slides.eq(n)):r===!0?e(t).prependTo(i.$slideTrack):e(t).appendTo(i.$slideTrack),i.$slides=i.$slideTrack.children(this.options.slide),i.$slideTrack.children(this.options.slide).detach(),i.$slideTrack.append(i.$slides),i.$slides.each(function(t,n){e(n).attr("data-slick-index",t)}),i.$slidesCache=i.$slides,i.reinit()},t.prototype.animateHeight=function(){var e=this;if(1===e.options.slidesToShow&&e.options.adaptiveHeight===!0&&e.options.vertical===!1){var t=e.$slides.eq(e.currentSlide).outerHeight(!0);e.$list.animate({height:t},e.options.speed)}},t.prototype.animateSlide=function(t,n){var r={},i=this;i.animateHeight(),i.options.rtl===!0&&i.options.vertical===!1&&(t=-t),i.transformsEnabled===!1?i.options.vertical===!1?i.$slideTrack.animate({left:t},i.options.speed,i.options.easing,n):i.$slideTrack.animate({top:t},i.options.speed,i.options.easing,n):i.cssTransitions===!1?(i.options.rtl===!0&&(i.currentLeft=-i.currentLeft),e({animStart:i.currentLeft}).animate({animStart:t},{duration:i.options.speed,easing:i.options.easing,step:function(e){e=Math.ceil(e),i.options.vertical===!1?(r[i.animType]="translate("+e+"px, 0px)",i.$slideTrack.css(r)):(r[i.animType]="translate(0px,"+e+"px)",i.$slideTrack.css(r))},complete:function(){n&&n.call()}})):(i.applyTransition(),t=Math.ceil(t),r[i.animType]=i.options.vertical===!1?"translate3d("+t+"px, 0px, 0px)":"translate3d(0px,"+t+"px, 0px)",i.$slideTrack.css(r),n&&setTimeout(function(){i.disableTransition(),n.call()},i.options.speed))},t.prototype.getNavTarget=function(){var t=this,n=t.options.asNavFor;return n&&null!==n&&(n=e(n).not(t.$slider)),n},t.prototype.asNavFor=function(t){var n=this,r=n.getNavTarget();null!==r&&"object"==typeof r&&r.each(function(){var n=e(this).slick("getSlick");n.unslicked||n.slideHandler(t,!0)})},t.prototype.applyTransition=function(e){var t=this,n={};n[t.transitionType]=t.options.fade===!1?t.transformType+" "+t.options.speed+"ms "+t.options.cssEase:"opacity "+t.options.speed+"ms "+t.options.cssEase,t.options.fade===!1?t.$slideTrack.css(n):t.$slides.eq(e).css(n)},t.prototype.autoPlay=function(){var e=this;e.autoPlayClear(),e.slideCount>e.options.slidesToShow&&(e.autoPlayTimer=setInterval(e.autoPlayIterator,e.options.autoplaySpeed))},t.prototype.autoPlayClear=function(){var e=this;e.autoPlayTimer&&clearInterval(e.autoPlayTimer)},t.prototype.autoPlayIterator=function(){var e=this,t=e.currentSlide+e.options.slidesToScroll;e.paused||e.interrupted||e.focussed||(e.options.infinite===!1&&(1===e.direction&&e.currentSlide+1===e.slideCount-1?e.direction=0:0===e.direction&&(t=e.currentSlide-e.options.slidesToScroll,e.currentSlide-1===0&&(e.direction=1))),e.slideHandler(t))},t.prototype.buildArrows=function(){var t=this;t.options.arrows===!0&&(t.$prevArrow=e(t.options.prevArrow).addClass("slick-arrow"),t.$nextArrow=e(t.options.nextArrow).addClass("slick-arrow"),t.slideCount>t.options.slidesToShow?(t.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),t.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.prependTo(t.options.appendArrows),t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.appendTo(t.options.appendArrows),t.options.infinite!==!0&&t.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):t.$prevArrow.add(t.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},t.prototype.buildDots=function(){var t,n,r=this;if(r.options.dots===!0&&r.slideCount>r.options.slidesToShow){for(r.$slider.addClass("slick-dotted"),n=e("<ul />").addClass(r.options.dotsClass),t=0;t<=r.getDotCount();t+=1)n.append(e("<li />").append(r.options.customPaging.call(this,r,t)));r.$dots=n.appendTo(r.options.appendDots),r.$dots.find("li").first().addClass("slick-active").attr("aria-hidden","false")}},t.prototype.buildOut=function(){var t=this;t.$slides=t.$slider.children(t.options.slide+":not(.slick-cloned)").addClass("slick-slide"),t.slideCount=t.$slides.length,t.$slides.each(function(t,n){e(n).attr("data-slick-index",t).data("originalStyling",e(n).attr("style")||"")}),t.$slider.addClass("slick-slider"),t.$slideTrack=0===t.slideCount?e('<div class="slick-track"/>').appendTo(t.$slider):t.$slides.wrapAll('<div class="slick-track"/>').parent(),t.$list=t.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent(),t.$slideTrack.css("opacity",0),(t.options.centerMode===!0||t.options.swipeToSlide===!0)&&(t.options.slidesToScroll=1),e("img[data-lazy]",t.$slider).not("[src]").addClass("slick-loading"),t.setupInfinite(),t.buildArrows(),t.buildDots(),t.updateDots(),t.setSlideClasses("number"==typeof t.currentSlide?t.currentSlide:0),t.options.draggable===!0&&t.$list.addClass("draggable")},t.prototype.buildRows=function(){var e,t,n,r,i,a,o,s=this;if(r=document.createDocumentFragment(),a=s.$slider.children(),s.options.rows>1){for(o=s.options.slidesPerRow*s.options.rows,i=Math.ceil(a.length/o),e=0;i>e;e++){var l=document.createElement("div");for(t=0;t<s.options.rows;t++){var c=document.createElement("div");for(n=0;n<s.options.slidesPerRow;n++){var u=e*o+(t*s.options.slidesPerRow+n);a.get(u)&&c.appendChild(a.get(u))}l.appendChild(c)}r.appendChild(l)}s.$slider.empty().append(r),s.$slider.children().children().children().css({width:100/s.options.slidesPerRow+"%",display:"inline-block"})}},t.prototype.checkResponsive=function(t,n){var r,i,a,o=this,s=!1,l=o.$slider.width(),c=window.innerWidth||e(window).width();if("window"===o.respondTo?a=c:"slider"===o.respondTo?a=l:"min"===o.respondTo&&(a=Math.min(c,l)),o.options.responsive&&o.options.responsive.length&&null!==o.options.responsive){i=null;for(r in o.breakpoints)o.breakpoints.hasOwnProperty(r)&&(o.originalSettings.mobileFirst===!1?a<o.breakpoints[r]&&(i=o.breakpoints[r]):a>o.breakpoints[r]&&(i=o.breakpoints[r]));null!==i?null!==o.activeBreakpoint?(i!==o.activeBreakpoint||n)&&(o.activeBreakpoint=i,"unslick"===o.breakpointSettings[i]?o.unslick(i):(o.options=e.extend({},o.originalSettings,o.breakpointSettings[i]),t===!0&&(o.currentSlide=o.options.initialSlide),o.refresh(t)),s=i):(o.activeBreakpoint=i,"unslick"===o.breakpointSettings[i]?o.unslick(i):(o.options=e.extend({},o.originalSettings,o.breakpointSettings[i]),t===!0&&(o.currentSlide=o.options.initialSlide),o.refresh(t)),s=i):null!==o.activeBreakpoint&&(o.activeBreakpoint=null,o.options=o.originalSettings,t===!0&&(o.currentSlide=o.options.initialSlide),o.refresh(t),s=i),t||s===!1||o.$slider.trigger("breakpoint",[o,s])}},t.prototype.changeSlide=function(t,n){var r,i,a,o=this,s=e(t.currentTarget);switch(s.is("a")&&t.preventDefault(),s.is("li")||(s=s.closest("li")),a=o.slideCount%o.options.slidesToScroll!==0,r=a?0:(o.slideCount-o.currentSlide)%o.options.slidesToScroll,t.data.message){case"previous":i=0===r?o.options.slidesToScroll:o.options.slidesToShow-r,o.slideCount>o.options.slidesToShow&&o.slideHandler(o.currentSlide-i,!1,n);break;case"next":i=0===r?o.options.slidesToScroll:r,o.slideCount>o.options.slidesToShow&&o.slideHandler(o.currentSlide+i,!1,n);break;case"index":var l=0===t.data.index?0:t.data.index||s.index()*o.options.slidesToScroll;o.slideHandler(o.checkNavigable(l),!1,n),s.children().trigger("focus");break;default:return}},t.prototype.checkNavigable=function(e){var t,n,r=this;if(t=r.getNavigableIndexes(),n=0,e>t[t.length-1])e=t[t.length-1];else for(var i in t){if(e<t[i]){e=n;break}n=t[i]}return e},t.prototype.cleanUpEvents=function(){var t=this;t.options.dots&&null!==t.$dots&&e("li",t.$dots).off("click.slick",t.changeSlide).off("mouseenter.slick",e.proxy(t.interrupt,t,!0)).off("mouseleave.slick",e.proxy(t.interrupt,t,!1)),t.$slider.off("focus.slick blur.slick"),t.options.arrows===!0&&t.slideCount>t.options.slidesToShow&&(t.$prevArrow&&t.$prevArrow.off("click.slick",t.changeSlide),t.$nextArrow&&t.$nextArrow.off("click.slick",t.changeSlide)),t.$list.off("touchstart.slick mousedown.slick",t.swipeHandler),t.$list.off("touchmove.slick mousemove.slick",t.swipeHandler),t.$list.off("touchend.slick mouseup.slick",t.swipeHandler),t.$list.off("touchcancel.slick mouseleave.slick",t.swipeHandler),t.$list.off("click.slick",t.clickHandler),e(document).off(t.visibilityChange,t.visibility),t.cleanUpSlideEvents(),t.options.accessibility===!0&&t.$list.off("keydown.slick",t.keyHandler),t.options.focusOnSelect===!0&&e(t.$slideTrack).children().off("click.slick",t.selectHandler),e(window).off("orientationchange.slick.slick-"+t.instanceUid,t.orientationChange),e(window).off("resize.slick.slick-"+t.instanceUid,t.resize),e("[draggable!=true]",t.$slideTrack).off("dragstart",t.preventDefault),e(window).off("load.slick.slick-"+t.instanceUid,t.setPosition),e(document).off("ready.slick.slick-"+t.instanceUid,t.setPosition)
},t.prototype.cleanUpSlideEvents=function(){var t=this;t.$list.off("mouseenter.slick",e.proxy(t.interrupt,t,!0)),t.$list.off("mouseleave.slick",e.proxy(t.interrupt,t,!1))},t.prototype.cleanUpRows=function(){var e,t=this;t.options.rows>1&&(e=t.$slides.children().children(),e.removeAttr("style"),t.$slider.empty().append(e))},t.prototype.clickHandler=function(e){var t=this;t.shouldClick===!1&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},t.prototype.destroy=function(t){var n=this;n.autoPlayClear(),n.touchObject={},n.cleanUpEvents(),e(".slick-cloned",n.$slider).detach(),n.$dots&&n.$dots.remove(),n.$prevArrow&&n.$prevArrow.length&&(n.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),n.htmlExpr.test(n.options.prevArrow)&&n.$prevArrow.remove()),n.$nextArrow&&n.$nextArrow.length&&(n.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),n.htmlExpr.test(n.options.nextArrow)&&n.$nextArrow.remove()),n.$slides&&(n.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){e(this).attr("style",e(this).data("originalStyling"))}),n.$slideTrack.children(this.options.slide).detach(),n.$slideTrack.detach(),n.$list.detach(),n.$slider.append(n.$slides)),n.cleanUpRows(),n.$slider.removeClass("slick-slider"),n.$slider.removeClass("slick-initialized"),n.$slider.removeClass("slick-dotted"),n.unslicked=!0,t||n.$slider.trigger("destroy",[n])},t.prototype.disableTransition=function(e){var t=this,n={};n[t.transitionType]="",t.options.fade===!1?t.$slideTrack.css(n):t.$slides.eq(e).css(n)},t.prototype.fadeSlide=function(e,t){var n=this;n.cssTransitions===!1?(n.$slides.eq(e).css({zIndex:n.options.zIndex}),n.$slides.eq(e).animate({opacity:1},n.options.speed,n.options.easing,t)):(n.applyTransition(e),n.$slides.eq(e).css({opacity:1,zIndex:n.options.zIndex}),t&&setTimeout(function(){n.disableTransition(e),t.call()},n.options.speed))},t.prototype.fadeSlideOut=function(e){var t=this;t.cssTransitions===!1?t.$slides.eq(e).animate({opacity:0,zIndex:t.options.zIndex-2},t.options.speed,t.options.easing):(t.applyTransition(e),t.$slides.eq(e).css({opacity:0,zIndex:t.options.zIndex-2}))},t.prototype.filterSlides=t.prototype.slickFilter=function(e){var t=this;null!==e&&(t.$slidesCache=t.$slides,t.unload(),t.$slideTrack.children(this.options.slide).detach(),t.$slidesCache.filter(e).appendTo(t.$slideTrack),t.reinit())},t.prototype.focusHandler=function(){var t=this;t.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*:not(.slick-arrow)",function(n){n.stopImmediatePropagation();var r=e(this);setTimeout(function(){t.options.pauseOnFocus&&(t.focussed=r.is(":focus"),t.autoPlay())},0)})},t.prototype.getCurrent=t.prototype.slickCurrentSlide=function(){var e=this;return e.currentSlide},t.prototype.getDotCount=function(){var e=this,t=0,n=0,r=0;if(e.options.infinite===!0)for(;t<e.slideCount;)++r,t=n+e.options.slidesToScroll,n+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;else if(e.options.centerMode===!0)r=e.slideCount;else if(e.options.asNavFor)for(;t<e.slideCount;)++r,t=n+e.options.slidesToScroll,n+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;else r=1+Math.ceil((e.slideCount-e.options.slidesToShow)/e.options.slidesToScroll);return r-1},t.prototype.getLeft=function(e){var t,n,r,i=this,a=0;return i.slideOffset=0,n=i.$slides.first().outerHeight(!0),i.options.infinite===!0?(i.slideCount>i.options.slidesToShow&&(i.slideOffset=i.slideWidth*i.options.slidesToShow*-1,a=n*i.options.slidesToShow*-1),i.slideCount%i.options.slidesToScroll!==0&&e+i.options.slidesToScroll>i.slideCount&&i.slideCount>i.options.slidesToShow&&(e>i.slideCount?(i.slideOffset=(i.options.slidesToShow-(e-i.slideCount))*i.slideWidth*-1,a=(i.options.slidesToShow-(e-i.slideCount))*n*-1):(i.slideOffset=i.slideCount%i.options.slidesToScroll*i.slideWidth*-1,a=i.slideCount%i.options.slidesToScroll*n*-1))):e+i.options.slidesToShow>i.slideCount&&(i.slideOffset=(e+i.options.slidesToShow-i.slideCount)*i.slideWidth,a=(e+i.options.slidesToShow-i.slideCount)*n),i.slideCount<=i.options.slidesToShow&&(i.slideOffset=0,a=0),i.options.centerMode===!0&&i.options.infinite===!0?i.slideOffset+=i.slideWidth*Math.floor(i.options.slidesToShow/2)-i.slideWidth:i.options.centerMode===!0&&(i.slideOffset=0,i.slideOffset+=i.slideWidth*Math.floor(i.options.slidesToShow/2)),t=i.options.vertical===!1?e*i.slideWidth*-1+i.slideOffset:e*n*-1+a,i.options.variableWidth===!0&&(r=i.$slideTrack.children(".slick-slide").eq(i.slideCount<=i.options.slidesToShow||i.options.infinite===!1?e:e+i.options.slidesToShow),t=i.options.rtl===!0?r[0]?-1*(i.$slideTrack.width()-r[0].offsetLeft-r.width()):0:r[0]?-1*r[0].offsetLeft:0,i.options.centerMode===!0&&(r=i.$slideTrack.children(".slick-slide").eq(i.slideCount<=i.options.slidesToShow||i.options.infinite===!1?e:e+i.options.slidesToShow+1),t=i.options.rtl===!0?r[0]?-1*(i.$slideTrack.width()-r[0].offsetLeft-r.width()):0:r[0]?-1*r[0].offsetLeft:0,t+=(i.$list.width()-r.outerWidth())/2)),t},t.prototype.getOption=t.prototype.slickGetOption=function(e){var t=this;return t.options[e]},t.prototype.getNavigableIndexes=function(){var e,t=this,n=0,r=0,i=[];for(t.options.infinite===!1?e=t.slideCount:(n=-1*t.options.slidesToScroll,r=-1*t.options.slidesToScroll,e=2*t.slideCount);e>n;)i.push(n),n=r+t.options.slidesToScroll,r+=t.options.slidesToScroll<=t.options.slidesToShow?t.options.slidesToScroll:t.options.slidesToShow;return i},t.prototype.getSlick=function(){return this},t.prototype.getSlideCount=function(){var t,n,r,i=this;return r=i.options.centerMode===!0?i.slideWidth*Math.floor(i.options.slidesToShow/2):0,i.options.swipeToSlide===!0?(i.$slideTrack.find(".slick-slide").each(function(t,a){return a.offsetLeft-r+e(a).outerWidth()/2>-1*i.swipeLeft?(n=a,!1):void 0}),t=Math.abs(e(n).attr("data-slick-index")-i.currentSlide)||1):i.options.slidesToScroll},t.prototype.goTo=t.prototype.slickGoTo=function(e,t){var n=this;n.changeSlide({data:{message:"index",index:parseInt(e)}},t)},t.prototype.init=function(t){var n=this;e(n.$slider).hasClass("slick-initialized")||(e(n.$slider).addClass("slick-initialized"),n.buildRows(),n.buildOut(),n.setProps(),n.startLoad(),n.loadSlider(),n.initializeEvents(),n.updateArrows(),n.updateDots(),n.checkResponsive(!0),n.focusHandler()),t&&n.$slider.trigger("init",[n]),n.options.accessibility===!0&&n.initADA(),n.options.autoplay&&(n.paused=!1,n.autoPlay())},t.prototype.initADA=function(){var t=this;t.$slides.add(t.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),t.$slideTrack.attr("role","listbox"),t.$slides.not(t.$slideTrack.find(".slick-cloned")).each(function(n){e(this).attr({role:"option","aria-describedby":"slick-slide"+t.instanceUid+n})}),null!==t.$dots&&t.$dots.attr("role","tablist").find("li").each(function(n){e(this).attr({role:"presentation","aria-selected":"false","aria-controls":"navigation"+t.instanceUid+n,id:"slick-slide"+t.instanceUid+n})}).first().attr("aria-selected","true").end().find("button").attr("role","button").end().closest("div").attr("role","toolbar"),t.activateADA()},t.prototype.initArrowEvents=function(){var e=this;e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},e.changeSlide),e.$nextArrow.off("click.slick").on("click.slick",{message:"next"},e.changeSlide))},t.prototype.initDotEvents=function(){var t=this;t.options.dots===!0&&t.slideCount>t.options.slidesToShow&&e("li",t.$dots).on("click.slick",{message:"index"},t.changeSlide),t.options.dots===!0&&t.options.pauseOnDotsHover===!0&&e("li",t.$dots).on("mouseenter.slick",e.proxy(t.interrupt,t,!0)).on("mouseleave.slick",e.proxy(t.interrupt,t,!1))},t.prototype.initSlideEvents=function(){var t=this;t.options.pauseOnHover&&(t.$list.on("mouseenter.slick",e.proxy(t.interrupt,t,!0)),t.$list.on("mouseleave.slick",e.proxy(t.interrupt,t,!1)))},t.prototype.initializeEvents=function(){var t=this;t.initArrowEvents(),t.initDotEvents(),t.initSlideEvents(),t.$list.on("touchstart.slick mousedown.slick",{action:"start"},t.swipeHandler),t.$list.on("touchmove.slick mousemove.slick",{action:"move"},t.swipeHandler),t.$list.on("touchend.slick mouseup.slick",{action:"end"},t.swipeHandler),t.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},t.swipeHandler),t.$list.on("click.slick",t.clickHandler),e(document).on(t.visibilityChange,e.proxy(t.visibility,t)),t.options.accessibility===!0&&t.$list.on("keydown.slick",t.keyHandler),t.options.focusOnSelect===!0&&e(t.$slideTrack).children().on("click.slick",t.selectHandler),e(window).on("orientationchange.slick.slick-"+t.instanceUid,e.proxy(t.orientationChange,t)),e(window).on("resize.slick.slick-"+t.instanceUid,e.proxy(t.resize,t)),e("[draggable!=true]",t.$slideTrack).on("dragstart",t.preventDefault),e(window).on("load.slick.slick-"+t.instanceUid,t.setPosition),e(document).on("ready.slick.slick-"+t.instanceUid,t.setPosition)},t.prototype.initUI=function(){var e=this;e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.show(),e.$nextArrow.show()),e.options.dots===!0&&e.slideCount>e.options.slidesToShow&&e.$dots.show()},t.prototype.keyHandler=function(e){var t=this;e.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===e.keyCode&&t.options.accessibility===!0?t.changeSlide({data:{message:t.options.rtl===!0?"next":"previous"}}):39===e.keyCode&&t.options.accessibility===!0&&t.changeSlide({data:{message:t.options.rtl===!0?"previous":"next"}}))},t.prototype.lazyLoad=function(){function t(t){e("img[data-lazy]",t).each(function(){var t=e(this),n=e(this).attr("data-lazy"),r=document.createElement("img");r.onload=function(){t.animate({opacity:0},100,function(){t.attr("src",n).animate({opacity:1},200,function(){t.removeAttr("data-lazy").removeClass("slick-loading")}),o.$slider.trigger("lazyLoaded",[o,t,n])})},r.onerror=function(){t.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),o.$slider.trigger("lazyLoadError",[o,t,n])},r.src=n})}var n,r,i,a,o=this;o.options.centerMode===!0?o.options.infinite===!0?(i=o.currentSlide+(o.options.slidesToShow/2+1),a=i+o.options.slidesToShow+2):(i=Math.max(0,o.currentSlide-(o.options.slidesToShow/2+1)),a=2+(o.options.slidesToShow/2+1)+o.currentSlide):(i=o.options.infinite?o.options.slidesToShow+o.currentSlide:o.currentSlide,a=Math.ceil(i+o.options.slidesToShow),o.options.fade===!0&&(i>0&&i--,a<=o.slideCount&&a++)),n=o.$slider.find(".slick-slide").slice(i,a),t(n),o.slideCount<=o.options.slidesToShow?(r=o.$slider.find(".slick-slide"),t(r)):o.currentSlide>=o.slideCount-o.options.slidesToShow?(r=o.$slider.find(".slick-cloned").slice(0,o.options.slidesToShow),t(r)):0===o.currentSlide&&(r=o.$slider.find(".slick-cloned").slice(-1*o.options.slidesToShow),t(r))},t.prototype.loadSlider=function(){var e=this;e.setPosition(),e.$slideTrack.css({opacity:1}),e.$slider.removeClass("slick-loading"),e.initUI(),"progressive"===e.options.lazyLoad&&e.progressiveLazyLoad()},t.prototype.next=t.prototype.slickNext=function(){var e=this;e.changeSlide({data:{message:"next"}})},t.prototype.orientationChange=function(){var e=this;e.checkResponsive(),e.setPosition()},t.prototype.pause=t.prototype.slickPause=function(){var e=this;e.autoPlayClear(),e.paused=!0},t.prototype.play=t.prototype.slickPlay=function(){var e=this;e.autoPlay(),e.options.autoplay=!0,e.paused=!1,e.focussed=!1,e.interrupted=!1},t.prototype.postSlide=function(e){var t=this;t.unslicked||(t.$slider.trigger("afterChange",[t,e]),t.animating=!1,t.setPosition(),t.swipeLeft=null,t.options.autoplay&&t.autoPlay(),t.options.accessibility===!0&&t.initADA())},t.prototype.prev=t.prototype.slickPrev=function(){var e=this;e.changeSlide({data:{message:"previous"}})},t.prototype.preventDefault=function(e){e.preventDefault()},t.prototype.progressiveLazyLoad=function(t){t=t||1;var n,r,i,a=this,o=e("img[data-lazy]",a.$slider);o.length?(n=o.first(),r=n.attr("data-lazy"),i=document.createElement("img"),i.onload=function(){n.attr("src",r).removeAttr("data-lazy").removeClass("slick-loading"),a.options.adaptiveHeight===!0&&a.setPosition(),a.$slider.trigger("lazyLoaded",[a,n,r]),a.progressiveLazyLoad()},i.onerror=function(){3>t?setTimeout(function(){a.progressiveLazyLoad(t+1)},500):(n.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),a.$slider.trigger("lazyLoadError",[a,n,r]),a.progressiveLazyLoad())},i.src=r):a.$slider.trigger("allImagesLoaded",[a])},t.prototype.refresh=function(t){var n,r,i=this;r=i.slideCount-i.options.slidesToShow,!i.options.infinite&&i.currentSlide>r&&(i.currentSlide=r),i.slideCount<=i.options.slidesToShow&&(i.currentSlide=0),n=i.currentSlide,i.destroy(!0),e.extend(i,i.initials,{currentSlide:n}),i.init(),t||i.changeSlide({data:{message:"index",index:n}},!1)},t.prototype.registerBreakpoints=function(){var t,n,r,i=this,a=i.options.responsive||null;if("array"===e.type(a)&&a.length){i.respondTo=i.options.respondTo||"window";for(t in a)if(r=i.breakpoints.length-1,n=a[t].breakpoint,a.hasOwnProperty(t)){for(;r>=0;)i.breakpoints[r]&&i.breakpoints[r]===n&&i.breakpoints.splice(r,1),r--;i.breakpoints.push(n),i.breakpointSettings[n]=a[t].settings}i.breakpoints.sort(function(e,t){return i.options.mobileFirst?e-t:t-e})}},t.prototype.reinit=function(){var t=this;t.$slides=t.$slideTrack.children(t.options.slide).addClass("slick-slide"),t.slideCount=t.$slides.length,t.currentSlide>=t.slideCount&&0!==t.currentSlide&&(t.currentSlide=t.currentSlide-t.options.slidesToScroll),t.slideCount<=t.options.slidesToShow&&(t.currentSlide=0),t.registerBreakpoints(),t.setProps(),t.setupInfinite(),t.buildArrows(),t.updateArrows(),t.initArrowEvents(),t.buildDots(),t.updateDots(),t.initDotEvents(),t.cleanUpSlideEvents(),t.initSlideEvents(),t.checkResponsive(!1,!0),t.options.focusOnSelect===!0&&e(t.$slideTrack).children().on("click.slick",t.selectHandler),t.setSlideClasses("number"==typeof t.currentSlide?t.currentSlide:0),t.setPosition(),t.focusHandler(),t.paused=!t.options.autoplay,t.autoPlay(),t.$slider.trigger("reInit",[t])},t.prototype.resize=function(){var t=this;e(window).width()!==t.windowWidth&&(clearTimeout(t.windowDelay),t.windowDelay=window.setTimeout(function(){t.windowWidth=e(window).width(),t.checkResponsive(),t.unslicked||t.setPosition()},50))},t.prototype.removeSlide=t.prototype.slickRemove=function(e,t,n){var r=this;return"boolean"==typeof e?(t=e,e=t===!0?0:r.slideCount-1):e=t===!0?--e:e,r.slideCount<1||0>e||e>r.slideCount-1?!1:(r.unload(),n===!0?r.$slideTrack.children().remove():r.$slideTrack.children(this.options.slide).eq(e).remove(),r.$slides=r.$slideTrack.children(this.options.slide),r.$slideTrack.children(this.options.slide).detach(),r.$slideTrack.append(r.$slides),r.$slidesCache=r.$slides,void r.reinit())},t.prototype.setCSS=function(e){var t,n,r=this,i={};r.options.rtl===!0&&(e=-e),t="left"==r.positionProp?Math.ceil(e)+"px":"0px",n="top"==r.positionProp?Math.ceil(e)+"px":"0px",i[r.positionProp]=e,r.transformsEnabled===!1?r.$slideTrack.css(i):(i={},r.cssTransitions===!1?(i[r.animType]="translate("+t+", "+n+")",r.$slideTrack.css(i)):(i[r.animType]="translate3d("+t+", "+n+", 0px)",r.$slideTrack.css(i)))},t.prototype.setDimensions=function(){var e=this;e.options.vertical===!1?e.options.centerMode===!0&&e.$list.css({padding:"0px "+e.options.centerPadding}):(e.$list.height(e.$slides.first().outerHeight(!0)*e.options.slidesToShow),e.options.centerMode===!0&&e.$list.css({padding:e.options.centerPadding+" 0px"})),e.listWidth=e.$list.width(),e.listHeight=e.$list.height(),e.options.vertical===!1&&e.options.variableWidth===!1?(e.slideWidth=Math.ceil(e.listWidth/e.options.slidesToShow),e.$slideTrack.width(Math.ceil(e.slideWidth*e.$slideTrack.children(".slick-slide").length))):e.options.variableWidth===!0?e.$slideTrack.width(5e3*e.slideCount):(e.slideWidth=Math.ceil(e.listWidth),e.$slideTrack.height(Math.ceil(e.$slides.first().outerHeight(!0)*e.$slideTrack.children(".slick-slide").length)));var t=e.$slides.first().outerWidth(!0)-e.$slides.first().width();e.options.variableWidth===!1&&e.$slideTrack.children(".slick-slide").width(e.slideWidth-t)},t.prototype.setFade=function(){var t,n=this;n.$slides.each(function(r,i){t=n.slideWidth*r*-1,e(i).css(n.options.rtl===!0?{position:"relative",right:t,top:0,zIndex:n.options.zIndex-2,opacity:0}:{position:"relative",left:t,top:0,zIndex:n.options.zIndex-2,opacity:0})}),n.$slides.eq(n.currentSlide).css({zIndex:n.options.zIndex-1,opacity:1})},t.prototype.setHeight=function(){var e=this;if(1===e.options.slidesToShow&&e.options.adaptiveHeight===!0&&e.options.vertical===!1){var t=e.$slides.eq(e.currentSlide).outerHeight(!0);e.$list.css("height",t)}},t.prototype.setOption=t.prototype.slickSetOption=function(){var t,n,r,i,a,o=this,s=!1;if("object"===e.type(arguments[0])?(r=arguments[0],s=arguments[1],a="multiple"):"string"===e.type(arguments[0])&&(r=arguments[0],i=arguments[1],s=arguments[2],"responsive"===arguments[0]&&"array"===e.type(arguments[1])?a="responsive":"undefined"!=typeof arguments[1]&&(a="single")),"single"===a)o.options[r]=i;else if("multiple"===a)e.each(r,function(e,t){o.options[e]=t});else if("responsive"===a)for(n in i)if("array"!==e.type(o.options.responsive))o.options.responsive=[i[n]];else{for(t=o.options.responsive.length-1;t>=0;)o.options.responsive[t].breakpoint===i[n].breakpoint&&o.options.responsive.splice(t,1),t--;o.options.responsive.push(i[n])}s&&(o.unload(),o.reinit())},t.prototype.setPosition=function(){var e=this;e.setDimensions(),e.setHeight(),e.options.fade===!1?e.setCSS(e.getLeft(e.currentSlide)):e.setFade(),e.$slider.trigger("setPosition",[e])},t.prototype.setProps=function(){var e=this,t=document.body.style;e.positionProp=e.options.vertical===!0?"top":"left","top"===e.positionProp?e.$slider.addClass("slick-vertical"):e.$slider.removeClass("slick-vertical"),(void 0!==t.WebkitTransition||void 0!==t.MozTransition||void 0!==t.msTransition)&&e.options.useCSS===!0&&(e.cssTransitions=!0),e.options.fade&&("number"==typeof e.options.zIndex?e.options.zIndex<3&&(e.options.zIndex=3):e.options.zIndex=e.defaults.zIndex),void 0!==t.OTransform&&(e.animType="OTransform",e.transformType="-o-transform",e.transitionType="OTransition",void 0===t.perspectiveProperty&&void 0===t.webkitPerspective&&(e.animType=!1)),void 0!==t.MozTransform&&(e.animType="MozTransform",e.transformType="-moz-transform",e.transitionType="MozTransition",void 0===t.perspectiveProperty&&void 0===t.MozPerspective&&(e.animType=!1)),void 0!==t.webkitTransform&&(e.animType="webkitTransform",e.transformType="-webkit-transform",e.transitionType="webkitTransition",void 0===t.perspectiveProperty&&void 0===t.webkitPerspective&&(e.animType=!1)),void 0!==t.msTransform&&(e.animType="msTransform",e.transformType="-ms-transform",e.transitionType="msTransition",void 0===t.msTransform&&(e.animType=!1)),void 0!==t.transform&&e.animType!==!1&&(e.animType="transform",e.transformType="transform",e.transitionType="transition"),e.transformsEnabled=e.options.useTransform&&null!==e.animType&&e.animType!==!1},t.prototype.setSlideClasses=function(e){var t,n,r,i,a=this;n=a.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),a.$slides.eq(e).addClass("slick-current"),a.options.centerMode===!0?(t=Math.floor(a.options.slidesToShow/2),a.options.infinite===!0&&(e>=t&&e<=a.slideCount-1-t?a.$slides.slice(e-t,e+t+1).addClass("slick-active").attr("aria-hidden","false"):(r=a.options.slidesToShow+e,n.slice(r-t+1,r+t+2).addClass("slick-active").attr("aria-hidden","false")),0===e?n.eq(n.length-1-a.options.slidesToShow).addClass("slick-center"):e===a.slideCount-1&&n.eq(a.options.slidesToShow).addClass("slick-center")),a.$slides.eq(e).addClass("slick-center")):e>=0&&e<=a.slideCount-a.options.slidesToShow?a.$slides.slice(e,e+a.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):n.length<=a.options.slidesToShow?n.addClass("slick-active").attr("aria-hidden","false"):(i=a.slideCount%a.options.slidesToShow,r=a.options.infinite===!0?a.options.slidesToShow+e:e,a.options.slidesToShow==a.options.slidesToScroll&&a.slideCount-e<a.options.slidesToShow?n.slice(r-(a.options.slidesToShow-i),r+i).addClass("slick-active").attr("aria-hidden","false"):n.slice(r,r+a.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false")),"ondemand"===a.options.lazyLoad&&a.lazyLoad()},t.prototype.setupInfinite=function(){var t,n,r,i=this;if(i.options.fade===!0&&(i.options.centerMode=!1),i.options.infinite===!0&&i.options.fade===!1&&(n=null,i.slideCount>i.options.slidesToShow)){for(r=i.options.centerMode===!0?i.options.slidesToShow+1:i.options.slidesToShow,t=i.slideCount;t>i.slideCount-r;t-=1)n=t-1,e(i.$slides[n]).clone(!0).attr("id","").attr("data-slick-index",n-i.slideCount).prependTo(i.$slideTrack).addClass("slick-cloned");for(t=0;r>t;t+=1)n=t,e(i.$slides[n]).clone(!0).attr("id","").attr("data-slick-index",n+i.slideCount).appendTo(i.$slideTrack).addClass("slick-cloned");i.$slideTrack.find(".slick-cloned").find("[id]").each(function(){e(this).attr("id","")})}},t.prototype.interrupt=function(e){var t=this;e||t.autoPlay(),t.interrupted=e},t.prototype.selectHandler=function(t){var n=this,r=e(t.target).is(".slick-slide")?e(t.target):e(t.target).parents(".slick-slide"),i=parseInt(r.attr("data-slick-index"));return i||(i=0),n.slideCount<=n.options.slidesToShow?(n.setSlideClasses(i),void n.asNavFor(i)):void n.slideHandler(i)},t.prototype.slideHandler=function(e,t,n){var r,i,a,o,s,l=null,c=this;return t=t||!1,c.animating===!0&&c.options.waitForAnimate===!0||c.options.fade===!0&&c.currentSlide===e||c.slideCount<=c.options.slidesToShow?void 0:(t===!1&&c.asNavFor(e),r=e,l=c.getLeft(r),o=c.getLeft(c.currentSlide),c.currentLeft=null===c.swipeLeft?o:c.swipeLeft,c.options.infinite===!1&&c.options.centerMode===!1&&(0>e||e>c.getDotCount()*c.options.slidesToScroll)?void(c.options.fade===!1&&(r=c.currentSlide,n!==!0?c.animateSlide(o,function(){c.postSlide(r)}):c.postSlide(r))):c.options.infinite===!1&&c.options.centerMode===!0&&(0>e||e>c.slideCount-c.options.slidesToScroll)?void(c.options.fade===!1&&(r=c.currentSlide,n!==!0?c.animateSlide(o,function(){c.postSlide(r)}):c.postSlide(r))):(c.options.autoplay&&clearInterval(c.autoPlayTimer),i=0>r?c.slideCount%c.options.slidesToScroll!==0?c.slideCount-c.slideCount%c.options.slidesToScroll:c.slideCount+r:r>=c.slideCount?c.slideCount%c.options.slidesToScroll!==0?0:r-c.slideCount:r,c.animating=!0,c.$slider.trigger("beforeChange",[c,c.currentSlide,i]),a=c.currentSlide,c.currentSlide=i,c.setSlideClasses(c.currentSlide),c.options.asNavFor&&(s=c.getNavTarget(),s=s.slick("getSlick"),s.slideCount<=s.options.slidesToShow&&s.setSlideClasses(c.currentSlide)),c.updateDots(),c.updateArrows(),c.options.fade===!0?(n!==!0?(c.fadeSlideOut(a),c.fadeSlide(i,function(){c.postSlide(i)})):c.postSlide(i),void c.animateHeight()):void(n!==!0?c.animateSlide(l,function(){c.postSlide(i)}):c.postSlide(i))))},t.prototype.startLoad=function(){var e=this;e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.hide(),e.$nextArrow.hide()),e.options.dots===!0&&e.slideCount>e.options.slidesToShow&&e.$dots.hide(),e.$slider.addClass("slick-loading")},t.prototype.swipeDirection=function(){var e,t,n,r,i=this;return e=i.touchObject.startX-i.touchObject.curX,t=i.touchObject.startY-i.touchObject.curY,n=Math.atan2(t,e),r=Math.round(180*n/Math.PI),0>r&&(r=360-Math.abs(r)),45>=r&&r>=0?i.options.rtl===!1?"left":"right":360>=r&&r>=315?i.options.rtl===!1?"left":"right":r>=135&&225>=r?i.options.rtl===!1?"right":"left":i.options.verticalSwiping===!0?r>=35&&135>=r?"down":"up":"vertical"},t.prototype.swipeEnd=function(){var e,t,n=this;if(n.dragging=!1,n.interrupted=!1,n.shouldClick=n.touchObject.swipeLength>10?!1:!0,void 0===n.touchObject.curX)return!1;if(n.touchObject.edgeHit===!0&&n.$slider.trigger("edge",[n,n.swipeDirection()]),n.touchObject.swipeLength>=n.touchObject.minSwipe){switch(t=n.swipeDirection()){case"left":case"down":e=n.options.swipeToSlide?n.checkNavigable(n.currentSlide+n.getSlideCount()):n.currentSlide+n.getSlideCount(),n.currentDirection=0;break;case"right":case"up":e=n.options.swipeToSlide?n.checkNavigable(n.currentSlide-n.getSlideCount()):n.currentSlide-n.getSlideCount(),n.currentDirection=1}"vertical"!=t&&(n.slideHandler(e),n.touchObject={},n.$slider.trigger("swipe",[n,t]))}else n.touchObject.startX!==n.touchObject.curX&&(n.slideHandler(n.currentSlide),n.touchObject={})},t.prototype.swipeHandler=function(e){var t=this;if(!(t.options.swipe===!1||"ontouchend"in document&&t.options.swipe===!1||t.options.draggable===!1&&-1!==e.type.indexOf("mouse")))switch(t.touchObject.fingerCount=e.originalEvent&&void 0!==e.originalEvent.touches?e.originalEvent.touches.length:1,t.touchObject.minSwipe=t.listWidth/t.options.touchThreshold,t.options.verticalSwiping===!0&&(t.touchObject.minSwipe=t.listHeight/t.options.touchThreshold),e.data.action){case"start":t.swipeStart(e);break;case"move":t.swipeMove(e);break;case"end":t.swipeEnd(e)}},t.prototype.swipeMove=function(e){var t,n,r,i,a,o=this;return a=void 0!==e.originalEvent?e.originalEvent.touches:null,!o.dragging||a&&1!==a.length?!1:(t=o.getLeft(o.currentSlide),o.touchObject.curX=void 0!==a?a[0].pageX:e.clientX,o.touchObject.curY=void 0!==a?a[0].pageY:e.clientY,o.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(o.touchObject.curX-o.touchObject.startX,2))),o.options.verticalSwiping===!0&&(o.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(o.touchObject.curY-o.touchObject.startY,2)))),n=o.swipeDirection(),"vertical"!==n?(void 0!==e.originalEvent&&o.touchObject.swipeLength>4&&e.preventDefault(),i=(o.options.rtl===!1?1:-1)*(o.touchObject.curX>o.touchObject.startX?1:-1),o.options.verticalSwiping===!0&&(i=o.touchObject.curY>o.touchObject.startY?1:-1),r=o.touchObject.swipeLength,o.touchObject.edgeHit=!1,o.options.infinite===!1&&(0===o.currentSlide&&"right"===n||o.currentSlide>=o.getDotCount()&&"left"===n)&&(r=o.touchObject.swipeLength*o.options.edgeFriction,o.touchObject.edgeHit=!0),o.swipeLeft=o.options.vertical===!1?t+r*i:t+r*(o.$list.height()/o.listWidth)*i,o.options.verticalSwiping===!0&&(o.swipeLeft=t+r*i),o.options.fade===!0||o.options.touchMove===!1?!1:o.animating===!0?(o.swipeLeft=null,!1):void o.setCSS(o.swipeLeft)):void 0)},t.prototype.swipeStart=function(e){var t,n=this;return n.interrupted=!0,1!==n.touchObject.fingerCount||n.slideCount<=n.options.slidesToShow?(n.touchObject={},!1):(void 0!==e.originalEvent&&void 0!==e.originalEvent.touches&&(t=e.originalEvent.touches[0]),n.touchObject.startX=n.touchObject.curX=void 0!==t?t.pageX:e.clientX,n.touchObject.startY=n.touchObject.curY=void 0!==t?t.pageY:e.clientY,void(n.dragging=!0))},t.prototype.unfilterSlides=t.prototype.slickUnfilter=function(){var e=this;null!==e.$slidesCache&&(e.unload(),e.$slideTrack.children(this.options.slide).detach(),e.$slidesCache.appendTo(e.$slideTrack),e.reinit())},t.prototype.unload=function(){var t=this;e(".slick-cloned",t.$slider).remove(),t.$dots&&t.$dots.remove(),t.$prevArrow&&t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.remove(),t.$nextArrow&&t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.remove(),t.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},t.prototype.unslick=function(e){var t=this;t.$slider.trigger("unslick",[t,e]),t.destroy()},t.prototype.updateArrows=function(){var e,t=this;e=Math.floor(t.options.slidesToShow/2),t.options.arrows===!0&&t.slideCount>t.options.slidesToShow&&!t.options.infinite&&(t.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),t.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===t.currentSlide?(t.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),t.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):t.currentSlide>=t.slideCount-t.options.slidesToShow&&t.options.centerMode===!1?(t.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),t.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):t.currentSlide>=t.slideCount-1&&t.options.centerMode===!0&&(t.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),t.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},t.prototype.updateDots=function(){var e=this;null!==e.$dots&&(e.$dots.find("li").removeClass("slick-active").attr("aria-hidden","true"),e.$dots.find("li").eq(Math.floor(e.currentSlide/e.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden","false"))},t.prototype.visibility=function(){var e=this;e.options.autoplay&&(e.interrupted=document[e.hidden]?!0:!1)},e.fn.slick=function(){var e,n,r=this,i=arguments[0],a=Array.prototype.slice.call(arguments,1),o=r.length;for(e=0;o>e;e++)if("object"==typeof i||"undefined"==typeof i?r[e].slick=new t(r[e],i):n=r[e].slick[i].apply(r[e].slick,a),"undefined"!=typeof n)return n;return r}}),angular.module("slickCarousel",[]).constant("slickCarouselConfig",{method:{},event:{}}).directive("slick",["$timeout","slickCarouselConfig",function(e,t){var n,r;return n=["slickGoTo","slickNext","slickPrev","slickPause","slickPlay","slickAdd","slickRemove","slickFilter","slickUnfilter","unslick"],r=["afterChange","beforeChange","breakpoint","destroy","edge","init","reInit","setPosition","swipe","lazyLoaded","lazyLoadError"],{scope:{settings:"=",enabled:"@",accessibility:"@",adaptiveHeight:"@",autoplay:"@",autoplaySpeed:"@",arrows:"@",asNavFor:"@",appendArrows:"@",prevArrow:"@",nextArrow:"@",centerMode:"@",centerPadding:"@",cssEase:"@",customPaging:"&",dots:"@",draggable:"@",fade:"@",focusOnSelect:"@",easing:"@",edgeFriction:"@",infinite:"@",initialSlide:"@",lazyLoad:"@",mobileFirst:"@",pauseOnHover:"@",pauseOnDotsHover:"@",respondTo:"@",responsive:"=?",rows:"@",slide:"@",slidesPerRow:"@",slidesToShow:"@",slidesToScroll:"@",speed:"@",swipe:"@",swipeToSlide:"@",touchMove:"@",touchThreshold:"@",useCSS:"@",variableWidth:"@",vertical:"@",verticalSwiping:"@",rtl:"@"},restrict:"AE",link:function(r,i,a){angular.element(i).css("display","none");var o,s,l,c,u,d;return s=function(){o=angular.extend(angular.copy(t),{enabled:"false"!==r.enabled,accessibility:"false"!==r.accessibility,adaptiveHeight:"true"===r.adaptiveHeight,autoplay:"true"===r.autoplay,autoplaySpeed:null!=r.autoplaySpeed?parseInt(r.autoplaySpeed,10):3e3,arrows:"false"!==r.arrows,asNavFor:r.asNavFor?r.asNavFor:void 0,appendArrows:angular.element(r.appendArrows?r.appendArrows:i),prevArrow:r.prevArrow?angular.element(r.prevArrow):void 0,nextArrow:r.nextArrow?angular.element(r.nextArrow):void 0,centerMode:"true"===r.centerMode,centerPadding:r.centerPadding||"50px",cssEase:r.cssEase||"ease",customPaging:a.customPaging?function(e,t){return r.customPaging({slick:e,index:t})}:void 0,dots:"true"===r.dots,draggable:"false"!==r.draggable,fade:"true"===r.fade,focusOnSelect:"true"===r.focusOnSelect,easing:r.easing||"linear",edgeFriction:r.edgeFriction||.15,infinite:"false"!==r.infinite,initialSlide:parseInt(r.initialSlide)||0,lazyLoad:r.lazyLoad||"ondemand",mobileFirst:"true"===r.mobileFirst,pauseOnHover:"false"!==r.pauseOnHover,pauseOnDotsHover:"true"===r.pauseOnDotsHover,respondTo:null!=r.respondTo?r.respondTo:"window",responsive:r.responsive||void 0,rows:null!=r.rows?parseInt(r.rows,10):1,slide:r.slide||"",slidesPerRow:null!=r.slidesPerRow?parseInt(r.slidesPerRow,10):1,slidesToShow:null!=r.slidesToShow?parseInt(r.slidesToShow,10):1,slidesToScroll:null!=r.slidesToScroll?parseInt(r.slidesToScroll,10):1,speed:null!=r.speed?parseInt(r.speed,10):300,swipe:"false"!==r.swipe,swipeToSlide:"true"===r.swipeToSlide,touchMove:"false"!==r.touchMove,touchThreshold:r.touchThreshold?parseInt(r.touchThreshold,10):5,useCSS:"false"!==r.useCSS,variableWidth:"true"===r.variableWidth,vertical:"true"===r.vertical,verticalSwiping:"true"===r.verticalSwiping,rtl:"true"===r.rtl},r.settings)},l=function(){var e=angular.element(i);return e.hasClass("slick-initialized")&&(e.remove("slick-list"),e.slick("unslick")),e},c=function(){s();var t=angular.element(i);if(angular.element(i).hasClass("slick-initialized")){if(o.enabled)return t.slick("getSlick");l()}else{if(!o.enabled)return;t.on("init",function(e,t){return"undefined"!=typeof o.event.init&&o.event.init(e,t),"undefined"!=typeof d?t.slideHandler(d):void 0}),e(function(){angular.element(i).css("display","block"),t.not(".slick-initialized").slick(o)})}r.internalControl=o.method||{},n.forEach(function(e){r.internalControl[e]=function(){var n;
n=Array.prototype.slice.call(arguments),n.unshift(e),t.slick.apply(i,n)}}),t.on("afterChange",function(t,n,i){d=i,"undefined"!=typeof o.event.afterChange&&e(function(){r.$apply(function(){o.event.afterChange(t,n,i)})})}),t.on("beforeChange",function(t,n,i,a){"undefined"!=typeof o.event.beforeChange&&e(function(){e(function(){r.$apply(function(){o.event.beforeChange(t,n,i,a)})})})}),t.on("reInit",function(t,n){"undefined"!=typeof o.event.reInit&&e(function(){r.$apply(function(){o.event.reInit(t,n)})})}),"undefined"!=typeof o.event.breakpoint&&t.on("breakpoint",function(t,n,i){e(function(){r.$apply(function(){o.event.breakpoint(t,n,i)})})}),"undefined"!=typeof o.event.destroy&&t.on("destroy",function(t,n){e(function(){r.$apply(function(){o.event.destroy(t,n)})})}),"undefined"!=typeof o.event.edge&&t.on("edge",function(t,n,i){e(function(){r.$apply(function(){o.event.edge(t,n,i)})})}),"undefined"!=typeof o.event.setPosition&&t.on("setPosition",function(t,n){e(function(){r.$apply(function(){o.event.setPosition(t,n)})})}),"undefined"!=typeof o.event.swipe&&t.on("swipe",function(t,n,i){e(function(){r.$apply(function(){o.event.swipe(t,n,i)})})}),"undefined"!=typeof o.event.lazyLoaded&&t.on("lazyLoaded",function(t,n,i,a){e(function(){r.$apply(function(){o.event.lazyLoaded(t,n,i,a)})})}),"undefined"!=typeof o.event.lazyLoadError&&t.on("lazyLoadError",function(t,n,i,a){e(function(){r.$apply(function(){o.event.lazyLoadError(t,n,i,a)})})})},u=function(){l(),c()},i.one("$destroy",function(){l()}),r.$watch("settings",function(e){return null!==e?u():void 0},!0)}}}]),!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],function(n){return t(e,n)}):"object"==typeof exports?t(e,require("jquery")):t(e,e.jQuery||e.Zepto)}(this,function(e,t){"use strict";function n(e){if(k&&"none"===e.css("animation-name")&&"none"===e.css("-webkit-animation-name")&&"none"===e.css("-moz-animation-name")&&"none"===e.css("-o-animation-name")&&"none"===e.css("-ms-animation-name"))return 0;var t,n,r,i,a=e.css("animation-duration")||e.css("-webkit-animation-duration")||e.css("-moz-animation-duration")||e.css("-o-animation-duration")||e.css("-ms-animation-duration")||"0s",o=e.css("animation-delay")||e.css("-webkit-animation-delay")||e.css("-moz-animation-delay")||e.css("-o-animation-delay")||e.css("-ms-animation-delay")||"0s",s=e.css("animation-iteration-count")||e.css("-webkit-animation-iteration-count")||e.css("-moz-animation-iteration-count")||e.css("-o-animation-iteration-count")||e.css("-ms-animation-iteration-count")||"1";for(a=a.split(", "),o=o.split(", "),s=s.split(", "),i=0,n=a.length,t=Number.NEGATIVE_INFINITY;n>i;i++)r=parseFloat(a[i])*parseInt(s[i],10)+parseFloat(o[i]),r>t&&(t=r);return t}function r(){if(t(document).height()<=t(window).height())return 0;var e,n,r=document.createElement("div"),i=document.createElement("div");return r.style.visibility="hidden",r.style.width="100px",document.body.appendChild(r),e=r.offsetWidth,r.style.overflow="scroll",i.style.width="100%",r.appendChild(i),n=i.offsetWidth,r.parentNode.removeChild(r),e-n}function i(){if(!$){var e,n,i=t("html"),a=u("is-locked");i.hasClass(a)||(n=t(document.body),e=parseInt(n.css("padding-right"),10)+r(),n.css("padding-right",e+"px"),i.addClass(a))}}function a(){if(!$){var e,n,i=t("html"),a=u("is-locked");i.hasClass(a)&&(n=t(document.body),e=parseInt(n.css("padding-right"),10)-r(),n.css("padding-right",e+"px"),i.removeClass(a))}}function o(e,t,n,r){var i=u("is",t),a=[u("is",_.CLOSING),u("is",_.OPENING),u("is",_.CLOSED),u("is",_.OPENED)].join(" ");e.$bg.removeClass(a).addClass(i),e.$overlay.removeClass(a).addClass(i),e.$wrapper.removeClass(a).addClass(i),e.$modal.removeClass(a).addClass(i),e.state=t,!n&&e.$modal.trigger({type:t,reason:r},[{reason:r}])}function s(e,r,i){var a=0,o=function(e){e.target===this&&a++},s=function(e){e.target===this&&0===--a&&(t.each(["$bg","$overlay","$wrapper","$modal"],function(e,t){i[t].off(v+" "+y)}),r())};t.each(["$bg","$overlay","$wrapper","$modal"],function(e,t){i[t].on(v,o).on(y,s)}),e(),0===n(i.$bg)&&0===n(i.$overlay)&&0===n(i.$wrapper)&&0===n(i.$modal)&&(t.each(["$bg","$overlay","$wrapper","$modal"],function(e,t){i[t].off(v+" "+y)}),r())}function l(e){e.state!==_.CLOSED&&(t.each(["$bg","$overlay","$wrapper","$modal"],function(t,n){e[n].off(v+" "+y)}),e.$bg.removeClass(e.settings.modifier),e.$overlay.removeClass(e.settings.modifier).hide(),e.$wrapper.hide(),a(),o(e,_.CLOSED,!0))}function c(e){var t,n,r,i,a={};for(e=e.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,","),t=e.split(","),i=0,n=t.length;n>i;i++)t[i]=t[i].split(":"),r=t[i][1],("string"==typeof r||r instanceof String)&&(r="true"===r||"false"!==r&&r),("string"==typeof r||r instanceof String)&&(r=isNaN(r)?r:+r),a[t[i][0]]=r;return a}function u(){for(var e=g,t=0;t<arguments.length;++t)e+="-"+arguments[t];return e}function d(){var e,n,r=location.hash.replace("#","");if(r){try{n=t('[data-remodal-id="'+r+'"]')}catch(i){}n&&n.length&&(e=t[f].lookup[n.data(f)],e&&e.settings.hashTracking&&e.open())}else h&&h.state===_.OPENED&&h.settings.hashTracking&&h.close()}function p(e,n){var r=t(document.body),i=r,a=this;a.settings=t.extend({},b,n),a.index=t[f].lookup.push(a)-1,a.state=_.CLOSED,a.$overlay=t("."+u("overlay")),null!==a.settings.appendTo&&a.settings.appendTo.length&&(i=t(a.settings.appendTo)),a.$overlay.length||(a.$overlay=t("<div>").addClass(u("overlay")+" "+u("is",_.CLOSED)).hide(),i.append(a.$overlay)),a.$bg=t("."+u("bg")).addClass(u("is",_.CLOSED)),a.$modal=e.addClass(g+" "+u("is-initialized")+" "+a.settings.modifier+" "+u("is",_.CLOSED)).attr("tabindex","-1"),a.$wrapper=t("<div>").addClass(u("wrapper")+" "+a.settings.modifier+" "+u("is",_.CLOSED)).hide().append(a.$modal),i.append(a.$wrapper),a.$wrapper.on("click."+g,'[data-remodal-action="close"]',function(e){e.preventDefault(),a.close()}),a.$wrapper.on("click."+g,'[data-remodal-action="cancel"]',function(e){e.preventDefault(),a.$modal.trigger(w.CANCELLATION),a.settings.closeOnCancel&&a.close(w.CANCELLATION)}),a.$wrapper.on("click."+g,'[data-remodal-action="confirm"]',function(e){e.preventDefault(),a.$modal.trigger(w.CONFIRMATION),a.settings.closeOnConfirm&&a.close(w.CONFIRMATION)}),a.$wrapper.on("click."+g,function(e){var n=t(e.target);n.hasClass(u("wrapper"))&&a.settings.closeOnOutsideClick&&a.close()})}var h,m,f="remodal",g=e.REMODAL_GLOBALS&&e.REMODAL_GLOBALS.NAMESPACE||f,v=t.map(["animationstart","webkitAnimationStart","MSAnimationStart","oAnimationStart"],function(e){return e+"."+g}).join(" "),y=t.map(["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"],function(e){return e+"."+g}).join(" "),b=t.extend({hashTracking:!0,closeOnConfirm:!0,closeOnCancel:!0,closeOnEscape:!0,closeOnOutsideClick:!0,modifier:"",appendTo:null},e.REMODAL_GLOBALS&&e.REMODAL_GLOBALS.DEFAULTS),_={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened"},w={CONFIRMATION:"confirmation",CANCELLATION:"cancellation"},k=function(){var e=document.createElement("div").style;return void 0!==e.animationName||void 0!==e.WebkitAnimationName||void 0!==e.MozAnimationName||void 0!==e.msAnimationName||void 0!==e.OAnimationName}(),$=/iPad|iPhone|iPod/.test(navigator.platform);p.prototype.open=function(){var e,n=this;n.state!==_.OPENING&&n.state!==_.CLOSING&&(e=n.$modal.attr("data-remodal-id"),e&&n.settings.hashTracking&&(m=t(window).scrollTop(),location.hash=e),h&&h!==n&&l(h),h=n,i(),n.$bg.addClass(n.settings.modifier),n.$overlay.addClass(n.settings.modifier).show(),n.$wrapper.show().scrollTop(0),n.$modal.focus(),s(function(){o(n,_.OPENING)},function(){o(n,_.OPENED)},n))},p.prototype.close=function(e){var n=this;n.state!==_.OPENING&&n.state!==_.CLOSING&&n.state!==_.CLOSED&&(n.settings.hashTracking&&n.$modal.attr("data-remodal-id")===location.hash.substr(1)&&(location.hash="",t(window).scrollTop(m)),s(function(){o(n,_.CLOSING,!1,e)},function(){n.$bg.removeClass(n.settings.modifier),n.$overlay.removeClass(n.settings.modifier).hide(),n.$wrapper.hide(),a(),o(n,_.CLOSED,!1,e)},n))},p.prototype.getState=function(){return this.state},p.prototype.destroy=function(){var e,n=t[f].lookup;l(this),this.$wrapper.remove(),delete n[this.index],e=t.grep(n,function(e){return!!e}).length,0===e&&(this.$overlay.remove(),this.$bg.removeClass(u("is",_.CLOSING)+" "+u("is",_.OPENING)+" "+u("is",_.CLOSED)+" "+u("is",_.OPENED)))},t[f]={lookup:[]},t.fn[f]=function(e){var n,r;return this.each(function(i,a){r=t(a),null==r.data(f)?(n=new p(r,e),r.data(f,n.index),n.settings.hashTracking&&r.attr("data-remodal-id")===location.hash.substr(1)&&n.open()):n=t[f].lookup[r.data(f)]}),n},t(document).ready(function(){t(document).on("click","[data-remodal-target]",function(e){e.preventDefault();var n=e.currentTarget,r=n.getAttribute("data-remodal-target"),i=t('[data-remodal-id="'+r+'"]');t[f].lookup[i.data(f)].open()}),t(document).find("."+g).each(function(e,n){var r=t(n),i=r.data("remodal-options");i?("string"==typeof i||i instanceof String)&&(i=c(i)):i={},r[f](i)}),t(document).on("keydown."+g,function(e){h&&h.settings.closeOnEscape&&h.state===_.OPENED&&27===e.keyCode&&h.close()}),t(window).on("hashchange."+g,d)})}),function(){var e,t,n,r,i,a,o,s,l,c,u,d,p,h,m,f,g,v,y,b,_,w,k,$,x,C,S,T,A,M,E,P,N,D,z,L,I,B,O,F,H,R,j,U,q,W,G,Y,V,K=[].slice,J={}.hasOwnProperty,X=function(e,t){function n(){this.constructor=e}for(var r in t)J.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Z=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};for(_={catchupTime:100,initialRate:.03,minTime:250,ghostTime:100,maxProgressPerFrame:20,easeFactor:1.25,startOnPageLoad:!0,restartOnPushState:!0,restartOnRequestAfter:500,target:"body",elements:{checkInterval:100,selectors:["body"]},eventLag:{minSamples:10,sampleCount:3,lagThreshold:3},ajax:{trackMethods:["GET"],trackWebSockets:!0,ignoreURLs:[]}},A=function(){var e;return null!=(e="undefined"!=typeof performance&&null!==performance&&"function"==typeof performance.now?performance.now():void 0)?e:+new Date},E=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,b=window.cancelAnimationFrame||window.mozCancelAnimationFrame,null==E&&(E=function(e){return setTimeout(e,50)},b=function(e){return clearTimeout(e)}),N=function(e){var t,n;return t=A(),(n=function(){var r;return r=A()-t,r>=33?(t=A(),e(r,function(){return E(n)})):setTimeout(n,33-r)})()},P=function(){var e,t,n;return n=arguments[0],t=arguments[1],e=3<=arguments.length?K.call(arguments,2):[],"function"==typeof n[t]?n[t].apply(n,e):n[t]},w=function(){var e,t,n,r,i,a,o;for(t=arguments[0],r=2<=arguments.length?K.call(arguments,1):[],a=0,o=r.length;o>a;a++)if(n=r[a])for(e in n)J.call(n,e)&&(i=n[e],null!=t[e]&&"object"==typeof t[e]&&null!=i&&"object"==typeof i?w(t[e],i):t[e]=i);return t},g=function(e){var t,n,r,i,a;for(n=t=0,i=0,a=e.length;a>i;i++)r=e[i],n+=Math.abs(r),t++;return n/t},$=function(e,t){var n,r,i;if(null==e&&(e="options"),null==t&&(t=!0),i=document.querySelector("[data-pace-"+e+"]")){if(n=i.getAttribute("data-pace-"+e),!t)return n;try{return JSON.parse(n)}catch(a){return r=a,"undefined"!=typeof console&&null!==console?console.error("Error parsing inline pace options",r):void 0}}},o=function(){function e(){}return e.prototype.on=function(e,t,n,r){var i;return null==r&&(r=!1),null==this.bindings&&(this.bindings={}),null==(i=this.bindings)[e]&&(i[e]=[]),this.bindings[e].push({handler:t,ctx:n,once:r})},e.prototype.once=function(e,t,n){return this.on(e,t,n,!0)},e.prototype.off=function(e,t){var n,r,i;if(null!=(null!=(r=this.bindings)?r[e]:void 0)){if(null==t)return delete this.bindings[e];for(n=0,i=[];n<this.bindings[e].length;)i.push(this.bindings[e][n].handler===t?this.bindings[e].splice(n,1):n++);return i}},e.prototype.trigger=function(){var e,t,n,r,i,a,o,s,l;if(n=arguments[0],e=2<=arguments.length?K.call(arguments,1):[],null!=(o=this.bindings)?o[n]:void 0){for(i=0,l=[];i<this.bindings[n].length;)s=this.bindings[n][i],r=s.handler,t=s.ctx,a=s.once,r.apply(null!=t?t:this,e),l.push(a?this.bindings[n].splice(i,1):i++);return l}},e}(),c=window.Pace||{},window.Pace=c,w(c,o.prototype),M=c.options=w({},_,window.paceOptions,$()),G=["ajax","document","eventLag","elements"],j=0,q=G.length;q>j;j++)I=G[j],M[I]===!0&&(M[I]=_[I]);l=function(e){function t(){return Y=t.__super__.constructor.apply(this,arguments)}return X(t,e),t}(Error),t=function(){function e(){this.progress=0}return e.prototype.getElement=function(){var e;if(null==this.el){if(e=document.querySelector(M.target),!e)throw new l;this.el=document.createElement("div"),this.el.className="pace pace-active",document.body.className=document.body.className.replace(/pace-done/g,""),document.body.className+=" pace-running",this.el.innerHTML='<div class="pace-progress">\n  <div class="pace-progress-inner"></div>\n</div>\n<div class="pace-activity"></div>',null!=e.firstChild?e.insertBefore(this.el,e.firstChild):e.appendChild(this.el)}return this.el},e.prototype.finish=function(){var e;return e=this.getElement(),e.className=e.className.replace("pace-active",""),e.className+=" pace-inactive",document.body.className=document.body.className.replace("pace-running",""),document.body.className+=" pace-done"},e.prototype.update=function(e){return this.progress=e,this.render()},e.prototype.destroy=function(){try{this.getElement().parentNode.removeChild(this.getElement())}catch(e){l=e}return this.el=void 0},e.prototype.render=function(){var e,t,n,r,i,a,o;if(null==document.querySelector(M.target))return!1;for(e=this.getElement(),r="translate3d("+this.progress+"%, 0, 0)",o=["webkitTransform","msTransform","transform"],i=0,a=o.length;a>i;i++)t=o[i],e.children[0].style[t]=r;return(!this.lastRenderedProgress||this.lastRenderedProgress|0!==this.progress|0)&&(e.children[0].setAttribute("data-progress-text",""+(0|this.progress)+"%"),this.progress>=100?n="99":(n=this.progress<10?"0":"",n+=0|this.progress),e.children[0].setAttribute("data-progress",""+n)),this.lastRenderedProgress=this.progress},e.prototype.done=function(){return this.progress>=100},e}(),s=function(){function e(){this.bindings={}}return e.prototype.trigger=function(e,t){var n,r,i,a,o;if(null!=this.bindings[e]){for(a=this.bindings[e],o=[],r=0,i=a.length;i>r;r++)n=a[r],o.push(n.call(this,t));return o}},e.prototype.on=function(e,t){var n;return null==(n=this.bindings)[e]&&(n[e]=[]),this.bindings[e].push(t)},e}(),R=window.XMLHttpRequest,H=window.XDomainRequest,F=window.WebSocket,k=function(e,t){var n,r,i;i=[];for(r in t.prototype)try{i.push(null==e[r]&&"function"!=typeof t[r]?"function"==typeof Object.defineProperty?Object.defineProperty(e,r,{get:function(){return t.prototype[r]},configurable:!0,enumerable:!0}):e[r]=t.prototype[r]:void 0)}catch(a){n=a}return i},S=[],c.ignore=function(){var e,t,n;return t=arguments[0],e=2<=arguments.length?K.call(arguments,1):[],S.unshift("ignore"),n=t.apply(null,e),S.shift(),n},c.track=function(){var e,t,n;return t=arguments[0],e=2<=arguments.length?K.call(arguments,1):[],S.unshift("track"),n=t.apply(null,e),S.shift(),n},L=function(e){var t;if(null==e&&(e="GET"),"track"===S[0])return"force";if(!S.length&&M.ajax){if("socket"===e&&M.ajax.trackWebSockets)return!0;if(t=e.toUpperCase(),Z.call(M.ajax.trackMethods,t)>=0)return!0}return!1},u=function(e){function t(){var e,n=this;t.__super__.constructor.apply(this,arguments),e=function(e){var t;return t=e.open,e.open=function(r,i){return L(r)&&n.trigger("request",{type:r,url:i,request:e}),t.apply(e,arguments)}},window.XMLHttpRequest=function(t){var n;return n=new R(t),e(n),n};try{k(window.XMLHttpRequest,R)}catch(r){}if(null!=H){window.XDomainRequest=function(){var t;return t=new H,e(t),t};try{k(window.XDomainRequest,H)}catch(r){}}if(null!=F&&M.ajax.trackWebSockets){window.WebSocket=function(e,t){var r;return r=null!=t?new F(e,t):new F(e),L("socket")&&n.trigger("request",{type:"socket",url:e,protocols:t,request:r}),r};try{k(window.WebSocket,F)}catch(r){}}}return X(t,e),t}(s),U=null,x=function(){return null==U&&(U=new u),U},z=function(e){var t,n,r,i;for(i=M.ajax.ignoreURLs,n=0,r=i.length;r>n;n++)if(t=i[n],"string"==typeof t){if(-1!==e.indexOf(t))return!0}else if(t.test(e))return!0;return!1},x().on("request",function(t){var n,r,i,a,o;return a=t.type,i=t.request,o=t.url,z(o)?void 0:c.running||M.restartOnRequestAfter===!1&&"force"!==L(a)?void 0:(r=arguments,n=M.restartOnRequestAfter||0,"boolean"==typeof n&&(n=0),setTimeout(function(){var t,n,o,s,l,u;if(t="socket"===a?i.readyState<2:0<(s=i.readyState)&&4>s){for(c.restart(),l=c.sources,u=[],n=0,o=l.length;o>n;n++){if(I=l[n],I instanceof e){I.watch.apply(I,r);break}u.push(void 0)}return u}},n))}),e=function(){function e(){var e=this;this.elements=[],x().on("request",function(){return e.watch.apply(e,arguments)})}return e.prototype.watch=function(e){var t,n,r,i;return r=e.type,t=e.request,i=e.url,z(i)?void 0:(n="socket"===r?new h(t):new m(t),this.elements.push(n))},e}(),m=function(){function e(e){var t,n,r,i,a,o,s=this;if(this.progress=0,null!=window.ProgressEvent)for(n=null,e.addEventListener("progress",function(e){return s.progress=e.lengthComputable?100*e.loaded/e.total:s.progress+(100-s.progress)/2},!1),o=["load","abort","timeout","error"],r=0,i=o.length;i>r;r++)t=o[r],e.addEventListener(t,function(){return s.progress=100},!1);else a=e.onreadystatechange,e.onreadystatechange=function(){var t;return 0===(t=e.readyState)||4===t?s.progress=100:3===e.readyState&&(s.progress=50),"function"==typeof a?a.apply(null,arguments):void 0}}return e}(),h=function(){function e(e){var t,n,r,i,a=this;for(this.progress=0,i=["error","open"],n=0,r=i.length;r>n;n++)t=i[n],e.addEventListener(t,function(){return a.progress=100},!1)}return e}(),r=function(){function e(e){var t,n,r,a;for(null==e&&(e={}),this.elements=[],null==e.selectors&&(e.selectors=[]),a=e.selectors,n=0,r=a.length;r>n;n++)t=a[n],this.elements.push(new i(t))}return e}(),i=function(){function e(e){this.selector=e,this.progress=0,this.check()}return e.prototype.check=function(){var e=this;return document.querySelector(this.selector)?this.done():setTimeout(function(){return e.check()},M.elements.checkInterval)},e.prototype.done=function(){return this.progress=100},e}(),n=function(){function e(){var e,t,n=this;this.progress=null!=(t=this.states[document.readyState])?t:100,e=document.onreadystatechange,document.onreadystatechange=function(){return null!=n.states[document.readyState]&&(n.progress=n.states[document.readyState]),"function"==typeof e?e.apply(null,arguments):void 0}}return e.prototype.states={loading:0,interactive:50,complete:100},e}(),a=function(){function e(){var e,t,n,r,i,a=this;this.progress=0,e=0,i=[],r=0,n=A(),t=setInterval(function(){var o;return o=A()-n-50,n=A(),i.push(o),i.length>M.eventLag.sampleCount&&i.shift(),e=g(i),++r>=M.eventLag.minSamples&&e<M.eventLag.lagThreshold?(a.progress=100,clearInterval(t)):a.progress=100*(3/(e+3))},50)}return e}(),p=function(){function e(e){this.source=e,this.last=this.sinceLastUpdate=0,this.rate=M.initialRate,this.catchup=0,this.progress=this.lastProgress=0,null!=this.source&&(this.progress=P(this.source,"progress"))}return e.prototype.tick=function(e,t){var n;return null==t&&(t=P(this.source,"progress")),t>=100&&(this.done=!0),t===this.last?this.sinceLastUpdate+=e:(this.sinceLastUpdate&&(this.rate=(t-this.last)/this.sinceLastUpdate),this.catchup=(t-this.progress)/M.catchupTime,this.sinceLastUpdate=0,this.last=t),t>this.progress&&(this.progress+=this.catchup*e),n=1-Math.pow(this.progress/100,M.easeFactor),this.progress+=n*this.rate*e,this.progress=Math.min(this.lastProgress+M.maxProgressPerFrame,this.progress),this.progress=Math.max(0,this.progress),this.progress=Math.min(100,this.progress),this.lastProgress=this.progress,this.progress},e}(),B=null,D=null,v=null,O=null,f=null,y=null,c.running=!1,C=function(){return M.restartOnPushState?c.restart():void 0},null!=window.history.pushState&&(W=window.history.pushState,window.history.pushState=function(){return C(),W.apply(window.history,arguments)}),null!=window.history.replaceState&&(V=window.history.replaceState,window.history.replaceState=function(){return C(),V.apply(window.history,arguments)}),d={ajax:e,elements:r,document:n,eventLag:a},(T=function(){var e,n,r,i,a,o,s,l;for(c.sources=B=[],o=["ajax","elements","document","eventLag"],n=0,i=o.length;i>n;n++)e=o[n],M[e]!==!1&&B.push(new d[e](M[e]));for(l=null!=(s=M.extraSources)?s:[],r=0,a=l.length;a>r;r++)I=l[r],B.push(new I(M));return c.bar=v=new t,D=[],O=new p})(),c.stop=function(){return c.trigger("stop"),c.running=!1,v.destroy(),y=!0,null!=f&&("function"==typeof b&&b(f),f=null),T()},c.restart=function(){return c.trigger("restart"),c.stop(),c.start()},c.go=function(){var e;return c.running=!0,v.render(),e=A(),y=!1,f=N(function(t,n){var r,i,a,o,s,l,u,d,h,m,f,g,b,_,w,k;for(d=100-v.progress,i=f=0,a=!0,l=g=0,_=B.length;_>g;l=++g)for(I=B[l],m=null!=D[l]?D[l]:D[l]=[],s=null!=(k=I.elements)?k:[I],u=b=0,w=s.length;w>b;u=++b)o=s[u],h=null!=m[u]?m[u]:m[u]=new p(o),a&=h.done,h.done||(i++,f+=h.tick(t));return r=f/i,v.update(O.tick(t,r)),v.done()||a||y?(v.update(100),c.trigger("done"),setTimeout(function(){return v.finish(),c.running=!1,c.trigger("hide")},Math.max(M.ghostTime,Math.max(M.minTime-(A()-e),0)))):n()})},c.start=function(e){w(M,e),c.running=!0;try{v.render()}catch(t){l=t}return document.querySelector(".pace")?(c.trigger("start"),c.go()):setTimeout(c.start,50)},"function"==typeof define&&define.amd?define(["pace"],function(){return c}):"object"==typeof exports?module.exports=c:M.startOnPageLoad&&c.start()}.call(this);