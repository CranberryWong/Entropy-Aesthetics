var PopInSearchBox={index:-1,id:-1,lastValue:"",searchField:null,searchSuggestion:null,timerId:0,callbacks:[],wordmap:{},TIMEOUT_MS:1000,emptyFunction:function(){},baseUrl:location.pathname.replace(location.pathname.substring(0,location.pathname.lastIndexOf("/")+1),""),getPageOffset:function(c){var e={x:0,y:0};var a=document;if(c==a){return e}var b=null;var d;e.x=c.offsetLeft;e.y=c.offsetTop;b=c.offsetParent;if(b!=c){while(b){e.x+=b.offsetLeft;e.y+=b.offsetTop;b=b.offsetParent}}if(c.style.position=="absolute"){e.y-=document.body.offsetTop}b=c.offsetParent;while(b&&b!=document.body){e.x-=b.scrollLeft;b=b.offsetParent}return e},addSuggestion:function(d,c,e){var b=function(){};b.prototype=Suggest;var a=new b();a.init(d,c,e)},onDOMContentLoaded:function(f,k,a){if(typeof f=="undefined"){f="popInSearchField"}if(typeof k=="undefined"){k=_popIn_customsearch_path}if(typeof a=="undefined"){a="_popin_default"}var b=UserId.getUserId();var j=PopInSearchBox;var c=document.getElementById(f);if(!(typeof _popIn_suggestion_enable!="undefined"&&String(_popIn_suggestion_enable)=="false")){j.addSuggestion(c,k,a)}var g=j.getKeyword();if(g&&g!=""&&!(typeof _popIn_excludeUrl!="undefined"&&_popIn_excludeUrl==location.href)){var i=k.replace("http://","").replace(/\/$/,"");var d=window.location.toString().replace("http://","").replace(/\/$/,"");if(d==i){return}j.popInLog("type=referer&url="+location.href+"&q="+encodeURIComponent(g));document.getElementById(f).value=g;try{document.getElementById(f).value=decodeURIComponent(g).replace(/\+/g," ")}catch(h){}}},addEvent:function(d,c,b,a){if("addEventListener" in document){d.addEventListener(c,b,a)}else{if(document.attachEvent){d.attachEvent("on"+c,function(){b.call(d,window.event)})}}},cancel:function(a){if(typeof a.preventDefault=="undefined"){a.returnValue=false}else{a.preventDefault()}},toHankaku:function(c){if(typeof(c)!="string"){return false}var b=(function(){var f="["+String.fromCharCode(65281)+"-"+String.fromCharCode(65374)+"]";var e=new RegExp(f,"g");var d=function(g){return String.fromCharCode(g.charCodeAt(0)-65248)};return function(g){return g.replace(e,d)}})();var a=c;a=b(a);a=a.replace(/[縲]+/g," ");return a.toLowerCase()},services:[{host:"google.co",query:"q"},{host:"search.yahoo.co",query:"p"},{host:"www.bing.com",query:"q"},{host:"static.popin.cc",query:"q"}],getKeywordFromString:function(e){for(var c=0;c<this.services.length;c++){var a=this.services[c];if(e.indexOf(a.host)>=1){var d=new RegExp("[?|&]"+a.query+"=([^&]*)");var b=e.match(d);if(b){return decodeURIComponent(b[1].replace(/\+/g,"%20").replace("%E3%80%80","%20"))}}}return""},getKeyword:function(){return PopInSearchBox.getKeywordFromString(document.referrer)},popInLog:function(a){var b=document.createElement("img");b.src="http://r.popin.cc/log.gif?"+a+"&rnd="+(new Date).getTime();b.width="0px";b.height="0px";document.body.appendChild(b)}};var CookieManager={removeItem:function(a){document.cookie=a+"=; path=/; max-age:0; expires=Thu, 01-Jan-70 00:00:01 GMT;"},setItem:function(d,e,c){var b,a;if("expires" in c){b=new Date();b.setTime(b.getTime()+(c.expires*24*60*60*1000));a="; path=/; expires="+b.toGMTString()}else{a=""}document.cookie=d+"="+encodeURIComponent(e)+a},getItem:function(a){if(!document.cookie){return null}var d=document.cookie.split(";");var c,b;for(c=0;c<d.length;c++){b=d[c].replace(/^\s+|\s+$/g,"");if(b.substring(0,a.length+1)==(a+"=")){return decodeURIComponent(b.substring(a.length+1))}}return null},ensuredGetItem:function(b,c,a){if(this.getItem(b)===null){this.setItem(b,c,a)}return this.getItem(b)}};var UserId={makeGUID:function(){var b=function(g){var h=parseInt(Math.floor(Math.random()*Math.pow(16,g))).toString(16);return(""+Math.pow(10,g)+h).slice(-g)};var d=b(8);var c=b(4);var a=b(4);var f=b(4);var e=b(12);return d+"-"+c+"-"+a+"-"+f+"-"+e},getUserId:function(){var a=CookieManager.getItem("popin_user_id");if(a!=null){CookieManager.removeItem("popin_user_id")}else{a=this.makeGUID()}return CookieManager.ensuredGetItem("_popin_user_id",a,{expires:2*365})}};var Suggest={DOWN:40,UP:38,ENTER:13,cache:{},focus:false,requestCount:0,callbacks:[],getState:function(){var a=CookieManager.getItem("popin_suggest_enable");if(a!=null){CookieManager.removeItem("popin_suggest_enable")}else{a=true}return CookieManager.ensuredGetItem("_popin_suggest_enable",a,{expires:2*365})},setState:function(a){return CookieManager.setItem("_popin_suggest_enable",a,{expires:2*365})},init:function(a,b,c){if(typeof a=="undefined"){a="popInSearchField"}if(typeof b=="undefined"){b=_popIn_customsearch_path}if(typeof c=="undefined"){c="_popin_default"}this.textField=a;this.searchPath=b;this.actionId=c;a.setAttribute("AutoComplete","off");a.setAttribute("SpellCheck","false");this.initCookieState();this.addFieldEvents();this.createContainer()},addFieldEvents:function(){var a=this;setInterval(function(){if(a.focus){a.handleKey()}},100);this.textField.onfocus=function(b){a.changePos();a.handleFocus()};this.textField.onblur=function(b){a.handleBlur()};this.textField.onkeydown=function(b){b=b||window.event;if(b.keyCode==a.DOWN){a.handleKeyDown(b)}else{if(b.keyCode==a.UP){a.handleKeyUp(b)}}}},createContainer:function(){var e=document.createElement("div");var d=PopInSearchBox.getPageOffset(this.textField);d.y+=this.textField.offsetHeight;var a=Math.max(180,this.textField.offsetWidth-2);var b="display:none; position: absolute; top:"+d.y+"px; left:"+d.x+"px; z-index:999999;width:"+a+"px;float:none;";if(typeof _popin_conf_param=="undefined"||typeof _popin_conf_param.containerClass=="undefined"){b+="border: solid 1px black;"}else{e.className=_popin_conf_param.containerClass}e.style.cssText=b;document.body.appendChild(e);var c=e.appendChild(document.createElement("div"));c.style.cssText="background: #FFFFFF;float:none;";this.currentInnerDiv=c;this.currentDiv=e},changePos:function(){var b=this.currentDiv;var c=PopInSearchBox.getPageOffset(this.textField);c.y+=this.textField.offsetHeight;var a=Math.max(180,this.textField.offsetWidth-2);b.style.top=c.y+"px";b.style.left=c.x+"px";b.style.width=a+"px"},handleKey:function(){if(this.textField.value.replace(/^\s+/,"").replace(/\s+/g,"")==""){this.hideContainer();this.previousWord=-1;return}var a=PopInSearchBox.toHankaku(this.textField.value);if(a==this.previousWord||(this.lastInvalid&&a.indexOf(this.lastInvalid)==0)){return}this.currentIndex=-1;if(this.enabled){this.fillContainer()}else{this.currentInnerDiv.innerHTML="";this.createSuggestOptions();this.showContainer();this.previousWord=a}},showContainer:function(){this.currentDiv.style.display="block"},hideContainer:function(){this.currentDiv.style.display="none"},fillContainer:function(){var d=PopInSearchBox.toHankaku(this.textField.value);this.previousWord=d;d=d.replace(/[\":\*!{}^\\[\]\(\)\?]/g,"").replace(/^\s+/,"").replace(/\s+/g,"_");var c=this.searchPath;var b="https://search.popin.cc/suggest/select/?q=site:(";b+=encodeURIComponent(c.replace(/^http:\/\/|\/$/g,""));b+=")%20AND%20input:(";b+=encodeURIComponent(d);b+="*)&fl=keyword&sort=frequency%20desc&version=2.2&start=0&rows=10&omitHeader=true";var a=this;this.doCall(b,function(e){a.currentInnerDiv.innerHTML="";a.fillInnerDiv(e);if(a.lastResults.length>0){a.createSuggestOptions();a.showContainer()}else{a.hideContainer();a.lastInvalid=a.previousWord}})},fillInnerDiv:function(k){var j=this;var g=[];this.lastResults=g;var f=k.response.docs;var b=this.textField.value.replace(/\s+$/,"");var a=this.currentInnerDiv.appendChild(document.createElement("div"));a.style.cssText="float:none;";a.onmouseover=function(o){o=o||window.event;var n=o.target||o.srcElement;for(var l=0;l<g.length;l++){var m=g[l].element;if(n==m){j.currentIndex=l;break}}j.highlightNode(j.currentIndex)};a.onmouseout=function(){};a.onmousedown=function(){j.handleClick(g[j.currentIndex])};var c=10;if(typeof _popIn_suggestion_max!="undefined"){c=parseInt(_popIn_suggestion_max)}for(var d=0,e=f.length;d<e&&g.length<c;d++){text=f[d].keyword;if(text==b){continue}var h=a.appendChild(document.createElement("div"));h.appendChild(document.createTextNode(text));h.style.cssText="padding: 2px 2px;margin: 0px;cursor: default;text-align:left;font-size:13px;line-height:15px;color:#333;float:none;";g.push({data:f[d],element:h})}},handleClick:function(c){function a(h){var g=document.createElement("span");g.innerHTML='<a href="'+h+'" />';return g.firstChild.href}var d=c.data.keyword;if(typeof PopInCustom=="object"){window.top.location.href=PopInCustom.querys.keywordSearch(d)+PopInCustom.imgparam}else{var f=this.actionId;var e=_popIn_search_box[f].qname.replace(/{_popIn_word}/,encodeURIComponent(d));var b=_popIn_search_box[f].action.indexOf("http://")==0?_popIn_search_box[f].action:a(_popIn_search_box[f].action);window.top.location.href=[b,e].join("")}},doCall:function(b,e){if(this.cache[b]){e.call(this,this.cache[b]);return}var a=this;var d=document.createElement("script");var c=(new Date).getTime();d.src=b+"&wt=json&json.wrf=Suggest.callt"+c+"&r="+c;d.charset="UTF-8";document.body.appendChild(d);Suggest["callt"+c]=function(f){a.cache[b]=f;e.call(a,f);document.body.removeChild(d)}},handleFocus:function(){this.focus=true},handleBlur:function(){this.focus=false;var a=this;setTimeout(function(){a.hideContainer()},100)},handleKeyUp:function(a){PopInSearchBox.cancel(a);if(this.currentIndex<=0){this.currentIndex=this.lastResults.length}this.currentIndex--;this.highlightNode(this.currentIndex);this.textField.value=this.lastResults[this.currentIndex].data.keyword;this.previousWord=this.textField.value},handleKeyDown:function(a){PopInSearchBox.cancel(a);if(this.currentIndex>=this.lastResults.length-1){this.currentIndex=-1}this.currentIndex++;this.highlightNode(this.currentIndex);this.textField.value=this.lastResults[this.currentIndex].data.keyword;this.previousWord=this.textField.value},highlightNode:function(a){for(var b=0;b<this.lastResults.length;b++){var c=this.lastResults[b].element;if(b==a){c.style.background="rgb(51,102,204)";c.style.color="#ffffff";self.currentIndex=b}else{c.style.background="#ffffff";c.style.color="#333333"}}},initCookieState:function(){this.enabled=this.getState()=="true"?true:false},changeState:function(){this.previousWord=-1;if(this.enabled){this.disable()}else{this.enable()}},enable:function(){this.enabled=true;this.setState("true");var a=this},disable:function(){this.enabled=false;this.setState("false")},createSuggestOptions:function(){var b=this;var c=document.createElement("div");c.style.cssText="padding: 0px 5px 2px 0px;margin:0px;font-size:12px;font-family:Arial;cursor:default;background:#f7f7f7; color:#666666;text-align:right;border-top:1px solid #efefef;float:none;";var a=document.createElement("a");var d="サジェスト機能"+(!this.enabled?"オン":"オフ");a.appendChild(document.createTextNode(d));a.style.cssText="color:#828282;text-decoration:underline;pointer:cursor;";a.href="#";c.appendChild(a);a.onmousedown=function(g){var f=window.event||g;PopInSearchBox.cancel(f);b.changeState()};this.currentInnerDiv.appendChild(c)}};var PopInSearchBoxConf={};PopInSearchBoxConf.isLoadEnd=false;PopInSearchBoxConf.initializeStyle=function(){var c=_popin_conf_param.nodeStyle;if(typeof c=="undefined"){return}for(var d in c){var b=document.getElementById(d);if(b){for(var a in c[d]){b.style[a]=c[d][a]}}}};PopInSearchBoxConf.actionCheck=function(a,d,g){a=a||window.event;var i=PopInSearchBox;var h=a.target||a.srcElement;if(h.type=="text"&&a.keyCode!=13){return}function f(k){var j=document.getElementById(k);if(j&&((j.type=="radio"&&j.checked)||(j.tagName=="OPTION"&&j.selected))||(typeof _popin_conf_param.tabstyle!="undefind"&&String(_popin_conf_param.tabstyle)=="true"&&k==_popIn_selected_tab_id)){return true}return false}if(typeof _popin_conf_param.choiceList!="undefined"){for(var c in _popin_conf_param.choiceList){if(f(c)){var b=_popin_conf_param.choiceList[c].actionId||"";if(typeof _popIn_search_box[b]=="undefined"){return}d=b;break}}}i.cancel(a);e(_popIn_search_box[d]);function e(n){if(typeof g=="undefined"){g=PopInSearchBoxConf.defaultFiledId}if(typeof n.fieldId!="undefined"){g=n.fieldId}var m=document.getElementById(g);var l=encodeURIComponent(m.value).replace(/%20/g,"+");var p=n.qname.replace(/{_popIn_word}/,l);if(typeof _popIn_searchbox_log!=="undefined"&&_popIn_searchbox_log){PopInSearchBox.popInLog("type=search&path="+_popIn_customsearch_path+"&q="+l)}function j(r){var q=document.createElement("span");q.innerHTML='<a href="'+r+'" />';return q.firstChild.href}var k=n.action.indexOf("http://")==0?n.action:j(n.action);var o=n.param||"";window.top.location.href=[k,p,o].join("")}};PopInSearchBoxConf.initializeLogo=function(b){if((typeof _popin_conf_param.showLogo!="undefined"&&!_popin_conf_param.showLogo)){return}var a=PopInSearchBox;if(typeof b=="undefined"){b="popInSearchField"}var h=document.getElementById(b);function c(i){h.bg=i;if(h.value==""&&typeof _popin_conf_param.showMsg=="undefined"){h.style.background=i}}a.addEvent(h,"focus",function(){h.style.background="#fff"},false);a.addEvent(h,"blur",function(){c(h.bg)},false);var g=_popin_conf_param.choiceList;var e="#fff url(data:image/gif;base64,R0lGODlhZQAPANU/APf4+/n6/cLJ4LjA2+Tl8rW92dba6q+51vX1+unq9czS5aOt0dDU5+jq8+vt9cjO47zD3b/G3u/x9u3u9f39/srP5N/i7sbM4qCr0Kiy08TK4eHl8Nzg7fL0+dPX6aev09nd6/Hy+N/j752ozqu01Ofp8u/v98PE48jK5d/f8LGz25umzLi53tna7c7P6Kao1s7T5vT1+fv8/ay11a221t7h7fz9/fX2+vr6/aex0vn6/Nvf7ePm8b2/4NTV6////yH5BAEAAD8ALAAAAABlAA8AAAb/wJ9wSCwaj8ikcslsOp/QqHRKrVqvUJgAy0Ught4lqCAaUmAFh1VT4GJ9viF8CVutKpROYfXh/W47NQIaan8wERVfJRseETA4PxcDOCA8AgITblFzQpxKDgcrNAsrGgBCEisFNTALEjIzEDUaJDgKdxYDBRQPAwgrAzUVH0QuKSg9BJ09JyY/J0I9XykJAcgoAT89KT0/Jic9cT/cJy7iPz4nyMon2ehfQhQVKxhlQxMfpz+IGzNDBwYYtPlhA0MJBb4wSPghgwQRZj8CqAjgA4W3iT1MmFDR4gcLayl+tHDx40WKbCycnSBg4mMAFud8uFSBwNwPBCqMJAhRxMHA/x8GIjQaokEADAb/QCCM8eHGDx00HirTlqBHAiEoErRo4SPFRxYl4SArKSSBCjjhONnsJM5FApzoQha5YaPIhAwyhFy4YOHAkAIMGAwYsoDH0g9fAPgbkixa1as/sn4D24NryQSYnb0oywLzW7Ux2ypD4dXdEAMjZjQgImFEhAYcFjTAkeNCAwb5GIzwkOBCLTYxMMT4ASDHQ2gSA7SwiBMltBYqnG37kSDO5ojRRRKoij1mN4lfTHywOCTEHlIrHlAQMgEgBAgbhITQMCDCwgoaYAwQMLyGAVs6MIQUYy2AM5ULPVjVSUgmdBMROM1oM0SDPWCDToUtyCVSCiewoDkhTUPEtgIENzRAgipqgMLEAwpEoaAmVXB3GgkcDKHDAzSsNsEA6ylxVBQuOAPjFMyYNuSRSCZ5RRAAOw==) 5px center no-repeat";if(typeof g!="undefined"){var f=false;for(var d in g){(function(l,m){var i=l.background||"#fff";if(typeof l.def!="undefined"&&l.def==true){e=i}var k=document.getElementById(m);if(k){if(k.tagName=="OPTION"){k.bgdata=i;if(!f){f=true;var j=k.parentNode;a.addEvent(j,"change",(function(){var n=this.childNodes[this.selectedIndex].bgdata;c(n)}),false)}}else{a.addEvent(k,"click",function(){c(i)},false)}}})(g[d],d)}}c(e)};PopInSearchBoxConf.initializeField=function(b){var a=PopInSearchBox;if(typeof b=="undefined"){b="popInSearchField"}var c=document.getElementById(b);c.background="#fff";if(typeof _popin_conf_param.showMsg!="undefined"){c.value=_popin_conf_param.showMsg;c.style.color="#bbbbbb";a.addEvent(c,"focus",function(){if(c.value==_popin_conf_param.showMsg){c.value=""}c.style.color="";c.background="#fff"},false);a.addEvent(c,"blur",function(){if(c.value==""){c.value=_popin_conf_param.showMsg;c.background="#fff";c.style.color="#bbbbbb"}},false)}};PopInSearchBoxConf.startConf=function(){if(typeof _popIn_search_box=="undefined"){return}var b=PopInSearchBox;var e=["popInSearchField"];PopInSearchBoxConf.defaultFiledId="popInSearchField";if(typeof _popin_conf_param!="undefined"&&typeof _popin_conf_param.fieldId!="undefined"){if(typeof _popin_conf_param.fieldId=="string"){e=[_popin_conf_param.fieldId];PopInSearchBoxConf.defaultFiledId=_popin_conf_param.fieldId}else{e=[];for(var d in _popin_conf_param.fieldId){e.push(d)}PopInSearchBoxConf.defaultFiledId=e[0]}}function c(){if(PopInSearchBoxConf.isLoadEnd){return}var k=0;for(var j=0;j<e.length;j++){(function(i){var m=_popIn_customsearch_path;var n="_popin_default";if(typeof _popin_conf_param!="undefined"&&typeof _popin_conf_param.fieldId!="undefined"&&typeof _popin_conf_param.fieldId[i]!="undefined"){m=_popin_conf_param.fieldId[i]["path"];n=_popin_conf_param.fieldId[i]["actionId"]}var l=document.getElementById(i);if(l){k++;b.addEvent(l,(window.opera?"keypress":"keydown"),function(o){PopInSearchBoxConf.actionCheck(o,n,i)},false);b.onDOMContentLoaded(i,m,n);PopInSearchBoxConf.initializeStyle();PopInSearchBoxConf.initializeLogo(i);PopInSearchBoxConf.initializeField(i)}})(e[j])}if(k==0){var g=PopInSearchBox.getKeyword();if(g&&g!=""&&!(typeof _popIn_excludeUrl!="undefined"&&_popIn_excludeUrl==location.href)){PopInSearchBox.popInLog("type=referer&url="+location.href+"&q="+encodeURIComponent(g))}}for(var h in _popIn_search_box){(function(l){var i=document.getElementById(l);if(i){b.addEvent(i,"click",function(m){PopInSearchBoxConf.actionCheck(m,l)},false)}})(h)}PopInSearchBoxConf.isLoadEnd=true}var f="readyState" in document?document.readyState:null;if(f&&f=="complete"||f=="loaded"){c()}else{if("addEventListener" in document){b.addEvent(document,"DOMContentLoaded",c,false)}else{if(document.attachEvent){var a=function(){try{new Image().doScroll();c()}catch(g){setTimeout(arguments.callee,1)}};a()}}}b.addEvent(window,"load",c,false)};var PopIn3={};PopIn3.ajaxCache=[];PopIn3.load=function(d,c){var a=this;var g={func:d,self:this,loaded:false};var h=function(){if(!g.loaded){g.loaded=true;g.func()}};if(c&&!PopIn3.$F.isIE6&&!PopIn3.$F.isIE7&&!PopIn3.$F.isIE8){setTimeout(h,1);return}var f="readyState" in document?document.readyState:null;if(f){if(f=="complete"||f=="loaded"){h()}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",h,false);window.addEventListener("load",h,false)}else{document.attachEvent("onreadystatechange",function(){if(document.readyState=="complete"){h()}})}}}else{if(document.addEventListener){var b=document.createElement("script");b.src="data:text/javascript,void 0";b.charset="UTF-8";b.onload=function(){setTimeout(h,100);b.parentNode.removeChild(b)};document.documentElement.appendChild(b)}else{if(window.onload!=null){var e=window.onload;window.onload=function(i){e(i);h()}}else{window.onload=h}}}};PopIn3.Class=function(b,a){PopIn3[b]=function(){if(this.init){this.init.apply(this,arguments)}};PopIn3[b].prototype=a;PopIn3[b].prototype._className=b};PopIn3.StaticClass=function(b,a){PopIn3[b]=a;if(a.init){a.init()}};PopIn3.ClassLoad=function(c,b){var a=function(){PopIn3.Class(c,b);var d=function(){var e=new PopIn3[c]()};setTimeout(function(){PopIn3.load(d,0)},1)};PopIn3.globalLoad(a)};PopIn3.ClassLoadFast=function(c,b){var a=function(){PopIn3.Class(c,b);var d=function(){var e=new PopIn3[c]()};setTimeout(function(){PopIn3.load(d,1)},1)};PopIn3.globalLoad(a)};PopIn3.globalLoad=function(a){if(window._popIn_global){if(window._popIn_global.lib3_ready){a()}else{_popIn_global.addEventListener("init_lib3",a)}}else{a()}};new PopIn3.StaticClass("Cookie",{init:function(){},setCookie:function(d,f,c){var a="";c=c||{};if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){var b;if(typeof c.expires=="number"){b=new Date();b.setTime(b.getTime()+(c.expires*24*60*60*1000))}else{b=c.expires}a="; expires="+b.toUTCString()}var h=c.path?"; path="+(c.path):"";var e=c.domain?"; domain="+(c.domain):"";var g=c.secure?"; secure":"";var f=c.noencode?f:encodeURIComponent(f);document.cookie=[d,"=",f,a,h,e,g].join("")},getCookie:function(b){if(!navigator.cookieEnabled||document.cookie==""){return null}b=b.replace(/\W/g,"\\$&");var c=new RegExp("(?:^|;)\\s?"+b+"=([^;]*)","i"),a=document.cookie.match(c);return a&&decodeURIComponent(a[1])},removeCookie:function(a){this.setCookie(a,"",{expires:-1})}});PopIn3.StaticClass("$F",{init:function(){this.nua=navigator.userAgent;this.detectBrowser(this.nua.toLowerCase());this.cssExclude=/z-?index|font-?weight|opacity|zoom|line-?height/;this.boxModel=false;this.validDocType=this.isIE?(document.getElementById&&(document.compatMode=="CSS1Compat")):true},detectBrowser:function(f){this.browser="\v"=="v"?"ie":"firefox";this.browserType="unknown";var e=[["Firefox","firefox"],["Firefox3","firefox","3.0."],["IE","msie"],["IE6","msie 6"],["IE7","msie 7"],["IE8","msie 8"],["IE9","msie 9"],["IE10","msie 10"],["iPhone","iphone"],["iPad","ipad"],["iPod","ipod"],["Safari","safari"],["Chrome","chrome"],["Android","android"]];for(var d=0;d<e.length;d++){var c=e[d];var b=true;for(var a=1;a<c.length;a++){if(f.indexOf(c[a])<0){b=false}}this["is"+c[0]]=b;if(b===true){this.browserType=c[0]}}},isTest:function(){return location.href.indexOf("popintest=true")>-1},bind:function(a,e,b,d){var f=function(){return true};if(e=="mouseenter"&&!this.isIE){e="mouseover";f=function(h){var i=h.relatedTarget||h.fromElement;var g=true;while(g&&i){if(i==a){g=false}i=i.parentNode}return g}}if(e=="mouseleave"&&!this.isIE){e="mouseout";f=function(h){var i=h.relatedTarget||h.toElement;var g=true;while(g&&i){if(i==a){g=false}i=i.parentNode}return g}}var c=function(h){h=h||window.event;if(f.apply(this,[h])){var g=b.apply(a,[h,d]);if(!PopIn3.$F.isIE&&g===false){h.preventDefault();h.stopPropagation()}else{if(PopIn3.$F.isIE&&g===false){h.returnValue=false;h.cancelBubble=true}}}};if(a.addEventListener){a.addEventListener(e,c,false)}else{if(a.attachEvent){a.attachEvent("on"+e,c)}}return a},isMobileDevice:function(){return this.isiPhone||this.isiPod||(this.isAndroid&&this.nua.toLowerCase().indexOf("mobile")!==-1)},isTabletDevice:function(){return(this.isAndroid&&this.nua.toLowerCase().indexOf("mobile")===-1)||this.isiPad},getWindowWidth:function(){var b=window;var a=b.document;return b.innerWidth||a.documentElement.clientWidth||a.body.clientWidth||a.scrollWidth},getWindowHeight:function(){var b=window;var a=b.document;return b.innerHeight||a.documentElement.clientHeight||a.body.clientHeight||a.body.scrollHeight},parseUrl:function(a){var b=new Object();if(a.indexOf("?")>0){qString=a.substring(a.indexOf("?"));a=a.substring(0,a.indexOf("?"));qString.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(d,c,f,e){b[c]=e})}return{url:a,qString:b}},parseUri:function(c){var b=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/;var a=c.match(b);if(a){return{scheme:a[1],host:a[2],path:a[3],query:a[4],fragment:a[5]}}else{return null}},toArray:function(b){var a=[];for(var c=0;c<b.length;c++){a.push(b[c])}return a},css:function(){var c=arguments[0];if(typeof arguments[1]=="string"&&arguments.length==2){return this.cssGet(c,arguments[1])}else{if(typeof arguments[1]=="string"&&arguments.length==3){this.cssSet(c,arguments[1],arguments[2]);return c}else{if(typeof arguments[1]=="object"){var b=arguments[1];for(var a in b){this.cssSet(c,a,b[a])}return c}}}},appendCSS:function(a){var b=document.createElement("style");b.type="text/css";b.rel="stylesheet";b.charSet="UTF-8";document.getElementsByTagName("head")[0].appendChild(b);if(PopIn3.$F.isIE){b.styleSheet.cssText=a}else{b.appendChild(document.createTextNode(a))}},CSS_NEED_PREFIX:{transition:true,"transition-timing-function":true,"transition-duration":true,"transition-property":true,transform:true,"transform-origin":true,"backface-visibility":true},cssSet:function(b,a,c){if(a=="opacity"&&this.isIE){this.cssSet(b,"zoom",1);this.cssSet(b,"filter","alpha(opacity="+Number(c*100)+")")}if(typeof c=="number"&&!this.cssExclude.test(a)){c+="px"}if(a in this.CSS_NEED_PREFIX&&a.indexOf("-")!=0){a=(this.isIE?"-ms-":this.isFirefox?"-moz-":window.opera?"-o-":"-webkit-")+a;if(a.indexOf("transition")!=-1&&c.indexOf("transform")!=-1){c=a.substring(0,a.indexOf("transition"))+c}}if(!this.isIE){b.style.setProperty(a,c,null)}else{if(a.indexOf("-")>0){a=a.replace(/\-(\w)/g,function(e,f){return f.toUpperCase()})}try{b.style[a]=c}catch(d){}}},toCamelCase:function(f){var d=f.split("-");if(d.length==1){return d[0]}var b=f.indexOf("-")==0?d[0].charAt(0).toUpperCase()+d[0].substring(1):d[0];for(var c=1,a=d.length;c<a;c++){var e=d[c];b+=e.charAt(0).toUpperCase()+e.substring(1)}return b},cssGet:function(c,b){var d=PopIn3.$F.toCamelCase(b),a=c.style[d];if(!a){if(document.defaultView){a=document.defaultView.getComputedStyle(c,"").getPropertyValue(b)}else{if(c.currentStyle){a=c.currentStyle[d]}else{if(c.style.getPropertyValue){a=c.style.getPropertyValue(b)}}}}if(!a&&b=="opacity"){return 1}return a},insertAfter:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},replaceWith:function(a,b){if(a.parentNode){a.parentNode.replaceChild(b,a)}return a},notEmpty:function(a){return typeof a!="undefined"&&a!=""&&a!=0&&a!=false&&a!=null},ajax_counter:0,ajax:function(){var k;if(arguments.length==2){k={url:arguments[0],success:arguments[1]}}else{if(arguments.length==1&&typeof arguments[0]=="object"){k=arguments[0]}else{throw"Invalid Arguments"}}var d=function(){};var f=k.callbackname?k.callbackname:"pi_ajax"+this.ajax_counter++;var j=document.getElementsByTagName("head")[0];window[f]=function(g){window[f]=undefined;try{delete window[f]}catch(e){}if("callback" in k){window[k.callback](g)}if("success" in k){k.success(g)}try{setTimeout(d,10)}catch(e){}};var i=document.createElement("script");i.charset="utf-8";var a=k.url;a+=((a.indexOf("?")>=0)?"&":"?")+(k.callbackParameterName?k.callbackParameterName:"callback")+"="+encodeURIComponent(f);if(k.iframeLoad){var c=document.createElement("iframe");c.width=1;c.height=1;this.cssSet(c,"display","none");document.body.appendChild(c);var b=(c.contentWindow)?c.contentWindow:(c.contentDocument.document)?c.contentDocument.document:c.contentDocument;var h=[];h.push('<body onload="');h.push("var js = document.createElement('script');");h.push("js.src = '"+a+"';");h.push("var d = document;d.getElementsByTagName('head')[0].appendChild(js);\">");h.push("<script type='text/javascript'>");h.push("window['"+f+"'] = function(data) {");h.push("parent['"+f+"'](data);");h.push("};");h.push("\x3c/script>");h.push("</body>");b.document.open();b.document.write(h.join(""));b.document.close();d=function(){PopIn3.$F.remove(c)};return}i.src=a;if(k.charset){i.charset=k.charset}j.appendChild(i);d=function(){PopIn3.$F.remove(i)}},join:function(d,c){if(typeof d=="undefined"){d={}}if(typeof c=="undefined"){c={}}if(typeof d!="object"||typeof c!="object"){return}if(typeof d.length=="number"&&typeof c.length=="number"){var a=[];for(var b=0;b<d.length;b++){a.push(d[b])}for(var b=0;b<c.length;b++){a.push(c[b])}return a}else{var a={};for(var b in d){a[b]=d[b]}for(var b in c){a[b]=c[b]}return a}},isArray:function(a){var b=Object.prototype.toString;return b.call(a)=="[object Array]"},makeListener:function(a){a._listeners={};a.addEventListener=function(b,c){if(!this._listeners[b]){this._listeners[b]=[]}this._listeners[b].push(c)};a.fireEvent=function(c,b){if(this._listeners[c]){for(var d=0;d<this._listeners[c].length;d++){var e=this._listeners[c][d];e.apply(this,b)}}}},ce:function(a,c,d){var b=a.appendChild(document.createElement(c));if(typeof d!="undefined"){b.appendChild(document.createTextNode(d))}return b},remove:function(a){if(a.parentNode){a.parentNode.removeChild(a)}return a},position:function(c){if(c.getBoundingClientRect){var g=c.getBoundingClientRect();var f=document;var b=f.documentElement;var a=f.body;return{left:Math.round(g.left+(a.scrollLeft||b.scrollLeft)-b.clientLeft),top:Math.round(g.top+(a.scrollTop||b.scrollTop)-b.clientTop)}}else{var e=0,d=0;for(;c!=undefined;c=c.offsetParent){d+=c.offsetLeft;e+=c.offsetTop}return{top:e,left:d}}},tableBuilder:function(d,c){var a=typeof c=="undefined"?true:c;var b=document.createElement("table");if(a){PopIn3.$F.css(b,{border:"0px","border-collapse":"collapse",margin:"0px",padding:"0px"})}return{cols:d||1,cells:0,table:b,newCell:function(){if(!this.tbody){this.tbody=PopIn3.$F.ce(this.table,"tbody")}if(this.cells%this.cols==0){this.actualRow=PopIn3.$F.ce(this.tbody,"tr")}this.cell=PopIn3.$F.ce(this.actualRow,"td");if(a){PopIn3.$F.cssSet(this.cell,"border","0px")}this.cells++;return this.cell}}},insertAdjacentElement:function(b,c,a){c=c.toLowerCase();switch(c){case"beforebegin":b.parentNode.insertBefore(a,b);break;case"afterend":b.parentNode.insertBefore(a,b.nextSibling);break;case"afterbegin":b.insertBefore(a,b.firstChild);break;case"beforeend":b.appendChild(a);break}},oneSelector:function(a,c){var b=this.selector(a,c);return b.length>0?b[0]:false},selector:function(f,l){var m=l.split(" ");var n=[f];for(var g=0;g<m.length;g++){var c=m[g];var a=[];if(c.indexOf("#")==0){var b=c.substring(1,c.length);var o=document.getElementById(b);if(o){a=[o]}}else{for(var e=0;e<n.length;e++){if(c.indexOf(".")==0){var h=this.getElementsByClassName(n[e],c.substring(1,c.length))}else{var h=this.getElementsByTagName(n[e],c)}for(var d=0;d<h.length;d++){a.push(h[d])}}}n=a}return n},getElementsByTagName:function(b,a){return b.getElementsByTagName(a)},getElementsByClassName:function(e,l,g){var c=e.childNodes;var k=[];if(e.nodeType!==1||e.tagName.toLowerCase()==="script"){return k}if(this.isIE&&g&&g!==e.parentNode){return k}for(var f=0;f<c.length;f++){var b=c[f];if(b.nodeType!=1){continue}var a=b.className||b.getAttribute("class");if((" "+a+" ").indexOf(" "+l+" ")>-1){k.push(b)}var h=this.getElementsByClassName(b,l,e);for(var d=0;d<h.length;d++){k.push(h[d])}}return k},bodyOffset:function(b){var d=document;var a=this.position(b);var c=this.position(d.body);if(this.cssGet(d.body,"position")=="relative"){a.left-=(d.body.offsetLeft||c.left);a.top-=(d.body.offsetTop||c.top)}return a},size:function(a){return{width:a.offsetWidth?a.offsetWidth:parseInt(PopIn3.$F.cssGet(a,"width")),height:a.offsetHeight?a.offsetHeight:parseInt(PopIn3.$F.cssGet(a,"height"))}},empty:function(a){while(a.hasChildNodes()){a.removeChild(a.firstChild)}return a},createShortSum:function(f,b){var e=0;var c="";b=(typeof b=="undefined")?60:b;for(var d=0,a=f.length;d<a;d++){var g=f.charCodeAt(d);c+=f.substring(d,d+1);e+=(g>=255)?2:1;if(e>b){return f.substring(0,d)+"..."}}return c},pass:function(c,d,a){if(typeof a=="undefined"){a=[]}var b=c;return function(){return b.apply(d,a)}},pageScrollTop:function(){return document.body.scrollTop||document.documentElement.scrollTop},testOne:function(c,d){for(var a=c.length;a-->0;){var b=new RegExp(c[a]);if(b.test(d)){return true}}return false},replaceAll:function(f,e){var c=f;for(var b=0;b<e.length;b++){var d=e[b];for(var a in d){c=c.replace(new RegExp(a),d[a])}}return c},nextElement:function(a){var b=a;do{b=b.nextSibling}while(b&&b.nodeType!=1);return b},previousElement:function(a){var b=a;do{b=b.previousSibling}while(b&&b.nodeType!=1);return b},escaped:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#39;")},extend:function(c,b){for(var a in b){if(a!="init"&&a!="_className"){c[a]=b[a]}}},hasClass:function(b,a){return new RegExp("(\\s|^)"+a+"(\\s|$)").test(b.className)},addClass:function(b,a){if(!this.hasClass(b,a)){b.className+=(b.className?" ":"")+a}},removeClass:function(b,a){if(this.hasClass(b,a)){b.className=b.className.replace(new RegExp("(\\s|^)"+a+"(\\s|$)")," ").replace(/^\s+|\s+$/g,"")}},aspectBefore:function(d,c,b){var a=d[c];d[c]=function(){b.apply(this,arguments);return a.apply(this,arguments)}},aspectAfter:function(d,c,b){var a=d[c];d[c]=function(){var e=a.apply(this,arguments);b.apply(this,arguments);return e}},getInnerText:function(b){var a=b.innerText||b.textContent||b.data;return PopIn3.$F.notEmpty(a)?a:""},digest:function(f){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$".split("");var c=0,d="",b;for(var a=0,g=f.length;a<g;a++){b=f.charCodeAt(a);c=((c<<5)-c)+b;c|=0}for(var a=0;a<6;a++){d+=e[c&63];c>>>=6}return d}});new PopIn3.StaticClass("JSON",{inif:function(){this.gap="",this.rep="",this.indent=""},quote:function(a){var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};c.lastIndex=0;return c.test(a)?'"'+a.replace(c,function(d){var e=b[d];return typeof e==="string"?e:"\\u"+("0000"+d.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},str:function(h,e){var c,b,j,a,f=this.gap,d,g=e[h];if(g&&typeof g==="object"&&typeof g.toJSON==="function"){g=g.toJSON(h)}if(typeof this.rep==="function"){g=this.rep.call(e,h,g)}switch(typeof g){case"string":return this.quote(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"null":return String(g);case"object":if(!g){return"null"}this.gap+=this.indent;d=[];if(Object.prototype.toString.apply(g)==="[object Array]"){a=g.length;for(c=0;c<a;c+=1){d[c]=this.str(c,g)||"null"}j=d.length===0?"[]":this.gap?"[\n"+this.gap+d.join(",\n"+this.gap)+"\n"+f+"]":"["+d.join(",")+"]";this.gap=f;return j}if(this.rep&&typeof this.rep==="object"){a=this.rep.length;for(c=0;c<a;c+=1){b=this.rep[c];if(typeof b==="string"){j=this.str(b,g);if(j){d.push(this.quote(b)+(this.gap?": ":":")+j)}}}}else{for(b in g){if(Object.prototype.hasOwnProperty.call(g,b)){j=this.str(b,g);if(j){d.push(this.quote(b)+(this.gap?": ":":")+j)}}}}j=d.length===0?"{}":this.gap?"{\n"+this.gap+d.join(",\n"+this.gap)+"\n"+f+"}":"{"+d.join(",")+"}";this.gap=f;return j}},stringify:function(d,b,c){var a;this.gap="";this.indent="";if(typeof c==="number"){for(a=0;a<c;a+=1){this.indent+=" "}}else{if(typeof c==="string"){this.indent=c}}this.rep=b;if(b&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number")){throw new Error("JSON.stringify")}return this.str("",{"":d})},parse:function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}});(kite=function(p,q){var n="";var k=[];var b=null;var h=0;var c=0;var o=kite.formatters||{};if(p.charAt(0)=="#"){var e=null;e=document.getElementById(p.substr(1));if(!e){throw"Template element #"+e+" not found"}p=e.innerHTML}function m(w,u){for(var t=w+1;t<u;){var v=k[t];if(typeof v=="function"){t+=v()}else{n+=v;++t}}}function i(w,v,u){var y=b;var x=h;if(w instanceof Array){var t=w.length;for(h=0;h<t;++h){c=t;b=w[h];m(v,u)}}else{b=w;h=undefined;m(v,u)}b=y;h=x}function l(t){n="";i(t instanceof Array?({"":t}):t,-1,k.length);return n}function r(t){if(!t){return false}if((t instanceof Array)&&t.length==0){return false}return true}function f(t,w,u,v){return function(){var x=b[t];if(r(x)){i(x,w,u);return(v||u)-w}return u-w}}function g(v){var u,t=v.indexOf("|");if(t>=0){u=v.substr(t+1);v=v.substr(0,t);u=o[u]}if(v.indexOf("at")==0){var w=new Function("at","return ("+v+");");return function(){n+=w(h);return 1}}else{if(v=="."){if(u){return function(){n+=u(b,b);return 1}}else{return function(){if(b!==undefined){n+=b}return 1}}}else{if(u){return function(){var x=b[v];n+=u(x,b);return 1}}else{return function(){var x=b[v];if(x!==undefined){n+=x}return 1}}}}}function j(u,t){return function(){m(u,t);return t-u+1}}function s(x,w,t,v){var u=new Function("_","at","last","with(_) {return ("+x+");}");return function(){if(u(b,h,h==c-1)){m(w,t);return v-w}return t-w}}function a(){for(var v=0;v<p.length;){var u=p.indexOf("{{",v);if(u<0){break}var t=p.indexOf("}}",u+2);if(t<0){break}k.push(p.substring(v,u));k.push(p.substring(u+2,t));v=t+2}k.push(p.substr(v))}function d(){a();var w=k.length;function v(A,z){for(var y=A+2;y<w;y+=2){var x=k[y];switch(x.charAt(0)){case"#":y=u(y,x.substr(1));continue;case"?":y=t(y,x.substr(1));if(k[y]=="/?"){k[y]=""}else{y-=2}continue;case"/":k[A]=j(A,y);if(x.substr(1)==z){k[y]=""}return y;case"^":k[A]=j(A,y);return y;default:k[y]=g(x);continue}}return y}function u(B,z){for(var y=B+2;y<w;y+=2){var x=k[y];switch(x.charAt(0)){case"#":y=u(y,x.substr(1));continue;case"?":y=t(y,x.substr(1));if(k[y]=="/?"){k[y]=""}else{y-=2}continue;case"^":if(x.substr(1)==z){var A=y;y=v(y,z);k[B]=f(z,B,A,y);return y}k[B]=f(z,B,y,y);return y-2;case"/":k[B]=f(z,B,y);if(x.substr(1)!=z){return y-2}k[y]="";return y;default:k[y]=g(x);continue}}return y}function t(B,z){for(var y=B+2;y<w;y+=2){var x=k[y];switch(x.charAt(0)){case"#":y=u(y,x.substr(1));continue;case"?":var A=y;y=t(y,x.substr(1));k[B]=s(z,B,A,y);return y;case"^":if(x.substr(1)=="?"){var A=y;y=v(y,"?");k[B]=s(z,B,A,y);return y}k[B]=s(z,B,y,y);return y-2;case"/":k[B]=s(z,B,y,y);if(x.substr(1)!="?"){return y-2}k[y]="";return y;default:k[y]=g(x);continue}}return y}u(-1,"")}d();if(q===undefined){return function(t){return l(t)}}return l(q)}).formatters={date:function(a){var b=a.split("-");if(b.length!=3){return a}return["January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(b[1],10)-1]+" "+parseInt(b[2],10)+", "+b[0]},escaped:function(a){return a.replace("&","&amp;").replace('"',"&quot;").replace("'","&#39;").replace("<","&lt;").replace(">","&gt;")}};new PopIn3.StaticClass("$M",{init:function(){this.config={search_box:{_popin_default:{action:"http://www.google.com/search",qname:"?q={_popIn_word}"}}};this.overrideConfig(this)},makeConfigurable:function(a){a.getParam=function(c,b){return PopIn3.$M.getParam(c,b)}},overrideConfig:function(a){if(typeof a.config!="object"){return}var c=a.config;for(var b in c){var e="_popIn_"+b;if(typeof window[e]=="undefined"){continue}var d=window[e];if(typeof d==typeof c[b]){c[b]=d}else{}}},searchUrl:function(f,b){if(!b){b={r:"reflink"}}var h=this.config.search_box;var d=h._popin_default;var g=d.qname.replace(/{_popIn_word}/,encodeURIComponent(f));var e=[d.action,g];for(var c in b){e.push("&"+c+"=");e.push(encodeURIComponent(b[c]))}var a=e.join("");return a},log:function(a){this.logImage("http://r.popin.cc/log.gif?"+a)},logImage:function(a){var b=document.createElement("img");a+="&rnd="+(new Date).getTime();a+="&browser="+PopIn3.$F.browserType;b.src=a;b.width="0px";b.height="0px";document.body.appendChild(b)},getParameterMap:function(){if(PopIn3.$F.notEmpty(this.parameterMap)){return this.parameterMap}if(typeof _pop=="undefined"){return{}}var e={};for(var d=0;d<_pop.length;d++){var c=_pop[d];var b=c[0];var a=b.substring(0,5);var f=b.substring(5);if(a=="_set_"){e[f]=c[1]}if(a=="_add_"){if(PopIn3.$F.isArray(e[f])){e[f].push(c[1])}else{if(PopIn3.$F.notEmpty(e[f])){e[f]=[e[f],c[1]]}else{e[f]=[c[1]]}}}}this.parameterMap=e;return e},getParam:function(a,b){this.paramMap=this.getParameterMap();if(typeof this.paramMap[a]!="undefined"){return this.paramMap[a]}if(typeof window["_popin_"+a]!="undefined"){return window["_popin_"+a]}if(typeof window["_popIn_"+a]!="undefined"){return window["_popIn_"+a]}return b}});new PopIn3.Class("ProxyAjax",{init:function(a){if(typeof a=="string"){a={url:a}}this.status="init";this.success=false;this.data=a;this.timeout=1000},loaded:function(a){this.result=a;this.status="finish";this.func.call(this,a)},setCallback:function(a){this.func=a},load:function(){this.status="start";for(var c=0;c<PopIn3.ajaxCache.length;c++){var b=PopIn3.ajaxCache[c];if(b.data.url==this.data.url){if(b.status=="finish"){this.loaded(b.result);return}else{if(b.status=="start"){var a=this;PopIn3.$F.aspectAfter(b,"loaded",function(d){a.loaded(d)});return}}}}PopIn3.ajaxCache.push(this);var a=this;setTimeout(function(){if(!a.success){a.success=true;a.loaded(null)}},this.timeout);PopIn3.$F.ajax(PopIn3.$F.join(this.data,{success:function(d){if(a.success==false){a.success=true;a.loaded(d)}},fast:true}))}});new PopIn3.StaticClass("Resource",{init:function(){PopIn3.$M.makeConfigurable(this);this.skin=this.getParam("skin","black");var a="https://i.popincdn.com/media/v1/color_"+this.skin+"/images";this.bp=a+".png";this.bpx=a+"-x.png";this.bpy=a+"-y.png"},backgroundFile:function(d,b,a,f,c){var e=d=="100%"?"repeat-x":b=="100%"?"repeat-y":"no-repeat";return{background:"transparent url("+c+") "+e+" scroll "+f+"px "+a+"px",width:d,height:b}},background:function(e,c,b,f){var a=PopIn3.Resource;var d=e=="100%"?a.bpx:c=="100%"?a.bpy:a.bp;return a.backgroundFile(e,c,b,f,d)}});new PopIn3.StaticClass("$T",{init:function(){PopIn3.$M.makeConfigurable(this);this.items=this.getParam("templates",[])},renderSimpleKite:function(c,b){var a=document.createElement("span");a.innerHTML=kite(b.template,c);return a},renderKite:function(h,e,c){var a=false;if(typeof kite!="undefined"){var g=this.findElement(e.selector);if(g){var f=document.createElement("span");PopIn3.$F.insertAdjacentElement(g,e.position,f);var b=kite(e.template,h);if(typeof c!="undefined"&&typeof c.htmlReplace!="undefined"){b=c.htmlReplace(b)}var d=document.createElement("div");d.innerHTML=b;if(typeof c!="undefined"&&typeof c.domReplace!="undefined"){d=c.domReplace(d)}this.replace_with_el(f,d);a=true;this.insertCSS(e)}}return a},findElement:function(e){var d=(e==="body")?document:document.body;if(typeof e=="string"){e=[e]}for(var b=0;b<e.length;b++){var a=e[b];var c=PopIn3.$F.selector(d,a);if(c.length>0){return c[0]}}},replace_with_el:function(c,b){var d=b.childNodes;var a=[];while(d.length>0){a.push(d[0]);c.parentNode.insertBefore(d[0],c)}c.parentNode.removeChild(c);return a},findTemplats:function(d){var b=0,e=this.items.length,c,a=[];for(;b<e;b++){c=this.items[b];if(typeof c!=="undefined"&&typeof c.func!=="undefined"&&c.func===d){a.push(c)}}return a},insertCSS:function(a){if(typeof a.insertCSS=="undefined"){return}PopIn3.$F.appendCSS(a.insertCSS)}});new PopIn3.StaticClass("UI",{init:function(){this.animation=true;this.cssTransition=false},animate:function(b,d,c){if(typeof c=="undefined"){c={}}if(typeof c!="object"){c={speed:c}}if(typeof c.speed=="string"&&c.speed=="slow"){c.speed=500}if(typeof c.speed=="string"&&c.speed=="fast"){c.speed=100}if(typeof c.speed=="string"&&c.speed=="medium"){c.speed=300}var a=PopIn3.$F.join({element:b,style:d,speed:500,steps:PopIn3.$F.isIE||PopIn3.$F.isFirefox?16:46,exp:1},c);a.start=function(){a.initialStyle={};for(var f in this.style){var h=PopIn3.$F.cssGet(this.element,f);if(typeof h=="string"){h=Number(h.replace("px","").replace("%",""))}a.initialStyle[f]=h}if(PopIn3.UI.animation&&!PopIn3.UI.cssTransition){for(var f=0;f<this.steps;f++){var e=(f+1)/this.steps;var g=e<0.5?Math.sqrt(e/2):(1-Math.sqrt((1-e)/2));setTimeout(PopIn3.$F.pass(a.move,a,[e]),g*this.speed)}}else{this.move(1)}};a.move=function(f){for(var e in this.style){PopIn3.$F.cssSet(this.element,e,(parseInt(this.style[e])-this.initialStyle[e])*f+this.initialStyle[e])}if(f==1&&this.end&&!PopIn3.UI.cssTransition){this.end.apply(this)}};a.start()},fadeIn:function(b){var a;if(arguments.length==3){a={speed:arguments[1],end:arguments[2]}}else{if(arguments.length==2&&typeof arguments[1]=="object"){a=arguments[1]}else{if(arguments.length==2){a={speed:arguments[1]}}}}PopIn3.$F.css(b,{opacity:0,display:""});this.animate(b,{opacity:1},a)},fadeOut:function(b){var a;if(arguments.length==3){a={speed:arguments[1],end:arguments[2]}}else{if(arguments.length==2&&typeof arguments[1]=="object"){a=arguments[1]}else{if(arguments.length==2){a={speed:arguments[1]}}}}PopIn3.$F.cssSet(b,"opacity",1);this.animate(b,{opacity:0},a)}});PopIn3.UI.slideDown=function(e,g,c){var b={};if(typeof g!="undefined"){b.speed=g}if(typeof c!="undefined"){b.end=c}var d=b.end;var a=PopIn3.$F.cssGet(e,"height");var f=PopIn3.$F.cssGet(e,"overflow");PopIn3.$F.css(e,{height:"0px",display:"block",overflow:"hidden"});PopIn3.UI.animate(e,{height:a},PopIn3.$F.join(b,{end:function(){PopIn3.$F.cssSet(e,"overflow",f);if(d){d.apply(this)}}}))};PopIn3.UI.slideUp=function(d,f,b){var a={};if(typeof f!="undefined"){a.speed=f}if(typeof b!="undefined"){a.end=b}var c=a.end;var e=PopIn3.$F.cssGet(d,"overflow");PopIn3.$F.cssSet(d,"overflow","hidden");PopIn3.UI.animate(d,{height:0},PopIn3.$F.join(a,{end:function(){PopIn3.$F.css(d,{overflow:e,display:"none"});if(c){c.apply(d)}}}))};PopIn3.UI.scrollImageLoad=function(b,e,a){if(PopIn3.$F.isIE){b.src="http://images.popin.cc/related/1.gif"}else{var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";b.src=c}if(typeof PopIn3.imageLoader=="undefined"){var d={offset:50,images:[],addImage:function(f,g){PopIn3.$F.bind(f,"error",function(){if(typeof a!=="undefined"&&this.src!==a){this.src=a}});this.images.push({element:f,url:g})},start:function(){var f=this;setInterval(function(){f.handleScroll()},100)},showImage:function(h){var f=this;if(typeof this.lastEvent!="undefined"){h.element.src=h.url;PopIn3.$F.cssSet(h.element,"opacity",0);var g=h.element;setTimeout(function(){PopIn3.UI.fadeIn(g,1000)},100)}else{h.element.src=h.url}},handleScroll:function(){for(var h=0;h<this.images.length;h++){var g=this.images[h];var k=document.body.scrollTop||document.documentElement.scrollTop;var l=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;var f=PopIn3.$F.position(g.element).top;var j=PopIn3.$F.size(g.element);if(j.width*j.height>0&&k+l+this.offset>f){this.showImage(g);this.images.splice(h,1);h--}}}};d.start();PopIn3.imageLoader=d}PopIn3.imageLoader.addImage(b,e)};new PopIn3.Class("Keyword",{init:function(){this.keywords=[];this.maxFound=100;this.startNode=document.body;this.ignoreTags=["A","H1","H2","H3","H4","H5","SCRIPT","STYLE"]},addKeyword:function(a){if(PopIn3.$F.notEmpty(a)){if(typeof a=="string"){a={name:a}}if(PopIn3.$F.notEmpty(a.name)){if(!a.score){a.score=1}for(var b=0;b<this.keywords.length;b++){if(this.keywords[b].name==a.name){return}}this.keywords.push(a)}}},setStartNode:function(a){this.startNode=a},doKeywordMap:function(a){var e=new PopIn3.KeywordMap();var c={};for(var d=0;d<this.keywords.length;d++){var b=this.keywords[d];if(b.found.length>0){e.addKeyword(b,b.found);b.foundBefore=b.found;var j=[];c[b.name]=j;b.found=j}}e.truncateHistogram(a);var h=e.getKeywords();for(var d=0;d<h.length;d++){var g=h[d];if(g.status==1){c[g.name].push(g.element)}else{PopIn3.$F.replaceWith(g.element,document.createTextNode(g.element.innerHTML))}}},process:function(a){this.processResult={};var d=0;for(var c=0;c<this.keywords.length;c++){var b=this.keywords[c];if(d>=this.maxFound){b.found=[]}else{this.processResult[b.name]=[];this._processKeyword(b.name);b.found=this.processResult[b.name];if(b.found.length>0){d++}}}this.doKeywordMap(a);return this.keywords},_processKeyword:function(a){this._processNode(this.startNode,a)},_processNode:function(e,a){if(this._ignoreTag(e)){return}if(this.skipNode&&this.skipNode==e){return}if(e.nodeType==3){var d=this._processTextNode(e,a);if(d){this.processResult[a].push(d)}}else{var c=PopIn3.$F.toArray(e.childNodes);for(var b=0;b<c.length;b++){this._processNode(c[b],a)}}},_ignoreTag:function(b){if(typeof b.id=="string"&&b.id.indexOf("popIn")==0){return true}for(var a=0;a<this.ignoreTags.length;a++){if(b.tagName==this.ignoreTags[a]){return true}}return false},_processTextNode:function(b,e){var l=b.nodeValue;var i=b.ownerDocument;var c=l.toUpperCase();var g=e.toUpperCase();var d=c.indexOf(g);if(d<0){return false}this.hasKeyword=true;var j=i.createTextNode(l.substr(0,d));var h=i.createTextNode(l.substr(d,e.length));var a=i.createTextNode(l.substr(d+e.length));var f=i.createDocumentFragment();f.appendChild(j);var k=i.createElement("span");k.id="popIn"+Math.random();k.appendChild(h);f.appendChild(k);f.appendChild(a);b.parentNode.replaceChild(f,b);this._processNode(a,e);return k}});PopIn3.ClassLoad("KeywordComponent",{init:function(){PopIn3.$M.makeConfigurable(this);var a=this;var b=0;this.timer=setInterval(function(){b++;if(PopIn3.ReferrerUtils.isLoaded){clearInterval(a.timer);a.load()}if(b>50){clearInterval(a.timer)}},100)},load:function(){this.searchKeyword=PopIn3.ReferrerUtils.searchKeyword;this.metaKeyword=PopIn3.ReferrerUtils.metaKeyword;this.max=Number(this.getParam("keyword_max",3));this.searchPath=this.getParam("customsearch_path",window.location.href);this.contentSelector=this.getParam("main_contentSelector","");this.skipNode=this.getParam("keyword_skipNode","");this.showCount=this.getParam("keyword_show_count",true);var b=this.searchPath.replace("http://","").replace(/\/$/,"");var c=window.location.toString().replace("http://","").replace(/\/$/,"");if(b==c){return}var a=PopIn3.$F.selector(document.body,this.contentSelector);if(PopIn3.$F.notEmpty(this.searchKeyword)){this.handleSearchResult(this.searchKeyword,{facet_counts:{facet_fields:{category:[]}},response:{docs:[],numFound:5,start:0}})}else{if(PopIn3.$F.notEmpty(this.metaKeyword)){this.handleSearchResult(null)}}},processKeywords:function(f,b){var c=new PopIn3.Keyword();if(this.contentSelector!=""){var a=PopIn3.$F.selector(document.body,this.contentSelector);if(a.length>0){c.startNode=a[0]}}if(this.skipNode!=""){var a=PopIn3.$F.selector(document.body,this.skipNode);if(a.length>0){c.skipNode=a[0]}}if(b){var h=f.indexOf(" ")>=0?f.split(" "):[f];if(b.response.numFound>1||h.length>1){for(var e=0;e<h.length;e++){if(h[e]!=""){c.addKeyword({name:h[e],score:1000,type:"referrer"})}}}}else{if(PopIn3.$F.notEmpty(this.metaKeyword)){var g=this.metaKeyword.split(",");for(var e=0;e<g.length;e++){c.addKeyword({name:g[e],score:1000,type:"meta"})}}}var d=c.process(this.max);this.transformKeywordResult(d,b)},transformKeywordResult:function(p,g){var n=new PopIn3.SearchTransformer();var k=0;var a=g&&this.showCount?g.response.numFound:"";var o=g&&g.response.numFound>1;for(var d=0;d<p.length;d++){var l=p[d];if(l.type=="referrer"&&o){for(var b=0;b<l.found.length;b++){var f=l.found[b];var c=f.innerText||f.textContent;var h=PopIn3.$M.searchUrl(o?this.searchKeyword:l.name);var m=n.transform(h,c,a);var q=new PopIn3.WhiteTooltip(m);q.result=g;q.word=this.searchKeyword;PopIn3.$F.replaceWith(f,m);k++}}}if(typeof this.searchKeyword!="undefined"&&this.searchKeyword!=""){if(o||k>=1){new PopIn3.SearchResultsBox(this.searchKeyword,g)}return}else{var e=new PopIn3.MetaTransformer();for(var d=0;d<p.length;d++){var l=p[d];if(l.type=="meta"){for(var b=0;b<l.found.length;b++){var f=l.found[b];var h=PopIn3.$M.searchUrl(l.name);var m=e.transform(h,f.innerHTML);PopIn3.$F.replaceWith(f,m)}}}}},handleSearchResult:function(b,a){this.processKeywords(b,a)}});PopIn3.ClassLoad("KeywordComponentTop",{init:function(){PopIn3.$M.makeConfigurable(this);this.max=Number(this.getParam("keyword_max",3));this.contentSelector=this.getParam("main_contentSelector","");this.skipNode=this.getParam("keyword_skipNode","");this.rankingUrl=this.getParam("ranking_url","");this.rankingMax=Number(this.getParam("ranking_max",3));if(PopIn3.$F.notEmpty(this.rankingUrl)){var a=this;new PopIn3.$F.ajax({url:this.rankingUrl,callbackname:"PopInTop10",success:function(b){a.handleTop10(b)}})}},handleTop10:function(p){var l=new PopIn3.Keyword();var m=document.body.textContent;var a=p.response.docs;for(var d=0;d<a.length;d++){var b=a[d].keyword;if(m.indexOf(b)>=0){l.addKeyword(b)}}l.maxFound=this.rankingMax;if(this.contentSelector!=""){var o=PopIn3.$F.selector(document.body,this.contentSelector);if(o.length>0){l.startNode=o[0]}}if(this.skipNode!=""){var o=PopIn3.$F.selector(document.body,this.skipNode);if(o.length>0){l.skipNode=o[0]}}var p=l.process(this.max);var e=new PopIn3.MetaTransformer();for(var d=0;d<p.length;d++){var b=p[d];for(var c=0;c<b.found.length;c++){var h=b.found[c];var g=PopIn3.$M.searchUrl(b.name,{r:"ranking"});var n=e.transform(g,b.name);PopIn3.$F.replaceWith(h,n)}}}});new PopIn3.Class("KeywordMap",{init:function(){this.keywords=[];this.initHistogram()},initHistogram:function(){this.histogram=[];this.windowHeight=PopIn3.$F.getWindowHeight();this.windowHeight=this.windowHeight%2==0?this.windowHeight:this.windowHeight+1;var b=document;this.documentHeight=Math.max(Math.max(b.body.scrollHeight,b.documentElement.scrollHeight),Math.max(b.body.offsetHeight,b.documentElement.offsetHeight),Math.max(b.body.clientHeight,b.documentElement.clientHeight));for(var a=0;a<this.documentHeight;a++){this.histogram.push(0)}},addKeywordToHistogram:function(b){b.status=1;for(var a=Math.max(0,b.position.top-Math.floor(this.windowHeight/2));a<Math.min(b.position.top+b.size.height+this.windowHeight/2,this.documentHeight);a++){this.histogram[a]++}},getKeywords:function(){return this.keywords},getKeywordsBetween:function(e,d){var c=[];for(var a=0;a<this.keywords.length;a++){var b=this.keywords[a];if(b.status==1&&b.position.top>=e&&b.position.top+b.size.height<=d){c.push(b)}}return c},clone:function(d){if(d==null||typeof(d)!="object"){return d}if(typeof d.length=="number"){var a=[];for(var c=0;c<d.length;c++){a.push(d[c])}return a}else{var a={};for(var b in d){a[b]=d[b]}return a}},addKeyword:function(a,c){for(var b=0;b<c.length;b++){var d=this.clone(a,false);d.element=c[b];d.position=PopIn3.$F.position(c[b]);d.size=PopIn3.$F.size(c[b]);this.addKeywordToHistogram(d);this.keywords.push(d)}},getMaxHeight:function(){var b=0;for(var a=0;a<this.documentHeight;a++){b=Math.max(b,this.histogram[a])}return b},removeKeywordFromHistogram:function(b){for(var a=Math.max(0,b.position.top-Math.floor(this.windowHeight/2));a<Math.min(b.position.top+b.size.height+this.windowHeight/2,this.documentHeight);a++){this.histogram[a]--}b.status=0},getBestDeleteCandidate:function(c){var b=10000;for(var a=0;a<c.length;a++){b=Math.min(c[a].score,b)}var d=[];for(var a=0;a<c.length;a++){if(c[a].score==b){d.push(c[a])}}return d[Math.floor(Math.random()*d.length)]},truncateHistogram:function(b){for(var c=this.getMaxHeight();c>b;c=this.getMaxHeight()){var f=0;var e=0;var a=0;while(f<this.documentHeight){for(;f<this.documentHeight;f++){if(this.histogram[f]==c){break}}for(e=f+1;e<this.documentHeight;e++){if(this.histogram[e]<c){break}}var d=this.getKeywordsBetween(f-this.windowHeight/2,e+this.windowHeight/2);if(d.length>0){a++;this.removeKeywordFromHistogram(this.getBestDeleteCandidate(d));break}f=e+1}if(a==0){break}}}});PopIn3.StaticClass("ReferrerUtils",{init:function(){this.parsedReferrer=PopIn3.$F.parseUrl(document.referrer);this.isLoaded=true;this.config={meta_keyword:"POPIN_DAMI"};PopIn3.$M.overrideConfig(this);PopIn3.$M.makeConfigurable(this);this.se=[["search.yahoo.co","p"],["www.bing.com","q"],["www.baidu.jp","wd"],["static.popin.cc","q"],["search.popin.cc","q"]];var b=this.getParam("referrer_disable",false);if(b){return}this.searchKeyword="";for(var c=0;c<this.se.length;c++){var f=this.se[c];if(this.parsedReferrer.url.indexOf(f[0])>=0&&document.referrer.indexOf("popinstart=")<0&&typeof this.parsedReferrer.qString[f[1]]!="undefined"){this.searchProvider=f[0];this.searchKeyword=decodeURIComponent(this.parsedReferrer.qString[f[1]].replace(/\+/g,"%20").replace(/%E3%80%80/g,"%20"));try{this.searchKeyword=decodeURIComponent(this.searchKeyword).replace(/\+/g," ")}catch(g){}if(this.searchKeyword==""){this.isLoaded=false;var h=this;var k=0;function j(){k++;if(typeof PopIn3.UrlKeyword!="undefined"){var e=new PopIn3.UrlKeyword();e.onFinish=function(i){h.searchKeyword=i;h.isLoaded=true};e.load()}else{if(k<10){setTimeout(j,100)}else{h.isLoaded=true}}}j()}if(this.isMatchUrl(location.href)){if(RegExp.$1){var d={path:"/"};PopIn3.Cookie.setCookie("popin_referrer_url",RegExp.$1,d);PopIn3.Cookie.setCookie("popin_referrer_key",this.searchKeyword,d)}}break}}this.metaKeyword="";var l=document.getElementsByTagName("meta");for(var c=0;c<l.length;c++){if(l[c].name==this.config.meta_keyword){this.metaKeyword=l[c].content;break}}var a=PopIn3.Cookie.getCookie("popin_referrer_url");if(a){this.loadCookie()}},isMatchUrl:function(c){var e=this.getParam("referrer_cookie",[]),d,b=0,a=e.length;for(;b<a;b++){d=new RegExp(e[b]);if(d.test(c)){return true}}return false},loadCookie:function(){var b=PopIn3.Cookie.getCookie("popin_referrer_url");if(this.isMatchUrl(location.href)){if(RegExp.$1&&b===RegExp.$1){this.searchKeyword=PopIn3.Cookie.getCookie("popin_referrer_key");return}}var a={path:"/","max-age":0,expires:"Thu, 01-Jan-70 00:00:01 GMT;"};PopIn3.Cookie.setCookie("popin_referrer_url","",a);PopIn3.Cookie.setCookie("popin_referrer_key","",a);return}});new PopIn3.Class("SearchResultsBox",{init:function(b,a){this.word=b;this.result=a;PopIn3.$M.makeConfigurable(this);this.showCategories=(new String(this.getParam("show_categories",true))=="true");this.infoboxBeforeWidth=this.getParam("infobox_before_width","500px");this.infoboxAfterWidth=this.getParam("infobox_after_width","300px");this.ibarfc=this.getParam("infoBar_first_color","#e3f1fa");this.iboxfc=this.getParam("infoBox_first_color","#f7f7f7");this.fl=this.getParam("facet_label","カテゴリー別");this.kfc=this.getParam("keyword_fontColor","#555");this.boxtitpos=this.getParam("infobox_titlePosition","AfterBegin");this.boxcontpos=this.getParam("infobox_contentPosition","BeforeEnd");this.boxtitsel=this.getParam("infobox_titleSelector","");this.boxcontsel=this.getParam("infobox_contentSelector","");this.templates=this.getParam("templates",[]);if(this.templates.length>0){this.doKite()}else{this.createBox()}},createBox:function(){var f=PopIn3.$F.escaped(this.word);var a=this.result;var b=[{infobox_width:this.infoboxBeforeWidth,infobox_margin:"0 0 10px 0",title_padding:"5px 10px 0px 30px",title_margin:0,subtitle_padding:"0 10px 0 30px",subtitle_margin:0,icon_background:"url(http://cdn.popin.cc/referrer/v1/icon_s.png) no-repeat 6px center",icon_background_color:this.ibarfc,border_radius:"3px",compact:true,selector:this.boxtitsel,position:this.boxtitpos},{infobox_width:this.infoboxAfterWidth,infobox_margin:"10px auto",title_padding:"5px 10px 0px 50px",title_margin:0,subtitle_padding:"0 10px 10px 50px",subtitle_margin:0,icon_background:"url(http://cdn.popin.cc/referrer/v1/icon_l.png) no-repeat 10px 8px",icon_background_color:this.iboxfc,border_radius:"5px",compact:false,selector:this.boxcontsel,position:this.boxcontpos}];for(var c=0;c<b.length;c++){var e=PopIn3.$T.findElement(b[c].selector);if(e){var d=this.makeSearchBox(f,a,b[c]);PopIn3.$F.insertAdjacentElement(e,b[c].position,d)}}},makeSearchBox:function(b,r,q){var n=true;if(r&&r.response.numFound<2){n=false}var h=r&&typeof r.facet_counts!="undefined"?r.facet_counts.facet_fields.category:[];var f=[];var l=this;for(var d=0;d<h.length;d+=2){f.push({name:h[d],count:h[d+1]})}var a=document.createElement("div");var e="rgba(0, 0, 0, 0.296875) 0px 0px 4px";var c="rgba(0, 0, 0, 0.296875) 0px 0px 6px";PopIn3.$F.css(a,{width:q.infobox_width,margin:q.infobox_margin,border:"solid 1px #bdbdbd",background:q.icon_background,"background-color":q.icon_background_color,"margin-bottom":"10px","-webkit-box-shadow":e,"-moz-box-shadow":e,zoom:"1","line-hegight":"1.5",clear:"both","border-radius":q.border_radius,"-moz-border-radius":q.border_radius});PopIn3.$F.bind(a,"mouseenter",function(){PopIn3.$F.css(a,{"-webkit-box-shadow":e,"-moz-box-shadow":e})});PopIn3.$F.bind(a,"mouseleave",function(){PopIn3.$F.css(a,{"-webkit-box-shadow":c,"-moz-box-shadow":c})});var o=PopIn3.$F.ce(a,"div");var p;if(n){var p="「"+b+"」の記事をお探しですか？"}else{var p="関連記事を検索してみますか？"}PopIn3.$F.css(o,{"font-size":"15px","font-weight":"bold",color:"#003366",padding:q.title_padding,margin:q.title_margin,"text-align":"left","line-height":1.6});var j;if(q.compact){PopIn3.$F.cssSet(a,"padding","5px");j=o}else{j=PopIn3.$F.ce(a,"div")}PopIn3.$F.css(j,{"text-align":"left","font-size":"13px",color:"black",padding:q.subtitle_padding,margin:q.subtitle_margin,"line-height":1.6});if(n){o.appendChild(document.createTextNode(p));var g=PopIn3.$F.ce(j,"span");var m=PopIn3.$F.ce(g,"a");PopIn3.$F.cssSet(g,"margin-left","10px");PopIn3.$F.css(m,{font:"normal normal normal 13px sans-serif",color:this.kfc,"text-decoration":"underline"});m.href=PopIn3.$M.searchUrl(b);m.innerHTML="<b>最新関連記事が&nbsp;10+&nbsp;件</b>";g.appendChild(m);g.appendChild(document.createTextNode(" あります。"))}else{var k=b.split(" ");for(var d=0;d<k.length;d++){var m=PopIn3.$F.ce(j,"a",k[d]);PopIn3.$F.css(m,{color:"#555555","text-decoration":"underline"});m.href=PopIn3.$M.searchUrl(k[d],{r:"reflink"});j.appendChild(document.createTextNode(" "))}o.appendChild(document.createTextNode(p))}if(q.compact){var l=this;PopIn3.$F.bind(a,"click",function(){location.href=PopIn3.$M.searchUrl(b)});PopIn3.$F.cssSet(a,"cursor","pointer");return a}return a},doKite:function(){var o=this.result;if(o&&o.response.numFound<2){return}var c=["referrer_title","referrer_content"];var l=this.templates;var k=PopIn3.$F.escaped(this.word);var n="10+";var h=PopIn3.$M.searchUrl(k);var g=[];var b=0;for(var e=0;e<c.length;e++){var a=c[e];for(var d=0;d<l.length;d++){var f=l[d];if(typeof f.func=="undefined"){continue}if(f.func==a){b++;var m={referrer:[]};m.referrer=[{keyword:k,count:n,searchurl:PopIn3.$M.searchUrl(k)}];if(g.length>0){m.referrer[0]["category"]={facetlabel:this.fl,categories:g};if(g.length>5){m.referrer[0]["category"]["more"]="全てのカテゴリを見る +"}}PopIn3.$T.renderKite(m,f)}}}if(b==0){this.createBox()}else{this.addEvent()}},addEvent:function(){var a=document.getElementById("popin_more");var b=document.getElementById("popin_ref_more");if(a&&b){PopIn3.$F.bind(a,"mousedown",function(){this.removeChild(this.firstChild);var c=PopIn3.$F.cssGet(b,"display");if(c=="none"){PopIn3.$F.cssSet(b,"display","inline");this.appendChild(document.createTextNode("カテゴリを隠す"))}else{PopIn3.$F.cssSet(b,"display","none");this.appendChild(document.createTextNode("全てのカテゴリを見る +"))}})}}});new PopIn3.Class("MetaTransformer",{init:function(a){PopIn3.$M.makeConfigurable(this);PopIn3.$F.makeListener(this);this.delay=200;this.linkStyle=this.getParam("keyword_linkStyle","solid 1px #003366");this.fontColor=this.getParam("keyword_fontColor","#003366")},transform:function(a,c){var b=document.createElement("a");b.href=a;b.title="関連記事を検索";b.innerHTML=c;PopIn3.$F.css(b,{"border-bottom":this.linkStyle,color:this.fontColor,"text-decoration":"none"});return b}});new PopIn3.Class("SearchTransformer",{init:function(){this.delay=200;this.config={highlight_color:"transparent",keyword_linkStyle:"solid 1px #003366",keyword_fontColor:"#003366"};PopIn3.$M.overrideConfig(this);PopIn3.$M.makeConfigurable(this)},transform:function(a,c,b){this.template=this.getParam("templates",[]);if(this.template.length!==0){return this.doKite(a,c,b)}else{return this.createBox(a,c,b)}},createBox:function(b,f,e){var d=document.createElement("a");d.href=b;var a=this;d.innerHTML=f;PopIn3.$F.css(d,{background:this.config.highlight_color,"border-bottom":this.config.keyword_linkStyle,color:this.config.keyword_fontColor,"text-decoration":"none"});var a=this;if(typeof e!=undefined&&e!=""){var c=document.createElement("sup");e="10+";c.innerHTML=e+"&nbsp;件";var g=PopIn3.$F.isIE?"0px":"2px";PopIn3.$F.css(c,{color:"white","font-size":"11px",padding:"1px 2px","border-radius":g,postion:"relative","-moz-border-radius":"2px","line-height":1.2,opacity:0.7,"background-color":this.config.keyword_fontColor});d.appendChild(c)}return d},doKite:function(g,a,f){var b="searchtransformer";var j=this.template;var h=null;var c=0;for(var d=0;d<j.length;d++){var e=j[d];if(typeof e.func=="undefined"||e.func!==b){continue}c++;var k={transform:[]};f="10+";k.transform=[{word:a,link:g,count:f}];h=PopIn3.$T.renderSimpleKite(k,e);break}if(c==0){return this.createBox(g,a,f)}return h}});PopIn3.Class("UrlKeyword",{init:function(){this.onFinish=function(){};this.keyword="";this.isLoaded=false},load:function(){this.keyword="";this.req="http://search.popin.cc/urlkeyword/url_keyword?url=";var a=this;var b=this.req+location.href},handleUrl:function(a){if(a&&a.length>0){this.keyword=a[0]}this.onFinish(this.keyword);this.isLoaded=true},getKeyword:function(){return this.keyword}});PopIn3.WhiteTooltipCSS={container:{width:"296px","line-height":"normal","z-index":"10000"},top:{background:"url(http://cdn.popin.cc/referrer/v1/box_n.png) no-repeat 0 0",padding:"9px 5px 0px 12px",cursor:"pointer","background-color":"transparent"},titleDiv:{"text-align":"left","font-size":"14px","font-weight":"bold",color:"#003366","padding-bottom":"5px","margin-right":"5px","background-color":"white"},subtitleDiv:{"text-align":"left","font-size":"13px",color:"black","padding-bottom":"5px"},separator:{background:"url(http://cdn.popin.cc/referrer/v1/box_c.png) repeat-y",height:"1px"},bottom:{background:"url(http://cdn.popin.cc/referrer/v1/box_s.png) no-repeat bottom",padding:"5px 15px 17px 15px"}};new PopIn3.Class("WhiteTooltip",{init:function(b){this.el=b;var a=this;PopIn3.$M.makeConfigurable(this);PopIn3.$F.bind(b,"mouseenter",function(c){a.handleEnterLink(c)});PopIn3.$F.bind(b,"mouseleave",function(c){a.handleLeaveLink(c)})},handleEnterLink:function(b){var a=this;this.createTimeout=setTimeout(function(){var c=a.createDiv();a.div=c;PopIn3.$F.bind(c,"mouseenter",function(d){a.handleEnterElement(d)});PopIn3.$F.bind(c,"mouseleave",function(d){a.handleLeaveElement(d)})},500)},handleLeaveLink:function(b){clearTimeout(this.createTimeout);var a=this;this.removeTimeout=setTimeout(function(){if(a.div){PopIn3.$F.remove(a.div)}},500)},handleEnterElement:function(a){clearTimeout(this.removeTimeout)},handleLeaveElement:function(a){PopIn3.$F.remove(this.div)},createDiv:function(){var b=PopIn3.$F.position(this.el);var a=PopIn3.$F.ce(document.body,"div");PopIn3.$F.css(a,{position:"absolute",top:b.top+25,left:b.left+10});PopIn3.$F.css(a,PopIn3.WhiteTooltipCSS.container);this.templates=this.getParam("templates",[]);if(this.templates.length>0){this.doKite(a)}else{this.createBox(a)}return a},createBox:function(c){var i=PopIn3.$F.ce(c,"div","");var f=PopIn3.$F.ce(c,"div");var a=PopIn3.$F.ce(c,"div");var d=PopIn3.$F.ce(i,"div");var e=PopIn3.$F.ce(i,"div");PopIn3.$F.css(i,PopIn3.WhiteTooltipCSS.top);PopIn3.$F.css(f,PopIn3.WhiteTooltipCSS.separator);PopIn3.$F.css(a,PopIn3.WhiteTooltipCSS.bottom);PopIn3.$F.css(d,PopIn3.WhiteTooltipCSS.titleDiv);PopIn3.$F.css(e,PopIn3.WhiteTooltipCSS.subtitleDiv);var j=!(this.result&&this.result.response&&this.result.response.numFound<=1);var k="";if(j){k="「"+this.word+"」の記事をお探しですか？"}else{k="関連記事を検索してみますか？"}PopIn3.$F.ce(d,"span",k);if(j){var g=this;var b=PopIn3.$M.searchUrl(this.word);PopIn3.$F.bind(c,"click",function(){window.top.location=b});var h=PopIn3.$F.ce(e,"a");h.href=b;h.innerHTML="<b>最新関連記事が&nbsp;10+&nbsp;件</b>";e.appendChild(document.createTextNode(" あります。"));PopIn3.$F.bind(h,"mouseenter",function(){PopIn3.$F.cssSet(this,"color","#aaaaaa")});PopIn3.$F.bind(h,"mouseleave",function(){PopIn3.$F.cssSet(this,"color","#555555")})}},doKite:function(b){var k=!(this.result&&this.result.response&&this.result.response.numFound<=1);if(!k){return}var c=this.word;var l=PopIn3.$M.searchUrl(c);var h="10+";var o=["whitetooltip"];var m=this.templates;var d=0;for(var f=0;f<o.length;f++){var a=o[f];for(var e=0;e<m.length;e++){var g=m[e];if(typeof g.func=="undefined"){continue}if(g.func==a){b.className="popIn_whitetooltips";d++;var n={tooltips:[]};n.tooltips=[{word:c,link:l,count:h}];PopIn3.$T.renderKite(n,g)}}}if(d==0){this.createBox(b)}else{this.addEvent(b)}},addEvent:function(d){var b=PopIn3.$M.searchUrl(this.word);PopIn3.$F.bind(d,"click",function(){window.top.location=b});var a=PopIn3.$F.getElementsByTagName(d,"a");if(a.length>1){var c=a[1];PopIn3.$F.bind(c,"mouseenter",function(){PopIn3.$F.cssSet(this,"color","#aaaaaa")});PopIn3.$F.bind(c,"mouseleave",function(){PopIn3.$F.cssSet(this,"color","#555555")})}}});new PopIn3.Class("CancelListener",{init:function(){var a=this;PopIn3.$F.bind(document.documentElement,"click",function(b){a.handleMouse(b)});PopIn3.$F.makeListener(this)},handleMouse:function(c){var b=c.target||c.srcElement;var a=false;while(b){if(b.id&&typeof b.id=="string"&&b.id.indexOf("popIn")==0){a=true}b=b.parentNode}if(!a){this.fireSelectionEvent(c)}},fireSelectionEvent:function(a){this.fireEvent("cancel",[a])}});new PopIn3.Class("FlashCommunication",{init:function(){var a=this;PopIn3.$F.bind(window,"message",function(b){if(b.origin.indexOf("service.popin.cc")>0){a.handlePostMessage(b.data)}});PopIn3.$F.makeListener(this)},handlePostMessage:function(c){if(typeof c=="string"){c=JSON.parse(c)}var a=c.command;var b=c.value;if(a=="display-object"){this.enablerDisplayObj(b)}},enablerDisplayObj:function(b){var a={serviceUrl:b.src,serviceName:b.title};if(b.type=="iframe"){a.width=PopIn3.$F.getWindowWidth()*0.8;a.height=PopIn3.$F.getWindowHeight()*0.8}else{if(b.type=="image"){a.width=new Number(b.width)+2;a.height=new Number(b.height)+42}else{if(b.type=="video"){a.width=PopIn3.$F.getWindowWidth()*0.8;a.height=PopIn3.$F.getWindowHeight()*0.8}}}this.fireEvent("showService",[a])}});PopIn3.Class("Menu",{init:function(){},getElementToDisplay:function(){var b=document.createElement("div");b.id="popIn_menu"+Math.random();PopIn3.$F.css(b,{width:"136px",position:"absolute",top:this.position.top,left:this.position.left,"z-index":999999});var a=this;PopIn3.$F.bind(b,"mouseenter",function(){a.expand()});PopIn3.$F.bind(b,"mouseleave",function(){a.contract()});this.top=PopIn3.$F.ce(b,"div");this.middle=PopIn3.$F.ce(b,"div");this.middlepad=PopIn3.$F.ce(this.middle,"div");this.bottom=PopIn3.$F.ce(b,"div");PopIn3.$F.css(this.top,PopIn3.Resource.background(136,14,0,0));PopIn3.$F.css(this.top,{"font-size":"0px"});PopIn3.$F.css(this.middle,PopIn3.Resource.background(136,"100%",0,0));PopIn3.$F.css(this.middlepad,{padding:"0px 11px 2px 11px",overflow:"hidden"});PopIn3.$F.css(this.bottom,PopIn3.Resource.backgroundFile(136,16,0,0,"https://i.popincdn.com/media/v1/common/menu_bottom.png"));PopIn3.$F.css(this.bottom,{"font-size":"0px",position:"relative","background-position":"bottom"});this.fillBottom();return b},fillBottom:function(){var b=PopIn3.$F.ce(this.bottom,"div","無効にする");this.options=b;PopIn3.$F.css(b,PopIn3.Resource.background(95,17,-14,0));PopIn3.$F.css(b,{"font-size":"12px","line-height":"17px",cursor:"pointer",bottom:"16px",left:"20px","text-align":"center",color:"#333",position:"absolute",display:"none"});PopIn3.$F.addClass(b,"popInCenter");var a=this;PopIn3.$F.bind(b,"mouseup",function(c){a.handleMenuButtonClick({position:PopIn3.$F.position(b)})})},addMenuItems:function(d){var a=this;this.menuItemElements=[];for(var c=0;c<d.length;c++){var e=d[c];var b=e.createItem();if(c>0){PopIn3.$F.cssSet(b,"display","none")}this.middlepad.appendChild(b);this.menuItemElements.push(b)}},expand:function(){PopIn3.$F.cssSet(this.middlepad,"overflow","hidden");PopIn3.$F.cssSet(this.middlepad,"height",PopIn3.$F.size(this.menuItemElements[0]).height);var d=0;for(var c=0;c<this.menuItemElements.length;c++){var a=this.menuItemElements[c];PopIn3.$F.cssSet(a,"display","block");d+=PopIn3.$F.size(a).height}var b=this.middlepad;PopIn3.UI.animate(b,{height:d},{speed:"fast",end:function(){PopIn3.$F.cssSet(b,"height","auto")}});PopIn3.$F.cssSet(this.bottom,"height",36);PopIn3.$F.cssSet(this.options,"display","block")},contract:function(){var a=this.middlepad;PopIn3.$F.cssSet(a,"height",PopIn3.$F.size(a).height);PopIn3.UI.animate(a,{height:PopIn3.$F.size(this.menuItemElements[0]).height},"fast");PopIn3.$F.cssSet(this.bottom,"height",16);PopIn3.$F.cssSet(this.options,"display","none")},show:function(){var a=this.getElementToDisplay();this.div=a;document.body.appendChild(this.div)},destroy:function(){PopIn3.$F.remove(this.div);this.destroySubMenu()},handleMenuButtonClick:function(d){var g=PopIn3.$F.ce(document.body,"div","この機能を無効にしますか？");this.subMenu=g;var b=PopIn3.$F.ce(g,"button","一時停止");var e=PopIn3.$F.ce(g,"button","永久停止");var c=PopIn3.$F.ce(g,"button","キャンセル");var a=PopIn3.$F.ce(g,"div","✕");var f="0px 0px 10px #000";PopIn3.$F.css(g,{position:"absolute",top:d.position.top,left:d.position.left,width:290,height:80,margin:0,padding:"20px 0px 0px 0px",background:"#444","font-size":"16px",color:"#ffffff","text-align":"center",border:"2px solid #ddd","box-shadow":f,"-webkit-box-shadow":f,"-moz-box-shadow":f,"z-index":999999});PopIn3.$F.css(b,{position:"absolute",left:"10px",bottom:"15px",width:"90px",height:"25px","line-height":"1",padding:"0px","text-align":"center"});PopIn3.$F.css(e,{position:"absolute",left:"100px",bottom:"15px",width:"90px",height:"25px","line-height":"1",padding:"0px","text-align":"center"});PopIn3.$F.css(c,{position:"absolute",right:"10px",bottom:"15px",width:"90px",height:"25px","line-height":"1",padding:"0px","text-align":"center"});PopIn3.$F.css(a,{position:"absolute",right:"0px",top:"0px",padding:"3px 7px 0px 0px","text-align":"center",cursor:"pointer"});PopIn3.$F.bind(b,"mousedown",function(){PopIn3.Cookie.setCookie("popIn_disabled",1,{path:"/"});window.location.reload()});PopIn3.$F.bind(e,"mousedown",function(){PopIn3.Cookie.setCookie("popIn_disabled",1,{expires:365*1000,path:"/"});window.location.reload()});PopIn3.$F.bind(c,"mousedown",PopIn3.$F.pass(this.destroySubMenu,this,[]));PopIn3.$F.bind(a,"mousedown",PopIn3.$F.pass(this.destroySubMenu,this,[]))},destroySubMenu:function(){if(typeof this.subMenu=="undefined"){return}var a=this.subMenu;setTimeout(function(){PopIn3.$F.remove(a)},160)}});PopIn3.Class("MenuComponent",{init:function(){this.config={searchNameIcon:"",searchName:"",custom_services:{}};PopIn3.$M.overrideConfig(this);PopIn3.$F.makeListener(this);PopIn3.$M.makeConfigurable(this)},showMenu:function(a){if(!this.menu){var c=new PopIn3.Menu();this.menu=c;c.position=a.position;c.show();var b=this.buildItems(a);this.addItems(c,b)}},destroyMenu:function(){if(this.menu){this.menu.destroy();this.menu=null}},buildItems:function(l){var b=[];var f=this.config.searchName;var g=this.getParam("searchNameWithWord",false);if(g!==false){f=g.replace(/{query}/,l.word)+f}var j=PopIn3.$M.searchUrl(l.word,{r:"selection"});var k=new PopIn3.IconTitleMenuItem(this.config.searchNameIcon,f);k.eventName="jump";k.eventParams={url:j};b.push(k);var h=this.config.custom_services;for(var d=0;d<h.length;d++){var e=h[d];var a=new PopIn3.IconTitleMenuItem(e.icon,e.name);if(e.popin){var c={title:e.name,url:e.popin.replace("{qstring}",encodeURIComponent(l.word))};a.eventName="window";a.eventParams=PopIn3.$F.join(l,c)}else{if(e.jump){var c={url:e.jump.replace("{qstring}",encodeURIComponent(l.word))};a.eventName="jump";a.eventParams=PopIn3.$F.join(l,c)}}b.push(a)}return b},addItems:function(f,c){var a=this;var e=[];for(var b=0;b<c.length;b++){var d=c[b];d.addEventListener("action",function(g){a.destroyMenu();a.fireEvent(g.eventName,[g])});if(b>0){e.push(new PopIn3.SeparatorMenuItem())}e.push(d)}f.addMenuItems(e)}});new PopIn3.Class("IconTitleMenuItem",{init:function(a,b){this.eventName="action";this.eventParams={};this.icon=a;this.title=b;PopIn3.$F.makeListener(this)},addEvents:function(b){var a=this;PopIn3.$F.bind(b,"click",function(c){var d=PopIn3.$F.join({menuItem:a,eventName:a.eventName},a.eventParams);a.fireEvent("action",[d])})},createItem:function(){var e=document.createElement("div");PopIn3.$F.css(e,{position:"relative","text-align":"left",color:"#FFFFFF","font-size":"13px","line-height":"15px",padding:"4px 0px 4px 0px","font-weight":"normal",cursor:"pointer"});var a=document.createElement("span");var d=document.createElement("span");var b=document.createElement("div");PopIn3.$F.css(b,{"padding-left":"30px",color:"#FFFFFF"});PopIn3.$F.css(a,PopIn3.Resource.background(18,18,-51,0));PopIn3.$F.css(a,{position:"absolute",top:"3px",left:"5px"});PopIn3.$F.css(d,{width:"16px",height:"16px",margin:"1px",display:"inline-block","vertical-align":"top",background:"url("+this.icon+")","background-size":"16px 16px","-moz-background-size":"16px 16px","-webkit-background-size":"16px 16px","-o-background-size":"16px 16px"});if(PopIn3.$F.isIE){var c="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.icon+"', sizingMethod='scale')";PopIn3.$F.css(d,{"-ms-background-size":"16px 16px",filter:c,"-ms-filter":c})}b.innerHTML=this.title;a.appendChild(d);e.appendChild(a);e.appendChild(b);PopIn3.$F.bind(e,"mouseenter",function(){PopIn3.$F.css(this,{"background-color":"#BABABA",color:"#000"});PopIn3.$F.cssSet(b,"color","black")});PopIn3.$F.bind(e,"mouseleave",function(){PopIn3.$F.css(this,{"background-color":"transparent",color:"#FFF"});PopIn3.$F.cssSet(b,"color","white")});this.addEvents(e);return e}});new PopIn3.Class("SeparatorMenuItem",{init:function(){this.separatorStyles={black:{"border-top":"solid 1px #262626","border-bottom":"solid 1px #484848"},blue:{"border-top":"solid 1px #3F4890","border-bottom":"solid 1px #6470c7"},graphite:{"border-top":"solid 1px #384854","border-bottom":"solid 1px #5d707f"},green:{"border-top":"solid 1px #346C35","border-bottom":"solid 1px #589c59"},brown:{"border-top":"solid 1px #4A3939","border-bottom":"solid 1px #745e5e"},emeraldgreen:{"border-top":"solid 1px #2E7B83","border-bottom":"solid 1px #52adb7"},purple:{"border-top":"solid 1px #8A2672","border-bottom":"solid 1px #c04ba4"},purple2:{"border-top":"solid 1px #5C4772","border-bottom":"solid 1px #896fa3"}}},createItem:function(){var a=document.createElement("div");var b=PopIn3.$F.ce(a,"div","");PopIn3.$F.css(b,{"text-align":"left",margin:"1px 0px",height:"0px","font-size":"0px"});PopIn3.$F.css(b,this.separatorStyles[PopIn3.Resource.skin]);return a}});PopIn3.ClassLoad("Select",{init:function(){var c=this;var d=PopIn3.Cookie.getCookie("popIn_disabled");if(d==1){return}if(PopIn3.$F.isIE6){return}if(PopIn3.$F.isIE7){return}if(!window.postMessage){return}PopIn3.$M.makeConfigurable(this);var g=this.getParam("selector_disable",false);if(g){return}this.selectListener=b;var b=new PopIn3.SelectListener();b.minSize=2;b.maxSize=10;b.startListening();b.addEventListener("selection",function(h){c.handleSelection(h)});this.cancelListener=new PopIn3.CancelListener();this.cancelListener.addEventListener("cancel",function(h){c.menuComponent.destroyMenu();c.windowComponent.destroyWindow()});var f=new PopIn3.MenuComponent();this.menuComponent=f;f.addEventListener("window",function(h){c.windowComponent.showWindow(h)});f.addEventListener("jump",function(h){window.open(h.url,"_blank")});var a=new PopIn3.WindowComponent();this.windowComponent=a;var e=new PopIn3.FlashCommunication();e.addEventListener("showService",function(h){c.windowComponent.showWindow({service:h})});PopIn3.$M.flashConnectionId=e.connectionId},handleSelection:function(b){var a=b.getPosition();var c=b.getText();this.menuComponent.showMenu({word:c,position:a,selection:b})}});PopIn3.Class("SelectListener",{init:function(){this.previousSelectionText="";this.minSize=1;this.maxSize=10000;this.mousedownNode=null;PopIn3.$F.makeListener(this);this.mainNode=document.documentElement},startListening:function(){var a=this;PopIn3.$F.bind(this.mainNode,"mousedown",function(b){b=b||window.event;var c=b.target||b.srcElement;a.mousedownNode=c});PopIn3.$F.bind(this.mainNode,"mouseup",function(){a.handleMouseUp()})},handleMouseUp:function(){var c=this.mousedownNode;if(!c){return}while(c!=null){if(c.id&&typeof c.id=="string"&&c.id.indexOf("popIn")==0){return false}if(c.tagName=="INPUT"||c.tagName=="SELECT"||c.tagName=="TEXTAREA"){return false}c=c.parentNode}var b=this.getSelection();var d=b.getText().replace(/(^\s+)|(\s+$)/g,"");if(this.previousSelectionText!=d&&d!=""){if(d.length<=this.maxSize&&d.length>this.minSize||!d.match(/[ぁ-ん]/)){var a=this;setTimeout(function(){a.fireSelectionEvent(b)},1)}}this.previousSelectionText=b.getText()},getSelection:function(){if(PopIn3.$F.isIE){return new PopIn3.SelectionIE()}else{return new PopIn3.SelectionFirefox()}},fireSelectionEvent:function(a){this.fireEvent("selection",[a])}});new PopIn3.Class("SelectionFirefox",{init:function(){this.sel=window.getSelection()},getText:function(){if(this.text){return this.text}this.text=this.sel?this.sel.toString():"";return this.text},deselect:function(){this.sel.removeAllRanges()},_getRange:function(){if(this.range){return this.range}if(this.sel.getRangeAt&&this.sel.rangeCount>0){this.range=this.sel.getRangeAt(0)}else{var a=document.createRange();if(this.sel.anchorNode&&this.sel.anchorOffset){a.setStart(this.sel.anchorNode,this.sel.anchorOffset)}if(this.sel.focusNode&&this.sel.focusOffset){a.setEnd(this.sel.focusNode,this.sel.focusOffset)}this.range=a}return this.range},getPosition:function(){if(this.position){return this.position}var c=document.createDocumentFragment();var e=document.createElement("span");e.id="selectionDami";e.innerHTML="";c.appendChild(e);var b=this._getRange();var a=b.endContainer;var f=b.endOffset;switch(a.nodeType){case 1:a.insertBefore(c,a.childNodes[f]);break;case 3:var d=a.splitText(f);d.parentNode.insertBefore(c,d);break}PopIn3.$F.css(e,{background:"none",display:"inline",border:"none",padding:"0px",margin:"0px"});e.innerHTML="&nbsp;";var g=PopIn3.$F.join(PopIn3.$F.bodyOffset(e),PopIn3.$F.size(e));g.node=e.parentNode.tagName=="A"?e.parentNode.parentNode:e.parentNode;PopIn3.$F.remove(e);this.position=g;return g},insertElementAfter:function(d){var c=document.createDocumentFragment();c.appendChild(d);var b=this._getRange();var a=b.endContainer;var f=b.endOffset;switch(a.nodeType){case 1:a.insertBefore(c,a.childNodes[f]);break;case 3:var e=a.splitText(f);if(a.parentNode.tagName=="A"){e.parentNode.parentNode.appendChild(c)}else{if(e.parentNode.offsetHeight>450){e.parentNode.insertBefore(c,e)}else{e.parentNode.appendChild(c)}}break}}});new PopIn3.Class("SelectionIE",{init:function(){this.selection=document.selection;this.range=this.selection.createRange();this.text=this.range.text},deselect:function(){this.range.setEndPoint("EndToStart",this.range);this.range.select()},getText:function(){return this.text},getPosition:function(){if(typeof this.range!="undefined"){this.range.collapse(false);this.range.pasteHTML('<span id="selectionDami">&nbsp;</span>');var a=document.getElementById("selectionDami")}a.innerHTML="&nbsp;";PopIn3.$F.css(a,{background:"none",display:"inline",border:"none",padding:"0px",margin:"0px"});var b=PopIn3.$F.join(PopIn3.$F.bodyOffset(a),PopIn3.$F.size(a));b.node=a.parentNode;PopIn3.$F.remove(a);return b},insertElementAfter:function(a){if(typeof this.range!="undefined"){this.range.collapse(false);this.range.pasteHTML('<span id="selectionDami">&nbsp;</span>');var b=document.getElementById("selectionDami")}b.id="popInDami"+Math.random();b.innerHTML="&nbsp;";var c=PopIn3.$F.size(b.parentNode);if(c.height>450){b.parentNode.replaceChild(a,b)}else{PopIn3.$F.insertAfter(b.parentNode,a);PopIn3.$F.remove(b)}}});new PopIn3.Class("Window",{TYPE_POPIN:"pi",TYPE_POPUP:"pu",init:function(){this.type=this.TYPE_POPIN;this.width=300;this.height=300;this.draggable=false;this.resizable=false;this.zIndex=10;this.maximizeUrl="";this.initStyles()},slideDown:function(){var a=this.contentDiv;PopIn3.$F.cssSet(a,"display","none");PopIn3.UI.slideDown(this.resizeElement,"medium",function(){PopIn3.$F.cssSet(a,"display","block")})},slideUp:function(a){var b=this.contentDiv;PopIn3.$F.cssSet(b,"display","none");PopIn3.UI.slideUp(this.resizeElement,"fast",a)},initStyles:function(){var a=PopIn3.Resource.background;this.styles={pi_bottom:a("100%",29,0,0),pi_bottom_left:a(14,29,-125,0),pi_bottom_right:a(26,29,-154,0),pi_center_left:a(14,"100%",0,-136),pi_center_right:a(26,"100%",0,-150),pi_top:a("100%",27,-29,0),pi_top_left:a(14,27,-183,0),pi_top_right:a(26,27,-210,0),pu_bottom:a("100%",29,-56,0),pu_bottom_left:a(14,29,-237,0),pu_bottom_right:a(26,29,-266,0),pu_center_left:a(14,"100%",0,-176),pu_center_right:a(26,"100%",0,-190),pu_top:a("100%",27,-85,0),pu_top_left:a(14,27,-295,0),pu_top_right:a(26,27,-322,0),close_btn:a(10,10,-31,0),close_btn_over:a(10,10,-41,0),rainbow_logo:a(99,15,-349,0),rainbow_logo_over:a(99,15,-364,0),open_new:a(10,10,-105,0),open_new_over:a(10,10,-115,0),pi_center:{},pu_center:{}}},getElementToDisplay:function(){var l=PopIn3.$F.tableBuilder(1);var a=PopIn3.$F.ce(l.newCell(),"div");PopIn3.$F.css(a,{position:"relative"});this.div=a;var b=PopIn3.$F.tableBuilder(1);var p=[b.newCell(),b.newCell(),b.newCell()];this.rows=p;var n=b.table;var k={"border-collapse":"collapse","border-spacing":"0"};PopIn3.$F.css(n,{width:this.width,height:this.height,position:"relative"});PopIn3.$F.css(n,k);a.appendChild(n);this.resizeElement=n;this.skinDivs=[];for(var f=0;f<3;f++){var o=PopIn3.$F.tableBuilder(3);PopIn3.$F.css(p[f],{padding:"0",position:"relative"});var m=[o.newCell(),o.newCell(),o.newCell()];for(var e=0;e<3;e++){var d=PopIn3.$F.ce(m[e],"div");PopIn3.$F.cssSet(m[e],"padding","0");this.skinDivs.push(d)}PopIn3.$F.css(o.table,k);p[f].appendChild(o.table)}PopIn3.$F.cssSet(this.skinDivs[4],"background-color","#ededed");this.refreshSkin();var h=PopIn3.$F.ce(a,"div");PopIn3.$F.css(h,{position:"absolute",top:"6px",width:this.width,height:"20px"});var c=PopIn3.$F.ce(a,"div");PopIn3.$F.css(c,{position:"absolute",top:"27px",left:"7px",width:this.width-16,height:this.height-56});var g=PopIn3.$F.ce(a,"div");PopIn3.$F.css(g,{position:"absolute",top:this.height-28,width:this.width,height:"19px"});this.headerDiv=h;this.contentDiv=c;this.footerDiv=g;this.fillContents();return l.table},refreshSkin:function(){var c=[14,this.width-40,26];var e=[27,this.height-56,29];var g=["_top","_center","_bottom"];var d=["_left","","_right"];for(var h=0;h<3;h++){for(var a=0;a<3;a++){var f=this.skinDivs[h*3+a];var b=g[h]+d[a];PopIn3.$F.css(f,this.styles[this.type+b]);PopIn3.$F.css(f,{width:c[a],height:e[h]})}}},fillContents:function(){this.buildHeader(this.headerDiv);this.buildContent(this.contentDiv);this.buildFooter(this.footerDiv)},buildHeader:function(c){var a=this;var b=PopIn3.$F.createShortSum(this.title,40);var e=c.appendChild(document.createElement("div"));e.innerHTML=b;PopIn3.$F.css(e,{"text-align":"center",color:"#444444","font-size":"12px","line-height":"20px",cursor:this.draggable?"move":"auto"});PopIn3.$F.addClass(e,"popInCenter");var d=PopIn3.$F.ce(c,"div","");PopIn3.$F.css(d,{cursor:"pointer",position:"absolute",right:"17px",top:"5px","font-size":"0px"});PopIn3.$F.css(d,this.styles.close_btn);PopIn3.$F.bind(d,"click",function(){a.destroy()});PopIn3.$F.bind(d,"mousedown",function(g){!PopIn3.$F.isIE?g.stopPropagation():g.cancelBubble=true});PopIn3.$F.bind(d,"mouseenter",function(g){PopIn3.$F.css(this,a.styles.close_btn_over)});PopIn3.$F.bind(d,"mouseleave",function(g){PopIn3.$F.css(this,a.styles.close_btn)});if(this.maximizeUrl!=""){var f=PopIn3.$F.ce(c,"div","");PopIn3.$F.css(f,{cursor:"pointer",position:"absolute",right:"37px",top:"5px","font-size":"0px"});PopIn3.$F.css(f,this.styles.open_new);PopIn3.$F.bind(f,"click",function(g){window.location=a.maximizeUrl});PopIn3.$F.bind(f,"mouseenter",function(g){PopIn3.$F.css(this,a.styles.open_new_over)});PopIn3.$F.bind(f,"mouseleave",function(g){PopIn3.$F.css(this,a.styles.open_new)})}},buildContent:function(a){if(typeof this.contentBuilder!="undefined"){this.contentBuilder.build(this,a)}},buildFooter:function(c){var b=this;var d=PopIn3.$F.ce(c,"div");PopIn3.$F.css(d,{height:"19px","text-align":"center","padding-top":"2px",cursor:"pointer"});var a=PopIn3.$F.ce(d,"div");PopIn3.$F.css(a,this.styles.rainbow_logo);PopIn3.$F.css(a,{cursor:"pointer",margin:"0 auto","font-size":"0px"});PopIn3.$F.bind(a,"mouseover",function(){PopIn3.$F.css(this,b.styles.rainbow_logo_over)});PopIn3.$F.bind(a,"mouseleave",function(){PopIn3.$F.css(this,b.styles.rainbow_logo)});PopIn3.$F.bind(a,"click",function(f){b.clickRainbow(f)})},clickRainbow:function(a){window.location.href="http://www.popin.cc"},destroy:function(){}});PopIn3.Class("WindowComponent",{init:function(){this.windows=[];PopIn3.$M.makeConfigurable(this);PopIn3.$F.makeListener(this);this.windowWidth=this.getParam("width",520);this.windowHeight=this.getParam("height",400)},destroyWindow:function(){if(this.windows.length>0){this.windows.pop().destroy()}},showWindow:function(c){var b=new PopIn3.Window();this.windows.push(b);if(typeof c.service!="undefined"){var a=c.service;b.width=a.width;b.height=a.height;b.type=b.TYPE_POPUP;b.title=a.serviceName;b.maximizeUrl=a.serviceUrl;b.contentBuilder=new PopIn3.WindowIframe(a.serviceUrl)}else{b.width=this.windowWidth;b.height=this.windowHeight;b.type=b.TYPE_POPIN;b.title=c.title;b.contentBuilder=new PopIn3.WindowIframe(c.url)}this.appendWindow(b,c)},appendWindow:function(f,d){var e=f.getElementToDisplay();if(typeof d.selection!="undefined"){var a=document.createElement("div");a.appendChild(e);a.id="popIn_windowc"+Math.random();PopIn3.$F.addClass(a,"popIn_window_class");d.selection.insertElementAfter(a);f.slideDown();setTimeout(function(){var l=PopIn3.$F.position(a).top;var j=PopIn3.$F.size(a).height;var m=PopIn3.$F.getWindowHeight();var k=PopIn3.$F.pageScrollTop();if(l+j>m+k){window.scrollTo(0,l+j-m)}},500);f.destroy=function(){f.slideUp(function(){PopIn3.$F.remove(a)})}}if(typeof d.service!="undefined"){var c=PopIn3.$F.ce(document.body,"div");var b=PopIn3.$F.ce(document.body,"div");var i={width:PopIn3.$F.getWindowWidth(),height:PopIn3.$F.getWindowHeight()};c.id="black";PopIn3.$F.css(c,{position:"absolute",top:PopIn3.$F.pageScrollTop(),left:0,opacity:0.5,width:i.width,height:i.height,"z-index":9999,"background-color":"black"});PopIn3.$F.css(b,{position:"absolute","z-index":10000});var g=0;b.appendChild(e);var h=PopIn3.$F.size(e);PopIn3.$F.css(b,{left:(i.width-h.width)/2,top:PopIn3.$F.pageScrollTop()+(i.height-h.height)/2+g});f.destroy=function(){PopIn3.$F.remove(c);PopIn3.$F.remove(b)}}}});new PopIn3.Class("WindowIframe",{init:function(a){this.url=a},build:function(b,c){var a=document.createElement("iframe");a.src=this.prepareUrl();a.frameborder=0;PopIn3.$F.css(a,{width:"100%",height:"100%",border:"0px"});c.appendChild(a)},prepareUrl:function(){var a=this.url;if(a.indexOf("service.popin.cc")>0){a+="&connectionID="+PopIn3.$M.flashConnectionId;a+="&skinColor=skin_black&type=enabler&ads=false";if(typeof window._popIn_amazon_id!="undefined"){a+="&affiliateId="+window._popIn_amazon_id}}return a}});PopIn3.ClassLoad("CheckUrl",{init:function(){PopIn3.$M.makeConfigurable(this);if(this.getParam("check_url_disable",false)){return}this.includeFilter=this.getParam("checkurl_include_filter",this.getParam("include_filter",{}));this.checkUrlUrl=this.getParam("checkurl_url",window.location.href);if(typeof this.includeFilter.url!="undefined"){if(!PopIn3.$F.testOne(this.includeFilter.url,this.checkUrlUrl)){return}}this.canonical={tag:"link",attr:"rel",property:"canonical",urlattr:"href"};try{if(/IE[6-8]/.test(PopIn3.$F.browserType)){return}this.findMainNode()}catch(a){}},findMainNode:function(){var b=this.getParam("main_contentSelector","");if(PopIn3.$F.notEmpty(b)){var a=PopIn3.$F.selector(document.body,b);if(a.length>0){this.checkUrl()}}},checkUrl:function(){if(this.checkProperty(this.canonical)){return}var a=this.checkUrlUrl;if(a.indexOf(".htm")>0){a=a.replace(window.location.search,"")}a=this.changeUrl(a);if(a===""){return}this.processUrl(a)},changeUrl:function(b){var a=this.getParam("checkurl_replace",[]);a=(a.length==0)&&typeof this.getParam("url_replace")!="undefined"?this.getParam("url_replace"):a;if(a.length>0){b=PopIn3.$F.replaceAll(b,a)}return b},checkProperty:function(e){var a=document.getElementsByTagName(e.tag);for(var c=0,g=a.length;c<g;c++){var d=a[c];var f=d.getAttribute(e.attr);if(typeof f!="undefined"&&f==e.property){var b=d.getAttribute(e.urlattr);if(typeof b!="undefined"&&b.length>0){this.processUrl(b);return true}}}return false},processUrl:function(c){var a=this.getParam("checkurl_replace",[]);if(a.length>0){c=PopIn3.$F.replaceAll(c,a)}var g=encodeURIComponent(c);var d=document.createElement("iframe");d.src="https://checkurl.popincdn.com/?url="+g;PopIn3.$F.css(d,{width:1,height:1});document.body.appendChild(d);PopIn3.$F.cssSet(d,"display","none");if(g.indexOf("%253A%252F%252F")>-1){var e=location.protocol+"//rlog.popin.cc/e.gif?";var f=["url="+g,"type=urlcheck","browser="+PopIn3.$F.browserType,"ua="+encodeURIComponent(PopIn3.$F.nua),"t="+new Date().getTime()];e+=f.join("&");var b=new Image();b.src=e;b.width="1";b.height="1";document.body.appendChild(b)}}});PopIn3.ClassLoad("SearchBox",{init:function(){}});new PopIn3.Class("UserId",{init:function(){var a=this;this.uid="";this.loaded=false;PopIn3.$F.makeListener(this);if(typeof window.onmessage!=="undefined"){this.prepare(function(b){if(typeof b!="undefined"&&typeof b.items!="undefined"){a.uid=b.items}a.loaded=true;a.fireEvent("load",[b.items])})}else{this.uid=PopIn3.Cookie.getCookie("uid");this.loaded=true;setTimeout(function(){a.fireEvent("load",[a.uid])},100)}},prepare:function(b){var a=this;PopIn3.$F.bind(window,"message",function(c){if(a.frameWindow==c.source){b({items:c.data})}});this.renderIframe("getuid")},renderIframe:function(b){var a=window.location.protocol+"//api.popin.cc/retarget/uid.html?ac=";var c=document.createElement("iframe");c.name="popIniframe";c.width=1;c.height=1;c.style.display="none";document.body.appendChild(c);c.src=a+b;this.frameWindow=c.contentWindow},isLoaded:function(){return this.loaded},getUserId:function(){return this.uid}});