(function(e,t){if(typeof exports==="object"&&exports){t(exports)}else{var n={};t(n);if(typeof define==="function"&&define.amd){define(n)}else{e.Mustache=n}}})(this,function(e){function a(e,t){return u.call(e,t)}function f(e){return!a(r,e)}function h(e){return typeof e==="function"}function p(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function v(e){return String(e).replace(/[&<>"'\/]/g,function(e){return d[e]})}function m(e){if(!c(e)||e.length!==2){throw new Error("Invalid tags: "+e)}return[new RegExp(p(e[0])+"\\s*"),new RegExp("\\s*"+p(e[1]))]}function g(r,u){function E(){if(v&&!g){while(d.length){delete h[d.pop()]}}else{d=[]}v=false;g=false}u=u||e.tags;r=r||"";if(typeof u==="string"){u=u.split(n)}var a=m(u);var l=new w(r);var c=[];var h=[];var d=[];var v=false;var g=false;var S,x,T,N,C,k;while(!l.eos()){S=l.pos;T=l.scanUntil(a[0]);if(T){for(var L=0,A=T.length;L<A;++L){N=T.charAt(L);if(f(N)){d.push(h.length)}else{g=true}h.push(["text",N,S,S+1]);S+=1;if(N==="\n"){E()}}}if(!l.scan(a[0]))break;v=true;x=l.scan(o)||"name";l.scan(t);if(x==="="){T=l.scanUntil(i);l.scan(i);l.scanUntil(a[1])}else if(x==="{"){T=l.scanUntil(new RegExp("\\s*"+p("}"+u[1])));l.scan(s);l.scanUntil(a[1]);x="&"}else{T=l.scanUntil(a[1])}if(!l.scan(a[1])){throw new Error("Unclosed tag at "+l.pos)}C=[x,T,S,l.pos];h.push(C);if(x==="#"||x==="^"){c.push(C)}else if(x==="/"){k=c.pop();if(!k){throw new Error('Unopened section "'+T+'" at '+S)}if(k[1]!==T){throw new Error('Unclosed section "'+k[1]+'" at '+S)}}else if(x==="name"||x==="{"||x==="&"){g=true}else if(x==="="){a=m(u=T.split(n))}}k=c.pop();if(k){throw new Error('Unclosed section "'+k[1]+'" at '+l.pos)}return b(y(h))}function y(e){var t=[];var n,r;for(var i=0,s=e.length;i<s;++i){n=e[i];if(n){if(n[0]==="text"&&r&&r[0]==="text"){r[1]+=n[1];r[3]=n[3]}else{t.push(n);r=n}}}return t}function b(e){var t=[];var n=t;var r=[];var i,s;for(var o=0,u=e.length;o<u;++o){i=e[o];switch(i[0]){case"#":case"^":n.push(i);r.push(i);n=i[4]=[];break;case"/":s=r.pop();s[5]=i[2];n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}}return t}function w(e){this.string=e;this.tail=e;this.pos=0}function E(e,t){this.view=e==null?{}:e;this.cache={".":this.view};this.parent=t}function S(){this.cache={}}var t=/\s*/;var n=/\s+/;var r=/\S/;var i=/\s*=/;var s=/\s*\}/;var o=/#|\^|\/|>|\{|&|=|!/;var u=RegExp.prototype.test;var l=Object.prototype.toString;var c=Array.isArray||function(e){return l.call(e)==="[object Array]"};var d={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};w.prototype.eos=function(){return this.tail===""};w.prototype.scan=function(e){var t=this.tail.match(e);if(t&&t.index===0){var n=t[0];this.tail=this.tail.substring(n.length);this.pos+=n.length;return n}return""};w.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail;this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t);this.tail=this.tail.substring(t)}this.pos+=n.length;return n};E.prototype.push=function(e){return new E(e,this)};E.prototype.lookup=function(e){var t;if(e in this.cache){t=this.cache[e]}else{var n=this;while(n){if(e.indexOf(".")>0){t=n.view;var r=e.split("."),i=0;while(t!=null&&i<r.length){t=t[r[i++]]}}else{t=n.view[e]}if(t!=null)break;n=n.parent}this.cache[e]=t}if(h(t)){t=t.call(this.view)}return t};S.prototype.clearCache=function(){this.cache={}};S.prototype.parse=function(e,t){if(!(e in this.cache)){this.cache[e]=g(e,t)}return this.cache[e]};S.prototype.render=function(e,t,n){var r=this.parse(e);var i=t instanceof E?t:new E(t);return this.renderTokens(r,i,n,e)};S.prototype.renderTokens=function(t,n,r,i){function u(e){return o.render(e,n,r)}var s="";var o=this;var a,f;for(var l=0,p=t.length;l<p;++l){a=t[l];switch(a[0]){case"#":f=n.lookup(a[1]);if(!f)continue;if(c(f)){for(var d=0,v=f.length;d<v;++d){s+=this.renderTokens(a[4],n.push(f[d]),r,i)}}else if(typeof f==="object"||typeof f==="string"){s+=this.renderTokens(a[4],n.push(f),r,i)}else if(h(f)){if(typeof i!=="string"){throw new Error("Cannot use higher-order sections without the original template")}f=f.call(n.view,i.slice(a[3],a[5]),u);if(f!=null)s+=f}else{s+=this.renderTokens(a[4],n,r,i)}break;case"^":f=n.lookup(a[1]);if(!f||c(f)&&f.length===0){s+=this.renderTokens(a[4],n,r,i)}break;case">":if(!r)continue;f=this.parse(h(r)?r(a[1]):r[a[1]]);if(f!=null)s+=this.renderTokens(f,n,r,i);break;case"&":f=n.lookup(a[1]);if(f!=null)s+=f;break;case"name":f=n.lookup(a[1]);if(f!=null)s+=e.escape(f);break;case"text":s+=a[1];break}}return s};e.name="mustache.js";e.version="0.8.0";e.tags=["{{","}}"];var x=new S;e.clearCache=function(){return x.clearCache()};e.parse=function(e,t){return x.parse(e,t)};e.render=function(e,t,n){return x.render(e,t,n)};e.to_html=function(t,n,r,i){var s=e.render(t,n,r);if(h(i)){i(s)}else{return s}};e.escape=v;e.Scanner=w;e.Context=E;e.Writer=S})